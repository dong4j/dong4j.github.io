<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>HomeLab数据备份：打造坚实的数据安全防线 | 司机带你开车</title><meta name="keywords" content="HomeLab,数据备份,NAS,树莓派,OpenWrt,Synology"><meta name="author" content="dong4j"><meta name="copyright" content="dong4j"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="HomeLab数据备份：打造坚实的数据安全防线"><meta name="application-name" content="HomeLab数据备份：打造坚实的数据安全防线"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="HomeLab数据备份：打造坚实的数据安全防线"><meta property="og:url" content="https://blog.dong4j.site/posts/6c25aa66.html"><meta property="og:site_name" content="司机带你开车"><meta property="og:description" content="本文详细介绍了作者的个人 Homelab 架构，包括硬件设备、网络环境、数据存储方案以及数据备份和恢复策略。文章涵盖了从树莓派到 OpenWrt 的一系列设备的备份方法，以及 Synology NAS 的多种备份功能的应用，如 Snapshot Replication、Hyper Backup 和"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.dong4j.site/source/image/20241229154732_oUxZug2L.webp"><meta property="article:author" content="dong4j"><meta property="article:tag" content="dong4j, Java, Python, Golang, HomeLab, SpringBoot, 架构"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.dong4j.site/source/image/20241229154732_oUxZug2L.webp"><meta name="description" content="本文详细介绍了作者的个人 Homelab 架构，包括硬件设备、网络环境、数据存储方案以及数据备份和恢复策略。文章涵盖了从树莓派到 OpenWrt 的一系列设备的备份方法，以及 Synology NAS 的多种备份功能的应用，如 Snapshot Replication、Hyper Backup 和"><link rel="shortcut icon" href="https://cdn.dong4j.site/source/image/favicon.ico"><link rel="canonical" href="https://blog.dong4j.site/posts/6c25aa66.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//hm.baidu.com"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="codeva-D4HsBP841S"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media=&quot;all&quot;"><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?61a751ac36d18d3ba293fe8ef3ec53eb",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script><script>let GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"与数百名博主无限进步",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"Local",mode:"online",switchBtn:!0,btnLink:"https://github.com/dong4j/blog-summary-assistant-server",randomNum:3,basicWordCount:1999,key:"84yT3Gkl6fp",Referer:"https://blog.dong4j.site:1024",apiUrl:"https://oneapi.dong4j.ink:1024/api/summary",audioUrl:"https://api.dong4j.ink:1024/audio"},diytitle:{enable:!0,leaveTitle:"兄台留步 🙏",backTitle:"兄台,别来无恙 👋"},LA51:{enable:!0,ck:"3Ki5mmyy6E5xtXuf",LingQueMonitorID:"3Ki5mmyy6E5xtXuf"},greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.dong4j.ink:1024",commentBarrageConfig:{enable:!0,maxBarrage:1,barrageTime:4e3,accessToken:"3a358103e6024cfb97546ec8f8408f5a",mailMd5:"3435c7a74ba1cad3f5d57b0b61b9b25cee221b97599c47b32edbdb36038c5411"},music_page_default:"nav_music",root:"/",preloader:{source:"car"},friends_vue_info:{apiurl:"https://friends.dong4j.ink:1024/"},navMusic:!0,mainTone:{mode:"both",api:"https://img2color.dong4j.ink:1024/api?img=",cover_change:!0},authorStatus:{skills:["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","😎 HomeLab 折腾专家","🏃 脚踏实地行动派","🧱 团队小组发动机","👶 尿不湿更换专家"]},algolia:{appId:"JFMEP32WXP",apiKey:"8e3acd038435dda872706ba6777a54b3",indexName:"blog-index",hits:{per_page:10},languages:{input_placeholder:"输入关键词后按下回车查找",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"该内容距离上次更新已经过了",messageNext:"天，文章内容可能已经过时。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!0,post:!0},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: dong4j",link:"链接: ",source:"来源: 司机带你开车",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"mediumZoom",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0,shortcutKey:{enable:!0,delay:100,shiftDelay:200},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"司机带你开车",title:"HomeLab数据备份：打造坚实的数据安全防线",postAI:"本文详细介绍了作者的个人 Homelab 架构，包括硬件设备、网络环境、数据存储方案以及数据备份和恢复策略。文章涵盖了从树莓派到 OpenWrt 的一系列设备的备份方法，以及 Synology NAS 的多种备份功能的应用，如 Snapshot Replication、Hyper Backup 和 Active Backup for Business。此外，还讨论了使用 rsync 进行文件增量备份，以及利用阿里云盘的 WebDAV 服务进行异地备份的策略。文章最后总结了整个 Homelab 架构的备份时间表和备份流程。",pageFillDescription:"数据备份, 树莓派备份, TF 复制, dd 命令, 通过网络复制, 参考, OpenWrt 备份, 自动备份脚本, WebUI 手动备份, eMMC 备份, Linux 备份, M920x 备份, Station, macOS 备份, 系统备份, 使用 ABB 备份, 使用 Time Machine, 重要文件备份, iCloud 数据备份, Synology NAS, Snapshot Replication, Hyper Backup, Active Backup for Business, NAS 整机备份, Windowsx2FmacOS 备份, 物理服务器备份, 文件服务器备份, 虚拟机备份, Synology Drive Client, DSM 系统冗余, DSM 配置备份, NAS 整机备份, Hyper Backup, Active Backup for Business, 还原整个系统, 参考, 冗余备份, macOS 上搭建 Rsync Server, 云端备份, 备份时间整理, macOS, M920x, Station, H28K, HK1Box, NanoPI NEO4, 树莓派, R2S ampamp R5S, NAS 快照, DS218+, DS923+, 数据备份总结, 总结封面来源数据备份备份是必不可少的一部分按照不同的系统架构备份大致有下列几类文件级别的备份直接在应用所属宿主机上运行定时任务增量或者全量将文件复制到其他远程位置可以使用等这类工具进行备份应用级别的备份通过应用完成备份例如等自带的备份功能可以将用户数据和数据库等数据一起备份到远程位置系统级别的备份例如自带的备份树莓派和的全系统备份等自带的系统级备份功能或者其他软件实现的全盘备份比如命名虚拟化备份在有虚拟化的时候整个操作系统等于多个文件所以只需要将此文件备份便能实现整个虚拟机的备份比如的虚拟机文件的虚拟机文件的虚拟机文件等存储卷备份一种完整备份策略会将整个存储卷文件系统作为一个单元进行备份比如磁盘冗余阵列虽然不能算作一种备份方式但是提供了一定程度的数据冗余与可靠性比如我的台都通过组了确保在一块坏了的情况下系统仍然能够运行数据备份这一章我会先从各个服务器开始总结因为最后备份文件都会汇总到上所以会最后说明的备份相关文章先导篇我的概要硬件篇介绍我所拥有的硬件设备网络篇包括网络环境异地组网与网络安全服务篇使用搭建的各类服务数据篇包括数据存储方案备份方案和数据恢复方案数据同步构建高效的数据同步网络数据备份打造坚实的数据安全防线网络续集升级网络再战年内网穿透详解揭秘网络连接背后的奥秘树莓派备份树莓派设备有个复制在系统中一键备份树莓派系统卡的脚本脚本文件来源使用方法下载脚本文件到系统中把需要备份的卡插入系统中用命令查询下卡对应的设备名进入脚本文件所在目录只需要下面两行命令即可完成卡备份最终文件会生成在文件夹下赋可执行权限第一个参数是树莓派卡分区的设备名第二个参数是分区的设备名视情况修改命令使用复制文件到提前使用将挂载到树莓派上使用压缩文件在目录下执行上述方式在树莓派上执行需要提前挂载到本地通过网络复制将远程的备份到本机的此方法同样适用备份出处上述方式都会生成一个文件后续如果要恢复可以使用像这类工具将最新的文件烧录到卡上使用第二种命名备份树莓派卡时需要在每台树莓派上执行且还需要挂载所以我使用另一种方式集中化处理的方式有种方式直接在上通过网络复制卡然后使用减小镜像大小在其他主机上执行使用减小镜像大小后再自动上传到第一种方案的问题是无法直接在上运行为了避免安装的依赖对有影响我的计划是在上执行整个流程最后将压缩后的镜像上传到上所以第一步就是在上安装依赖并下载脚本下面是自动化脚本在上备份树莓派的卡用法检查参数参数赋值树莓派的别名树莓派的卡设备上保留的最大镜像文件数本地备份存放目录脚本路径目标目录时间戳确保本地备份目录存在日志记录函数检查并创建目标目录第一步备份卡到本地第二步压缩镜像文件删除原始未压缩镜像文件第三步上传到删除本地压缩镜像文件第四步清理上多余的备份删除远程的旧备份备份完成并清理清理本地旧日志文件保留最新份添加定时任务需要运行参考再推荐一个备份树莓派系统的脚本树莓派实验室小白教程给你的启动盘做个可恢复快照专版恩山无线论坛树莓派系统备份博客树莓派备份树莓派安装系统和系统备份还原树莓派备份系统镜像红色小小螃蟹的博客博客树莓派备份系统到硬盘树莓派系统备份最小镜像备份树莓派系统镜像一键备份脚本最小化镜像保存次世代池树莓派备份脚本树莓派备份系统到硬盘克隆树莓的卡卡克隆博客教你树莓派的系统备份方法教程大全全卡压缩备份博客园在系统中一键备份树莓派系统卡的脚本在中运行树莓派系统压缩备份应用实操博客树莓派系统镜像一键备份脚本最小化镜像保存次世代池树莓派系统镜像备份及压缩至最小的方法树莓派压缩备份博客上备份复制树莓派镜像个人笔记存档备份设备有个自动备份脚本参数配置本地备份目的地目录例如备份文件前缀例如最大保留备份数量例如远程备份目录检查参数是否足够使用方法备份目的地目录备份文件前缀最大备份数量备份文件路径创建备份备份文件将备份文件复制到指定目的地目录同步到远程服务器删除临时备份文件保留本地备份数量检查并清理本地备份文件删除旧的本地备份保留远程备份数量检查并清理远程备份文件删除远程的旧备份备份完成并清理通知系统备份成功脚本的作用是自动生成备份文件然后通过上传到的目录下而目录后续会被其他套件备份脚本中的是一个别名需要在中配置且配置免密登录然后在系统中添加定时任务每周早上点执行规则需要执行的命令一星期中的第几天其中表示星期日月份一个月中的第几天一天中的第几小时一小时中的第几分钟示例分钟小时月内第几天月份每周第几天表示周日效果每分钟执行一次每五分钟执行一次每过个小时后的第分钟执行一次在月中的号的点分各执行一次工作日期间周到周每天早上点分执行一次每月的第日晚上点执行一次手动备份在修改了配置后及时手动执行备份操作下载后的备份文件我会直接扔到以同步到的目录而此目录最终会被其他套件备份备份设备有个首先需要确认的分区可以确认分区为然后使用下面的命令构建镜像将远程的备份到本机的因为我有多个设备所以写了一个自动化脚本执行脚本目录日志文件路径将所有输出重定向到日志文件自动化备份脚本参数远程主机别名免密登录远程备份的设备路径如本地备份存储路径如备份文件名前缀如最大保留备份数量如检查参数是否完整创建备份目录如果不存在获取当前时间戳本地备份文件路径开始备份检查备份是否成功删除多余的备份文件将上述脚本保存为并赋予执行权限运行脚本要备份的设备的别名需要在配置并在设备端开启免密登录需要备份的设备路径如本地存储备份文件的目录备份文件名前缀如保留的最大备份数量如示例备份到当前目录下添加定时任务每天凌晨点执行如果是在上执行直接使用设置定时任务即可比如备份脚本路径设置任务计划备份主机只包括和个这种相对来说较大的主机其他的比如等衍生的系统不包含在内备份在一节中会使用的物理服务器备份功能备份的系统盘是作为主力机使用所以上面启动了大量的容器以及少量虚拟机这部分数据我打算使用增量备份到另一块上有块独立的定义源目录和目标目录假设配置文件在这里如果不对需要修改定义日志目录增量备份目录不使用避免产生大量日志增量备份目录增量备份配置文件输出完成信息保留最近的个日志文件删除旧日志确认完成此脚本将虚拟机文件以及的配置文件从备份到目录下将上述脚本重命名为并赋予执行权限然后添加到定时任务中必须使用运行每天凌晨点执行除了系统盘备份也会通过备份到上相当于份备份最后一份云端备份由统一处理作为实验室使用目前只有个的固态模型数据和系统是分开的像这些比较容易在网上获取的数据就没有必要备份了所以只需要备份系统盘即可在一节中会使用的物理服务器备份功能备份的系统盘备份设备有台是主力机其他两台放家里当服务器用因为只有的空间且备份速度较慢所以我打算将备份到上而其他台备份到系统备份使用备份我将使用的备份功能备份整个具体方式看备份使用另外两台直接使用备份只需要在上简单配置即可而同样可以作为备份首先打开启用通过进行播送可能对最新的存在兼容性问题所以推荐使用协议接着设置的存储目录最好新建一个专门用于的共享目录并启用索引功能后续可以直接使用搜索启动的文件和内容然后在上配置推荐使用可在特定时间启动中的备份比如可以选择间隔或创建其他类型的计划重要文件备份使用备份数据备份比较重要的就个照片对于前个目录直接在上通过脚本自动备份它会将中的和目录备份到指定的路径并使用格式的日期作为备份文件夹名定义源目录和目标目录这是的目录会自动同步到获取当前日期格式为创建备份文件夹开始备份打印完成信息使用添加定时任务在目录下创建一个文件设置每天凌晨点运行加载配置检查任务状态不用后可以卸载照片我则使用备份到然后再自动同步到其他参考使用为照片生成本地备份之所以先讲其他设备的备份方式是因为它们的备份文件最终都会写入到中最后我只需要对上的文件进行备份即可提供多种备份方式他们的对比如下备份目的地本地共用资料夹可使用可使用不可使用不可使用外接装置可使用不可使用可使用不可使用另一台可使用可使用不可使用不可使用档案伺服器可使用不可使用不可使用仅支援及资料同步公有云可使用不可使用不可使用可使用功能总结应用程式及系统设定备份可使用不可使用不可使用不可使用备份及还原效能低高中中储存空间利用效率中高低低备份频率每小时每分钟共用资料夹每分钟热插拔备份于资料变更时同步透过保护备份资料不可使用仅支援不可变快照不可使用不可使用根据上面的功能总结我计划的备份方案为使用在当前为重要共享目录创建快照作为第一层保护在手残误删文件时能够快速恢复本地备份在上使用将重要的配置与数据备份到同时通过加密备份到云端还原颗粒度可以精确到文件级别不同的存储介质备份在上使用将整个系统备份到同时通过加密备份到云端以便在系统崩溃或损坏时还原不同的存储介质备份在上使用将所有照片和家庭视频通过备份到连接的不同的存储介质备份在上使用将重要的配置与数据备份包括照片和家庭视频通过加密备份到云端云端备份在上使用整机备份不同的存储介质备份在上使用物理服务器备份功能集中备份和整个系统不同的存储介质备份在上使用文件服务器备份功能集中备份所有开发板和小主机的重要文件不同的存储介质备份在上使用外置存储定时备份产生的备份文件不同的存储介质备份其他能够安装的主要设备上使用自带的备份功能备份本机上重要的文件不同的存储介质备份是提供的一项数据备份功能它通过利用文件系统创建时间点副本实现数据的块级保护和快速恢复该功能支持多种复制策略可灵活部署并配备便捷的管理工具帮助我们轻松实现数据的备份和灾难恢复在系统支持文件格式的情况下建议优先考虑使用快照复制作为备份策略这种方式可以将备份周期设置得非常短非常适合处理公共文件夹中同时进行大量编辑的情况当遇到问题例如不慎删除了大量数据或是不知道进行了哪些修改需要恢复文件或整个共享文件夹时你会非常感激不需要按照一天或两天的时间单位来回溯优点是备份周期越短恢复时只需还原单个文件或整个文件夹而且还原速度极快这样的备份方案在紧急情况下能够大大减轻工作压力如果在勾选高级让快照可见的选项后可在文件管理器中查看已保存的快照此目录保存在每个创建了快照的共享目录下且不会被其他群晖备份套件备份同时还具备复制功能选择远程服务器作为复制目的地时比如另一台即可将快照在另一台重现不过我一直卡在循环验证的地方暂时并未使用此功能属于本地备份性能和还原速度都是最优的且快照占用的磁盘空间较小是几个备份套件中功能最全的一个除了整机备份还能单独备份共享目录和配置所以在整机备份的基础上我还是用它来单独备份个别共享目录和全部的配置这样我可以在不需要整机还原的情况下单独恢复部分数据或备份时会一并将对应的共享目录一起备份在上使用此套件将文件备份到并加密备份到阿里云盘相当于有份备份且一份在异地提供了灵活的方法来选择要备份的共享文件夹文件夹和文件可以勾选和取消勾选复选框以选择要备份的内容有种不同的备份选择可供选择是一款功能全面的备份与恢复工具适合需要集中管理多种设备数据的需求目前我正在用它来集中备份多个开发板上的重要文件整机备份以及的整机备份整机备份这个将在整机备份一节中详细介绍这里就不再赘述了备份我目前没有主机根据前面的计划将使用此功能备份可以享受万兆内网的速度另外台将使用备份到需要下载在端主动连接到的备份服务器因为是内网连接可以不用管这个证书问题点击仍然继续即可不过为了避免因为证书到期导致备份失败最好直接使用证书启用后会自动在控制面板安全性证书中添加相应的证书另一个问题是模版匹配连接服务器时因为备份目的地格式不受支持而添加失败其实不是格式不受支持是备份的目的地目录不存在在的修改模版中的目的地默认是但是我们的根本就没有这个共享目录所以出错了也有可能是我以前把这个目录手动删除了更换一个存在且可用的共享目录即可添加成功后的信息服务端信息后续就是根据自己的情况配置任务了物理服务器备份目前支持以下系统连接方式也非常简单下载官方的这个在物理服务器添加设备时会告知下载地址修改模版因为我没有这一步导致连接失败设置模版将共享文件夹修改成存在的共享目录在上安装可查看的操作指南安装完成后使用连接的的用户名对应的密码最后在端可修改备份计划如果是整机还原需要使用恢复媒体创建一个可启动的恢复驱动器如果只是文件还原可使用操作文件服务器备份将开发板连接到集中备份文件服务器备份使用的是且最好使用用户不然某些目录由于权限问题无法备份虚拟机备份只能备份与虚拟机所以上的虚拟机我只能使用脚本备份而中的虚拟机可以通过快照来备份另一种方式是将虚拟机导出到共享目录然后使用其他方式备份虚拟机文件在提供同步功能的同时还具备备份功能所以我将主力机上的重要文件使用它备份到中备份的目的地只能选择当前登录用户的目录系统冗余首先需要了解一下的几种类型类型磁盘数量数据分布冗余能力性能最少磁盘要求条带化无最高偶数镜像完全一般条带化奇偶校验单磁盘故障较高条带化双奇偶校验双磁盘故障较高偶数镜像条带化单磁盘故障每个镜像组高条带化单磁盘故障每个组较高条带化双磁盘故障每个组较高条带化是一种数据分配技术它将数据分割成小块通常称为条带或块并将这些小块分散存储在多个磁盘上这种技术在独立冗余磁盘阵列配置中非常常见尤其是在和等级别中说明速度快但无任何冗余适合不关心数据丢失的高性能场景安全性高写入时需要复制数据磁盘利用率较低提供奇偶校验容忍单个磁盘故障适合平衡性能与冗余需求双重奇偶校验更高安全性适用于关键数据保护兼顾的安全性和的速度适合企业级大型存储系统结合的性能和的冗余参考类型选择类型什么是计算器除了上述这些常见的类型一些硬件和软件厂商还会开发自己的磁盘冗余阵列技术或增强技术其他厂商的磁盘冗余阵列技术或增强技术厂商开发者现属于特点集文件系统和卷管理器于一体提供类似于的多种模式如支持快照数据完整性校验重复数据删除提供动态条带化无需固定条带大小优势高数据完整性基于校验码检测和修复数据损坏灵活性支持在线扩展存储池适用场景家庭如企业存储高可靠性备份厂商开发者特点提供类似于的功能但支持混合硬盘容量自动优化存储利用率允许用户使用不同大小的硬盘组合支持至块硬盘冗余类似或优势易用性面向普通用户无需手动配置复杂的模式灵活性允许随时添加更大容量的硬盘适用场景用户特别是家庭和小型企业存储系统厂商开发者特点与传统不同不做条带化或镜像而是将数据独立存储在每块硬盘上提供一个专用的奇偶校验盘用于数据冗余支持灵活扩展允许随时增加硬盘并使用不同容量的硬盘优势数据独立性即使多块硬盘损坏未损坏的硬盘数据仍可直接读取灵活性无需所有硬盘容量一致适用场景家庭媒体服务器大容量存储需求厂商开发者特点类似于提供双重奇偶校验可允许两块磁盘同时故障而不丢失数据专为的企业级存储系统设计优势更高的容错性专为大型企业的高可用性环境而设计适用场景企业存储系统如服务器厂商开发者特点基于单奇偶校验改进提供双奇偶校验类似专为企业级存储系统和大规模部署优化优势提高容错能力可容忍两块磁盘同时故障集成在的操作系统中支持高效快照和备份适用场景大规模企业存储和虚拟化环境厂商开发者特点软件定义存储将多个服务器的本地存储整合成共享存储池提供分布式数据冗余支持和级别的保护数据跨节点分布支持企业级高可用性优势高可扩展性适合超融合基础架构与环境深度集成适用场景虚拟化和云计算环境厂商开发者特点是提供的超融合基础架构整合计算存储和网络存储采用分布式冗余技术不直接使用传统而是基于对象的存储分布优势高扩展性节点扩展灵活适合云和企业级存储提供企业级容错和冗余适用场景云计算超融合数据中心厂商开发者特点提供类似于的功能如条带化镜像和奇偶校验支持混合硬盘容量允许动态扩展存储池优势集成在系统中部署成本低易于配置适合中小型企业和个人用户适用场景或家庭系统上的存储管理厂商开发者社区驱动开源特点分布式存储系统不依赖传统数据存储在多个节点上提供高可用性和故障恢复能力基于对象存储支持动态扩展优势高扩展性和灵活性无需专用硬件适合大型分布式存储系统适用场景云存储超大规模企业环境厂商开发者特点提供分布式文件系统和并行访问功能数据分布在多个磁盘或节点上提供高可靠性和高性能支持自动故障检测和数据修复优势高性能和高可靠性适合大规模高吞吐量的存储需求适用场景企业数据中心大数据分析高性能计算总结现代厂商开发的磁盘冗余技术大多是对传统的优化提供更强的灵活性扩展性和容错能力这些技术主要服务于以下需求家庭级存储如企业级存储如超融合与分布式存储如因为我的只有个盘位而也只支持块的所以索性将他们全部更换为并组至少能保证坏了一块的情况下系统仍然能够运行配置备份提供的配置备份可以自动备份到你的账户中且可手动导出备份到本地目前在寻找可自动导出备份文件的方法整机备份和都提供了整机备份的功能它们的区别为备份方式不同是作为备份目的地端的套件备份到在端操作是作为备份源为角色的套件备份到在端操作还原方式不同整机还原还原步骤两者都可以部分数据还原直接在远程上操作只能在本机操作数据查看方式不同能够通过查看共享目录下的任何文件无法友好的查看备份的文件目录与内容备份数据格式不同会将系统备份为数据盘和系统个镜像文件只能通过查看内部数据备份的是压缩文件官方推荐的整机备份方式是可以备份上的共享文件夹应用程序设置和系统配置从而确保整机数据与环境一致性以便在系统出现问题需要重装或彻底坏掉后能够恢复到另一台上但是我会同时使用备份全部的共享数据文件以便在数据被误删后能够单独恢复在上创建整机备份任务任务创建成功后可在远端的查看备份任务在上创建整机备份任务需要在上安装备份完成后可通过查看备份的数据还原整个系统对于已完成首次设置的设备单击还原然后选择整个系统您将被重定向到控制面板单击还原系统并选择存储备份数据的还原来源按向导完成还原对于尚未完成首次设置的设备在欢迎页面上单击还原系统选择存储备份数据的还原来源按向导完成还原参考備份多種解決方案比較当你拥有了第二台这是你需要了解的数据迁移和同步方式少数派担心群晖硬盘损坏丢失数据不来试试群晖云盘备份神器使用打通与无缝网盘同步企业应用篇群晖数据安全三猛将同步备份快照新兵備份解決方案概覽冗余备份因为所有的备份文件都会汇总到上所以最后一道保险就是为上的文件创建冗余备份正好有一个的闲置可以直接用作的冗余备份通过连接到了我的具有的速度在上使用套件合适的远程连接有和种尝试了在上分别部署和后最终选择了第一种方式首先需要了解一下基本参数一般做增量同步时直接使用即可参数归档模式传输等于详细模式输出打印速率文件数量等一般默认显示添加后会显示传输时进行压缩以提高效率递归传输目录及子目录即目录下得所有目录都同样传输保持文件时间信息保持文件属主信息保持文件权限保持文件属组信息保留软连接显示同步的过程及传输时的进度等信息保持设备文件信息保留软连接指向的目标文件使用的信道协议指定替代的程序指定排除不需要传输的文件模式文件名所在的目录文件限速传输断点续传让目标目录和源目录数据保持一致当删除某个文件时会同步删除默认是仅传输新增的数据不会删除远端存在但本端不存在的文件开启最高级别的表示显示所有信息为的最高级别基础命令参考资料下和增量备份梳理备份数据的重要性以及的基本使用上搭建二进制文件的配置日志密钥同步日志启动脚本启动脚本配置文件备份的目的地认证的用户认证配置在上配置上面的需要在启动后手动执行脚本启动为了减少手动操作我们可以通过的来管理的自启动在下新增文件工作目录所以上面的使用的是加载确认服务已运行同步日志如果需要卸载服务临时停止并从启动项中移除参考设置开机启动任务实现软件开启自启动云端备份最后就是异地备份了这里直接使用阿里云盘的服务为什么不用利用单向同步的方式备份到云端更适合同步数据会保留原始的文件路径一个任务只能选择一个共享目录没有的压缩备份块级传输多版本管理等高级功能备份到云端支持备份到云端这里我直接使用阿里云盘这个第三方套件然后通过备份到阿里云盘阿里云盘套件使用教程获取到后就可直接使用还能在中通过远程连接挂载阿里云盘到本地可以方便的浏览云盘内容我还会使用阿里云盘配合下载云盘内容工作流为将待下载的文件保存到阿里云盘然后在的连接阿里云盘的服务设置为单向同步云盘内容下载完成后直接在挂载的阿里云盘中删除即可除了第一步后续流程完全不需要登录到官方的阿里云盘操作备份时间整理因为我使用作为备份中枢且台之间存在关联关系所以我需要整理备份的时间以保证备份的正确性与可用性还需要考虑到台路由器的重启计划小米周的定时重启小米周定时重启源文件备份方式目的地时间备份数量系统卷物理服务器备份周启动整个磁盘周启动自动轮转其他重要文件每隔小时启动整个磁盘每周自动轮转整个磁盘每周自动轮转源文件备份方式目的地时间备份数量系统卷物理服务器备份周启动物理服务器备份周启动自动化脚本每天点增量备份其他重要文件文件服务器备份周启动源文件备份方式目的地时间备份数量系统卷物理服务器备份假日启动其他重要文件文件服务器备份假日启动源文件备份方式目的地时间备份数量任务计划备份脚本周启动其他重要文件文件服务器备份周启动源文件备份方式目的地时间备份数量任务计划备份脚本周启动其他重要文件文件服务器备份周启动个第二个往后延长分钟执行源文件备份方式目的地时间备份数量系统任务计划备份脚本周启动其他重要文件文件服务器备份周启动系统任务计划备份脚本周启动其他重要文件文件服务器备份周启动树莓派台树莓派每台间隔分钟执行备份任务源文件备份方式目的地时间备份数量系统卡定时任务通过网络复制脚本周天启动其他重要文件文件服务器备份周天启动系统卡定时任务通过网络复制脚本周天启动其他重要文件文件服务器备份周天启动系统卡定时任务通过网络复制脚本周天启动其他重要文件文件服务器备份周天启动系统卡定时任务通过网络复制脚本周天启动其他重要文件文件服务器备份周天启动源文件备份方式目的地时间备份数量系统卡任务计划备份脚本周启动配置任务计划自动备份脚本手动临时备份本地盘周启动其他重要文件文件服务器备份周启动系统卡任务计划备份脚本周启动配置任务计划自动备份脚本手动临时备份本地盘周启动其他重要文件文件服务器备份周启动系统卡任务计划备份脚本周启动配置任务计划自动备份脚本手动临时备份本地盘周启动其他重要文件文件服务器备份周启动系统卡任务计划备份脚本周启动配置任务计划自动备份脚本手动临时备份本地盘周启动其他重要文件文件服务器备份周启动快照任务名备份时间源地址目的地备份数量每天每天每天每天每天每天周周周天每天每天每天每天每天每天任务名备份套件备份时间备份源目的地备份数量周所有周部分共享目录周整个系统周所有重要数据阿里云盘整机备份无法使用只能是远程或所以只能将和重要数据备份到阿里云盘任务名备份套件备份时间备份源目的地备份数量周天所有周部分共享目录阿里云盘手动备份数据备份总结使用和进行整机备份则用于重要数据数据冗余备份使用文件备份并使用脚本进行整个系统备份使用的物理服务器和文件备份还需要使用脚本在特殊情况下备份开发版使用的文件备份并使用自动化脚本对整个系统备份包括和卡台分别使用快照对重要共享目录进行备份使用备份数据到并使用进行整机备份其他设备的备份文件全部传输到使用备份数据到云盘和外置磁盘这一次算是把所有设备的备份全部梳理了一遍整个备份系搭建下来感觉承担了所有就是不知道它扛不扛得住这就要通过时间去验证这套备份体系了总结至此篇关于的文章算是全部完结了我以为花个一周时间应该可以写个七七八八但是这几篇文章加起来花了接近一个月的时间看来还是太高估自己的能力了原因应该是花了大量时间查阅文档以及进行各种测试如今基于目前的架构应该可以支撑很长一段时间只要我不手残或不添置新的设备所以相关的文章应该到此结束了或许下一篇的开始应该就是另一种架构了比如全套机架了慢慢折腾吧相关文章先导篇我的概要硬件篇介绍我所拥有的硬件设备网络篇包括网络环境异地组网与网络安全服务篇使用搭建的各类服务数据篇包括数据存储方案备份方案和数据恢复方案数据同步构建高效的数据同步网络数据备份打造坚实的数据安全防线网络续集升级网络再战年内网穿透详解揭秘网络连接背后的奥秘",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-04-03 20:08:00",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{var o;0!==a&&(o=Date.now(),localStorage.setItem(e,JSON.stringify({value:t,expiry:o+864e5*a})))},get:e=>{var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!(Date.now()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=(o,c={})=>new Promise((t,e)=>{let a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},Object.keys(c).forEach(e=>{a.setAttribute(e,c[e])}),document.head.appendChild(a)}),e.getCSS=(o,c=!1)=>new Promise((t,e)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,c&&(a.id=c),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};var e=saveToLocal.get("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,o=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!t&&!a&&!o,t=(void 0===e?(a?activateLightMode():t?activateDarkMode():(o||c)&&((a=(new Date).getHours())<=8||22<=a?activateDarkMode:activateLightMode)(),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode:activateLightMode)()})):("light"===e?activateLightMode:activateDarkMode)(),saveToLocal.get("aside-status"));void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://s1.hdslb.com/bfs/static/jinkela/long/font/medium.css"><script src="https://cdn.dong4j.site/source/static/echarts.min.js"></script><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/core.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/footer.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/index-imgloaded.css"><script src="https://cdn.dong4j.site/source/static/index-imgloaded.js"></script><script src="https://cdn.dong4j.site/source/static/detect-devtools.js"></script><script defer="" src="https://cdn.dong4j.site/source/static/umami.self.js" data-host-url="https://umami.dong4j.ink:1024" data-website-id="bd4721b7-a43f-4161-83ed-51c148a7ca9d"></script><script defer="" src="https://cdn.dong4j.site/source/static/counter.js" async="" id="online-counter" interval="60000" api="https://umami.dong4j.ink:1024/counter" room="000000001"></script><script src="https://cdn.dong4j.site/source/static/confetti.browser.min.js"></script><script src="https://cdn.dong4j.site/source/static/confetti.js"></script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="司机带你开车" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="司机带你开车" type="application/rss+xml"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box"><div class="carplay"></div></div><script>let preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout(function(){preloader.endLoading()},2e3),document.getElementById("loading-box").addEventListener("click",()=>{preloader.endLoading()}),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.dong4j.site" title="个人主页"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/homepage.webp" alt="个人主页"><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://blog.dong4j.site" title="博客"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/blog.webp" alt="博客"><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://resume.dong4j.site" title="简历"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/resume.webp" alt="简历"><span class="back-menu-item-text">简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://npx-card.dong4j.site" title="npx-card"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/npx-card.webp" alt="npx-card"><span class="back-menu-item-text">npx-card</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack" title="Watt.Stack"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/watt.webp" alt="Watt.Stack"><span class="back-menu-item-text">Watt.Stack</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit" title="MIK"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/mik.webp" alt="MIK"><span class="back-menu-item-text">MIK</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev" title="macOS.dev"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/mac.webp" alt="macOS.dev"><span class="back-menu-item-text">macOS.dev</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.site/" title="更多"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/project.webp" alt="更多"><span class="back-menu-item-text">更多</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">服务</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services" title="服务状态"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/uptime-kuma.svg" alt="服务状态"><span class="back-menu-item-text">服务状态</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nezha.dong4j.dev" title="服务面板"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/nezha.webp" alt="服务面板"><span class="back-menu-item-text">服务面板</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nav.dong4j.dev" title="导航页"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/nav.webp" alt="导航页"><span class="back-menu-item-text">导航页</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://umami.dong4j.ink:1024/share/V7Rat8DdVw4npjl2/blog.dong4j.site" title="Umami"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/umami.webp" alt="Umami"><span class="back-menu-item-text">Umami</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://muselink.cc/dong4j 👈这是我的MuseLink数字名片！" title="数字名片"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/muse.lin.webp" alt="数字名片"><span class="back-menu-item-text">数字名片</span></a><a class="back-menu-item" href="/ai/deepseek-r1-webgpu/" title="DeepSeek"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/deepseek.webp" alt="DeepSeek"><span class="back-menu-item-text">DeepSeek</span></a><a class="back-menu-item" href="/ai/rmbg/playground/" title="RMBG"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/rmbg.webp" alt="RMBG"><span class="back-menu-item-text">RMBG</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.dong4j.site/" title="Mini-Chat"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/emoji1.webp" alt="Mini-Chat"><span class="back-menu-item-text">Mini-Chat</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">司机带你开车</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa fa-comments faa-tada"></i><span> 最新评论</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size:.9em"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/memos/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 备忘录</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fa-solid fa-map faa-tada"></i><span> 折腾清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/stars/"><i class="fa-brands fa-github faa-tada"></i><span> Star 清单</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.dong4j.dev"><span>小黑屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/wechat-pay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.dong4j.site/source/image/wechat-pay.webp"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.dong4j.site/source/image/alipay.webp"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/checkedexception/" style="font-size:1.05rem;color:#148f76">CheckedException<sup>1</sup></a><a href="/tags/error/" style="font-size:1.05rem;color:#7caa4e">Error<sup>1</sup></a><a href="/tags/exception/" style="font-size:1.05rem;color:#6ca2ab">Exception<sup>1</sup></a><a href="/tags/java/" style="font-size:1.05rem;color:#72966d">Java<sup>48</sup></a><a href="/tags/javabean/" style="font-size:1.05rem;color:#860ac1">JavaBean<sup>1</sup></a><a href="/tags/math/" style="font-size:1.05rem;color:#a75222">Math<sup>1</sup></a><a href="/tags/random/" style="font-size:1.05rem;color:#967478">Random<sup>1</sup></a><a href="/tags/runtimeexception/" style="font-size:1.05rem;color:#94aec3">RuntimeException<sup>1</sup></a><a href="/tags/string/" style="font-size:1.05rem;color:#453533">String<sup>2</sup></a><a href="/tags/stringbuffer/" style="font-size:1.05rem;color:#3f431c">StringBuffer<sup>2</sup></a><a href="/tags/stringbuilder/" style="font-size:1.05rem;color:#a0673c">StringBuilder<sup>1</sup></a><a href="/tags/throwable/" style="font-size:1.05rem;color:#ad4b80">Throwable<sup>1</sup></a><a href="/tags/final/" style="font-size:1.05rem;color:#77b142">final<sup>2</sup></a><a href="/tags/finalize/" style="font-size:1.05rem;color:#9a5c58">finalize<sup>1</sup></a><a href="/tags/finally/" style="font-size:1.05rem;color:#4fad4c">finally<sup>2</sup></a><a href="/tags/getter/" style="font-size:1.05rem;color:#a5c25f">getter<sup>1</sup></a><a href="/tags/new%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:1.05rem;color:#050f6f">new关键字<sup>1</sup></a><a href="/tags/setter/" style="font-size:1.05rem;color:#85a1b8">setter<sup>1</sup></a><a href="/tags/static/" style="font-size:1.05rem;color:#096286">static<sup>1</sup></a><a href="/tags/super/" style="font-size:1.05rem;color:#4f916e">super<sup>2</sup></a><a href="/tags/this/" style="font-size:1.05rem;color:#869dc2">this<sup>1</sup></a><a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size:1.05rem;color:#4d7499">二进制<sup>1</sup></a><a href="/tags/%E5%8C%85%E8%A3%85%E7%B1%BB/" style="font-size:1.05rem;color:#410937">包装类<sup>1</sup></a><a href="/tags/%E5%B0%81%E8%A3%85/" style="font-size:1.05rem;color:#768122">封装<sup>3</sup></a><a href="/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" style="font-size:1.05rem;color:#501f70">异常处理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size:1.05rem;color:#690252">数据类型<sup>4</sup></a><a href="/tags/%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/" style="font-size:1.05rem;color:#a38b10">方法重载<sup>1</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" style="font-size:1.05rem;color:#95a701">构造方法<sup>1</sup></a><a href="/tags/%E6%BA%A2%E5%87%BA/" style="font-size:1.05rem;color:#bf8181">溢出<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:1.05rem;color:#4ec37b">算法<sup>1</sup></a><a href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" style="font-size:1.05rem;color:#34c54f">类型转换<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" style="font-size:1.05rem;color:#74835a">线程安全<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" style="font-size:1.05rem;color:#702108">编程实践<sup>2</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F/" style="font-size:1.05rem;color:#3d022e">计算机程序<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/" style="font-size:1.05rem;color:#4c85aa">计算机语言<sup>1</sup></a><a href="/tags/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" style="font-size:1.05rem;color:#23b3be">访问控制<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size:1.05rem;color:#95198d">软件<sup>1</sup></a><a href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" style="font-size:1.05rem;color:#92b58f">错误处理<sup>2</sup></a><a href="/tags/%E9%9A%8F%E6%9C%BA%E6%95%B0/" style="font-size:1.05rem;color:#34929b">随机数<sup>1</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size:1.05rem;color:#53ab26">面向对象<sup>6</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"> <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/homelab-%E4%B8%AD%E5%B9%B4%E7%94%B7%E4%BA%BA%E7%9A%84%E5%BF%AB%E4%B9%90%E6%BA%90%E6%B3%89/" itemprop="url">HomeLab:中年男人的快乐源泉</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/homelab/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>HomeLab</span></a><a class="article-meta__tags" href="/tags/nas/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>NAS</span></a><a class="article-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>数据备份</span></a><a class="article-meta__tags" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>树莓派</span></a><a class="article-meta__tags" href="/tags/openwrt/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>OpenWrt</span></a><a class="article-meta__tags" href="/tags/synology/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Synology</span></a></span></div></div><h1 class="post-title" itemprop="name headline">HomeLab数据备份：打造坚实的数据安全防线</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2020-04-24T16:00:00.000Z" title="发表于 2020-04-25 00:00:00">2020-04-25</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-03T12:08:00.708Z" title="更新于 2025-04-03 20:08:00">2025-04-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">14.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>56分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="HomeLab数据备份：打造坚实的数据安全防线"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/6c25aa66.html#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.dong4j.site/source/image/20241229154732_oUxZug2L.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="fa-regular fa-robot fa-fade"></i><div class="ai-title-text">摘要助手</div><div id="ai-Toggle">切换</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">SummaryGPT</div></div><div class="ai-explanation">AI 初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成摘要 👋</div><div class="ai-btn-item">推荐文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item">前往订阅 💥</div><div class="ai-btn-item" id="go-comment">前往评论 💬</div><div class="ai-btn-item" id="read-audio">Kokoro TTS 🎙️</div><div class="ai-btn-item" id="go-tianli-blog">👀 部署教程</div></div><script data-pjax="" src="https://cdn.dong4j.site/source/static/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope="" itemtype="https://blog.dong4j.site/posts/6c25aa66.html"><header><a class="post-meta-categories" href="/categories/homelab-%E4%B8%AD%E5%B9%B4%E7%94%B7%E4%BA%BA%E7%9A%84%E5%BF%AB%E4%B9%90%E6%BA%90%E6%B3%89/" itemprop="url">HomeLab:中年男人的快乐源泉</a><a href="/tags/homelab/" tabindex="-1" itemprop="url">HomeLab</a><a href="/tags/nas/" tabindex="-1" itemprop="url">NAS</a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/" tabindex="-1" itemprop="url">数据备份</a><a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/" tabindex="-1" itemprop="url">树莓派</a><a href="/tags/openwrt/" tabindex="-1" itemprop="url">OpenWrt</a><a href="/tags/synology/" tabindex="-1" itemprop="url">Synology</a><h1 id="CrawlerTitle" itemprop="name headline">HomeLab数据备份：打造坚实的数据安全防线</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">dong4j</span><time itemprop="dateCreated datePublished" datetime="2020-04-24T16:00:00.000Z" title="发表于 2020-04-25 00:00:00">2020-04-25</time><time itemprop="dateCreated datePublished" datetime="2025-04-03T12:08:00.708Z" title="更新于 2025-04-03 20:08:00">2025-04-03</time></header><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_oUxZug2L.webp" alt="/images/cover/20241229154732_oUxZug2L.webp"><br><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly91bnNwbGFzaC5jb20vcGhvdG9zL3Bob3RvLW9mLWNvbXB1dGVyLWNhYmxlcy1vWlB3bjQwekNLNA==">封面来源: Unsplash-Kvistholt Photography</a></p><h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><p>备份是 <strong>Homelab</strong> 必不可少的一部分，按照不同的系统架构，备份大致有下列几类：</p><ul><li>文件级别的备份：直接在应用所属宿主机上运行定时任务，增量或者全量将文件复制到其他远程位置，可以使用 <strong>Synologo Drive</strong>, <strong>Rsync</strong>, <strong>Rclone</strong>, <strong>Restic</strong> 等这类工具进行备份;</li><li>应用级别的备份：通过应用完成备份，例如 Gitlab, Portainer, 1Panle, Home Assistant 等自带的备份功能，可以将用户数据和数据库等数据一起备份到远程位置，</li><li>系统级别的备份：例如 macOS 自带的备份（Time Machine），树莓派和 OpenWrt 的全系统备份, OpenWrt, DSM 等自带的系统级备份功能, 或者其他软件实现的全盘备份(比如 rsync + dd 命名)。</li><li>虚拟化备份：在有虚拟化的时候，整个操作系统等于多个文件，所以只需要将此文件备份便能实现整个虚拟机的备份，比如 <strong>Parallels Desktop</strong> 的 <strong>*.pvm</strong> 虚拟机文件, UTM 的 <strong>*.utm</strong> 虚拟机文件, KVM 的虚拟机文件等;</li><li>存储卷备份: 一种 <strong>完整备份策略</strong>，会将整个存储卷（文件系统）作为一个单元进行备份, 比如 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuc3lub2xvZ3kuY24vemgtY24vZHNtL2ZlYXR1cmUvc25hcHNob3RfcmVwbGljYXRpb24="><strong>Synology Snapshot Replication</strong></a>;</li><li>RAID (磁盘冗余阵列)：虽然 RAID 不能算作一种备份方式, 但是提供了一定程度的数据冗余与可靠性, 比如我的 2 台 NAS 都通过 SSD 组了 RAID1, 确保在一块 SSD 坏了的情况下系统仍然能够运行.</li></ul><blockquote><p>数据备份这一章我会先从各个服务器开始总结, 因为最后备份文件都会汇总到 DS923+ 上, 所以会最后说明 Synology NAS 的备份.</p></blockquote><p><strong>相关文章:</strong></p><ol><li><a href="/posts/15433dee.html">先导篇</a>：我的 HomeLab 概要;</li><li><a href="/posts/1c3b04a.html">硬件篇</a>：介绍我所拥有的硬件设备;</li><li><a href="/posts/e537d446.html">网络篇</a>：包括网络环境、异地组网与网络安全;</li><li><a href="/posts/b2341239.html">服务篇</a>：使用 Docker 搭建的各类服务;</li><li><a href="/posts/b808f350.html">数据篇</a>：包括数据存储方案、备份方案和数据恢复方案;</li><li><a href="/posts/273b6766.html">HomeLab数据同步：构建高效的数据同步网络</a></li><li><a href="/posts/6c25aa66.html">HomeLab数据备份：打造坚实的数据安全防线</a></li><li><a href="/posts/7e09e56.html">HomeLab 网络续集：升级 10G 网络-再战 10 年</a></li><li><a href="/posts/15433dee.html">NAT 内网穿透详解：揭秘网络连接背后的奥秘</a></li></ol><hr><h3 id="树莓派备份"><a href="#树莓派备份" class="headerlink" title="树莓派备份"></a>树莓派备份</h3><p>树莓派设备有 4 个:</p><ul><li>Raspberry Pi Zero 2 W</li><li>Raspberry Pi 4B</li><li>Raspberry Pi 5B * 2</li></ul><h4 id="TF-复制"><a href="#TF-复制" class="headerlink" title="TF 复制"></a>TF 复制</h4><p>在 Linux 系统中一键备份树莓派系统 SD 卡的脚本 脚本文件来源: <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3Fpbmd0aWFuMTExMTIvYXJ0aWNsZS9kZXRhaWxzLzk5ODI1MjU3">https://blog.csdn.net/qingtian11112/article/details/99825257</a></p><p><strong>使用方法：</strong></p><p>step1：下载脚本文件 <code>rpi-backup.sh</code> 到 Linux 系统中<br>step2：把需要备份的 SD 卡插入 Linux 系统中，用 df -h 命令查询下 SD 卡对应的设备名。<br>step3：进入脚本文件 <code>rpi-backup.sh</code> 所在目录，只需要下面两行命令即可完成 SD 卡备份，最终 img 文件会生成在 <code>~/backupimg/</code> 文件夹下:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 赋可执行权限</span></span><br><span class="line">sudo <span class="built_in">chmod</span> +x rpi-backup.sh</span><br><span class="line"><span class="comment"># 第一个参数是树莓派 SD 卡 /boot 分区的设备名，第二个参数是 / 分区的设备名, 视情况修改</span></span><br><span class="line">./rpi-backup.sh /dev/sdb1 /dev/sdb2</span><br></pre></td></tr></tbody></table></figure><h4 id="dd-命令"><a href="#dd-命令" class="headerlink" title="dd 命令"></a>dd 命令</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.使用 dd 复制文件到 NAS(提前使用 NFS 将 NAS 挂载到树莓派上)</span></span><br><span class="line">sudo <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/mmcblk0 of=/mnt/ds923/remote/PI4/20240730.img bs=1MB status=progress</span><br><span class="line"><span class="comment"># 2.使用 PiShrink.sh 压缩文件 (在 /mnt/lankxin.u/Developer 目录下执行)</span></span><br><span class="line">sudo ./pishrink.sh /mnt/ds923/remote/PI4/20240816.img /mnt/ds923/remote/PI4/20240816-lite.img</span><br></pre></td></tr></tbody></table></figure><blockquote><p>上述方式在树莓派上执行, 需要提前挂载 NAS 到本地.</p></blockquote><h4 id="通过网络复制"><a href="#通过网络复制" class="headerlink" title="通过网络复制"></a>通过网络复制</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 远程的 /dev/mmcblk1 备份到 本机的 backup_image.img</span></span><br><span class="line">ssh root@&lt;ip_board_to_be_backup&gt; <span class="string">"dd if=/dev/mmcblk1"</span> | <span class="built_in">dd</span> of=backup_image.img bs=1M status=progress</span><br></pre></td></tr></tbody></table></figure><blockquote><p>此方法同样适用 eMMC 备份, 出处: <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9mb3J1bS5hcm1iaWFuLmNvbS90b3BpYy8xMTQwNC1ob3ctdG8tY2xvbmUtZW1tYy1uYW5vcGktbmVvLWNvcmUv"><strong>HOW TO CLONE EMMC (NANOPI NEO CORE)</strong></a>.</p></blockquote><p>上述方式都会生成一个 img 文件, 后续如果要恢复, 可以使用像 <strong>balenaEtcher</strong> 这类工具将最新的 img 文件烧录到 SD 卡上.</p><hr><p>使用第二种 <strong>dd 命名</strong> 备份树莓派 SD 卡时, 需要在每台树莓派上执行, 且还需要挂载 NAS, 所以我使用另一种方式集中化处理的方式.</p><p>有 2 种方式:</p><ol><li>直接在 NAS 上通过网络复制 SD 卡, 然后使用 <strong>pishrink.sh</strong> 减小镜像大小;</li><li>在其他主机上执行, 使用 <strong>pishrink.sh</strong> 减小镜像大小后再自动上传到 DS923+;</li></ol><p>第一种方案的问题是 <strong>pishrink.sh</strong> 无法直接在 DS923+ 上运行, 为了避免安装 <strong>pishrink.sh</strong> 的依赖对 NAS 有影响, 我的计划是在 M920x 上执行整个流程, 最后将压缩后的镜像上传到 DS923+ 上.</p><p>所以第一步就是在 M920x 上安装依赖并下载脚本:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install -y wget parted gzip pigz xz-utils udev e2fsprogs</span><br><span class="line">wget https://raw.githubusercontent.com/Drewsif/PiShrink/master/pishrink.sh</span><br><span class="line"><span class="built_in">chmod</span> +x pishrink.sh</span><br></pre></td></tr></tbody></table></figure><p>下面是自动化脚本:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 m920x 上备份树莓派的 SD 卡</span></span><br><span class="line"><span class="comment"># 用法:</span></span><br><span class="line"><span class="comment"># ./backup_sd.sh pi4 /dev/mmcblk1 3</span></span><br><span class="line"><span class="comment"># ./backup_sd.sh zero2w /dev/mmcblk1 3</span></span><br><span class="line"><span class="comment"># ./backup_sd.sh pi51 /dev/mmcblk1 3</span></span><br><span class="line"><span class="comment"># ./backup_sd.sh pi52 /dev/mmcblk1 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查参数</span></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$#</span> -lt 3 ]]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &lt;REMOTE_SD&gt; &lt;REMOTE_DEVICE&gt; &lt;MAX_BACKUPS&gt;"</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Example: <span class="variable">$0</span> raspberrypi /dev/mmcblk1 3"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数赋值</span></span><br><span class="line">REMOTE_SD=<span class="string">"<span class="variable">$1</span>"</span>                                  <span class="comment"># 树莓派的 SSH 别名</span></span><br><span class="line">REMOTE_DEVICE=<span class="string">"<span class="variable">$2</span>"</span>                              <span class="comment"># 树莓派的 SD 卡设备</span></span><br><span class="line">MAX_BACKUPS=<span class="string">"<span class="variable">$3</span>"</span>                                <span class="comment"># NAS 上保留的最大镜像文件数</span></span><br><span class="line">LOCAL_DIR=<span class="string">"/mnt/2.870.ssd/pi.backup"</span>            <span class="comment"># 本地备份存放目录</span></span><br><span class="line">PISHRINK_PATH=<span class="string">"<span class="variable">${LOCAL_DIR}</span>/pishrink.sh"</span>        <span class="comment"># pishrink.sh 脚本路径</span></span><br><span class="line">NAS_TARGET=<span class="string">"/volume4/backups/SD/<span class="variable">${REMOTE_SD}</span>"</span>   <span class="comment"># NAS 目标目录</span></span><br><span class="line">TIMESTAMP=$(<span class="built_in">date</span> <span class="string">"+%Y%m%d%H%M%S"</span>)               <span class="comment"># 时间戳</span></span><br><span class="line">LOCAL_IMAGE=<span class="string">"<span class="variable">$LOCAL_DIR</span>/temp_image_<span class="variable">${REMOTE_SD}</span>_<span class="variable">$TIMESTAMP</span>.img"</span></span><br><span class="line">LOCAL_IMAGE_LITE=<span class="string">"<span class="variable">$LOCAL_DIR</span>/<span class="variable">${REMOTE_SD}</span>_lite_<span class="variable">$TIMESTAMP</span>.img"</span></span><br><span class="line">LOG_FILE=<span class="string">"<span class="variable">$LOCAL_DIR</span>/backup_<span class="variable">${REMOTE_SD}</span>_<span class="variable">${TIMESTAMP}</span>.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保本地备份目录存在</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">"<span class="variable">$LOCAL_DIR</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志记录函数</span></span><br><span class="line"><span class="function"><span class="title">log_message</span></span>() {</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"[<span class="subst">$(date '+%Y-%m-%d %H:%M:%S')</span>] <span class="variable">$1</span>"</span> | <span class="built_in">tee</span> -a <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查并创建 NAS 目标目录</span></span><br><span class="line">log_message <span class="string">"Checking and creating NAS target directory if it doesn't exist..."</span></span><br><span class="line">ssh ds923 <span class="string">"mkdir -p <span class="variable">$NAS_TARGET</span>"</span></span><br><span class="line"><span class="keyword">if</span> [[ $? -ne 0 ]]; <span class="keyword">then</span></span><br><span class="line">  log_message <span class="string">"Error creating NAS target directory. Exiting."</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">log_message <span class="string">"NAS target directory is ready: <span class="variable">$NAS_TARGET</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步：备份 SD 卡到本地</span></span><br><span class="line">log_message <span class="string">"Starting SD card backup from <span class="variable">$REMOTE_SD</span>..."</span></span><br><span class="line">ssh <span class="variable">$REMOTE_SD</span> <span class="string">"dd if=<span class="variable">$REMOTE_DEVICE</span>"</span> | <span class="built_in">dd</span> of=<span class="variable">$LOCAL_IMAGE</span> bs=1M status=progress 2&gt;&gt;<span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line"><span class="keyword">if</span> [[ $? -ne 0 ]]; <span class="keyword">then</span></span><br><span class="line">  log_message <span class="string">"Error during SD card backup. Exiting."</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">log_message <span class="string">"SD card backup completed: <span class="variable">$LOCAL_IMAGE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步：压缩镜像文件</span></span><br><span class="line">log_message <span class="string">"Compressing the backup image using pishrink..."</span></span><br><span class="line"><span class="variable">$PISHRINK_PATH</span> <span class="variable">$LOCAL_IMAGE</span> <span class="variable">$LOCAL_IMAGE_LITE</span> &gt;&gt;<span class="string">"<span class="variable">$LOG_FILE</span>"</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [[ $? -ne 0 ]]; <span class="keyword">then</span></span><br><span class="line">  log_message <span class="string">"Error during image compression. Exiting."</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">log_message <span class="string">"Compression completed: <span class="variable">$LOCAL_IMAGE_LITE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除原始未压缩镜像文件</span></span><br><span class="line"><span class="built_in">rm</span> -f <span class="string">"<span class="variable">$LOCAL_IMAGE</span>"</span></span><br><span class="line">log_message <span class="string">"Deleted uncompressed backup image: <span class="variable">$LOCAL_IMAGE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三步：上传到 NAS</span></span><br><span class="line">log_message <span class="string">"Uploading compressed image to NAS..."</span></span><br><span class="line">rsync -azvP <span class="variable">$LOCAL_IMAGE_LITE</span> ds923:<span class="variable">$NAS_TARGET</span> &gt;&gt;<span class="string">"<span class="variable">$LOG_FILE</span>"</span> 2&gt;&amp;1</span><br><span class="line"><span class="keyword">if</span> [[ $? -ne 0 ]]; <span class="keyword">then</span></span><br><span class="line">  log_message <span class="string">"Error during upload to NAS. Exiting."</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">log_message <span class="string">"Upload completed: <span class="variable">$LOCAL_IMAGE_LITE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除本地压缩镜像文件</span></span><br><span class="line"><span class="built_in">rm</span> -f <span class="string">"<span class="variable">$LOCAL_IMAGE_LITE</span>"</span></span><br><span class="line">log_message <span class="string">"Deleted local compressed backup image: <span class="variable">$LOCAL_IMAGE_LITE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第四步：清理 NAS 上多余的备份</span></span><br><span class="line">ssh ds923 <span class="string">"</span></span><br><span class="line"><span class="string">  find <span class="variable">${NAS_TARGET}</span> -type f -name '*.img' | sort -r | tail -n +<span class="subst">$((MAX_BACKUPS + 1)</span>) | while read -r file; do</span></span><br><span class="line"><span class="string">    echo \"删除远程的旧备份: \$file\"</span></span><br><span class="line"><span class="string">    rm -f \"\$file\"</span></span><br><span class="line"><span class="string">  done</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"备份完成并清理。"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理本地旧日志文件，保留最新 5 份</span></span><br><span class="line">log_message <span class="string">"Cleaning up old local logs..."</span></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$LOCAL_DIR</span>"</span> &amp;&amp; <span class="built_in">ls</span> -t backup_<span class="variable">${REMOTE_SD}</span>_*.<span class="built_in">log</span> | <span class="built_in">tail</span> -n +6 | xargs -r <span class="built_in">rm</span> -f</span><br><span class="line"><span class="keyword">if</span> [[ $? -ne 0 ]]; <span class="keyword">then</span></span><br><span class="line">  log_message <span class="string">"Error during log cleanup."</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">log_message <span class="string">"Log cleanup completed. Retained latest 5 logs for <span class="variable">$REMOTE_SD</span>."</span></span><br><span class="line"></span><br><span class="line">log_message <span class="string">"Backup process finished successfully!"</span></span><br></pre></td></tr></tbody></table></figure><p><strong>添加定时任务</strong>:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pishrink.sh 需要 root 运行</span></span><br><span class="line">sudo crontab -e</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 10 * * 7 /mnt/2.870.ssd/pi.backup/backup.sd.sh pi4 /dev/mmcblk0 3</span><br><span class="line">30 10 * * 7 /mnt/2.870.ssd/pi.backup/backup.sd.sh pi51 /dev/mmcblk0 3</span><br><span class="line">0 11 * * 7 /mnt/2.870.ssd/pi.backup/backup.sd.sh pi52 /dev/mmcblk0 3</span><br><span class="line">30 11 * * 7 /mnt/2.870.ssd/pi.backup/backup.sd.sh zero2w /dev/mmcblk0 3</span><br></pre></td></tr></tbody></table></figure><hr><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zaHVtZWlwYWkubnhlei5jb20vMjAyMC8xMC8yOC9iYWNrdXAtdGhlLXJhc3BiZXJyeS1waS1zeXN0ZW0tYXMtYW4taW1nLWZpbGUuaHRtbA==">再推荐一个备份树莓派系统的脚本 | 树莓派实验室</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cucmlnaHQuY29tLmNuL2ZvcnVtL3RocmVhZC00MDU2MzEzLTEtMS5odG1s">【小白教程】给你的 openwrt 启动盘做个可恢复“快照”。-OPENWRT 专版-恩山无线论坛 - Powered by Discuz!</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLjUxY3RvLmNvbS93YW5namljaHVhbi81NjkxMjIz">树莓派系统备份_51CTO 博客_树莓派备份</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lhbmdjdW5iaWFvL2FydGljbGUvZGV0YWlscy8xMjMwNzkxMDM=">树莓派安装系统和系统备份还原_树莓派备份系统镜像_红色小小螃蟹的博客-CSDN 博客</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hbGxhbmhhby5jb20vMjAyMi8wOS8xOC8yMDIyLTA5LTE4LXJwaS1iYWNrdXAv">树莓派备份系统到硬盘 | AllanHao</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL25hbmhhbnRpYW55aS9ycGktYmFja3Vw">GitHub - nanhantianyi/rpi-backup: raspberry pi backup，树莓派系统备份，最小镜像备份</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9uZXVjcmFjay5jb20vcC8xMDc=">树莓派系统镜像一键备份脚本, 最小化镜像保存-次世代 BUG 池</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL21naGNvb2wvUmFzcGJlcnJ5LWJhY2t1cA==">GitHub - mghcool/Raspberry-backup: 树莓派备份脚本</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hbGxhbmhhby5jb20vMjAyMi8wOS8xOC8yMDIyLTA5LTE4LXJwaS1iYWNrdXAv">树莓派备份系统到硬盘 | AllanHao</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podW9xaW5nam9raW5nOTcyOTgvYXJ0aWNsZS9kZXRhaWxzLzExNDg3NTE3Nw==">克隆树莓 Raspberry Pi Mode4 的 TF 卡_tf 卡克隆-CSDN 博客</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYm9uZ2VtL3AvMTIzMTI4NzguaHRtbA==">教你树莓派 4B 的系统备份方法教程大全（全卡+压缩备份） - bongem - 博客园</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL0JpZ0J1YmJsZUd1bS9SYXNwYmVycnlCYWNrdXA=">GitHub - BigBubbleGum/RaspberryBackup: 在 Linux 系统中一键备份树莓派系统 SD 卡的脚本</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL0RyZXdzaWYvUGlTaHJpbms=">PiShrink</a> &amp;&amp; <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL0RyZXdzaWYvUGlTaHJpbmsvaXNzdWVzP3E9bWFjb3M=">在 macOS 中运行</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L20wXzM3NzI4Njc2L2FydGljbGUvZGV0YWlscy8xMDg1ODE0ODg=">树莓派系统压缩备份——PiShrink 应用实操-CSDN 博客</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9uZXVjcmFjay5jb20vcC8xMDc=">树莓派系统镜像一键备份脚本, 最小化镜像保存-次世代 BUG 池</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTM3MzU2ODgvYXJ0aWNsZS9kZXRhaWxzLzEyMTEzMDU4Mw==">树莓派系统镜像备份及压缩至最小的方法_树莓派压缩备份-CSDN 博客</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2VsZXNwZWMvcnBpLWJhY2t1cD90YWI9cmVhZG1lLW92LWZpbGU=">GitHub - elespec/rpi-backup: RaspberryPi Backup shell</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuemhhbmdqYy50ZWNoL2JhY2t1cF9vcl9jb3B5X3Jhc3BiZXJyeXBpX2ltYWdlX29uX21hYy8=">MAC 上备份（复制）树莓派镜像 | 个人笔记存档</a></li></ul><hr><h3 id="OpenWrt-备份"><a href="#OpenWrt-备份" class="headerlink" title="OpenWrt 备份"></a>OpenWrt 备份</h3><p>OpenWrt 设备有 4 个:</p><ul><li>R2S * 3</li><li>R5S</li></ul><h4 id="自动备份脚本"><a href="#自动备份脚本" class="headerlink" title="自动备份脚本"></a>自动备份脚本</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数配置</span></span><br><span class="line">DEST_DIR=<span class="variable">$1</span>      <span class="comment"># 本地备份目的地目录（例如: /mnt/lankxin.u/backup）</span></span><br><span class="line">BACKUP_PREFIX=<span class="variable">$2</span> <span class="comment"># 备份文件前缀（例如: backup-r2s2）</span></span><br><span class="line">MAX_BACKUPS=<span class="variable">$3</span>   <span class="comment"># 最大保留备份数量（例如: 5）</span></span><br><span class="line">REMOTE_DIR=<span class="string">"/volume1/driver/Others/Router/backup/automatic"</span>  <span class="comment"># 远程备份目录</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查参数是否足够</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$DEST_DIR</span>"</span> ] || [ -z <span class="string">"<span class="variable">$BACKUP_PREFIX</span>"</span> ] || [ -z <span class="string">"<span class="variable">$MAX_BACKUPS</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"使用方法: <span class="variable">$0</span> &lt;备份目的地目录&gt; &lt;备份文件前缀&gt; &lt;最大备份数量&gt;"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份文件路径</span></span><br><span class="line">backup_file=<span class="string">"/tmp/<span class="variable">${BACKUP_PREFIX}</span>-<span class="subst">$(date +%F)</span>.tar.gz"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份</span></span><br><span class="line"><span class="built_in">umask</span> go=</span><br><span class="line">sysupgrade -b <span class="string">"<span class="variable">$backup_file</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"备份文件: <span class="variable">${backup_file}</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将备份文件复制到指定目的地目录</span></span><br><span class="line"><span class="built_in">cp</span> <span class="string">"<span class="variable">$backup_file</span>"</span> <span class="string">"<span class="variable">$DEST_DIR</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 同步到远程服务器</span></span><br><span class="line">rsync -azvP <span class="string">"<span class="variable">$backup_file</span>"</span> <span class="string">"ds218:<span class="variable">$REMOTE_DIR</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除临时备份文件</span></span><br><span class="line"><span class="built_in">rm</span> -rf /tmp/<span class="variable">${BACKUP_PREFIX}</span>-*.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留本地备份数量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"检查并清理本地备份文件..."</span></span><br><span class="line">find <span class="string">"<span class="variable">${DEST_DIR}</span>"</span> -<span class="built_in">type</span> f -name <span class="string">"<span class="variable">${BACKUP_PREFIX}</span>-*.tar.gz"</span> -<span class="built_in">printf</span> <span class="string">'%T+ %p\n'</span> | \</span><br><span class="line"><span class="built_in">sort</span> -r | \</span><br><span class="line"><span class="built_in">tail</span> -n +$((MAX_BACKUPS + <span class="number">1</span>)) | \</span><br><span class="line">awk <span class="string">'{print $2}'</span> | \</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r file; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"删除旧的本地备份: <span class="variable">$file</span>"</span></span><br><span class="line">  <span class="built_in">rm</span> -f <span class="string">"<span class="variable">$file</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留远程备份数量</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"检查并清理远程备份文件..."</span></span><br><span class="line">ssh ds218 <span class="string">"</span></span><br><span class="line"><span class="string">  find <span class="variable">${REMOTE_DIR}</span> -type f -name '<span class="variable">${BACKUP_PREFIX}</span>-*.tar.gz' -printf '%T+ %p\n' | \</span></span><br><span class="line"><span class="string">  sort -r | \</span></span><br><span class="line"><span class="string">  tail -n +<span class="subst">$((MAX_BACKUPS + 1)</span>) | \</span></span><br><span class="line"><span class="string">  awk '{print \$2}' | \</span></span><br><span class="line"><span class="string">  while read -r file; do</span></span><br><span class="line"><span class="string">    echo \"删除远程的旧备份: \$file\"</span></span><br><span class="line"><span class="string">    rm -f \"\$file\"</span></span><br><span class="line"><span class="string">  done</span></span><br><span class="line"><span class="string">"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"备份完成并清理。"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bark 通知</span></span><br><span class="line">curl http://192.168.x.x:port/token/系统备份成功\(R2S.U\)\?group\=System.Backup</span><br></pre></td></tr></tbody></table></figure><p>脚本的作用是自动生成备份文件, 然后通过 <code>rsync</code> 上传到 NAS 的 <code>/volume1/driver/Others/Router/backup/automatic</code> 目录下, 而 <code>/volume1/driver</code> 目录后续会被其他套件备份.</p><blockquote><p>脚本中的 <strong>ds218</strong> 是一个 ssh 别名, 需要在 .ssh/config 中配置, 且配置免密登录.</p></blockquote><p>然后在 OpenWrt 系统中添加定时任务:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每周 2, 4, 6 早上 5 点执行</span></span><br><span class="line">0 5 * * 2,4,6 /root/backup.sh /mnt/lankxin.u/backup r2st 5 &gt; /tmp/backup.log 2&gt;&amp;1</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_GLxIfNZ5.webp" alt="20241229154732_GLxIfNZ5.webp"></p><blockquote><p>crontab 规则:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* * * * * 需要执行的命令</span><br><span class="line">- - - - -</span><br><span class="line">| | | | |</span><br><span class="line">| | | |  ----- 一星期中的第几天 (0 - 6) (其中0表示星期日)</span><br><span class="line">| | |  ------- 月份 (1 - 12)</span><br><span class="line">| |  --------- 一个月中的第几天 (1 - 31)</span><br><span class="line">|  ----------- 一天中的第几小时 (0 - 23)</span><br><span class="line"> ------------- 一小时中的第几分钟 (0 - 59)</span><br></pre></td></tr></tbody></table></figure><p>示例:</p><table><thead><tr><th>分钟 0-59</th><th>小时 0-23</th><th>月内第几天 1-31</th><th>月份 1-12</th><th>每周第几天 0-6(0 表示周日)</th><th>效果</th></tr></thead><tbody><tr><td>*</td><td>*</td><td>*</td><td>*</td><td>*</td><td>每分钟执行一次</td></tr><tr><td>*/5</td><td>*</td><td>*</td><td>*</td><td>*</td><td>每五分钟执行一次</td></tr><tr><td>12</td><td>*/3</td><td>*</td><td>*</td><td>*</td><td>每过 3 个小时后的第 12 分钟执行一次</td></tr><tr><td>57</td><td>11</td><td>15</td><td>1,6,12</td><td>*</td><td>在 1、6、12 月中的 15 号的 11 点 57 分各执行一次</td></tr><tr><td>25</td><td>6</td><td>*</td><td>*</td><td>1-5</td><td>工作日期间（周 1 到周 5），每天早上 6 点 25 分执行一次</td></tr><tr><td>0</td><td>0</td><td>4,12,26</td><td>*</td><td>*</td><td>每月的第 4、12、26 日，晚上 12 点执行一次</td></tr></tbody></table></blockquote><h4 id="WebUI-手动备份"><a href="#WebUI-手动备份" class="headerlink" title="WebUI 手动备份"></a>WebUI 手动备份</h4><p>在修改了配置后及时手动执行备份操作:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_mNVD9sKb.webp" alt="20241229154732_mNVD9sKb.webp"></p><p>下载后的备份文件我会直接扔到 <strong>~Synology/Others/Router/backup/manual</strong> 以同步到 NAS 的 <strong>driver</strong> 目录, 而此目录最终会被其他套件备份.</p><h3 id="eMMC-备份"><a href="#eMMC-备份" class="headerlink" title="eMMC 备份"></a>eMMC 备份</h3><p>eMMC 设备有 4 个:</p><ul><li>H28K (Armbian)</li><li>HB1 Box (Armbian)</li><li>NanoPi NEO4 * 2 (Ubuntu/Debian)</li></ul><p>首先需要确认 eMMC 的分区:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ fdisk -l</span><br><span class="line"></span><br><span class="line">Disk /dev/mmcblk1: 29.13 GiB, 31272730624 bytes, 61079552 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: B6CA70E8-D82F-BA42-AFC0-6A872D21A362</span><br><span class="line"></span><br><span class="line">Device          Start      End  Sectors  Size Type</span><br><span class="line">/dev/mmcblk1p1  32768   557055   524288  256M Linux extended boot</span><br><span class="line">/dev/mmcblk1p2 557056 60456959 59899904 28.6G Linux filesystem</span><br></pre></td></tr></tbody></table></figure><p>可以确认分区为 <strong>/dev/mmcblk1</strong>, 然后使用下面的命令构建镜像:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 远程的 /dev/mmcblk1 备份到 本机的 backup_image.img</span></span><br><span class="line">ssh root@&lt;ip_board_to_be_backup&gt; <span class="string">"dd if=/dev/mmcblk1"</span> | <span class="built_in">dd</span> of=backup_image.img bs=1M status=progress</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_ZllEgtpX.webp" alt="20241229154732_ZllEgtpX.webp"></p><p>因为我有多个 eMMC 设备, 所以写了一个自动化脚本执行:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本目录</span></span><br><span class="line">SCRIPT_DIR=$(<span class="built_in">dirname</span> <span class="string">"<span class="variable">$0</span>"</span>)</span><br><span class="line"><span class="comment"># 日志文件路径</span></span><br><span class="line">LOG_FILE=<span class="string">"<span class="variable">$SCRIPT_DIR</span>/backup_emmc.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将所有输出重定向到日志文件</span></span><br><span class="line"><span class="built_in">exec</span> &gt; &gt;(<span class="built_in">tee</span> -a <span class="string">"<span class="variable">$LOG_FILE</span>"</span>) 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"><span class="comment"># 自动化 eMMC 备份脚本</span></span><br><span class="line"><span class="comment"># =========================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数</span></span><br><span class="line">REMOTE_EMMC=<span class="string">"<span class="variable">$1</span>"</span>          <span class="comment"># 远程主机(.ssh/config 别名, 免密登录)</span></span><br><span class="line">REMOTE_DEVICE=<span class="string">"<span class="variable">$2</span>"</span>        <span class="comment"># 远程备份的设备路径 (如 /dev/mmcblk1)</span></span><br><span class="line">BACKUP_DIR=<span class="string">"<span class="variable">$3</span>"</span>           <span class="comment"># 本地备份存储路径 (如 /path/to/backups)</span></span><br><span class="line">BACKUP_PREFIX=<span class="string">"<span class="variable">$4</span>"</span>        <span class="comment"># 备份文件名前缀 (如 backup_emmc)</span></span><br><span class="line">MAX_BACKUPS=<span class="string">"<span class="variable">$5</span>"</span>          <span class="comment"># 最大保留备份数量 (如 5)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查参数是否完整</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$REMOTE_EMMC</span>"</span> ] || [ -z <span class="string">"<span class="variable">$REMOTE_DEVICE</span>"</span> ] || [ -z <span class="string">"<span class="variable">$BACKUP_DIR</span>"</span> ] || [ -z <span class="string">"<span class="variable">$BACKUP_PREFIX</span>"</span> ] || [ -z <span class="string">"<span class="variable">$MAX_BACKUPS</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> &lt;REMOTE_EMMC&gt; &lt;REMOTE_DEVICE&gt; &lt;BACKUP_DIR&gt; &lt;BACKUP_PREFIX&gt; &lt;MAX_BACKUPS&gt;"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份目录（如果不存在）</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">"<span class="variable">$BACKUP_DIR</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前时间戳</span></span><br><span class="line">TIMESTAMP=$(<span class="built_in">date</span> +%Y%m%d%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地备份文件路径</span></span><br><span class="line">BACKUP_FILE=<span class="string">"<span class="variable">$BACKUP_DIR</span>/<span class="variable">${BACKUP_PREFIX}</span>_<span class="variable">${TIMESTAMP}</span>.img"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始备份</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Starting backup from <span class="variable">$REMOTE_EMMC</span>:<span class="variable">$REMOTE_DEVICE</span> to <span class="variable">$BACKUP_FILE</span>"</span></span><br><span class="line">ssh <span class="variable">${REMOTE_EMMC}</span> <span class="string">"dd if=<span class="variable">${REMOTE_DEVICE}</span> bs=1M"</span> | <span class="built_in">dd</span> of=<span class="variable">$BACKUP_FILE</span> bs=1M status=progress</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查备份是否成功</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Backup completed: <span class="variable">$BACKUP_FILE</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Backup failed!"</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除多余的备份文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Cleaning up old backups..."</span></span><br><span class="line">find <span class="string">"<span class="variable">$BACKUP_DIR</span>"</span> -<span class="built_in">type</span> f -name <span class="string">"<span class="variable">${BACKUP_PREFIX}</span>_*.img"</span> -<span class="built_in">printf</span> <span class="string">'%T+ %p\n'</span> | \</span><br><span class="line"><span class="built_in">sort</span> -r | \</span><br><span class="line"><span class="built_in">tail</span> -n +$((MAX_BACKUPS + <span class="number">1</span>)) | \</span><br><span class="line">awk <span class="string">'{print $2}'</span> | \</span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r file; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Deleting old backup: <span class="variable">$file</span>"</span></span><br><span class="line">  <span class="built_in">rm</span> -f <span class="string">"<span class="variable">$file</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Backup process completed."</span></span><br></pre></td></tr></tbody></table></figure><p>将上述脚本保存为 <code>backup.emmc.sh</code>，并赋予执行权限：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x backup.emmc.sh</span><br></pre></td></tr></tbody></table></figure><p>运行脚本:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./backup.emmc.sh &lt;REMOTE_EMMC&gt; &lt;REMOTE_DEVICE&gt; &lt;BACKUP_DIR&gt; &lt;BACKUP_PREFIX&gt; &lt;MAX_BACKUPS&gt;</span><br></pre></td></tr></tbody></table></figure><ul><li>REMOTE_EMMC：要备份的设备的别名, 需要在 <code>.ssh/config</code> 配置, 并在设备端开启免密登录;</li><li>REMOTE_DEVICE：需要备份的设备路径（如 /dev/mmcblk1）;</li><li>BACKUP_DIR：本地存储备份文件的目录;</li><li>BACKUP_PREFIX：备份文件名前缀（如 backup_emmc）;</li><li>MAX_BACKUPS：保留的最大备份数量（如 5）。</li></ul><p>示例:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 备份到当前目录下</span></span><br><span class="line">./backup.emmc.sh h28k /dev/mmcblk1 . h28k 5</span><br></pre></td></tr></tbody></table></figure><p>添加定时任务:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo crontab -e</span><br></pre></td></tr></tbody></table></figure><p>每天凌晨 2 点执行:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 2 * * * /path/to/backup.emmc.sh &lt;REMOTE_EMMC&gt; &lt;REMOTE_DEVICE&gt; &lt;BACKUP_DIR&gt; &lt;BACKUP_PREFIX&gt; &lt;MAX_BACKUPS&gt;</span><br></pre></td></tr></tbody></table></figure><blockquote><p>如果是在 NAS 上执行, 直接使用 WebUI 设置定时任务即可:</p><p>比如备份脚本路径: <code>/volume4/backups/eMMC/backup.emmc.sh</code>, 设置任务计划:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_km0ameIh.webp" alt="20241229154732_km0ameIh.webp"></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/volume4/backups/eMMC/backup.emmc.sh h28k /dev/mmcblk1 /volume4/backups/eMMC h28k 5</span><br></pre></td></tr></tbody></table></figure></blockquote><hr><h3 id="Linux-备份"><a href="#Linux-备份" class="headerlink" title="Linux 备份"></a>Linux 备份</h3><p>Linux 主机只包括 M920x 和 Station 2 个 Ubuntu Server 这种相对来说较大的主机, 其他的比如 Armbian 等衍生的 Linux 系统不包含在内.</p><h4 id="M920x-备份"><a href="#M920x-备份" class="headerlink" title="M920x 备份"></a>M920x 备份</h4><p>在 <a href="#%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%87%E4%BB%BD">Synology NAS</a> 一节中会使用 <strong>Active Backup for Business</strong> 的 <a href="#%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%87%E4%BB%BD">物理服务器备份功能</a> 备份 M920x 的系统盘.</p><p>M920x 是作为 Docker 主力机使用, 所以上面启动了大量的 Docker 容器以及少量 KVM 虚拟机, 这部分数据我打算使用 <code>rsync</code> 增量备份到另一块 SSD 上(M920x 有 4 块独立的 1T SSD):</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义源目录和目标目录</span></span><br><span class="line">SOURCE_DIR_DOCKER=<span class="string">"/mnt/3.860.ssd/docker"</span></span><br><span class="line">SOURCE_DIR_KVM=<span class="string">"/mnt/3.860.ssd/kvm"</span></span><br><span class="line">SOURCE_DIR_KVM_CONFIG=<span class="string">"/etc/libvirt"</span>  <span class="comment"># 假设 KVM 配置文件在这里，如果不对需要修改</span></span><br><span class="line">DEST_DIR=<span class="string">"/mnt/1.870.ssd"</span></span><br><span class="line">LOG_DIR=<span class="string">"/mnt/1.870.ssd/backup_logs"</span>  <span class="comment"># 定义日志目录</span></span><br><span class="line">TIMESTAMP=$(<span class="built_in">date</span> <span class="string">"+%Y-%m-%d_%H-%M-%S"</span>)</span><br><span class="line">LOG_FILE=<span class="string">"<span class="variable">$LOG_DIR</span>/rsync_backup_<span class="variable">$TIMESTAMP</span>.log"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 增量备份 Docker 目录, 不使用 --progress 避免产生大量日志</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Starting backup of Docker directory..."</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line">rsync -avh --delete <span class="string">"<span class="variable">$SOURCE_DIR_DOCKER</span>"</span> <span class="string">"<span class="variable">$DEST_DIR</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增量备份 KVM 目录</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Starting backup of KVM directory..."</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line">rsync -avh --progress --delete <span class="string">"<span class="variable">$SOURCE_DIR_KVM</span>"</span> <span class="string">"<span class="variable">$DEST_DIR</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增量备份 KVM 配置文件</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Starting backup of KVM configuration files..."</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line">rsync -avh --progress --delete <span class="string">"<span class="variable">$SOURCE_DIR_KVM_CONFIG</span>"</span> <span class="string">"<span class="variable">$DEST_DIR</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span> 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出完成信息</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Backup completed on <span class="subst">$(date)</span>"</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保留最近的 5 个日志文件，删除旧日志</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Cleaning up old log files..."</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br><span class="line">find <span class="string">"<span class="variable">$LOG_DIR</span>"</span> -<span class="built_in">type</span> f -name <span class="string">"rsync_backup_*.log"</span> | <span class="built_in">sort</span> -r | <span class="built_in">tail</span> -n +6 | xargs -r <span class="built_in">rm</span> -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确认完成</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Cleanup completed. Latest 5 logs are kept."</span> &gt;&gt; <span class="string">"<span class="variable">$LOG_FILE</span>"</span></span><br></pre></td></tr></tbody></table></figure><p>此脚本将 <strong>docker</strong>, <strong>KVM 虚拟机文件</strong> 以及 <strong>KVM 的配置文件</strong> 从 <code>/mnt/3.860.ssd</code> 备份到 <code>/mnt/1.870.ssd</code> 目录下, 将上述脚本重命名为 <code>backup.sh</code> 并赋予执行权限, 然后添加到定时任务中:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 必须使用 sudo 运行</span></span><br><span class="line">sudo crontab -e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每天凌晨 2 点执行</span></span><br><span class="line">0 2 * * * /mnt/1.870.ssd/backup.sh</span><br></pre></td></tr></tbody></table></figure><blockquote><p>M920x 除了系统盘备份, <code>/mnt/3.860.ssd</code> 也会通过 <strong>Active Backup for Business</strong> 备份到 NAS 上, 相当于 2 份备份, 最后一份云端备份由 DS923+ 统一处理.</p></blockquote><hr><h4 id="Station"><a href="#Station" class="headerlink" title="Station"></a>Station</h4><p>Station 作为 AI 实验室使用, 目前只有 2 个 1T 的 m.2 固态, 模型数据和系统是分开的, 像 LLM 这些比较容易在网上获取的数据就没有必要备份了, 所以只需要备份系统盘即可.</p><p>在 <a href="#%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%87%E4%BB%BD">Synology NAS</a> 一节中会使用 <strong>Active Backup for Business</strong> 的 <a href="#%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%87%E4%BB%BD">物理服务器备份功能</a> 备份 Station 的系统盘.</p><h3 id="macOS-备份"><a href="#macOS-备份" class="headerlink" title="macOS 备份"></a>macOS 备份</h3><p>macOS 设备有 3 台:</p><ul><li>Macbook Pro Apple M1 Max</li><li>Mac mini 2018</li><li>Mac mini Apple M2</li></ul><p>MBP 是主力机, 其他两台放家里当服务器用, 因为 <strong>AirPort Time Capsule</strong> 只有 2T 的空间, 且备份速度较慢, 所以我打算将 MBP 备份到 DS923+ 上, 而其他 2 台 Mac 备份到 <strong>AirPort Time Capsule</strong>.</p><h4 id="系统备份"><a href="#系统备份" class="headerlink" title="系统备份"></a>系统备份</h4><h5 id="使用-ABB-备份"><a href="#使用-ABB-备份" class="headerlink" title="使用 ABB 备份"></a>使用 ABB 备份</h5><p>我将使用 <strong>Active Backup for Business</strong> 的 macOS 备份功能备份整个 MBP, 具体方式看 <a href="#Windows/macOS-%E5%A4%87%E4%BB%BD"><strong>Windows/macOS 备份</strong></a>.</p><h5 id="使用-Time-Machine"><a href="#使用-Time-Machine" class="headerlink" title="使用 Time Machine"></a>使用 Time Machine</h5><p>另外两台 Mac 直接使用 <strong>AirPort Time Capsule 2T</strong> 备份, 只需要在 macOS 上简单配置即可, 而 NAS 同样可以作为 Time Machine 备份 macOS.</p><p>首先打开 <strong>启用通过 SMB 进行 Bonjour Time Machine 播送</strong> (AFP 可能对最新的 macOS 存在兼容性问题, 所以推荐使用 SMB 协议):</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_qsi93R7k.webp" alt="20241229154732_qsi93R7k.webp"></p><p>接着设置 Time Machine 的存储目录, 最好新建一个专门用于 Time Machine 的共享目录, 并启用 <strong>索引</strong> 功能, 后续可以直接使用 Mac Finder 搜索启动的文件和内容.</p><p>然后在 macOS 上配置 Time Machine:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_XyeMqjkU.webp" alt="20241229154732_XyeMqjkU.webp"></p><p>推荐使用 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly90Y2xlbWVudGRldi5jb20vdGltZW1hY2hpbmVlZGl0b3Iv">TimeMachineEditor</a>, 可在特定时间启动 Time Machine 中的备份. 比如可以选择间隔或创建其他类型的计划:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_pgJJBWR8.webp" alt="20241229154732_pgJJBWR8.webp"></p><h4 id="重要文件备份"><a href="#重要文件备份" class="headerlink" title="重要文件备份"></a>重要文件备份</h4><p>使用 <a href="#Synology-Drive-Client">Synology Driver Client</a> 备份.</p><h3 id="iCloud-数据备份"><a href="#iCloud-数据备份" class="headerlink" title="iCloud 数据备份"></a>iCloud 数据备份</h3><p>iCloud 比较重要的就 3 个:</p><ul><li>Surge</li><li>Obsidian</li><li>照片</li></ul><p>对于前 2 个目录直接在 Mac mini 2018 上通过脚本自动备份 (<code>backup.icloud.sh</code>) :</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 它会将 iCloud 中的 Surge 和 Obsidian 目录备份到指定的 Synology Drive 路径，并使用 yyyy-mm-dd 格式的日期作为备份文件夹名</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义源目录和目标目录</span></span><br><span class="line">SOURCE_SURGE=<span class="string">"<span class="variable">$HOME</span>/Library/Mobile Documents/iCloud~com~nssurge~inc/Documents"</span></span><br><span class="line">SOURCE_OBSIDIAN=<span class="string">"<span class="variable">$HOME</span>/Library/Mobile Documents/iCloud~md~obsidian/Documents"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是 Synology Drive 的目录, 会自动同步到 NAS</span></span><br><span class="line">DEST_SURGE=<span class="string">"<span class="variable">$HOME</span>/Library/CloudStorage/SynologyDrive-driver/macOS/apps/surge"</span></span><br><span class="line">DEST_OBSIDIAN=<span class="string">"<span class="variable">$HOME</span>/Library/CloudStorage/SynologyDrive-driver/Obsidian"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前日期，格式为 yyyy-mm-dd</span></span><br><span class="line">DATE=$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建备份文件夹</span></span><br><span class="line">SURGE_BACKUP=<span class="string">"<span class="variable">$DEST_SURGE</span>/<span class="variable">$DATE</span>"</span></span><br><span class="line">OBSIDIAN_BACKUP=<span class="string">"<span class="variable">$DEST_OBSIDIAN</span>/<span class="variable">$DATE</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">"<span class="variable">$SURGE_BACKUP</span>"</span></span><br><span class="line"><span class="built_in">mkdir</span> -p <span class="string">"<span class="variable">$OBSIDIAN_BACKUP</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始备份</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Backing up Surge to <span class="variable">$SURGE_BACKUP</span>..."</span></span><br><span class="line">rsync -avh --delete <span class="string">"<span class="variable">$SOURCE_SURGE</span>/"</span> <span class="string">"<span class="variable">$SURGE_BACKUP</span>/"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Backing up Obsidian to <span class="variable">$OBSIDIAN_BACKUP</span>..."</span></span><br><span class="line">rsync -avh --delete <span class="string">"<span class="variable">$SOURCE_OBSIDIAN</span>/"</span> <span class="string">"<span class="variable">$OBSIDIAN_BACKUP</span>/"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印完成信息</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Backup completed: <span class="variable">$DATE</span>"</span></span><br></pre></td></tr></tbody></table></figure><p><strong>使用 launchd 添加定时任务</strong>:</p><ol><li><p>在 <code>~/Library/LaunchAgents</code> 目录下创建一个 <code>.plist</code> 文件 (<code>touch ~/Library/LaunchAgents/xx.xxx.icloud-backup.plist</code>):</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>xx.xxx.icloud-backup<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">string</span>&gt;</span>~/Library/CloudStorage/SynologyDrive-driver/DevOps/batch-script/shell/backup/backup.icloud.sh<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StartCalendarInterval<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>Hour<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">integer</span>&gt;</span>3<span class="tag">&lt;/<span class="name">integer</span>&gt;</span> <span class="comment">&lt;!-- 设置每天凌晨 3 点运行 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">key</span>&gt;</span>Minute<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">integer</span>&gt;</span>0<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardOutPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>/tmp/backup.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardErrorPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>/tmp/backup_error.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>加载 launchd 配置:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl load ~/Library/LaunchAgents/xx.xxx.icloud-backup.plist</span><br></pre></td></tr></tbody></table></figure></li><li><p>检查任务状态:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl list | grep xx.xxx.icloud-backup</span><br></pre></td></tr></tbody></table></figure></li><li><p>不用后可以卸载:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/xx.xxx.icloud-backup.plist</span><br></pre></td></tr></tbody></table></figure></li></ol><blockquote><p>照片我则使用 <strong>Synology Photos Mobile</strong> 备份到 DS218+, 然后再自动同步到 DS923+.</p></blockquote><p><strong>其他参考:</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9pb3Muc3NwYWkuY29tL3Bvc3QvOTA2NDE=">使用 Docker 为 iCloud 照片生成本地备份</a></li></ul><hr><h3 id="Synology-NAS"><a href="#Synology-NAS" class="headerlink" title="Synology NAS"></a>Synology NAS</h3><blockquote><p>之所以先讲其他设备的备份方式, 是因为它们的备份文件最终都会写入到 DS923+ 中, 最后我只需要对 DS923+ 上的文件进行备份即可.</p></blockquote><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jb20vemgtdHcvRFNNL3R1dG9yaWFsL0hvd190b19iYWNrX3VwX3lvdXJfU3lub2xvZ3lfTkFTI3hfYW5jaG9yX2lkMTI=">Synology NAS 提供多种备份方式</a>, 他们的对比如下:</p><table><thead><tr><th align="left">备份目的地</th><th align="left">Hyper Backup</th><th align="left">Snapshot Replication</th><th align="left">USB Copy</th><th align="left">Cloud Sync</th></tr></thead><tbody><tr><td align="left">本地共用资料夹</td><td align="left">可使用</td><td align="left">可使用</td><td align="left">不可使用</td><td align="left">不可使用</td></tr><tr><td align="left">外接装置(USB)</td><td align="left">可使用</td><td align="left">不可使用</td><td align="left">可使用</td><td align="left">不可使用</td></tr><tr><td align="left">另一台 Synology NAS</td><td align="left">可使用</td><td align="left">可使用</td><td align="left">不可使用</td><td align="left">不可使用</td></tr><tr><td align="left">档案伺服器</td><td align="left">可使用</td><td align="left">不可使用</td><td align="left">不可使用</td><td align="left">仅支援 WebDAV 及 OpenStack 资料同步</td></tr><tr><td align="left">公有云</td><td align="left">可使用</td><td align="left">不可使用</td><td align="left">不可使用</td><td align="left">可使用</td></tr></tbody></table><p><strong>功能总结</strong>:</p><table><thead><tr><th>应用程式及系统设定备份</th><th>可使用</th><th>不可使用</th><th>不可使用</th><th>不可使用</th></tr></thead><tbody><tr><td>备份及还原效能</td><td>低</td><td>高</td><td>中</td><td>中</td></tr><tr><td>储存空间利用效率</td><td>中</td><td>高</td><td>低</td><td>低</td></tr><tr><td>备份频率</td><td>每小时</td><td>每 5 分钟(共用资料夹) 每 15 分钟(iSCSI LUN)</td><td>热插拔备份</td><td>于资料变更时同步</td></tr><tr><td>透过 WriteOnce 保护备份资料</td><td>不可使用</td><td>仅支援不可变快照</td><td>不可使用</td><td>不可使用</td></tr></tbody></table><p>根据上面的功能总结, 我计划的备份方案为:</p><ol><li>使用 <strong>Snapshot Replication</strong> 在当前 NAS 为重要共享目录创建快照作为第一层保护, 在手残误删文件时能够快速恢复 (<strong>本地备份</strong>);</li><li>在 DS218+ 上使用 <strong>Hyper Backup</strong> 将重要的 APP 配置与数据备份到 DS923+, 同时通过 WebDAV 加密备份到云端, 还原颗粒度可以精确到文件级别 (<strong>不同的存储介质备份</strong>);</li><li>在 DS218+ 上使用 <strong>Hyper Backup</strong> 将整个系统备份到 DS923+, 同时通过 WebDAV 加密备份到云端, 以便在系统崩溃或损坏时还原 (<strong>不同的存储介质备份</strong>);</li><li>在 DS923+ 上使用 <strong>Hyper Backup</strong> 将所有照片和家庭视频通过 rsync 备份到 Mac mini 2018 连接的 <strong>LaCie 8TB d2 Professional</strong> (<strong>不同的存储介质备份</strong>);</li><li>在 DS923+ 上使用 <strong>Hyper Backup</strong> 将重要的 APP 配置与数据备份(包括照片和家庭视频)通过 WebDAV 加密备份到云端 (<strong>云端备份</strong>);</li><li>在 DS923+ 上使用 <strong>Active Backup for Business</strong> 整机备份 DS218+ (<strong>不同的存储介质备份</strong>);</li><li>在 DS923+ 上使用 <strong>Active Backup for Business</strong> 物理服务器备份功能集中备份 M920x 和 Station 整个系统 (<strong>不同的存储介质备份</strong>);</li><li>在 DS923+ 上使用 <strong>Active Backup for Business</strong> 文件服务器备份功能集中备份所有开发板和小主机的重要文件 (<strong>不同的存储介质备份</strong>);</li><li>在 DS923+ 上使用外置存储定时备份 <strong>Active Backup for Business</strong> 产生的备份文件 (<strong>不同的存储介质备份</strong>);</li><li>其他能够安装 <strong>Synology Drive Client</strong> 的主要设备上, 使用 <strong>Drive</strong> 自带的备份功能备份本机上重要的文件 (<strong>不同的存储介质备份</strong>);</li></ol><hr><h4 id="Snapshot-Replication"><a href="#Snapshot-Replication" class="headerlink" title="Snapshot Replication"></a>Snapshot Replication</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuc3lub2xvZ3kuY24vemgtY24vZHNtL2ZlYXR1cmUvc25hcHNob3RfcmVwbGljYXRpb24="><strong>Snapshot Replication</strong></a> 是 Synology 提供的一项数据备份功能，它通过利用 Btrfs 文件系统创建时间点副本，实现数据的块级保护和快速恢复。该功能支持多种复制策略，可灵活部署，并配备便捷的管理工具，帮助我们轻松实现数据的备份和灾难恢复.</p><p>在系统支持 Btrfs 文件格式的情况下，建议优先考虑使用快照复制作为备份策略。这种方式可以将备份周期设置得非常短，非常适合处理公共文件夹中同时进行大量编辑的情况。<br>当遇到问题（例如：不慎删除了大量数据，或是不知道进行了哪些修改）需要恢复文件或整个共享文件夹时，你会非常感激不需要按照一天或两天的时间单位来回溯。<br>优点是：备份周期越短，恢复时只需还原单个文件或整个文件夹，而且还原速度极快。这样的备份方案在紧急情况下能够大大减轻工作压力。</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_m09bLGED.webp" alt="20241229154732_m09bLGED.webp"></p><p>如果在勾选 <strong>高级-让快照可见</strong> 的选项后, 可在文件管理器中查看已保存的快照, 此目录保存在每个创建了快照的共享目录下, 且不会被其他群晖备份套件备份:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_d7mCWrSi.webp" alt="20241229154732_d7mCWrSi.webp"></p><p>同时还具备 <strong>复制</strong> 功能, 选择远程服务器作为复制目的地时, 比如另一台 NAS, 即可将快照在另一台 NAS <strong>重现</strong>, 不过我一直卡在循环验证的地方, 暂时并未使用此功能:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_smrtCyCo.webp" alt="20241229154732_smrtCyCo.webp"></p><blockquote><p>Snapshot Replication 属于本地备份, 性能和还原速度都是最优的, 且快照占用的磁盘空间较小.</p></blockquote><hr><h4 id="Hyper-Backup"><a href="#Hyper-Backup" class="headerlink" title="Hyper Backup"></a>Hyper Backup</h4><p>Hyper Backup 是几个备份套件中功能最全的一个, 除了整机备份, 还能单独备份共享目录和 APP 配置, 所以在 <a href="#NAS-%E6%95%B4%E6%9C%BA%E5%A4%87%E4%BB%BD">整机备份</a> 的基础上, 我还是用它来单独备份个别共享目录和全部的 APP 配置, 这样我可以在不需要整机还原的情况下单独恢复部分数据或 APP:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_bpGajtWl.webp" alt="20241229154732_bpGajtWl.webp"></p><p>Hyper Backup 备份 APP 时会一并将对应的共享目录一起备份:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_bQkbLo6V.webp" alt="20241229154732_bQkbLo6V.webp"></p><blockquote><p>在 DS218+ 上 使用此套件将文件备份到 DS923+, 并加密备份到阿里云盘, 相当于有 2 份备份, 且一份在异地.</p><p>Hyper Backup 提供了灵活的方法来选择要备份的共享文件夹、文件夹和文件。可以勾选和取消勾选复选框以选择要备份的内容。有 3 种不同的备份选择可供选择：</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_s5fn82qw.webp" alt="20241229154732_s5fn82qw.webp"></p></blockquote><hr><h4 id="Active-Backup-for-Business"><a href="#Active-Backup-for-Business" class="headerlink" title="Active Backup for Business"></a>Active Backup for Business</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuc3lub2xvZ3kuY24vemgtY24vZHNtL2ZlYXR1cmUvYWN0aXZlX2JhY2t1cF9idXNpbmVzcyNwYw==">Active Backup for Business</a> 是一款功能全面的备份与恢复工具，适合需要集中管理多种设备数据的需求. 目前我正在用它来集中备份多个开发板上的重要文件, Linux 整机备份以及 DS218+ 的整机备份.</p><h5 id="NAS-整机备份"><a href="#NAS-整机备份" class="headerlink" title="NAS 整机备份"></a>NAS 整机备份</h5><p>这个将在 <a href="#NAS-%E6%95%B4%E6%9C%BA%E5%A4%87%E4%BB%BD">NAS 整机备份</a> 一节中详细介绍, 这里就不再赘述了.</p><h5 id="Windows-macOS-备份"><a href="#Windows-macOS-备份" class="headerlink" title="Windows/macOS 备份"></a>Windows/macOS 备份</h5><p>我目前没有 Windows 主机, 根据 <a href="#macOS-%E5%A4%87%E4%BB%BD">前面的计划</a>, MBP 将使用此功能备份(可以享受万兆内网的速度), 另外 2 台 Mac 将使用 <a href="#%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD">Time Machine</a> 备份到 <strong>AirPort Time Capsule 2T</strong>.</p><p>macOS 需要下载 <strong>Active Backup for Business Agent</strong>, 在 macOS 端主动连接到 DS923+ 的备份服务器:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_ZfhbpwPy.webp" alt="20241229154732_ZfhbpwPy.webp"></p><p>因为是内网连接, 可以不用管这个 SSL 证书问题, 点击 <strong>仍然继续</strong> 即可. 不过为了避免因为证书到期导致备份失败, 最好直接使用 <strong>Active Backup for Business 证书</strong>:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_a4IEYPy8.webp" alt="20241229154732_a4IEYPy8.webp"></p><p>启用后会自动在 <strong>控制面板-安全性-证书</strong> 中添加相应的证书:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_VnZMCUOS.webp" alt="20241229154732_VnZMCUOS.webp"></p><p>另一个问题是模版匹配:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_6v2p4f48.webp" alt="20241229154732_6v2p4f48.webp"></p><p>连接服务器时, 因为 <strong>备份目的地格式不受支持</strong> 而添加失败, 其实不是格式不受支持, <strong>是备份的目的地目录不存在</strong>.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_xKF38i63.webp" alt="20241229154732_xKF38i63.webp"></p><p>在 DS923+ 的 <strong>Active Backup for Business</strong> 修改模版中的 <strong>目的地</strong>, 默认是 <strong>ActiveBackupforBusiness</strong>, 但是我们的 NAS 根本就没有这个共享目录, 所以出错了(也有可能是我以前把这个目录手动删除了 😂).</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_svmFryzc.webp" alt="20241229154732_svmFryzc.webp"></p><p>更换一个存在且可用的共享目录即可, 添加成功后的 <strong>Agent 信息</strong>:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_ZzsyQIdD.webp" alt="20241229154732_ZzsyQIdD.webp"></p><p><strong>服务端信息</strong>:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_o6QFY31x.webp" alt="20241229154732_o6QFY31x.webp"></p><p>后续就是根据自己的情况配置任务了.</p><hr><h5 id="物理服务器备份"><a href="#物理服务器备份" class="headerlink" title="物理服务器备份"></a>物理服务器备份</h5><p>Active Backup for Business 目前支持以下 Linux 系统:</p><ul><li>Debian：10, 11, 12</li><li>Ubuntu：16.04, 18.04, 20.04, 22.04, 24.04</li><li>Architechture: x86_64</li></ul><p>连接方式也非常简单:</p><ol><li><p>下载官方的 agent, 这个在 <strong>Active Backup for Business - 物理服务器 - 添加设备</strong> 时会告知下载地址;</p></li><li><p>修改模版(因为我没有这一步导致连接失败): <strong>Active Backup for Business - 设置 - 模版</strong>, 将 <strong>共享文件夹</strong> 修改成存在的共享目录;</p></li><li><p>在 Linux 上安装 Agent, 可查看 <strong>README</strong> 的操作指南;</p></li><li><p>安装完成后使用 <strong>abb-cli -c</strong> 连接 NAS:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ abb-cli -c</span><br><span class="line">Enter server address: NAS 的 IP</span><br><span class="line">Enter username: NAS 的用户名</span><br><span class="line">Enter password: 对应的密码</span><br><span class="line">Connecting...</span><br><span class="line">The SSL certificate of the Synology NAS is not trusted. To learn how to obtain a valid certificate, please have a registered domain by setting up DDNS (http://sy.to/ddns) and applying <span class="keyword">for</span> Let<span class="string">'s Encrypt (http://sy.to/letsencrypt) certificate. Proceed anyway? [y/n](default: y): y</span></span><br><span class="line"><span class="string">Enter a 6-digit verification code xxxxx (2FA code)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Server address: x.x.x.x</span></span><br><span class="line"><span class="string">Username: xxx</span></span><br><span class="line"><span class="string">Backup type: Server</span></span><br><span class="line"><span class="string">Applied template: Default</span></span><br><span class="line"><span class="string">Backup destination: backup</span></span><br><span class="line"><span class="string">Source type: System volumes backup</span></span><br><span class="line"><span class="string">Restoration privilege: admin, xxx, administrators</span></span><br><span class="line"><span class="string">Back up by time: Monday, Tuesday, Wednesday, Thursday, Friday Start at: 03:00(Daily/Weekly)</span></span><br><span class="line"><span class="string">Retention policy: Advanced retention policy settings</span></span><br><span class="line"><span class="string">Backup window: Disabled</span></span><br><span class="line"><span class="string">Data transfer compression: Enable</span></span><br><span class="line"><span class="string">Data transfer encryption: Enable</span></span><br><span class="line"><span class="string">Bandwidth consumption limit: Disabled</span></span><br><span class="line"><span class="string">Compression at backup destination: Enable</span></span><br><span class="line"><span class="string">Encryption at backup destination: Disabled</span></span><br><span class="line"><span class="string">Backup verification: Disabled</span></span><br><span class="line"><span class="string">Pre/post script: Disabled</span></span><br><span class="line"><span class="string">Confirm authentication? [y/n](default: y):</span></span><br><span class="line"><span class="string">Confirming authentication...</span></span><br><span class="line"><span class="string">Successfully connected</span></span><br></pre></td></tr></tbody></table></figure></li></ol><p>最后在 <strong>Active Backup for Business</strong> 端可修改备份计划:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_uMETHAjv.webp" alt="20241229154732_uMETHAjv.webp"></p><p>如果是整机还原, 需要使用 Linux 恢复媒体创建一个 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jb20vZW4tZ2xvYmFsL0RTTS90dXRvcmlhbC9Ib3dfZG9fSV9jcmVhdGVfYV9ib290YWJsZV9VU0JfZHJpdmVfZm9yX3Jlc3RvcmluZ19MaW51eA==">可启动的 USB 恢复驱动器</a>:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_PS1X66hN.webp" alt="20241229154732_PS1X66hN.webp"></p><p>如果只是文件还原, 可使用 <strong>Active Backup for Business Portal</strong> 操作:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_upTgftjF.webp" alt="20241229154732_upTgftjF.webp"></p><h5 id="文件服务器备份"><a href="#文件服务器备份" class="headerlink" title="文件服务器备份"></a>文件服务器备份</h5><p>将开发板连接到 <strong>Active Backup for Business Portal</strong> 集中备份:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_BiIE6axw.webp" alt="20241229154732_BiIE6axw.webp"></p><p>文件服务器备份使用的是 <strong>rsync</strong>, 且最好使用 root 用户, 不然某些目录由于权限问题无法备份:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_Wu9lAdyl.webp" alt="20241229154732_Wu9lAdyl.webp"></p><h5 id="虚拟机备份"><a href="#虚拟机备份" class="headerlink" title="虚拟机备份"></a>虚拟机备份</h5><p><strong>Active Backup for Business</strong> 只能备份 VMware® vSphere™ 与 Microsoft® Hyper-V® 虚拟机, 所以 <a href="#M920x-%E5%A4%87%E4%BB%BD">M920x 上的 KVM 虚拟机我只能使用脚本备份</a>,</p><p>而 Synology Virtual Machine Manager 中的虚拟机可以通过快照来备份, 另一种方式是将虚拟机导出到共享目录, 然后使用其他方式备份虚拟机文件.</p><hr><h4 id="Synology-Drive-Client"><a href="#Synology-Drive-Client" class="headerlink" title="Synology Drive Client"></a>Synology Drive Client</h4><p>Synology Drive Client 在提供同步功能的同时还具备备份功能, 所以我将主力机上的重要文件使用它备份到 NAS 中, 备份的目的地只能选择当前登录用户的 home 目录:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_sF7Y1PVi.webp" alt="20241229154732_sF7Y1PVi.webp"></p><hr><h4 id="DSM-系统冗余"><a href="#DSM-系统冗余" class="headerlink" title="DSM 系统冗余"></a>DSM 系统冗余</h4><p>首先需要了解一下 <strong>RAID 的几种类型</strong>:</p><table><thead><tr><th>RAID 类型</th><th>磁盘数量</th><th>数据分布</th><th>冗余能力</th><th>性能</th><th>最少磁盘要求</th></tr></thead><tbody><tr><td>RAID 0</td><td>2+</td><td>条带化</td><td>无</td><td>最高</td><td>2</td></tr><tr><td>RAID 1</td><td>2+（偶数）</td><td>镜像</td><td>完全</td><td>一般</td><td>2</td></tr><tr><td>RAID 5</td><td>3+</td><td>条带化+奇偶校验</td><td>单磁盘故障</td><td>较高</td><td>3</td></tr><tr><td>RAID 6</td><td>4+</td><td>条带化+双奇偶校验</td><td>双磁盘故障</td><td>较高</td><td>4</td></tr><tr><td>RAID 10</td><td>4+（偶数）</td><td>镜像+条带化</td><td>单磁盘故障（每个镜像组）</td><td>高</td><td>4</td></tr><tr><td>RAID 50</td><td>6+</td><td>RAID 5 + 条带化</td><td>单磁盘故障（每个 RAID 5 组）</td><td>较高</td><td>6</td></tr><tr><td>RAID 60</td><td>8+</td><td>RAID 6 + 条带化</td><td>双磁盘故障（每个 RAID 6 组）</td><td>较高</td><td>8</td></tr></tbody></table><blockquote><p>条带化（Striping）是一种数据分配技术，它将数据分割成小块（通常称为“条带”或“块”），并将这些小块分散存储在多个磁盘上。这种技术在 RAID（独立冗余磁盘阵列）配置中非常常见，尤其是在 RAID 0、RAID 5、RAID 6 和 RAID 10 等级别中。</p></blockquote><p><strong>说明：</strong></p><ol><li><strong>RAID 0</strong>：速度快，但无任何冗余，适合不关心数据丢失的高性能场景。</li><li><strong>RAID 1</strong>：安全性高，写入时需要复制数据，磁盘利用率较低。</li><li><strong>RAID 5</strong>：提供奇偶校验，容忍单个磁盘故障，适合平衡性能与冗余需求。</li><li><strong>RAID 6</strong>：双重奇偶校验，更高安全性，适用于关键数据保护。</li><li><strong>RAID 10（1+0）</strong>：兼顾 RAID 1 的安全性和 RAID 0 的速度。</li><li><strong>RAID 50/60</strong>：适合企业级大型存储系统，结合 RAID 0 的性能和 RAID 5/6 的冗余。</li></ol><p>参考:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvUkFJRA==">RAID 类型</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jbi96aC1jbi9EU00vaGVscC9EU00vU3RvcmFnZU1hbmFnZXIvc3RvcmFnZV9wb29sX3doYXRfaXNfcmFpZD92ZXJzaW9uPTc=">Synology-选择 RAID 类型</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jbi96aC1jbi9EU00vdHV0b3JpYWwvV2hhdF9pc19TeW5vbG9neV9IeWJyaWRfUkFJRF9TSFI=">什么是 Synology Hybrid RAID (SHR)</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuc3lub2xvZ3kuY24vemgtY24vc3VwcG9ydC9SQUlEX2NhbGN1bGF0b3I=">RAID 计算器</a></li></ul><p>除了上述这些常见的 RAID 类型, 一些硬件和软件厂商还会开发自己的磁盘冗余阵列技术或增强技术：</p><details class="folding-tag"><summary>🪬 其他厂商的磁盘冗余阵列技术或增强技术</summary><div class="content"><ol><li><p><strong>ZFS</strong>（Zettabyte File System）</p><ul><li><strong>厂商/开发者</strong>：Sun Microsystems（现属于 Oracle）</li><li><strong>特点</strong>：<ul><li>ZFS 集文件系统和卷管理器于一体。</li><li>提供类似于 RAID 的多种模式（如 RAID-Z、RAID-Z2、RAID-Z3）。</li><li>支持快照、数据完整性校验、重复数据删除（deduplication）。</li><li>提供动态条带化，无需固定条带大小。</li></ul></li><li><strong>优势</strong>：<ul><li>高数据完整性：基于校验码检测和修复数据损坏。</li><li>灵活性：支持在线扩展存储池。</li></ul></li><li><strong>适用场景</strong>：家庭 NAS（如 TrueNAS）、企业存储、高可靠性备份。</li></ul></li><li><p><strong>SHR</strong>（Synology Hybrid RAID）</p><ul><li><p><strong>厂商/开发者</strong>：Synology</p></li><li><p><strong>特点</strong>：</p><ul><li>提供类似于 RAID 的功能，但支持<strong>混合硬盘容量</strong>。</li><li>自动优化存储利用率，允许用户使用不同大小的硬盘组合。</li><li>支持 1 至 2 块硬盘冗余（类似 RAID 5 或 RAID 6）。</li></ul></li><li><p><strong>优势</strong>：</p><ul><li>易用性：面向普通用户，无需手动配置复杂的 RAID 模式。</li><li>灵活性：允许随时添加更大容量的硬盘。</li></ul></li><li><p><strong>适用场景</strong>：Synology NAS 用户，特别是家庭和小型企业存储系统。</p></li></ul></li><li><p>UnRAID</p><ul><li><strong>厂商/开发者</strong>：Lime Technology</li><li><strong>特点</strong>：<ul><li>与传统 RAID 不同，UnRAID 不做条带化或镜像，而是将数据独立存储在每块硬盘上。</li><li>提供一个专用的<strong>奇偶校验盘</strong>用于数据冗余。</li><li>支持灵活扩展，允许随时增加硬盘并使用不同容量的硬盘。​</li></ul></li><li><strong>优势</strong>：<ul><li>数据独立性：即使多块硬盘损坏，未损坏的硬盘数据仍可直接读取。</li><li>灵活性：无需所有硬盘容量一致。</li></ul></li><li><strong>适用场景</strong>：家庭媒体服务器、大容量存储需求。</li></ul></li><li><p>HP’s ADG (Advanced Data Guarding)</p><ul><li><strong>厂商/开发者</strong>：Hewlett-Packard (HP)</li><li><strong>特点</strong>：<ul><li>类似于 RAID 6，提供双重奇偶校验。</li><li>可允许两块磁盘同时故障而不丢失数据。</li><li>专为 HP 的企业级存储系统设计。</li></ul></li><li><strong>优势</strong>：<ul><li>更高的容错性。</li><li>专为大型企业的高可用性环境而设计。</li></ul></li><li><strong>适用场景</strong>：企业存储系统（如 HP ProLiant 服务器）。</li></ul></li><li><p>NetApp RAID-DP</p><ul><li><p><strong>厂商/开发者</strong>：NetApp</p></li><li><p><strong>特点</strong>：</p><ul><li>基于 RAID 4（单奇偶校验）改进，提供双奇偶校验（类似 RAID 6）。</li><li>专为企业级存储系统和大规模部署优化。</li></ul></li><li><p><strong>优势</strong>：</p><ul><li>提高容错能力，可容忍两块磁盘同时故障。</li><li>集成在 NetApp 的 Data ONTAP 操作系统中，支持高效快照和备份。</li></ul></li><li><p><strong>适用场景</strong>：大规模企业存储和虚拟化环境。</p></li></ul></li><li><p>VMware VSAN（Virtual SAN）</p><ul><li><strong>厂商/开发者</strong>：VMware</li><li><strong>特点</strong>：<ul><li>软件定义存储，将多个服务器的本地存储整合成共享存储池。</li><li>提供分布式数据冗余，支持 RAID 1、RAID 5 和 RAID 6 级别的保护。</li><li>数据跨节点分布，支持企业级高可用性。</li></ul></li><li><strong>优势</strong>：<ul><li>高可扩展性，适合超融合基础架构。</li><li>与 VMware 环境深度集成。</li></ul></li><li><strong>适用场景</strong>：虚拟化和云计算环境。</li></ul></li><li><p>Dell EMC VxRail</p><ul><li><strong>厂商/开发者</strong>：Dell EMC</li><li><strong>特点</strong>：<ul><li>VxRail 是 Dell EMC 提供的超融合基础架构，整合计算、存储和网络。</li><li>存储采用分布式冗余技术，不直接使用传统 RAID，而是基于对象的存储分布。</li></ul></li><li><strong>优势</strong>：<ul><li>高扩展性：节点扩展灵活，适合云和企业级存储。</li><li>提供企业级容错和冗余。</li></ul></li><li><strong>适用场景</strong>：云计算、超融合数据中心。</li></ul></li><li><p>Windows Storage Spaces</p><ul><li><strong>厂商/开发者</strong>：Microsoft</li><li><strong>特点</strong>：<ul><li>提供类似于 RAID 的功能，如条带化（RAID 0）、镜像（RAID 1）和奇偶校验（RAID 5）。</li><li>支持混合硬盘容量，允许动态扩展存储池。</li></ul></li><li><strong>优势</strong>：<ul><li>集成在 Windows 系统中，部署成本低。</li><li>易于配置，适合中小型企业和个人用户。</li></ul></li><li><strong>适用场景</strong>：Windows Server 或家庭 Windows 系统上的存储管理。</li></ul></li><li><p>Ceph</p><ul><li><strong>厂商/开发者</strong>：社区驱动（开源）</li><li><strong>特点</strong>：<ul><li>分布式存储系统，不依赖传统 RAID。</li><li>数据存储在多个节点上，提供高可用性和故障恢复能力。</li><li>基于对象存储，支持动态扩展。</li></ul></li><li><strong>优势</strong>：<ul><li>高扩展性和灵活性。</li><li>无需专用硬件，适合大型分布式存储系统。</li></ul></li><li><strong>适用场景</strong>：云存储、超大规模企业环境。</li></ul></li><li><p>IBM GPFS（General Parallel File System）</p><ul><li><strong>厂商/开发者</strong>：IBM</li><li><strong>特点</strong>：<ul><li>提供分布式文件系统和并行访问功能。</li><li>数据分布在多个磁盘或节点上，提供高可靠性和高性能。</li><li>支持自动故障检测和数据修复。</li></ul></li><li><strong>优势</strong>：<ul><li>高性能和高可靠性。</li><li>适合大规模、高吞吐量的存储需求。</li></ul></li><li><strong>适用场景</strong>：企业数据中心、大数据分析、高性能计算（HPC）。</li></ul></li></ol><p><strong>总结</strong></p><p>现代厂商开发的磁盘冗余技术大多是对传统 RAID 的优化，提供更强的灵活性、扩展性和容错能力。这些技术主要服务于以下需求：</p><ul><li><strong>家庭级存储</strong>：如 Synology SHR、UnRAID、ZFS;</li><li><strong>企业级存储</strong>：如 NetApp RAID-DP、Dell EMC VxRail、Ceph;</li><li><strong>超融合与分布式存储</strong>：如 VMware VSAN、IBM GPFS;</li></ul></div></details><blockquote><p>因为我的 <strong>DS218+</strong> 只有 2 个盘位, 而 <strong>DS923+</strong> 也只支持 2 块 M.2 的 SSD, 所以索性将他们全部更换为 SSD 并组 RAID1, 至少能保证坏了一块 SSD 的情况下系统仍然能够运行.</p></blockquote><hr><h4 id="DSM-配置备份"><a href="#DSM-配置备份" class="headerlink" title="DSM 配置备份"></a>DSM 配置备份</h4><p>Synology 提供 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jbi96aC1jbi9EU00vaGVscC9EU00vQWRtaW5DZW50ZXIvc3lzdGVtX2NvbmZpZ2JhY2t1cD92ZXJzaW9uPTc=">DSM 的配置备份</a>, 可以自动备份到你的 Synology 账户中, 且可手动导出备份到本地(<strong>目前在寻找可自动导出备份文件的方法</strong>):</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_zlEIvRtE.webp" alt="20241229154732_zlEIvRtE.webp"></p><h4 id="NAS-整机备份-1"><a href="#NAS-整机备份-1" class="headerlink" title="NAS 整机备份"></a>NAS 整机备份</h4><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuc3lub2xvZ3kuY24vZHNtL2ZlYXR1cmUvaHlwZXJfYmFja3Vw">Hyper Backup</a> 和 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuc3lub2xvZ3kuY24vemgtY24vZHNtL2ZlYXR1cmUvYWN0aXZlX2JhY2t1cF9idXNpbmVzcyNwYw==">Active Backup for Business</a> 都提供了 NAS 整机备份的功能, 它们的区别为:</p><ul><li>备份方式不同:<ul><li>Active Backup for Business 是作为备份 <strong>目的地</strong> 端的套件(A 备份到 B, 在 B 端操作);</li><li>Hyper Backup 是作为 <strong>备份源</strong> 为角色的套件(A 备份到 B, 在 A 端操作);</li></ul></li><li>还原方式不同:<ul><li>整机还原(<a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jbi96aC1jbi9EU00vaGVscC9IeXBlckJhY2t1cC9yZXN0b3JlP3ZlcnNpb249Nw==">还原步骤</a>):<ul><li>两者都可以;</li></ul></li><li>部分数据还原:<ul><li>Active Backup for Business 直接在远程 NAS 上操作;</li><li>Hyper Backup 只能在本机操作;</li></ul></li></ul></li><li>数据查看方式不同:<ul><li>Active Backup for Business 能够通过 <strong>Active Backup for Business Portal</strong> 查看共享目录下的任何文件;</li><li>Hyper Backup 无法友好的查看备份的文件目录与内容;</li></ul></li><li>备份数据格式不同:<ul><li>Active Backup for Business 会将 NAS 系统备份为 数据盘.img 和 系统.img 2 个镜像文件, 只能通过 <strong>Active Backup for Business Portal</strong> 查看内部数据;</li><li>Hyper Backup 备份的是压缩文件.</li></ul></li></ul><blockquote><p>官方推荐的整机备份方式是 <strong>Hyper Backup</strong>, 可以备份 NAS 上的 <strong>共享文件夹</strong>、<strong>应用程序设置</strong> 和 <strong>系统配置</strong>，从而确保整机数据与环境一致性, 以便在系统出现问题需要重装或彻底坏掉后能够恢复到另一台 NAS 上, 但是我会同时使用 <strong>Active Backup for Business</strong> 备份全部的共享数据文件, 以便在数据被误删后能够单独恢复.</p></blockquote><hr><h5 id="Hyper-Backup-1"><a href="#Hyper-Backup-1" class="headerlink" title="Hyper Backup"></a>Hyper Backup</h5><p>在 DS218+ 上创建整机备份任务:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_VUIY1Q8F.webp" alt="20241229154732_VUIY1Q8F.webp"></p><p>任务创建成功后, 可在远端 NAS(DS923+) 的 <strong>Hyper Backup Vault</strong> 查看备份任务:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_U8AJ0dt9.webp" alt="20241229154732_U8AJ0dt9.webp"></p><h5 id="Active-Backup-for-Business-1"><a href="#Active-Backup-for-Business-1" class="headerlink" title="Active Backup for Business"></a>Active Backup for Business</h5><p>在 DS923+ 上创建整机备份任务(需要在 DS218+ 上安装 Agent):</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_haQLMkXU.webp" alt="20241229154732_haQLMkXU.webp"></p><p>备份完成后可通过 <strong>Active Backup for Business Portal</strong> 查看备份的数据:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_Vv4y25dU.webp" alt="20241229154732_Vv4y25dU.webp"></p><blockquote><h5 id="还原整个系统"><a href="#还原整个系统" class="headerlink" title="还原整个系统"></a>还原整个系统</h5><p><strong>对于已完成首次设置的 Synology NAS 设备</strong>:</p><ol><li>单击 <strong>还原</strong>，然后选择 <strong>整个系统</strong>。您将被重定向到 <strong>控制面板</strong>。</li><li>单击 <strong>还原系统</strong> 并选择存储备份数据的还原来源。</li><li>按向导完成还原。</li></ol><p><strong>对于尚未完成首次设置的 Synology NAS 设备</strong>:</p><ol><li>在欢迎页面上单击 <strong>还原系统</strong>。</li><li>选择存储备份数据的还原来源。</li><li>按向导完成还原。</li></ol></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_VC4tJUte.webp" alt="20241229154732_VC4tJUte.webp"></p><hr><h4 id="参考-1"><a href="#参考-1" class="headerlink" title="参考"></a>参考</h4><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuY2prdW8ubmV0L3N5bm9sb2d5LW5hcy1iYWNrdXAv">備份 Synology NAS 多種解決方案比較</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC84MTUwOQ==">当你拥有了第二台 NAS，这是你需要了解的数据迁移和同步方式-少数派</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wb3N0LnNtemRtLmNvbS9wL2E4cGU2N2tuLw==">担心群晖硬盘损坏丢失数据？不来试试 Hyper Backup ？</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wb3N0LnNtemRtLmNvbS9wL2FsbDI0N3o4Lw==">群晖 NAS 云盘备份神器，使用 Cloud Sync 打通 NAS 与无缝网盘同步</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wb3N0LnNtemRtLmNvbS9wL2F6NTlrNjNuLw==">Synology-企业应用篇</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wb3N0LnNtemRtLmNvbS9wLzU0NTMwNC8=">群晖 DSM6.1 数据安全三猛将 → 同步、备份、快照，+新兵 USB Copy2.0</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9jbmRsLnN5bm9sb2d5LmNuL2Rvd25sb2FkL0RvY3VtZW50L1NvZnR3YXJlL1doaXRlUGFwZXIvUGFja2FnZS9BY3RpdmVCYWNrdXAvQWxsL2VudS9TeW5vbG9neV9CYWNrdXBfU29sdXRpb25fR3VpZGVfMjAyM19lbnUucGRm">Synology-Backup Solution Guide 2023</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9nbG9iYWwuZG93bmxvYWQuc3lub2xvZ3kuY29tL2Rvd25sb2FkL0RvY3VtZW50L1NvZnR3YXJlL1doaXRlUGFwZXIvT3MvRFNNL0FsbC9jaHQvYmFja3VwX3NvbHV0aW9uX2d1aWRlX2NodC5wZGY=">Synology-備份解決方案概覽</a></li></ul><h3 id="冗余备份"><a href="#冗余备份" class="headerlink" title="冗余备份"></a>冗余备份</h3><p>因为所有的备份文件都会汇总到 DS923+ 上, 所以最后一道保险就是为 DS923+ 上的文件创建冗余备份.</p><p>正好有一个 8TB 的 <strong>LaCie d2 Professional</strong> 闲置, 可以直接用作 DS923+ 的冗余备份.</p><p><strong>LaCie d2 Professional</strong> 通过 type-c 连接到了我的 Mac mini 2018, 具有 10Gb/s 的速度, 在 NAS 上使用 <strong>Hyper Backup</strong> 套件, 合适的远程连接有 rsync 和 WebDAV 2 种, 尝试了在 Mac mini 2018 上分别部署 Rsync Server 和 WebDAV 后, 最终选择了第一种方式.</p><p>首先需要了解一下 rsync 基本参数:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">一般做增量同步时，直接使用 -avz 即可。</span><br><span class="line"></span><br><span class="line">rsync参数：</span><br><span class="line">-a           #归档模式传输, 等于-tropgDl</span><br><span class="line">-v           #详细模式输出, 打印速率, 文件数量等。一般默认显示 info=all1，添加 -v 后会显示 info=all2</span><br><span class="line">-z           #传输时进行压缩以提高效率</span><br><span class="line"></span><br><span class="line">-r           #递归传输目录及子目录，即目录下得所有目录都同样传输。</span><br><span class="line">-t           #保持文件时间信息</span><br><span class="line">-o           #保持文件属主信息</span><br><span class="line">-p           #保持文件权限</span><br><span class="line">-g           #保持文件属组信息</span><br><span class="line">-l           #保留软连接</span><br><span class="line">-P           #显示同步的过程及传输时的进度等信息</span><br><span class="line">-D           #保持设备文件信息</span><br><span class="line">-L           #保留软连接指向的目标文件</span><br><span class="line">-e           #使用的信道协议,指定替代rsh的shell程序  ssh</span><br><span class="line">--exclude=PATTERN   #指定排除不需要传输的文件模式</span><br><span class="line">--exclude-from=file #文件名所在的目录文件</span><br><span class="line">--bwlimit=100       #限速传输</span><br><span class="line">--partial           #断点续传</span><br><span class="line">--delete            #让目标目录和源目录数据保持一致，当 src 删除某个文件时，dst 会同步删除，默认是仅传输新增的数据，不会删除远端存在但本端不存在的文件</span><br><span class="line">--debug=all4        #开启最高级别的debug，all 表示显示所有信息，4 为 loglevel 的最高级别。</span><br></pre></td></tr></tbody></table></figure><p>基础命令</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -avz --delete SRC DST</span><br></pre></td></tr></tbody></table></figure><p><strong>参考资料</strong>:</p><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zczY0LmNvbS9iYXNoL3JzeW5jX29wdGlvbnMuaHRtbA==">https://ss64.com/bash/rsync_options.html</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuY25ibG9ncy5jb20va2V2aW5ncmFjZS9wLzY2MDEwODguaHRtbA==">Linux 下 Rsync 和 Tar 增量备份梳理</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC84ODMzODczNw==">备份数据的重要性以及 rsync 的基本使用</a></p></li></ul><h4 id="macOS-上搭建-Rsync-Server"><a href="#macOS-上搭建-Rsync-Server" class="headerlink" title="macOS 上搭建 Rsync Server"></a>macOS 上搭建 Rsync Server</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">├── rsync													<span class="comment"># 二进制文件</span></span><br><span class="line">├── rsyncd.conf.txt								<span class="comment"># rsync 的配置</span></span><br><span class="line">├── rsyncd.log										<span class="comment"># rsync 日志</span></span><br><span class="line">├── rsyncd.secrets.txt						<span class="comment"># 密钥</span></span><br><span class="line">├── rsyncd_nas.log								<span class="comment"># 同步日志</span></span><br><span class="line">└── start													<span class="comment"># 启动脚本</span></span><br></pre></td></tr></tbody></table></figure><p><strong>启动脚本</strong>:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> /path/to/rsync -vvv --daemon --no-detach --ipv4 --config=/path/to/rsyncd.conf.txt . &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></tbody></table></figure><p><strong>配置文件(rsync.conf.txt)</strong>:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">port = 8873</span><br><span class="line"><span class="built_in">log</span> file = /path/to/rsyncd.log</span><br><span class="line">use <span class="built_in">chroot</span> = no</span><br><span class="line"></span><br><span class="line">[NAS]</span><br><span class="line"><span class="comment"># 备份的目的地</span></span><br><span class="line">path = /Volumes/LaCie/Backup/NAS</span><br><span class="line">comment = NAS</span><br><span class="line"><span class="built_in">log</span> file = /path/to/rsyncd_nas.log</span><br><span class="line">transfer logging = <span class="literal">true</span></span><br><span class="line"><span class="built_in">read</span> only = <span class="literal">false</span></span><br><span class="line"><span class="comment"># 认证的用户</span></span><br><span class="line">auth <span class="built_in">users</span> = username</span><br><span class="line">secrets file = /path/to/rsyncd.secrets.txt</span><br></pre></td></tr></tbody></table></figure><p><strong>认证配置(rsyncd.secrets.txt)</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:password</span><br></pre></td></tr></tbody></table></figure><p>在 DS923+ 上配置 <strong>Hyper Backup</strong> :</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_pDQp416p.webp" alt="20241229154732_pDQp416p.webp"></p><p>上面的 Rsync Server 需要在 macOS 启动后手动执行 <strong>start</strong> 脚本启动, 为了减少手动操作, 我们可以通过 macOS 的 launchctl 来管理 Rsync Server 的自启动:</p><p>在 <code>~/Library/LaunchAgents</code> 下新增 <code>xx.xxx.rsync.plist</code> 文件:</p><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">"-//Apple//DTD PLIST 1.0//EN"</span> <span class="string">"http://www.apple.com/DTDs/PropertyList-1.0.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">"1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>xx.xxx.rsync.plist<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>UserName<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>./rsync<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>-vvv<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>--daemon<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>--no-detach<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>--ipv4<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>--config=rsyncd.conf.txt<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>.<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>WorkingDirectory<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 工作目录, 所以上面的 ProgramArguments 使用的是 ./rsync --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>~/rsync-server<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>OnDemand<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">false</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>LaunchOnlyOnce<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardErrorPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>~/rsync-server/err.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardOutPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>~/rsync-server/out.log<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure><p>加载 plist:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl load ~/Library/LaunchAgents/xx.xxx.rsync.plist</span><br></pre></td></tr></tbody></table></figure><p>确认服务已运行:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ launchctl list | grep xx.xxx.rsync</span><br><span class="line">3130	0	xx.xxx.rsync</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ps -ef | grep -v grep | grep --color=auto rsync</span><br><span class="line">  501  3130     1   0 10:47AM ??         0:00.09 ./rsync -vvv --daemon --no-detach --ipv4 --config=rsyncd.conf.txt .</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_GRk3xPdz.webp" alt="20241229154732_GRk3xPdz.webp"></p><p><strong>同步日志</strong>:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_7zbndo4b.webp" alt="20241229154732_7zbndo4b.webp"></p><p>如果需要卸载服务（临时停止并从启动项中移除）:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload ~/Library/LaunchAgents/xx.xxx.rsync.plist</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong>:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly8wY2xpY2tqYWNraW5nMC5naXRodWIuaW8vMjAyMC8wNS8yMC9tYWNvcyVFOCVBRSVCRSVFNyVCRCVBRSVFNSVCQyU4MCVFNiU5QyVCQSVFNSU5MCVBRiVFNSU4QSVBOCVFNCVCQiVCQiVFNSU4QSVBMS8=">macOS 设置开机启动任务</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cubGlhbmdndWFuZ2h1aS5jb20vbWFjb3MtbG9naW4tc3RhcnR1cC8=">macOS 实现软件开启自启动</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvYXJjaGl2ZS9kb2N1bWVudGF0aW9uL01hY09TWC9Db25jZXB0dWFsL0JQU3lzdGVtU3RhcnR1cC9DaGFwdGVycy9DcmVhdGluZ0xhdW5jaGRKb2JzLmh0bWwjLy9hcHBsZV9yZWYvZG9jL3VpZC8xMDAwMDE3MmktU1c3LUJDSUVEREJK">Creating Launch Daemons and Agents</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvY29udGVudC9kb2N1bWVudGF0aW9uL01hY09TWC9Db25jZXB0dWFsL0JQU3lzdGVtU3RhcnR1cC9DaGFwdGVycy9JbnRyb2R1Y3Rpb24uaHRtbA==">Daemons and Services Programming Guide</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cDovL2RldmVsb3Blci5hcHBsZS5jb20vbGlicmFyeS9tYWMvdGVjaG5vdGVzL3RuMjA4My8=">Technical Note TN2083: Daemons and Agents</a></li></ul><hr><h3 id="云端备份"><a href="#云端备份" class="headerlink" title="云端备份"></a>云端备份</h3><p>最后就是异地备份了, 这里直接使用 <strong>阿里云盘的 WebDAV 服务</strong>.</p><blockquote><p>为什么不用 <strong>Cloud Sync</strong> 利用单向同步的方式备份到云端:</p><ol><li><strong>Cloud Sync</strong> 更适合同步数据, 会保留原始的文件路径;</li><li><strong>Cloud Sync</strong> 一个任务只能选择一个共享目录;</li><li>没有 <strong>Hyper Backup</strong> 的 <strong>压缩备份</strong>, <strong>块级传输</strong>, <strong>多版本管理</strong> 等高级功能;</li></ol></blockquote><p><strong>备份到云端</strong>:</p><p>Hyper Backup 支持备份到云端, 这里我直接使用 <strong>阿里云盘 WebDAV</strong> 这个第三方套件:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_OjkqZdJm.webp" alt="20241229154732_OjkqZdJm.webp"></p><p>然后 Hyper Backup 通过 <strong>WevDAV</strong> 备份到阿里云盘:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_4DViff2E.webp" alt="20241229154732_4DViff2E.webp"></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9pbW5rcy5jb20vMzkzOS5odG1s"><strong>阿里云盘 WebDAV 套件使用教程</strong></a>, 获取到 <strong>refresh_token</strong> 后就可直接使用, 还能在 File Station 中通过 <strong>远程连接</strong> 挂载阿里云盘到本地, 可以方便的浏览云盘内容:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_X52qX4Ur.webp" alt="20241229154732_X52qX4Ur.webp"></p><blockquote><p>我还会使用 阿里云盘 WebDAV 配合 Cloud Sync 下载云盘内容, 工作流为:</p><ol><li>将待下载的文件保存到阿里云盘;</li><li>然后在 DS923+ 的 Cloud Sync 连接阿里云盘的 WebDAV 服务, 设置为 <strong>单向同步</strong>;</li><li>云盘内容下载完成后直接在 File Station 挂载的阿里云盘 WebDAV 中删除即可. 除了第一步, 后续流程完全不需要登录到官方的阿里云盘操作;</li></ol></blockquote><h3 id="备份时间整理"><a href="#备份时间整理" class="headerlink" title="备份时间整理"></a>备份时间整理</h3><p>因为我使用 NAS 作为备份中枢, 且 2 台 NAS 之间存在关联关系, 所以我需要整理备份的时间, 以保证备份的正确性与可用性.</p><blockquote><p>还需要考虑到 2 台路由器的重启计划:</p><ul><li>小米 AX9000 周 2 4 6 的 04:30 定时重启;</li><li>小米 6500Pro 周 1 3 5 04:00 定时重启;</li></ul></blockquote><h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>系统卷 [MBP]</td><td>Active Backup for Business(物理服务器备份)</td><td>DS923+:/backups/ActiveBackupData</td><td>周 1 3 5 21:00 启动</td><td>3</td></tr><tr><td>整个磁盘 [MBP]</td><td>Time Machine</td><td>DS923+:/timemachine</td><td>周 2 4 6 22:00 启动</td><td>自动轮转</td></tr><tr><td>其他重要文件 [MBP]</td><td>Synology Drive Client</td><td>DS923+:/home/Backup</td><td>每隔 8 小时启动</td><td>1</td></tr><tr><td>整个磁盘 [Mac mini M2]</td><td>Time Machine</td><td>AirPort Time Capsule 2T</td><td>每周</td><td>自动轮转</td></tr><tr><td>整个磁盘 [Mac mini 2018]</td><td>Time Machine</td><td>AirPort Time Capsule 2T</td><td>每周</td><td>自动轮转</td></tr></tbody></table><h4 id="M920x"><a href="#M920x" class="headerlink" title="M920x"></a>M920x</h4><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>系统卷</td><td>Active Backup for Business(物理服务器备份)</td><td>DS923+:/backup/ActiveBackupData</td><td>周 1 3 5 12:00 启动</td><td>3</td></tr><tr><td>3.860.ssd</td><td>Active Backup for Business(物理服务器备份)</td><td>DS923+:/backup/ActiveBackupData</td><td>周 2 4 6 12:00 启动</td><td>3</td></tr><tr><td>3.860.ssd</td><td><a href="#M920x-%20%E5%A4%87%E4%BB%BD">自动化脚本</a></td><td>1.870.ssd</td><td>每天 2 点增量备份</td><td>1</td></tr><tr><td>其他重要文件</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/m920x</td><td>周 1 3 5 05:20 启动</td><td>5</td></tr></tbody></table><h4 id="Station-1"><a href="#Station-1" class="headerlink" title="Station"></a>Station</h4><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>系统卷</td><td>Active Backup for Business(物理服务器备份)</td><td>DS923+:/backup/ActiveBackupData</td><td>假日 22:00 启动</td><td>3</td></tr><tr><td>其他重要文件</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/station</td><td>假日 19:00 启动</td><td>5</td></tr></tbody></table><h4 id="H28K"><a href="#H28K" class="headerlink" title="H28K"></a>H28K</h4><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>eMMC</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 2 08:00 启动</td><td>3</td></tr><tr><td>其他重要文件</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/H28K</td><td>周 2 4 6 07:00 启动</td><td>5</td></tr></tbody></table><h4 id="HK1Box"><a href="#HK1Box" class="headerlink" title="HK1Box"></a>HK1Box</h4><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>eMMC</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 3 08:00 启动</td><td>3</td></tr><tr><td>其他重要文件</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/HA</td><td>周 1 3 5 09:00 启动</td><td>5</td></tr></tbody></table><h4 id="NanoPI-NEO4"><a href="#NanoPI-NEO4" class="headerlink" title="NanoPI NEO4"></a>NanoPI NEO4</h4><p>2 个 NEO4, 第二个往后延长 30 分钟执行.</p><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>系统(eMMC) [NEO4.1]</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 6 19:00 启动</td><td>3</td></tr><tr><td>其他重要文件 [NEO4.1]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/NEO4.1</td><td>周 6 20:00 启动</td><td>3</td></tr><tr><td>系统(eMMC) [NEO4.2]</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 6 19:30 启动</td><td>3</td></tr><tr><td>其他重要文件 [NEO4.2]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/NEO4.2</td><td>周 6 20:30 启动</td><td>3</td></tr></tbody></table><h4 id="树莓派"><a href="#树莓派" class="headerlink" title="树莓派"></a>树莓派</h4><p>4 台树莓派, 每台间隔 30 分钟执行备份任务</p><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>系统(SD 卡) [pi4]</td><td>M920x 定时任务: <a href="#%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%A4%8D%E5%88%B6">通过网络复制脚本</a></td><td>DS923+:/backups/SD/pi4</td><td>周天 10:00 启动</td><td>3</td></tr><tr><td>其他重要文件 [pi4]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/PI4</td><td>周天 11:00 启动</td><td>5</td></tr><tr><td>系统(SD 卡) [pi51]</td><td>M920x 定时任务: <a href="#%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%A4%8D%E5%88%B6">通过网络复制脚本</a></td><td>DS923+:/backups/SD/pi51</td><td>周天 10:30 启动</td><td>3</td></tr><tr><td>其他重要文件 [pi51]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/PI51</td><td>周天 11:30 启动</td><td>5</td></tr><tr><td>系统(SD 卡) [pi52]</td><td>M920x 定时任务: <a href="#%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%A4%8D%E5%88%B6">通过网络复制脚本</a></td><td>DS923+:/backups/SD/pi52</td><td>周天 11:00 启动</td><td>3</td></tr><tr><td>其他重要文件 [pi52]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/PI52</td><td>周天 12:00 启动</td><td>5</td></tr><tr><td>系统(SD 卡) [zero2w]</td><td>M920x 定时任务: <a href="#%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%A4%8D%E5%88%B6">通过网络复制脚本</a></td><td>DS923+:/backups/SD/zero2w</td><td>周天 11:30 启动</td><td>3</td></tr><tr><td>其他重要文件 [zero2w]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/Zero</td><td>周天 12:30 启动</td><td>5</td></tr></tbody></table><h4 id="R2S-R5S"><a href="#R2S-R5S" class="headerlink" title="R2S &amp;&amp; R5S"></a>R2S &amp;&amp; R5S</h4><table><thead><tr><th>源文件</th><th>备份方式</th><th>目的地</th><th>时间</th><th>备份数量</th></tr></thead><tbody><tr><td>系统(SD 卡) [R2S.T]</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 1 10:00 启动</td><td>3</td></tr><tr><td>OpenWrt 配置 [R2S.T]</td><td>OpenWrt 任务计划: <a href="#OpenWrt-%20%E5%A4%87%E4%BB%BD">OpenWrt 自动备份脚本</a> + 手动临时备份</td><td>本地 U 盘 + DS218+:/driver</td><td>周 1 06:00 启动</td><td>5</td></tr><tr><td>其他重要文件 [R2S.T]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/R2ST</td><td>周 1 3 5 14:00 启动</td><td>5</td></tr><tr><td>系统(SD 卡) [R2S.U]</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 1 11:30 启动</td><td>3</td></tr><tr><td>OpenWrt 配置 [R2S.U]</td><td>OpenWrt 任务计划: <a href="#OpenWrt-%20%E5%A4%87%E4%BB%BD">OpenWrt 自动备份脚本</a> + 手动临时备份</td><td>本地 U 盘 + DS218+:/driver</td><td>周 1 07:00 启动</td><td>5</td></tr><tr><td>其他重要文件 [R2S.U]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/R2SU</td><td>周 1 3 5 15:00 启动</td><td>5</td></tr><tr><td>系统(SD 卡) [R2S.C]</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 1 12:30 启动</td><td>3</td></tr><tr><td>OpenWrt 配置 [R2S.C]</td><td>OpenWrt 任务计划: <a href="#OpenWrt-%20%E5%A4%87%E4%BB%BD">OpenWrt 自动备份脚本</a> + 手动临时备份</td><td>本地 U 盘 + DS218+:/driver</td><td>周 1 08:00 启动</td><td>5</td></tr><tr><td>其他重要文件 [R2S.C]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/R2SC</td><td>周 1 3 5 16:00 启动</td><td>5</td></tr><tr><td>系统(SD 卡) [R5S]</td><td>DS923+ 任务计划: <a href="#eMMC-%20%E5%A4%87%E4%BB%BD">eMMC 备份脚本</a></td><td>DS923+:/backups/eMMC</td><td>周 1 13:30 启动</td><td>3</td></tr><tr><td>OpenWrt 配置 [R5S]</td><td>OpenWrt 任务计划: <a href="#OpenWrt-%20%E5%A4%87%E4%BB%BD">OpenWrt 自动备份脚本</a> + 手动临时备份</td><td>本地 U 盘 + DS218+:/driver</td><td>周 1 09:00 启动</td><td>5</td></tr><tr><td>其他重要文件 [R5S]</td><td>Active Backup for Business(文件服务器备份)</td><td>DS923+:/backup/R5S</td><td>周 1 3 5 17:00 启动</td><td>5</td></tr></tbody></table><h4 id="NAS-快照"><a href="#NAS-快照" class="headerlink" title="NAS 快照"></a>NAS 快照</h4><table><thead><tr><th>任务名</th><th>备份时间</th><th>源地址</th><th>目的地</th><th>备份数量</th></tr></thead><tbody><tr><td>DS218-photo-Snap</td><td>每天 00:00</td><td>DS218:/photo</td><td>DS218:/photo/#snapshot</td><td>5</td></tr><tr><td>DS218-driver-Snap</td><td>每天 01:00</td><td>DS218:/driver</td><td>DS218:/driver/#snapshot</td><td>5</td></tr><tr><td>DS218-1Panel-Snap</td><td>每天 20:00</td><td>DS218:/1Panel</td><td>DS218:/1Panel/#snapshot</td><td>5</td></tr><tr><td>DS218-docker-Snap</td><td>每天 20:10</td><td>DS218:/docker</td><td>DS218:/docker/#snapshot</td><td>5</td></tr><tr><td>DS218-Memos-Snap</td><td>每天 22:00</td><td>DS218:/Memos</td><td>DS218:/Memos/#snapshot</td><td>5</td></tr><tr><td>DS218-homes-Snap</td><td>每天 23:00</td><td>DS218:/homes</td><td>DS218:/homes/#snapshot</td><td>5</td></tr><tr><td>DS923-backup-Snap</td><td>周 1 3 5 00:10</td><td>DS923:/backup</td><td>DS923:/backup/#snapshot</td><td>3</td></tr><tr><td>DS923-backups-Snap</td><td>周 2 4 6 00:10</td><td>DS923:/backups</td><td>DS923:/backups/#snapshot</td><td>3</td></tr><tr><td>DS923-Developer-Snap</td><td>周天 01:00</td><td>DS923:/Developer</td><td>DS923:/Developer/#snapshot</td><td>3</td></tr><tr><td>DS923-homes-Snap</td><td>每天 01:30</td><td>DS923:/homes</td><td>DS923:/homes/#snapshot</td><td>5</td></tr><tr><td>DS923-photo-Snap</td><td>每天 02:10</td><td>DS923:/photo</td><td>DS923:/photo/#snapshot</td><td>5</td></tr><tr><td>DS923-driver-Snap</td><td>每天 05:00</td><td>DS923:/driver</td><td>DS923:/driver/#snapshot</td><td>5</td></tr><tr><td>DS923-1Panel-Snap</td><td>每天 12:00</td><td>DS923:/1Panel</td><td>DS923:/1Panel/#snapshot</td><td>5</td></tr><tr><td>DS923-Memos-Snap</td><td>每天 13:00</td><td>DS923:/Memos</td><td>DS923:/Memos/#snapshot</td><td>5</td></tr><tr><td>DS923-docker-Snap</td><td>每天 23:00</td><td>DS923:/docker</td><td>DS923:/docker/#snapshot</td><td>5</td></tr></tbody></table><h4 id="DS218"><a href="#DS218" class="headerlink" title="DS218+"></a>DS218+</h4><table><thead><tr><th>任务名</th><th>备份套件</th><th>备份时间</th><th>备份源</th><th>目的地</th><th>备份数量</th></tr></thead><tbody><tr><td>backup.apps</td><td>Hyper Backup</td><td>周 3 14:00</td><td>所有 APP</td><td>DS923:/backups/DS218.Apps.hbk</td><td>3</td></tr><tr><td>backup.datas</td><td>Hyper Backup</td><td>周 2 14:00</td><td>部分共享目录</td><td>DS923:/backups/DS218.Datas.hbk</td><td>3</td></tr><tr><td>backup.system</td><td>Hyper Backup</td><td>周 4 14:00</td><td>整个系统</td><td>DS923:/backups/DS218.System.hbk</td><td>3</td></tr><tr><td>backup.to.cloud</td><td>Hyper Backup</td><td>周 5 14:00</td><td>所有 APP + 重要数据</td><td>阿里云盘:/backups/DS218.Datas.hbk</td><td>3</td></tr></tbody></table><blockquote><p><strong>Hyper Backup</strong> 整机备份无法使用 <strong>WebDAV</strong>, 只能是远程 NAS 或 Synology C2 Storage, 所以只能将 APP 和重要数据备份到阿里云盘.</p></blockquote><h4 id="DS923"><a href="#DS923" class="headerlink" title="DS923+"></a>DS923+</h4><table><thead><tr><th>任务名</th><th>备份套件</th><th>备份时间</th><th>备份源</th><th>目的地</th><th>备份数量</th></tr></thead><tbody><tr><td>backup.to.Lacie</td><td>Hyper Backup</td><td>周天 16:00</td><td>所有 APP</td><td>Lacie:/Backup/NAS/DS923</td><td>3</td></tr><tr><td>backup.datas</td><td>Hyper Backup</td><td>周 3 16:00</td><td>部分共享目录</td><td>阿里云盘:/backups/DS923.Datas.hbk</td><td>3</td></tr><tr><td>VMS</td><td>-</td><td>手动备份</td><td>Virtual Machine Manager</td><td>DS923:/backups/NAS.VMs</td><td>3</td></tr></tbody></table><h3 id="数据备份总结"><a href="#数据备份总结" class="headerlink" title="数据备份总结"></a>数据备份总结</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/data-backup.drawio.svg" alt="data-backup.drawio.svg"></p><ol><li>macOS 使用 Time machine 和 ABB 进行整机备份, Synology Drive Client 则用于重要数据数据冗余备份;</li><li>OpenWrt 使用 ABB 文件备份, 并使用脚本进行整个系统备份;</li><li>Linux 使用 ABB 的物理服务器和文件备份, 还需要使用脚本在特殊情况下备份;</li><li>开发版使用 ABB 的文件备份, 并使用自动化脚本对整个系统备份, 包括 eMMC 和 SD 卡;</li><li>2 台 NAS 分别使用快照对重要共享目录进行备份;</li><li>DS218+ 使用 Hyper Backup 备份数据到 DS923+, 并使用 ABB 进行整机备份;</li><li>其他设备的备份文件全部传输到 DS923+;</li><li>DS923+ 使用 Hyper Backup 备份数据到云盘和外置磁盘;</li></ol><p>这一次算是把所有设备的备份全部梳理了一遍, 整个备份系搭建下来, 感觉 DS923+ 承担了所有, 就是不知道它扛不扛得住, 这就要通过时间去验证这套备份体系了.</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此, 7 篇关于 HomeLab 的文章算是全部完结了, 我以为花个一周时间应该可以写个七七八八, 但是这几篇文章加起来花了接近一个月的时间, 看来还是太高估自己的能力了, 原因应该是花了大量时间查阅文档以及进行各种测试.</p><p>如今基于目前的架构, 应该可以支撑很长一段时间, 只要我不手残或不添置新的设备, 所以 HomeLab 相关的文章应该到此结束了, 或许下一篇 HomeLab 的开始应该就是另一种架构了, 比如全套 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zdG9yZS51aS5jb20vdXMvZW4=">UniFi</a> + 机架了, 慢慢折腾吧.</p><p><strong>相关文章:</strong></p><ol><li><a href="/posts/15433dee.html">先导篇</a>：我的 HomeLab 概要;</li><li><a href="/posts/1c3b04a.html">硬件篇</a>：介绍我所拥有的硬件设备;</li><li><a href="/posts/e537d446.html">网络篇</a>：包括网络环境、异地组网与网络安全;</li><li><a href="/posts/b2341239.html">服务篇</a>：使用 Docker 搭建的各类服务;</li><li><a href="/posts/b808f350.html">数据篇</a>：包括数据存储方案、备份方案和数据恢复方案;</li><li><a href="/posts/273b6766.html">HomeLab数据同步：构建高效的数据同步网络</a></li><li><a href="/posts/6c25aa66.html">HomeLab数据备份：打造坚实的数据安全防线</a></li><li><a href="/posts/7e09e56.html">HomeLab 网络续集：升级 10G 网络-再战 10 年</a></li><li><a href="/posts/15433dee.html">NAT 内网穿透详解：揭秘网络连接背后的奥秘</a></li></ol></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar1.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">dong4j</div><div class="post-copyright__author_desc">岁月静好，诗酒趁年华🍺</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.dong4j.site/posts/6c25aa66.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl(&quot;https://blog.dong4j.site/posts/6c25aa66.html&quot;)">HomeLab数据备份：打造坚实的数据安全防线</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/wechat-pay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/wechat-pay.webp" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/alipay.webp" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wechat/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.dong4j.site/posts/6c25aa66.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=HomeLab数据备份：打造坚实的数据安全防线&amp;url=https://blog.dong4j.site/posts/6c25aa66.html&amp;pic=https://cdn.dong4j.site/source/image/20241229154732_oUxZug2L.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div><div class="share-link follow"><div class="share-button" id="post-share-url" title="订阅" onclick="icat.showFollowBox()"><i class="anzhiyufont anzhiyu-icon-rss"></i></div></div></div></div></div><div class="submit-box display"><form id="follow" action="https://api.follow.it/subscription-form/b29peEszNWYzK3FQbEw2dVlITEJMZ2pQRXh2dWRLVDE3SC96eFhRaGwwQWprcXpYYUp0NGFWemxVZllXRGU4Nm4yenNGSzNpV3l0Z1EwQzBXQU5xTG9pZWNzVCt5YWptWUt6TXppRXVXMXZxQTRZOGQ0NUVDRlRFOUYxSHMzMEJ8NmlodHY1VWhDQVZBaG8wM0pSV2pXSjdTNGRWS1o0RDVZbE11KzlEeWhuZz0=/8" method="post" target="_blank"><div class="follow-it-form-subscribe" style="position:relative"><div class="heading"><h5 style="font-weight:700;text-align:center">订阅本站文章：</h5></div><div class="input-field"><input type="email" id="email-input" name="email" placeholder="填入您的邮箱地址" spellcheck="false" oninput="validateEmail()"></div><div class="submit-button"><button type="submit" id="submit-button" onclick="ga(&quot;send&quot;,&quot;event&quot;,&quot;Form&quot;,&quot;Submit&quot;,&quot;Affiliate&quot;)" style="font-weight:700;font-size:14px;text-align:center" disabled="">确认订阅</button></div></div></form><style>#email-input{font-size:16px;font-weight:700;padding:10px;border:2px solid #ccc;border-radius:5px;width:100%;box-sizing:border-box}#email-input:focus{outline:0}#email-input.valid{border-color:green}#email-input.invalid{border-color:red}</style><script>function validateEmail(){var s=document.getElementById("email-input"),a=document.getElementById("submit-button"),e=s.value;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(a.disabled=!1,s.classList.add("valid"),s.classList.remove("invalid")):(a.disabled=!0,s.classList.add("invalid"),s.classList.remove("valid"))}</script></div><script>var icat={showFollowBox:function(){var s=document.querySelector(".submit-box");s.classList.contains("display")?s.classList.remove("display"):s.classList.add("display")}}</script><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.dong4j.site" target="_blank">司机带你开车</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/homelab-%E4%B8%AD%E5%B9%B4%E7%94%B7%E4%BA%BA%E7%9A%84%E5%BF%AB%E4%B9%90%E6%BA%90%E6%B3%89/"><span class="categoryes-punctuation"><i class="anzhiyufont anzhiyu-icon-inbox"></i></span>HomeLab:中年男人的快乐源泉<span class="categoryesPageCount">15</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/homelab/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>HomeLab<span class="tagsPageCount">17</span></a><a class="post-meta__box__tags" href="/tags/nas/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>NAS<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>数据备份<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>树莓派<span class="tagsPageCount">7</span></a><a class="post-meta__box__tags" href="/tags/openwrt/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>OpenWrt<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/synology/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Synology<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook a2a_counter"></a><a class="a2a_button_x"></a><a class="a2a_button_threads"></a><a class="a2a_button_pocket"></a><a class="a2a_button_email"></a><a class="a2a_button_sms"></a><a class="a2a_dd" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.addtoany.com/share"></a></div></div><script async="" src="https://static.addtoany.com/menu/page.js"></script><script>var a2a_config=a2a_config||{};a2a_config.templates=a2a_config.templates||{},a2a_config.templates.email={subject:"来自 dong4j 的分享: ${title}",body:"一篇有意思的博文:\n${link}"},a2a_config.templates.sms={body:"给你分享一篇有意思的博客:\n${title}\n${link}"}</script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/273b6766.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_NXaPIT2E.webp" onerror="onerror=null,src=&quot;/img/404.webp&quot;" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HomeLab数据同步：构建高效的数据同步网络</div></div></a></div><div class="next-post pull-right"><a href="/posts/9f1d6e11.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250113234024_3rZyCVYe.webp" onerror="onerror=null,src=&quot;/img/404.webp&quot;" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">打造智能URL切换器：让内外网访问更便捷</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/8dc39439.html" title="宝宝动一下就知道：如何用树莓派和小米大方摄像头构建智能监控"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?ksqmoij9" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-11-29</div><div class="title">宝宝动一下就知道：如何用树莓派和小米大方摄像头构建智能监控</div></div></a></div><div><a href="/posts/15433dee.html" title="HomeLab 先导篇：入门指南-开启你的个人云端实验室之旅"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_dJYxL1SG.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2020-04-08</div><div class="title">HomeLab 先导篇：入门指南-开启你的个人云端实验室之旅</div></div></a></div><div><a href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?mg3iapx4" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-15</div><div class="title">Ubuntu 使用备忘录：好记性不如烂笔头</div></div></a></div><div><a href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?eb4q02fh" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-13</div><div class="title">使用 Cloudflare 增强公网服务安全性的实践</div></div></a></div><div><a href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?po6ikv1j" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-12</div><div class="title">Ubuntu 系统下 LCD4Linux 的安装与配置指南</div></div></a></div><div><a href="/posts/ded15d16.html" title="捡垃圾的快乐：因为一张显卡组装了一台服务器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?esvhtge1" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-10</div><div class="title">捡垃圾的快乐：因为一张显卡组装了一台服务器</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/coding.gif" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">dong4j</h1><div class="author-info__desc">岁月静好，诗酒趁年华 🍺</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/dong4j" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fa-brands fa-github faa-tada"></i></a><a class="social-icon faa-parent animated-hover" href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fa-solid fa-at faa-tada"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><div style="display:flex;align-items:center"><span>👋🏻 Hi，欢迎来到我的博客~</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mario.gif" width="40"></div><span>❓ 如有问题欢迎评论区交流！🎉</span><br><span>😫 页面异常？试试<kbd>Ctrl</kbd>+<kbd>F5</kbd>🙉</span><br><span>📧 如需联系：<a href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer"><b>发邮件给我吧 🚀</b></a></span><div id="welcome-info"></div><a id="my-card-info-btn" href="/subscribe/" data-pjax-state=""><i class="anzhiyufont anzhiyu-icon-rss"></i><span>订阅本站</span></a></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://cdn.dong4j.site/source/image/63c02edf44033.webp) center center/100% no-repeat"></div><div class="back face" style="background:url(https://cdn.dong4j.site/source/image/645fa415e8694.webp) center center/100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">1.</span> <span class="toc-text">数据备份</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BE%E5%A4%87%E4%BB%BD"><span class="toc-number">1.1.</span> <span class="toc-text">树莓派备份</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#TF-%E5%A4%8D%E5%88%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text">TF 复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dd-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.2.</span> <span class="toc-text">dd 命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E7%BD%91%E7%BB%9C%E5%A4%8D%E5%88%B6"><span class="toc-number">1.1.3.</span> <span class="toc-text">通过网络复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.1.4.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenWrt-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.2.</span> <span class="toc-text">OpenWrt 备份</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.1.</span> <span class="toc-text">自动备份脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WebUI-%E6%89%8B%E5%8A%A8%E5%A4%87%E4%BB%BD"><span class="toc-number">1.2.2.</span> <span class="toc-text">WebUI 手动备份</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#eMMC-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.3.</span> <span class="toc-text">eMMC 备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.4.</span> <span class="toc-text">Linux 备份</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#M920x-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.4.1.</span> <span class="toc-text">M920x 备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Station"><span class="toc-number">1.4.2.</span> <span class="toc-text">Station</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.5.</span> <span class="toc-text">macOS 备份</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%A4%87%E4%BB%BD"><span class="toc-number">1.5.1.</span> <span class="toc-text">系统备份</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-ABB-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">使用 ABB 备份</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Time-Machine"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">使用 Time Machine</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD"><span class="toc-number">1.5.2.</span> <span class="toc-text">重要文件备份</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iCloud-%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">1.6.</span> <span class="toc-text">iCloud 数据备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Synology-NAS"><span class="toc-number">1.7.</span> <span class="toc-text">Synology NAS</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Snapshot-Replication"><span class="toc-number">1.7.1.</span> <span class="toc-text">Snapshot Replication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hyper-Backup"><span class="toc-number">1.7.2.</span> <span class="toc-text">Hyper Backup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Active-Backup-for-Business"><span class="toc-number">1.7.3.</span> <span class="toc-text">Active Backup for Business</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#NAS-%E6%95%B4%E6%9C%BA%E5%A4%87%E4%BB%BD"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">NAS 整机备份</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Windows-macOS-%E5%A4%87%E4%BB%BD"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">Windows/macOS 备份</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%89%A9%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%87%E4%BB%BD"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">物理服务器备份</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%A4%87%E4%BB%BD"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">文件服务器备份</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%A4%87%E4%BB%BD"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">虚拟机备份</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Synology-Drive-Client"><span class="toc-number">1.7.4.</span> <span class="toc-text">Synology Drive Client</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DSM-%E7%B3%BB%E7%BB%9F%E5%86%97%E4%BD%99"><span class="toc-number">1.7.5.</span> <span class="toc-text">DSM 系统冗余</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DSM-%E9%85%8D%E7%BD%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">1.7.6.</span> <span class="toc-text">DSM 配置备份</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NAS-%E6%95%B4%E6%9C%BA%E5%A4%87%E4%BB%BD-1"><span class="toc-number">1.7.7.</span> <span class="toc-text">NAS 整机备份</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Hyper-Backup-1"><span class="toc-number">1.7.7.1.</span> <span class="toc-text">Hyper Backup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Active-Backup-for-Business-1"><span class="toc-number">1.7.7.2.</span> <span class="toc-text">Active Backup for Business</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%98%E5%8E%9F%E6%95%B4%E4%B8%AA%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.7.7.3.</span> <span class="toc-text">还原整个系统</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83-1"><span class="toc-number">1.7.8.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%97%E4%BD%99%E5%A4%87%E4%BB%BD"><span class="toc-number">1.8.</span> <span class="toc-text">冗余备份</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#macOS-%E4%B8%8A%E6%90%AD%E5%BB%BA-Rsync-Server"><span class="toc-number">1.8.1.</span> <span class="toc-text">macOS 上搭建 Rsync Server</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%91%E7%AB%AF%E5%A4%87%E4%BB%BD"><span class="toc-number">1.9.</span> <span class="toc-text">云端备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E6%97%B6%E9%97%B4%E6%95%B4%E7%90%86"><span class="toc-number">1.10.</span> <span class="toc-text">备份时间整理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#macOS"><span class="toc-number">1.10.1.</span> <span class="toc-text">macOS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#M920x"><span class="toc-number">1.10.2.</span> <span class="toc-text">M920x</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Station-1"><span class="toc-number">1.10.3.</span> <span class="toc-text">Station</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#H28K"><span class="toc-number">1.10.4.</span> <span class="toc-text">H28K</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HK1Box"><span class="toc-number">1.10.5.</span> <span class="toc-text">HK1Box</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NanoPI-NEO4"><span class="toc-number">1.10.6.</span> <span class="toc-text">NanoPI NEO4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%91%E8%8E%93%E6%B4%BE"><span class="toc-number">1.10.7.</span> <span class="toc-text">树莓派</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#R2S-R5S"><span class="toc-number">1.10.8.</span> <span class="toc-text">R2S &amp;&amp; R5S</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NAS-%E5%BF%AB%E7%85%A7"><span class="toc-number">1.10.9.</span> <span class="toc-text">NAS 快照</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DS218"><span class="toc-number">1.10.10.</span> <span class="toc-text">DS218+</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DS923"><span class="toc-number">1.10.11.</span> <span class="toc-text">DS923+</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD%E6%80%BB%E7%BB%93"><span class="toc-number">1.11.</span> <span class="toc-text">数据备份总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">2.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/13e613ba.html" title="Proxmox VE 8.3 安装与配置指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?34n7j520" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Proxmox VE 8.3 安装与配置指南"></a><div class="content"><a class="title" href="/posts/13e613ba.html" title="Proxmox VE 8.3 安装与配置指南">Proxmox VE 8.3 安装与配置指南</a><time datetime="2025-02-17T11:52:42.000Z" title="发表于 2025-02-17 19:52:42">2025-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?mg3iapx4" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Ubuntu 使用备忘录：好记性不如烂笔头"></a><div class="content"><a class="title" href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头">Ubuntu 使用备忘录：好记性不如烂笔头</a><time datetime="2025-02-15T06:37:31.000Z" title="发表于 2025-02-15 14:37:31">2025-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?eb4q02fh" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="使用 Cloudflare 增强公网服务安全性的实践"></a><div class="content"><a class="title" href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践">使用 Cloudflare 增强公网服务安全性的实践</a><time datetime="2025-02-12T16:17:11.000Z" title="发表于 2025-02-13 00:17:11">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?po6ikv1j" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Ubuntu 系统下 LCD4Linux 的安装与配置指南"></a><div class="content"><a class="title" href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南">Ubuntu 系统下 LCD4Linux 的安装与配置指南</a><time datetime="2025-02-12T11:35:45.000Z" title="发表于 2025-02-12 19:35:45">2025-02-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c78c58c7.html" title="树莓派与移远EC20 4G网卡集成及自动拨号方案解析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?56t44pn3" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="树莓派与移远EC20 4G网卡集成及自动拨号方案解析"></a><div class="content"><a class="title" href="/posts/c78c58c7.html" title="树莓派与移远EC20 4G网卡集成及自动拨号方案解析">树莓派与移远EC20 4G网卡集成及自动拨号方案解析</a><time datetime="2025-02-12T06:55:16.000Z" title="发表于 2025-02-12 14:55:16">2025-02-12</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://weibo.com/u/1884084142" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.facebook.com/dsj.array" title="facebook"><i class="anzhiyufont anzhiyu-icon-facebook1"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" size="50px"><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/1835978167" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://v.douyin.com/iUqoRYwb/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener external nofollow noreferrer" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.travellings.cn/go.html">开往</a><a class="footer-item" title="服务状态" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services">服务状态</a></div></div><div class="footer-group"><div class="footer-title">项目</div><div class="footer-links"><a class="footer-item" title="Watt.Stack" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack">Watt.Stack</a><a class="footer-item" title="MIK" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit">MIK</a><a class="footer-item" title="macOS.dev" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev">macOS.dev</a><a class="footer-item" title="更多" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.ink:1024/">更多</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="我的装备" href="/equipment/">我的装备</a><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://nonbot.org/pledged/view/9e6e360a-4834-4dd0-b672-845baa0eb4de" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="Made By Humans" title="Made By Humans"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nonbot_pledged_logo.svg" alt="Made By Humans"></a><a class="github-badge" target="_blank" href="https://notbyai.fyi/cn/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="Not By AI" title="Not By AI"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/written-by-human-not-by-ai-white.svg" alt="Not By AI"></a><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/dong4j" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><footer-bar-left><div id="footer-bar-tips"><div class="copyright" style="display:flex;align-items:center;gap:10px">©2013 - 2025 By <a class="footer-bar-link" href="/" title="dong4j" target="_blank">dong4j</a><span class="indicator" id="indicator" style="display:inline-block;width:8px;height:8px;border-radius:50%;background-color:green;margin-left:0;animation:subtle-breathing 1.2s infinite;box-shadow:0 0 5px rgba(255,0,0,.8)"></span><span>在线人数:</span><span id="online_user" style="font-size:1em;font-weight:700">1</span></div></div><div id="footer-type-tips"></div></footer-bar-left><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/" title="蜀ICP备2025119258号">蜀ICP备2025119258号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">258</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">1094</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">18</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.dong4j.site" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/homepage.webp" alt="个人主页"><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://blog.dong4j.site" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/blog.webp" alt="博客"><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://resume.dong4j.site" title="简历"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/resume.webp" alt="简历"><span class="back-menu-item-text">简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://npx-card.dong4j.site" title="npx-card"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/npx-card.webp" alt="npx-card"><span class="back-menu-item-text">npx-card</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack" title="Watt.Stack"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/watt.webp" alt="Watt.Stack"><span class="back-menu-item-text">Watt.Stack</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit" title="MIK"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mik.webp" alt="MIK"><span class="back-menu-item-text">MIK</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev" title="macOS.dev"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mac.webp" alt="macOS.dev"><span class="back-menu-item-text">macOS.dev</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.site/" title="更多"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/project.webp" alt="更多"><span class="back-menu-item-text">更多</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">服务</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services" title="服务状态"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/uptime-kuma.svg" alt="服务状态"><span class="back-menu-item-text">服务状态</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nezha.dong4j.dev" title="服务面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nezha.webp" alt="服务面板"><span class="back-menu-item-text">服务面板</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nav.dong4j.dev" title="导航页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nav.webp" alt="导航页"><span class="back-menu-item-text">导航页</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://umami.dong4j.ink:1024/share/V7Rat8DdVw4npjl2/blog.dong4j.site" title="Umami"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/umami.webp" alt="Umami"><span class="back-menu-item-text">Umami</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://muselink.cc/dong4j 👈这是我的MuseLink数字名片！" title="数字名片"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/muse.lin.webp" alt="数字名片"><span class="back-menu-item-text">数字名片</span></a><a class="back-menu-item" href="/ai/deepseek-r1-webgpu/" title="DeepSeek"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/deepseek.webp" alt="DeepSeek"><span class="back-menu-item-text">DeepSeek</span></a><a class="back-menu-item" href="/ai/rmbg/playground/" title="RMBG"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/rmbg.webp" alt="RMBG"><span class="back-menu-item-text">RMBG</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.dong4j.site/" title="Mini-Chat"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/emoji1.webp" alt="Mini-Chat"><span class="back-menu-item-text">Mini-Chat</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa fa-comments faa-tada"></i><span> 最新评论</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size:.9em"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/memos/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 备忘录</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fa-solid fa-map faa-tada"></i><span> 折腾清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/stars/"><i class="fa-brands fa-github faa-tada"></i><span> Star 清单</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.dong4j.dev"><span>小黑屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size:.88rem;color:#556363;font-weight:500;color:var(--anzhiyu-lighttext)">Java<sup>48</sup></a><a href="/tags/final/" style="font-size:.88rem;color:#678a45">final<sup>2</sup></a><a href="/tags/finalize/" style="font-size:.88rem;color:#c069bc">finalize<sup>1</sup></a><a href="/tags/finally/" style="font-size:.88rem;color:#714840">finally<sup>2</sup></a><a href="/tags/new%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:.88rem;color:#197f3d">new关键字<sup>1</sup></a><a href="/tags/static/" style="font-size:.88rem;color:#704a0d">static<sup>1</sup></a><a href="/tags/super/" style="font-size:.88rem;color:#338051">super<sup>2</sup></a><a href="/tags/this/" style="font-size:.88rem;color:#a224a6">this<sup>1</sup></a><a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size:.88rem;color:#334e6b">二进制<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size:.88rem;color:#2dbd22">数据类型<sup>4</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" style="font-size:.88rem;color:#b7640c">构造方法<sup>1</sup></a><a href="/tags/%E6%BA%A2%E5%87%BA/" style="font-size:.88rem;color:#0b6ab5">溢出<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:.88rem;color:#0e1424">算法<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" style="font-size:.88rem;color:#000592">编程实践<sup>2</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F/" style="font-size:.88rem;color:#56b352">计算机程序<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/" style="font-size:.88rem;color:#8a3737">计算机语言<sup>1</sup></a><a href="/tags/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" style="font-size:.88rem;color:#a03027">访问控制<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size:.88rem;color:#0d6442">软件<sup>1</sup></a><a href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" style="font-size:.88rem;color:#c753c8">错误处理<sup>2</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size:.88rem;color:#c14483">面向对象<sup>6</sup></a></div></div><hr></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask(()=>{function o(){HoldLog.apply(console,arguments)}var c=new Date("6/28/2018 00:00:00"),c=(now1.setTime(now1.getTime()+250),(now1-c)/1e3/60/60/24),c=["Hi there 👋，I'm dong4j, Welcome to my blog","岁月静好，诗酒趁年华🍺",`
        
      +========================================================+
      |  ██████╗  ██████╗ ███╗   ██╗ ██████╗ ██╗  ██╗     ██╗  |
      |  ██╔══██╗██╔═══██╗████╗  ██║██╔════╝ ██║  ██║     ██║  |
      |  ██║  ██║██║   ██║██╔██╗ ██║██║  ███╗███████║     ██║  |
      |  ██║  ██║██║   ██║██║╚██╗██║██║   ██║╚════██║██   ██║  |
      |  ██████╔╝╚██████╔╝██║ ╚████║╚██████╔╝     ██║╚█████╔╝  |
      |  ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝ ╚═════╝      ╚═╝ ╚════╝   |
      +========================================================+
        
        `,"已上线",Math.floor(c),"天","Use 「npx dong4j」 and find me."],e=["NCC2-036","调用前置摄像头拍照成功，识别为【绝顶大佬】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`
%c${c[0]} %c ${c[1]} %c ${c[2]} %c${c[3]}%c ${c[4]}%c ${c[5]}

%c ${c[6]}
`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${e[0]} %c ${e[1]} %c 
${e[2]} %c
${e[3]}
`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，绝顶大佬.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 dong4j 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))})</script><script async="" src="/anzhiyu/random.js"></script><script async="">(()=>{var n,o,r,a,i,e=new Date("6/28/2018 00:00:00"),l=new Date;setInterval(()=>{var t;if(l=new Date,i=l.getHours(),t=(l-e)/1e3/60/60/24,n=Math.floor(t),t=(l-e)/1e3/60/60-24*n,o=Math.floor(t),1==String(o).length&&(o="0"+o),t=(l-e)/1e3/60-1440*n-60*o,r=Math.floor(t),1==String(r).length&&(r="0"+r),t=(l-e)/1e3-86400*n-3600*o-60*r,a=Math.round(t),1==String(a).length&&(a="0"+a),document.getElementById("footer")){let e="";e=(i<18&&9<=i||null!=(t=document.querySelector("#workboard .workSituationImg"))&&(t.src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg",t.title="下班了就该开开心心的玩耍，嘿嘿~",t.alt="下班了就该开开心心的玩耍，嘿嘿~"),`本站居然运行了 ${n} 天<span id='runtime'> ${o} 小时 ${r} 分 ${a} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`),document.getElementById("runtimeTextTip")&&(document.getElementById("runtimeTextTip").innerHTML=e)}},1e3)})()</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(()=>{let t=document.querySelectorAll("#article-container .mermaid-wrap");if(0!==t.length){let e=()=>{window.loadMermaid=!0;let a="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(t).forEach((e,t)=>{let d=e.firstElementChild;e="%%{init:{ 'theme':'"+a+"'}}%%\n"+d.textContent;let n=mermaid.render("mermaid-"+t,e);"string"==typeof n?(t=n,d.insertAdjacentHTML("afterend",t)):n.then(({svg:e})=>{d.insertAdjacentHTML("afterend",e)})})};var d=()=>{window.loadMermaid?e():getScript("https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js").then(e)};anzhiyu.addGlobalFn("themeChange",e,"mermaid"),window.pjax?d():document.addEventListener("DOMContentLoaded",d)}})()</script><script>(()=>{let t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.dong4j.ink:1024",region:"",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))};var o=()=>{"object"==typeof twikoo?setTimeout(n,0):getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(n)};let e=()=>{let o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo.dong4j.ink:1024",region:"",urls:[window.location.pathname],includeReply:!1}).then(t=>{o.textContent=t[0].count}).catch(t=>{console.error(t)})},n=()=>{t(),GLOBAL_CONFIG_SITE.isPost&&e()};o()})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",()=>{let t=e=>e=""!==e&&150<(e=(e=(e=(e=e.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length?e.substring(0,150)+"...":e,n=t=>{let n="";if(t.length)for(let e=0;e<t.length;e++)n=(n=(n+="<div class='aside-list-item'>")+`<a href='${t[e].url}' class='thumbnail'><img data-lazy-src='${t[e].avatar}' alt='${t[e].nick}'><div class='name'><span>${t[e].nick} </span></div></a>`)+`<div class='content'>
        <a class='comment' href='${t[e].url}' title='${t[e].content}'>${t[e].content}</a>
        <time datetime="${t[e].date}">${anzhiyu.diffDate(t[e].date,!0)}</time></div>
        </div>`;else n+="没有评论";var e=document.querySelector("#card-newest-comments .aside-list");e&&(e.innerHTML=n),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(e)};var e=()=>{var e;document.querySelector("#card-newest-comments .aside-list")&&((e=saveToLocal.get("twikoo-newest-comments"))?n(JSON.parse(e)):(e=()=>{twikoo.getRecentComments({envId:"https://twikoo.dong4j.ink:1024",region:"",pageSize:6,includeReply:!0}).then(function(e){e=e.map(e=>({content:t(e.comment),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(e),10/1440),n(e)}).catch(function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"})},"object"==typeof twikoo?e():getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(e)))};e(),document.addEventListener("pjax:complete",e)})</script><script>var visitorMail="996@icu.com"</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/subscribe.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/card-widget-today.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/card-widget-calendar.css" media="print" onload="this.media=&quot;all&quot;"><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/automatic-redirection.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-welcome.js"></script><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/card-widget-comments.js"></script><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/card-widget-today.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-countdown.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-calendar.js"></script><script async="" data-pjax="" src="https://open.lightxi.com/unpkg/chinese-lunar@0.1.4/lib/chinese-lunar.js"></script><script async="" data-pjax="" src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script src="https://cdn.dong4j.site/source/static/custom.js"></script><script src="https://cdn.dong4j.site/source/static/geoip2-check.js"></script><script defer="" id="fluttering_ribbon" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="永不言败,勇往直前,砥砺前行,自强不息,笃行致远,厚德载物,持之以恒,奋发有为,志在四方,拼搏进取,实事求是，为人民服务,勤劳致富，共奔小康,爱国、创新、包容、厚德,敬业乐群，诚信友善,自强不息，厚德载物,以人为本，全面协调可持续发展,建设生态文明，构建和谐社会,坚持改革开放，推动科学发展,立党为公，执政为民,实现中华民族伟大复兴的中国梦" data-fontsize="15px" data-random="true" async=""></script><script src="//code.tidio.co/14aqpkwnauu3r5ngcmspfxwelvattym5.js" async=""></script><script>(()=>{{let i=!1,o=()=>{window.tidioChatApi.hide(),i=!1,document.body.style.position="relative",document.documentElement.style.overflow="auto"};var t=()=>{window.tidioChatApi.hide(),window.tidioChatApi.on("close",o)};window.tidioChatApi?window.tidioChatApi.on("ready",t):document.addEventListener("tidioChat-ready",t),window.chatBtnFn=()=>{window.tidioChatApi&&(i?o():(window.tidioChatApi.open(),window.tidioChatApi.show(),i=!0))}}})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();var e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")}),document.addEventListener("pjax:complete",function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{let t=document.createElement("script");var a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()}),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async="" data-pjax="" data-prefix="busuanzi_value" src="https://cdn.dong4j.site/source/static/busuanzi.self.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script data-pjax="" src="https://cdn.dong4j.site/source/static/github-calendar.js"></script><script data-pjax="">function GithubCalendarConfig(){var t=document.getElementById("recent-posts");t&&"/"==location.pathname&&(console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>')),GithubCalendar("https://github-calendar.dong4j.ink:1024/api?user=dong4j",["#ebedf0","#a2f7af","#6ce480","#54ad63","#469252","#31753c","#1f5f2a","#13531f","#084111","#032b09","#000000"],"dong4j")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:0}}</style><style></style></body></html>