<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>Proxmox VE 8.3 安装与配置指南 | 司机带你开车</title><meta name="keywords" content="Node.js,LLM,one-api"><meta name="author" content="dong4j"><meta name="copyright" content="dong4j"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Proxmox VE 8.3 安装与配置指南"><meta name="application-name" content="Proxmox VE 8.3 安装与配置指南"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Proxmox VE 8.3 安装与配置指南"><meta property="og:url" content="https://blog.dong4j.site/posts/13e613ba.html"><meta property="og:site_name" content="司机带你开车"><meta property="og:description" content="本文是一份关于 Proxmox VE 8.3 的安装与配置指南，涵盖了从基础的网络设置到高级的存储配置，以及如何连接 4G 网卡和 USB 摄像头等。通过详细的步骤和代码示例，读者可以按照指南一步步完成自己的 Proxmox VE 环境搭建。无论是新手还是有经验的用户，都能从中获得有用的信息和技巧。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://api.dong4j.ink:1024/cover?34n7j520"><meta property="article:author" content="dong4j"><meta property="article:tag" content="dong4j, Java, Python, Golang, HomeLab, SpringBoot, 架构"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://api.dong4j.ink:1024/cover?34n7j520"><meta name="description" content="本文是一份关于 Proxmox VE 8.3 的安装与配置指南，涵盖了从基础的网络设置到高级的存储配置，以及如何连接 4G 网卡和 USB 摄像头等。通过详细的步骤和代码示例，读者可以按照指南一步步完成自己的 Proxmox VE 环境搭建。无论是新手还是有经验的用户，都能从中获得有用的信息和技巧。"><link rel="shortcut icon" href="https://cdn.dong4j.site/source/image/favicon.ico"><link rel="canonical" href="https://blog.dong4j.site/posts/13e613ba.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//hm.baidu.com"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="codeva-D4HsBP841S"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media=&quot;all&quot;"><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?61a751ac36d18d3ba293fe8ef3ec53eb",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script><script>let GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"与数百名博主无限进步",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"Local",mode:"online",switchBtn:!0,btnLink:"https://github.com/dong4j/blog-summary-assistant-server",randomNum:3,basicWordCount:1999,key:"84yT3Gkl6fp",Referer:"https://blog.dong4j.site:1024",apiUrl:"https://oneapi.dong4j.ink:1024/api/summary",audioUrl:"https://api.dong4j.ink:1024/audio"},diytitle:{enable:!0,leaveTitle:"兄台留步 🙏",backTitle:"兄台,别来无恙 👋"},LA51:{enable:!0,ck:"3Ki5mmyy6E5xtXuf",LingQueMonitorID:"3Ki5mmyy6E5xtXuf"},greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.dong4j.ink:1024",commentBarrageConfig:{enable:!0,maxBarrage:1,barrageTime:4e3,accessToken:"3a358103e6024cfb97546ec8f8408f5a",mailMd5:"3435c7a74ba1cad3f5d57b0b61b9b25cee221b97599c47b32edbdb36038c5411"},music_page_default:"nav_music",root:"/",preloader:{source:"car"},friends_vue_info:{apiurl:"https://friends.dong4j.ink:1024/"},navMusic:!0,mainTone:{mode:"both",api:"https://img2color.dong4j.ink:1024/api?img=",cover_change:!0},authorStatus:{skills:["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","😎 HomeLab 折腾专家","🏃 脚踏实地行动派","🧱 团队小组发动机","👶 尿不湿更换专家"]},algolia:{appId:"JFMEP32WXP",apiKey:"8e3acd038435dda872706ba6777a54b3",indexName:"blog-index",hits:{per_page:10},languages:{input_placeholder:"输入关键词后按下回车查找",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"该内容距离上次更新已经过了",messageNext:"天，文章内容可能已经过时。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!0,post:!0},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: dong4j",link:"链接: ",source:"来源: 司机带你开车",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"mediumZoom",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0,shortcutKey:{enable:!0,delay:100,shiftDelay:200},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"司机带你开车",title:"Proxmox VE 8.3 安装与配置指南",postAI:"本文是一份关于 Proxmox VE 8.3 的安装与配置指南，涵盖了从基础的网络设置到高级的存储配置，以及如何连接 4G 网卡和 USB 摄像头等。通过详细的步骤和代码示例，读者可以按照指南一步步完成自己的 Proxmox VE 环境搭建。无论是新手还是有经验的用户，都能从中获得有用的信息和技巧。",pageFillDescription:"简介, 安装完成后 IP 不对, 更换源, 通用软件源, pve 软件源, Ceph 源, CT 镜像下载源, 删除订阅弹窗, oh-my-zsh, 连接 WiFi, Web 打不开, pve_source 脚本, 迁移 Ubuntu 系统到 PVE, 镜像打包, 安装到 PVE, 安装 Windows, 核显直通与虚拟核显直通, 虚拟核显直通, 安装 Ubuntu, 开启 SSH 登录, 开启远程桌面, 安装 docker, docker 镜像源, 修改时区, 终端支持中文显示, 直通 nvme, LVM 扩容, 磁盘共享, 测试 NVMe 读写速度, Ceph 节点简介, 时间同步, 安装 Ceph, 配置 Ceph, 使用, 在 PVE 虚拟机中挂载 CephFS, 在虚拟机中使用 RBD（块存储）, Dashboard, 卸载 Ceph 🙉, ZFS, 使用, 网络, 策略路由, 基于 debian 的虚拟机配置, 基于 ubuntu 的虚拟机配置, 问题, 解决办法, 基于 debian, 基于 ubuntu, 流程图, qemu-guest-agent, 删减 PCIe 设备后网卡名称变更, 4G 网卡拨号(qmi_wwan), 自动拨号, 4G 网卡拨号(wvdial), 自动拨号, 搭建 40Gx2F56G 内网, 40G, 56G, 安装 MFT, 查询固件信息, 切换 IBx2FEthernet 模式, IB 组网, InfiniBand 子网管理器, IP over Infiniband, 测试 IB 网络速度, 使用 RDMA 提升 IB 网络性能, 82599ES 网卡 开启 SR-IOV, 连接 USB 摄像头, 推流, Cloud-init, 使用域名并添加 SSL 证书, 自制 CT 模版, 创建容器备份, 备份, 集群, 退出集群, 优化, 功耗节能, 问题汇总, ERROR Verification failed (0x1A) Security Violation, daemons have recently crashed, 运维脚本, 参考简介本文汇总了我在三台联想上搭建和使用过程中的心得与遇到的问题在选择虚拟化平台时我倾向于而非这一选择基于的开源性及其基于的架构这为它带来了相比更多的可玩性和折腾空间选择或并不在于哪个更优秀而在于哪个更能满足个人的特定需求安装完成后不对启动后出现了一张网卡这个是桥接网卡可以查看绑定的物理网卡修改一下个文件参考更换源通用软件源默认注释了源码镜像以提高速度如有需要可自行取消注释软件源清空使用非企业版源源镜像下载源将文件中默认的源地址替换为即可删除订阅弹窗连接名称密码会得到类似以下的输出也可以使用网页工具计算名称密码密码的密钥值我们需要复制这个值打开文件添加以下内容网卡名称如果你使用静态网卡名称你要分配的地址如网关地址名称密码的密钥值如果你使用动态网卡名称名称密码的密钥值为了方便管理我们推荐你使用静态重启网络网卡名称网卡名称安装工具查看信息参考基于与无线网卡的主机调试记录中使用连接无线网络打不开脚本稳定版开发版系统配置核显直通核显调整为定制向导推荐方案迁移系统到列举一下已存在的固态硬盘信息一共固态硬盘其中安装的其他根还未使用镜像打包原来安装的固态硬盘已经从机器上拔下来了为了将此固态硬盘中的系统打包成镜像然后恢复到中这里使用了来完成这项工作使用到的工具执行完成后会在指定的盘生成一些系统文件但是这个还不能直接使用所以我又使用将这些文件打包成最终的目的是将系统打包成然后在中使用虚拟机安装参考再生龙克隆系统操作指南使用再生龙进行系统的镜像完全封装和还原安装到在下查看显卡的信息要直通这块卡给虚拟机需要准备开启直通安装虚拟机就是上一步打包的安装核显直通与虚拟核显直通物理核显直通的优缺点对比优点缺点物理核显直通性能强支持物理显示输出兼容性好不妨碍升级独占不支持直通给多个虚拟机直通后宿主不能同时用核显虚拟核显直通可分为多个虚拟显卡给不同的虚拟机使用性能拆分分成多个显卡具体如何分配性能不详如等不建议超过个显卡具有性能高核显的处理器可以分为最高个不支持物理显示输出虽可使用等软件远程桌面但占用率较高在作为服务器的小主机上让原本紧张的资源更加捉襟见肘对内核依赖升级受限兼容性稳定性一般部分流媒体软件硬解转码功能受限虚拟核显直通在后添加有修改虚拟核显数量的需求将原来写入的参数注释掉改成你需要的数量例如下述为个参考的快乐之系统配置及核显直通一边原神一边同时独显直通和核显虚拟化玩转打造本地大模型地基配置显卡直通直通配置配置显卡直通直通显卡安装中的网络模型选择取决于虚拟机的用途和性能需求不同的网卡模型有不同的兼容性和性能以下是对比半虚拟化推荐优点性能最佳支持高吞吐量低开销延迟最低适合高性能服务器数据库服务等应用现代自带驱动无需额外安装缺点需要手动安装驱动可以从这里下载推荐用于虚拟机安装驱动高性能应用兼容性好但性能一般优点兼容性非常好几乎所有操作系统都自带驱动无需额外安装适用于老旧操作系统如缺点开销大数据包处理效率低带宽限制在无法发挥现代硬件的最大性能适用于老旧操作系统如兼容性优先的环境极老几乎不推荐优点兼容性好适用于一些极老的操作系统如缺点性能最差带宽完全跟不上现代网络需求高负载不适合生产环境不推荐除非你要运行这类老系统适用于兼容环境优点适合从迁移的虚拟机可无缝兼容环境低开销性能比好缺点需要安装才能正常工作否则性能低下如果不是从迁移过来的仍然是更好的选择适用于从迁移过来的虚拟机总结选项性能兼容性适用场景推荐度半虚拟化最佳需要驱动自带需安装现代安装驱动高吞吐应用一般无需驱动老旧兼容性优先最差无需驱动极老系统较好需要从迁移的推荐选选安装驱动选迁移过来的选最终建议如果是或现代请使用半虚拟化它的性能最佳开启登录安装安装完成后服务默认自动启动你可以通过以下命令校验服务运行状态如果你启用了防火墙请确保防火墙打开了端口命令如下允许远程登录修改配置重启服务开启远程桌面因为通过控制台链接后进入设置页面打开远程桌面老是卡死所以直接通过命令行操作安装执行前先开启代理镜像源将内容写入文件用户可以去掉配置镜像使用多个镜像源来提高镜像下载速度重启服务以使配置生效修改时区终端支持中文显示直通因为同品牌固态硬盘在的硬件列表中无法区分所以需要在命令行在找到具体的才能直通给虚拟机避免错误的将安装了系统的分配给虚拟机导致崩溃查看的列表查看系统安装在哪块盘上面的输出得知安装在因此就是应该直通给虚拟机的盘让我们找出它的找到了或者这样也行扩容刚开始只给了磁盘后面光安装显卡驱动就不够用了所以在控制天新添加了空间给其中是新增的磁盘需要将这空间添加到根分区中将添加为一个物理卷将新创建的物理卷添加到现有的卷组中扩展的是根分区扩展完逻辑卷后需要扩展文件系统使其能够使用新的空间文件系统文件系统检查文件系统是否成功扩展参考系列教程二十二安装桌面版玩转打造本地大模型地基制作模板磁盘共享测试读写速度可以使用等工具下面是具体的推荐及使用方法推荐工具最佳选择适用于真实负载是专业的存储测试工具可以模拟多线程高并发读写适合评估的真实性能安装测试顺序写最大写入速度块大小线程并发绕过系统缓存顺序写预期结果写入写入测试顺序读取最大读取速度顺序读取预期结果读取速度一般高于写入速度测试随机读写性能随机读写块大小深度读写随机读写主要看高端可能达到推荐工具快速测试可以用于简单的读写测试但不能准确反映真实性能顺序写输出示例顺序读读取速度通常比写入更快推荐工具查看驱动和硬件信息可以查看型号协议接口速度查看的寿命温度错误统计结论测试方式优点适用场景专业级支持多线程高并发最精准的测试简单易用适合快速测试快速测试顺序读写适用于设备管理查看信息和健康状态节点简介监视器负责维护集群状态映射帮助协调守护进程并负责管理守护进程与客户端之间的身份验证通常需要至少三个节点管理器守护进程负责跟踪运行时指标和当前运行状态并负责管理和公开集群信息通常需要至少两个节点对象存储守护进程负责存储数据处理数据复制恢复重新平衡并通过检查其他心跳向监视器和管理器提供监视信息通常需要至少三个节点元数据服务器负责存储元数据并允许用户运行基本命令而不为存储集群带来负担时间同步修改服务器地址允许客户同步段同步时需要配置手动同步查看本机时间同步状态查看时间同步服务器列表参考管理时间同步服务安装直接在端安装但是安装后报错原因是节点启动失败但是在端有没有节点显示创建的时候报错所以直接使用命令行来处理节点节点配置节点上的所以有和可以使用上的上面是系统盘另一块直通给使用了所以没有显示出来这个在数据迁移完成后再处理我们先将节点的块添加到这里将每块盘拆分为个分区然后将这些分区分别添加为独立的这样可以让更加高效利用资源同时减少阻塞提高并发性能使用命令将这些分区作为检查结果接下来还需要配置存储池并将存储池添加到和使用在虚拟机中挂载创建添加到中的在或中挂载在虚拟机中使用块存储查看存储池创建在内部映射磁盘并进行基本设置参考部署超融合集群超融合集群部署实录集群完整方案完整方案上使用的想法算了总结了太复杂了现在个跑了一晚上数据还没有同步完成所以打算玩玩家用应该也够了参考启用仪表盘配置对象网关卸载停止并禁用服务首先确保停止所有与相关的服务包括等然后禁用这些服务以确保它们不会在系统重启后自动启动卸载软件包卸载所有相关的包这将删除所有相关的软件包及其依赖删除配置和数据删除的配置文件和数据目录这些目录包含了的所有配置日志和数据文件清理卷和数据如果您使用了来管理确保删除所有的卷和卷组首先查看当前的配置如果存在使用的逻辑卷卷组或物理卷可以使用以下命令删除它们删除逻辑卷删除卷组删除物理卷删除设备用实际的设备路径替换删除相关的系统服务文件清理服务文件确保没有服务文件残留清除集群配置和密钥如果还没有删除集群的密钥环和配置文件可以手动清理删除清理网络和存储设置如果配置了使用的特定网络接口或防火墙规则请手动清理这些设置清理防火墙规则使用或清理使用的端口删除虚拟网络接口如等和存储挂载点重启系统完成以上步骤后最好重启系统以确保所有组件完全卸载检查系统状态重启后可以使用以下命令检查系统中是否仍然存在与相关的进程或配置检查是否有相关的进程检查配置是否被完全清除检查是否有残留的卷使用以下命令检查系统日志是否仍有相关的错误我块的的固态硬盘分别是和还有一块的而且后期我可能还会增加其他和现在我想在集群中使用初步计划是让划分为个分区分别作为的读写缓存而其他盘作为数据盘下面是具体操作使用在宿主机中使用存储支持直接在宿主机中使用存储池可以将存储池挂载到宿主机的特定目录然后将虚拟机和容器配置为使用该存储挂载存储这将把你的存储池挂载到目录可以在这个目录下创建文件并访问创建快照如果你想对存储池进行快照可以使用在虚拟机中使用存储要在虚拟机中使用存储可以通过以下两种方式方式使用作为虚拟机的磁盘在宿主机中创建一个数据集作为虚拟机的磁盘在中的虚拟机配置中将数据集作为虚拟磁盘挂载给虚拟机例如通过界面可以在虚拟机的硬盘设置中选择该数据集或者通过命令行使用方式使用文件共享给虚拟机如果不希望直接将存储池作为虚拟磁盘可以将存储池中的某个目录挂载为共享目录虚拟机通过网络访问在宿主机中创建目录设置权限在虚拟机内挂载或共享见下面的共享存储到局域网部分在容器中使用存储容器与虚拟机类似也可以直接访问宿主机上的存储池可以通过以下方式将存储挂载到容器内部挂载存储到容器目录可以将宿主机上的存储池挂载到容器的某个目录假设将挂载到容器中的可以在容器配置中添加以下配置编辑配置文件添加重新启动容器容器就能访问宿主机上的存储了在局域网中共享存储如果希望将存储共享给局域网中的其他设备比如其他计算机服务器或虚拟机可以使用或使用共享存储安装服务配置共享目录在文件中添加存储目录重新启动服务在客户端其他计算机挂载共享宿主机上通过挂载的问题在上读取硬盘添加储存使用共享存储安装配置共享目录编辑文件添加以下配置允许匿名访问设置文件的创建权限设置目录的创建权限重启服务在客户端其他计算机访问共享通过协议挂载共享宿主机网络策略路由每台都有至少个网卡且分别链接到电信和联通宽带因为只能设置一个网关所以需要通过策略路由的方式让第二块网卡可以链接外网比如是第一块网卡且能够成功链接外网是另一块网卡需要配置策略路由添加第二个默认路由创建规则然后使用测试不同的网卡能够成功返回正确的外网地址持久化编辑基于的虚拟机配置同上需要修改一下网卡名基于的虚拟机配置编辑问题上述配置后虽然能够通过两张网卡同时访问外网但是局域网的其他设备则无法通过网卡访问和虚拟机问题在于没有上述配置时如果从其他设备访问时知道请求来自直接通过返回因为同网段的流量不会走路由表只要有流量就会正常往返为了能让第二块网卡也能访问外网我们添加了如下配置定义让它的默认网关是让从发出的流量走也就是这样如果通过访问外网它就会从走从而实现两张网卡都能访问外网的目标但是当局域网设备访问时的路由策略默认使用主路由表决定回包路径而默认路由定义的是网卡所以会把默认从网卡出去导致请求的设备无法正确接收数据为什么设备无法正确接收数据收到设备的请求比如想访问它发送数据包这个包会通过接收的默认路由选择出口既有也有假设因为的默认网关是所以它的默认路由是默认使用主路由表进行路由查找而不是基于入口接口回包于是发送回包但是它从的网关出去了回包从出去导致失败设备本来期望请求回包但实际上发生了请求回包却从出去这导致收到的回包源还是但路由器可能会丢弃该包因为它的入站连接不是从发出的而是从来的这导致不匹配许多防火墙特别是企业路由器默认会丢弃非对称路由的回包因为它可能是伪造流量解决办法为了满足以下要求的两张网卡都能访问外网局域网能够正常访问的两张网卡我们需要做如下配置基于或虚拟机中只需要修改一下网卡名称基于最后我们可以以下命令验证流程图外部设备设备设备服务器路由表策略路由网关默认网关连接设备到流量进入流量进入的路由处理默认流量走主路由表匹配规则出口设备访问返回流量回包流量返回回包流量返回虚拟机执行命令不过报错了虚拟机内的无法找到设备通常是因为的配置没有正确启用所以需要在宿主机上开启虚拟机的然后还是启动失败查阅资料后发现是需要添加一个的设备然后再次启动显示启动成功了能够正常获取信息服务器上查看虚拟机信息查看查看磁盘信息查看主机名查看内存块信息查看您内存查看系统信息查看时间查看时区用户查看数量查看支持的命令查看网络不明关机休眠储存到硬盘休眠混合挂起休眠内存参考中的安装和使用删减设备后网卡名称变更网卡名称发生变化是因为系统使用了设备管理器来自动为网络接口分配名称默认使用可预测的网络接口名称规则这个规则基于网卡的硬件地址地址或者设备路径例如地址来命名网卡当拔掉后系统可能重新分配了网卡接口的名称这主要是因为插槽顺序设备初始化顺序等因素的变化导致了给网卡分配了不同的名称这会导致系统中已经配置好的网络会无法获取我们可以通过规则固定网卡名称重新加载规则我重新加载后没有生效是重启解决的这样系统每次启动时都会根据这个规则将指定的网卡名称固定为你指定的名称网卡拨号配置网卡并拨号上网查看系统中识别到的设备获取卡的设备信息获取卡的卡状态获取网络信号强度信息获取运营商网络状态设置并启动拨号连接替换为实际中国移动中国联通中国电信获取拨号后的网络配置获取当前网络配置包括地址子网掩码和网关配置动态获取为接口配置动态获取地址在文件中添加以下内容配置使用动态获取地址启动并检查网络接口重启网络服务以使配置生效确认接口已正确获取地址查看网络路由确保默认路由通过网卡手动请求获取可选使用手动请求服务器分配地址再次检查接口状态确认是否已获取到地址添加默认路由如果需要如果地址已正确分配但默认路由没有设置可以手动添加默认路由配置可选手动添加服务器配置虚拟网络桥接编辑网络配置文件确保接口桥接到虚拟网桥添加如下配置使虚拟机通过网络连接测试网络连接测试网络是否能正常连接到外部地址测试是否能解析域名动态更新地址和路由如果需要静态配置创建脚本来动态更新地址和路由当变化时添加以下内容更新更新默认路由更新的地址仅在你使用静态时才需要赋予脚本执行权限自动拨号参考网卡拨号打开配置文件电信拨号自动拨号运行步骤变量初始化超时计数初始化循环第一步先检查驱动使用查看是否有驱动查询结果是否包含检查驱动延时第二步开始使用拨号拨号第三步查询路由是否包含网卡拨号成功则会包含有网卡检查是否存在网卡包含网卡添加默认路由若包含网卡则添加默认路由不包含网卡再次循环查询循环次数超时计数若一分钟都没有路由网卡则说明没有拨号成功次检查不存在路由网卡说明没有拨号成功进入重启逻辑超时拨号则跳入重启步骤第四步通过命令检查网络状态通过命令检查网络状态成功失败再次循环查询超时则杀掉拨号线程并进入重启步骤次失败进入重启逻辑第五步重启模块重启网卡重启命令后延时稍微长一点搭建内网购买的迈络思默认为模式所以直接连接然后测试基本上跑满了带宽需要设置成模式安装安装依赖安装时报错我在另一台上安装则没有问题给我的回答是阻止了未签名的驱动所以查看一下两台的的状态报错的这台开启了另一台则没有开启所以基本上确认是这个问题需要去禁用然后重新安装第一次安装的是版本安装后使用出现如下问题加载模块后又自动卸载了且使用无法获取网卡信息查阅相关信息后是因为版本问题在尝试了多个版本后确认版本可行我的网卡是和查询固件信息切换模式首先查询当前连接模式其中为修改为模式模式模式模式组网安装相关依赖检查设备是否可用子网管理器输出显示仍然处于状态说明连接还没有完全建立因为网络需要来管理连接默认情况下如果网络中没有运行交换机支持则需要在至少一台服务器上运行所有网络都必须运行子网管理器才能正常工作即使两台机器没有使用交换机直接进行连接也是如此有可能有一个以上的子网管理器在这种情况下一个充当一个主子网管理器另一个子网管理器充当从属子网管理器当主子网管理器出现故障时将接管提供这是子网管理器的实现但是的功能是有限的没有活跃的上游开发通常交换机中嵌入的子网管理器提供更多功能并支持最新的硬件详情请查看安装和配置子网管理器现在显示连接正常且自动新增了一个网络接下来就是配置静态将两台通过网络连接是一种高速网络通信技术用于在计算机系统和数据中心中连接高性能计算存储和网络设备提供了一种高效的低延迟和高带宽的解决方案通过使用专用硬件和协议来提高数据传输的速度和可靠性与传统的以太网技术相比提供了更高的带宽和更低的延迟然而不是所有的软件都支持因此赋予一个则可以让它兼容大部分的软件协议这种方法就是自动加载模块重启网络测试在上在上测试首先在的服务器节点为上启动服务端然后查询相关信息显示有个节点分别是和所以我们可以在节点上作为客户端启动测试测试网络速度在节点上运行在节点上运行速率接近说明速率正常使用提升网络性能然后检查是否启用如果返回说明已开启可以进一步提升网络性能服务器有多个网卡并且已经配置好运行当中却没记得分别对应的是哪个物理的网卡此时可以使用如下命令此时就会看到对应的物理口一个灯在不停的闪烁参考电脑硬件学习笔记固件从升级到网络家用万兆网络指南不如先来个最简单的网络网卡测速在中使用配置和网络网络中走协议网卡安装教程网卡开启参考开启网卡虚拟化基于英特尔网卡网卡开启保姆级教程连接摄像头加载驱动检查摄像头设备文件安装是用于视频设备的工具可以测试和配置摄像头推流如果需要修改分辨率我们需要先支持摄像头支持哪些分辨率推流参数解析作用指定输入格式为即使用驱动来捕获视频流背景是系统中处理视频设备例如摄像头的视频驱动标准此参数告诉使用驱动来捕获摄像头的实时视频流作用指定输入视频源这里是表示连接的摄像头设备背景在系统中视频设备通常以的形式表示是数字你可以通过命令查看设备名称通常第一个摄像头是作用指定视频编码器使用即编码格式背景是一种高效的视频编码器广泛用于视频流和视频文件的压缩是现代视频流媒体中的常见编码格式因为它可以提供较高的压缩效率和质量作用设置编码预设为这是一个编码速度最快的设置但会牺牲一定的视频压缩率背景控制编码的速度和压缩效率选择较快的编码预设可以减少延迟是最快的预设但会使文件体积相对较大适合低延迟的实时流作用优化编码器以减少延迟背景选项控制编码器的调优模式是一种专门用于低延迟流的设置适用于直播视频会议等实时应用作用设置输出视频的分辨率为背景选项用于设置输出视频的分辨率是常见的高清分辨率如果你的摄像头支持更高的分辨率可以根据需要进行调整作用设置输出格式为格式背景是一种常用于流媒体传输的格式尤其是在流媒体传输中大部分流媒体服务器如和支持这种格式作用指定服务器地址背景这是你要推送流的服务器地址表示推送流到地址上的路径你可以根据自己的服务器地址和路径进行修改参考在中使用初始化并创建模板一键变身让镜像华丽转身快来看看怎么做使用域名并添加证书在控制台添加证书系统凭证在设置自定义在设置规则参考自制模版清理无用软件包清除和主机名配置清除操作命令创建容器备份移动到模板目录参考环境初始化创建自定义的容器模板备份使用备份的客户机与宿主机集群退出集群在集群节点上执行一面的命令停止和集群的服务并设置本机操作的宿主为本地模式删除之前的集群配置文件和进程再次启动单独的服务还需要删除本机以外的其他集群节点以便从中移除本机之外的其他节点优化功耗节能参考国光的环境搭建教程节能模式问题汇总参考运维脚本参考年最新安装使用指南新手入门安装优化折腾小记国光的环境搭建教程学习笔记配置探索管理页面系统最佳实践",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-04-03 20:08:00",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{var o;0!==a&&(o=Date.now(),localStorage.setItem(e,JSON.stringify({value:t,expiry:o+864e5*a})))},get:e=>{var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!(Date.now()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=(o,c={})=>new Promise((t,e)=>{let a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},Object.keys(c).forEach(e=>{a.setAttribute(e,c[e])}),document.head.appendChild(a)}),e.getCSS=(o,c=!1)=>new Promise((t,e)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,c&&(a.id=c),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};var e=saveToLocal.get("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,o=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!t&&!a&&!o,t=(void 0===e?(a?activateLightMode():t?activateDarkMode():(o||c)&&((a=(new Date).getHours())<=8||22<=a?activateDarkMode:activateLightMode)(),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode:activateLightMode)()})):("light"===e?activateLightMode:activateDarkMode)(),saveToLocal.get("aside-status"));void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://s1.hdslb.com/bfs/static/jinkela/long/font/medium.css"><script src="https://cdn.dong4j.site/source/static/echarts.min.js"></script><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/core.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/footer.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/index-imgloaded.css"><script src="https://cdn.dong4j.site/source/static/index-imgloaded.js"></script><script src="https://cdn.dong4j.site/source/static/detect-devtools.js"></script><script defer="" src="https://cdn.dong4j.site/source/static/umami.self.js" data-host-url="https://umami.dong4j.ink:1024" data-website-id="bd4721b7-a43f-4161-83ed-51c148a7ca9d"></script><script defer="" src="https://cdn.dong4j.site/source/static/counter.js" async="" id="online-counter" interval="60000" api="https://umami.dong4j.ink:1024/counter" room="000000001"></script><script src="https://cdn.dong4j.site/source/static/confetti.browser.min.js"></script><script src="https://cdn.dong4j.site/source/static/confetti.js"></script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="司机带你开车" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="司机带你开车" type="application/rss+xml"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box"><div class="carplay"></div></div><script>let preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout(function(){preloader.endLoading()},2e3),document.getElementById("loading-box").addEventListener("click",()=>{preloader.endLoading()}),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.dong4j.site" title="个人主页"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/homepage.webp" alt="个人主页"><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://blog.dong4j.site" title="博客"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/blog.webp" alt="博客"><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://resume.dong4j.site" title="简历"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/resume.webp" alt="简历"><span class="back-menu-item-text">简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://npx-card.dong4j.site" title="npx-card"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/npx-card.webp" alt="npx-card"><span class="back-menu-item-text">npx-card</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack" title="Watt.Stack"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/watt.webp" alt="Watt.Stack"><span class="back-menu-item-text">Watt.Stack</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit" title="MIK"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/mik.webp" alt="MIK"><span class="back-menu-item-text">MIK</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev" title="macOS.dev"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/mac.webp" alt="macOS.dev"><span class="back-menu-item-text">macOS.dev</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.site/" title="更多"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/project.webp" alt="更多"><span class="back-menu-item-text">更多</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">服务</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services" title="服务状态"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/uptime-kuma.svg" alt="服务状态"><span class="back-menu-item-text">服务状态</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nezha.dong4j.dev" title="服务面板"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/nezha.webp" alt="服务面板"><span class="back-menu-item-text">服务面板</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nav.dong4j.dev" title="导航页"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/nav.webp" alt="导航页"><span class="back-menu-item-text">导航页</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://umami.dong4j.ink:1024/share/V7Rat8DdVw4npjl2/blog.dong4j.site" title="Umami"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/umami.webp" alt="Umami"><span class="back-menu-item-text">Umami</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://muselink.cc/dong4j 👈这是我的MuseLink数字名片！" title="数字名片"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/muse.lin.webp" alt="数字名片"><span class="back-menu-item-text">数字名片</span></a><a class="back-menu-item" href="/ai/deepseek-r1-webgpu/" title="DeepSeek"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/deepseek.webp" alt="DeepSeek"><span class="back-menu-item-text">DeepSeek</span></a><a class="back-menu-item" href="/ai/rmbg/playground/" title="RMBG"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/rmbg.webp" alt="RMBG"><span class="back-menu-item-text">RMBG</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.dong4j.site/" title="Mini-Chat"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/emoji1.webp" alt="Mini-Chat"><span class="back-menu-item-text">Mini-Chat</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">司机带你开车</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa fa-comments faa-tada"></i><span> 最新评论</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size:.9em"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/memos/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 备忘录</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fa-solid fa-map faa-tada"></i><span> 折腾清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/stars/"><i class="fa-brands fa-github faa-tada"></i><span> Star 清单</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.dong4j.dev"><span>小黑屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/wechat-pay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.dong4j.site/source/image/wechat-pay.webp"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.dong4j.site/source/image/alipay.webp"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/checkedexception/" style="font-size:1.05rem;color:#148f76">CheckedException<sup>1</sup></a><a href="/tags/error/" style="font-size:1.05rem;color:#7caa4e">Error<sup>1</sup></a><a href="/tags/exception/" style="font-size:1.05rem;color:#6ca2ab">Exception<sup>1</sup></a><a href="/tags/java/" style="font-size:1.05rem;color:#72966d">Java<sup>48</sup></a><a href="/tags/javabean/" style="font-size:1.05rem;color:#860ac1">JavaBean<sup>1</sup></a><a href="/tags/math/" style="font-size:1.05rem;color:#a75222">Math<sup>1</sup></a><a href="/tags/random/" style="font-size:1.05rem;color:#967478">Random<sup>1</sup></a><a href="/tags/runtimeexception/" style="font-size:1.05rem;color:#94aec3">RuntimeException<sup>1</sup></a><a href="/tags/string/" style="font-size:1.05rem;color:#453533">String<sup>2</sup></a><a href="/tags/stringbuffer/" style="font-size:1.05rem;color:#3f431c">StringBuffer<sup>2</sup></a><a href="/tags/stringbuilder/" style="font-size:1.05rem;color:#a0673c">StringBuilder<sup>1</sup></a><a href="/tags/throwable/" style="font-size:1.05rem;color:#ad4b80">Throwable<sup>1</sup></a><a href="/tags/final/" style="font-size:1.05rem;color:#77b142">final<sup>2</sup></a><a href="/tags/finalize/" style="font-size:1.05rem;color:#9a5c58">finalize<sup>1</sup></a><a href="/tags/finally/" style="font-size:1.05rem;color:#4fad4c">finally<sup>2</sup></a><a href="/tags/getter/" style="font-size:1.05rem;color:#a5c25f">getter<sup>1</sup></a><a href="/tags/new%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:1.05rem;color:#050f6f">new关键字<sup>1</sup></a><a href="/tags/setter/" style="font-size:1.05rem;color:#85a1b8">setter<sup>1</sup></a><a href="/tags/static/" style="font-size:1.05rem;color:#096286">static<sup>1</sup></a><a href="/tags/super/" style="font-size:1.05rem;color:#4f916e">super<sup>2</sup></a><a href="/tags/this/" style="font-size:1.05rem;color:#869dc2">this<sup>1</sup></a><a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size:1.05rem;color:#4d7499">二进制<sup>1</sup></a><a href="/tags/%E5%8C%85%E8%A3%85%E7%B1%BB/" style="font-size:1.05rem;color:#410937">包装类<sup>1</sup></a><a href="/tags/%E5%B0%81%E8%A3%85/" style="font-size:1.05rem;color:#768122">封装<sup>3</sup></a><a href="/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" style="font-size:1.05rem;color:#501f70">异常处理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size:1.05rem;color:#690252">数据类型<sup>4</sup></a><a href="/tags/%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/" style="font-size:1.05rem;color:#a38b10">方法重载<sup>1</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" style="font-size:1.05rem;color:#95a701">构造方法<sup>1</sup></a><a href="/tags/%E6%BA%A2%E5%87%BA/" style="font-size:1.05rem;color:#bf8181">溢出<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:1.05rem;color:#4ec37b">算法<sup>1</sup></a><a href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" style="font-size:1.05rem;color:#34c54f">类型转换<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" style="font-size:1.05rem;color:#74835a">线程安全<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" style="font-size:1.05rem;color:#702108">编程实践<sup>2</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F/" style="font-size:1.05rem;color:#3d022e">计算机程序<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/" style="font-size:1.05rem;color:#4c85aa">计算机语言<sup>1</sup></a><a href="/tags/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" style="font-size:1.05rem;color:#23b3be">访问控制<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size:1.05rem;color:#95198d">软件<sup>1</sup></a><a href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" style="font-size:1.05rem;color:#92b58f">错误处理<sup>2</sup></a><a href="/tags/%E9%9A%8F%E6%9C%BA%E6%95%B0/" style="font-size:1.05rem;color:#34929b">随机数<sup>1</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size:1.05rem;color:#53ab26">面向对象<sup>6</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"> <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%96%B0%E6%97%B6%E4%BB%A3%E7%A0%81%E5%86%9C/" itemprop="url">新时代码农</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/node-js/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>Node.js</span></a><a class="article-meta__tags" href="/tags/llm/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>LLM</span></a><a class="article-meta__tags" href="/tags/one-api/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>one-api</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Proxmox VE 8.3 安装与配置指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-02-17T11:52:42.000Z" title="发表于 2025-02-17 19:52:42">2025-02-17</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-03T12:08:00.566Z" title="更新于 2025-04-03 20:08:00">2025-04-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">16.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>75分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="Proxmox VE 8.3 安装与配置指南"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/13e613ba.html#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://api.dong4j.ink:1024/cover?34n7j520"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="fa-regular fa-robot fa-fade"></i><div class="ai-title-text">摘要助手</div><div id="ai-Toggle">切换</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">SummaryGPT</div></div><div class="ai-explanation">AI 初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成摘要 👋</div><div class="ai-btn-item">推荐文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item">前往订阅 💥</div><div class="ai-btn-item" id="go-comment">前往评论 💬</div><div class="ai-btn-item" id="read-audio">Kokoro TTS 🎙️</div><div class="ai-btn-item" id="go-tianli-blog">👀 部署教程</div></div><script data-pjax="" src="https://cdn.dong4j.site/source/static/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope="" itemtype="https://blog.dong4j.site/posts/13e613ba.html"><header><a class="post-meta-categories" href="/categories/%E6%96%B0%E6%97%B6%E4%BB%A3%E7%A0%81%E5%86%9C/" itemprop="url">新时代码农</a><a href="/tags/node-js/" tabindex="-1" itemprop="url">Node.js</a><a href="/tags/llm/" tabindex="-1" itemprop="url">LLM</a><a href="/tags/one-api/" tabindex="-1" itemprop="url">one-api</a><h1 id="CrawlerTitle" itemprop="name headline">Proxmox VE 8.3 安装与配置指南</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">dong4j</span><time itemprop="dateCreated datePublished" datetime="2025-02-17T11:52:42.000Z" title="发表于 2025-02-17 19:52:42">2025-02-17</time><time itemprop="dateCreated datePublished" datetime="2025-04-03T12:08:00.566Z" title="更新于 2025-04-03 20:08:00">2025-04-03</time></header><meta name="referrer" content="no-referrer"><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?spm=z8ewv8vw" alt="random-pic-api"></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文汇总了我在三台联想 M920x 上搭建和使用 <strong>PVE</strong>（Proxmox Virtual Environment）过程中的心得与遇到的问题。</p><p>在选择虚拟化平台时，我倾向于 <strong>PVE</strong> 而非 <strong>ESXi</strong>（vSphere Hypervisor）。</p><p>这一选择基于 PVE 的开源性及其基于 Debian 的架构，这为它带来了相比 ESXi 更多的可玩性和折腾空间。</p><blockquote><p>选择 PVE 或 ESXi 并不在于哪个更优秀，而在于哪个更能满足个人的特定需求。</p></blockquote><h2 id="安装完成后-IP-不对"><a href="#安装完成后-IP-不对" class="headerlink" title="安装完成后 IP 不对"></a>安装完成后 IP 不对</h2><p>启动后出现了一张 <code>vmbr0</code> 网卡, 这个是桥接网卡, 可以查看绑定的物理网卡:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> show master vmbr0</span><br></pre></td></tr></tbody></table></figure><p>修改一下 3 个文件:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/network/interfaces</span></span><br><span class="line"></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">iface enp92s0 inet manual</span><br><span class="line"></span><br><span class="line">auto vmbr0</span><br><span class="line">iface vmbr0 inet static</span><br><span class="line">	address 192.168.100.100/24</span><br><span class="line">	gateway 192.168.100.1</span><br><span class="line">	bridge-ports enp92s0</span><br><span class="line">	bridge-stp off</span><br><span class="line">	bridge-fd 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/issue</span></span><br><span class="line">Welcome to the Proxmox Virtual Environment. Please use your web browser to</span><br><span class="line">configure this server - connect to:</span><br><span class="line"></span><br><span class="line">  https://192.168.100.100:8006/</span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/hosts</span></span><br><span class="line"></span><br><span class="line">127.0.0.1 localhost.localdomain localhost</span><br><span class="line">192.168.100.100 nuc.ihome nuc</span><br></pre></td></tr></tbody></table></figure><p><strong>参考:</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuemhpaHUuY29tL3RhcmRpcy96bS9hcnQvNDkyNDg0ODMzP3NvdXJjZV9pZD0xMDAz">https://www.zhihu.com/tardis/zm/art/492484833?source_id=1003</a></li></ul><hr><h2 id="更换源"><a href="#更换源" class="headerlink" title="更换源"></a>更换源</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install apt-transport-https ca-certificates</span><br><span class="line"></span><br><span class="line">wget https://mirrors.ustc.edu.cn/proxmox/debian/proxmox-release-bookworm.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bookworm.gpg</span><br></pre></td></tr></tbody></table></figure><h3 id="通用软件源"><a href="#通用软件源" class="headerlink" title="通用软件源"></a>通用软件源</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">vim /etc/apt/sources.list</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free-firmware</span><br><span class="line"></span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free-firmware</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free-firmware</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free-firmware</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free-firmware</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free-firmware</span></span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free-firmware</span><br><span class="line"><span class="comment"># deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free-firmware</span></span><br></pre></td></tr></tbody></table></figure><h3 id="pve-软件源"><a href="#pve-软件源" class="headerlink" title="pve 软件源"></a>pve 软件源</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/apt/sources.list.d/pve-enterprise.list /etc/apt/sources.list.d/pve-enterprise.list.bak</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空 /etc/apt/sources.list.d/pve-enterprise.list</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用Proxmox非企业版源</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"deb https://mirrors.ustc.edu.cn/proxmox/debian bookworm pve-no-subscription"</span> &gt; /etc/apt/sources.list.d/pve-no-subscription.list</span><br></pre></td></tr></tbody></table></figure><h3 id="Ceph-源"><a href="#Ceph-源" class="headerlink" title="Ceph 源"></a>Ceph 源</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /etc/apt/sources.list.d/ceph.list /etc/apt/sources.list.d/ceph.list.bak</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-quincy bookworm no-subscription"</span> &gt; /etc/apt/sources.list.d/ceph.list</span><br></pre></td></tr></tbody></table></figure><h3 id="CT-镜像下载源"><a href="#CT-镜像下载源" class="headerlink" title="CT 镜像下载源"></a>CT 镜像下载源</h3><p>将 /usr/share/perl5/PVE/APLInfo.pm 文件中默认的源地址 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cDovL2Rvd25sb2FkLnByb3htb3guY29tLw==">http://download.proxmox.com</a> 替换为 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9taXJyb3JzLnR1bmEudHNpbmdodWEuZWR1LmNuL3Byb3htb3g=">https://mirrors.tuna.tsinghua.edu.cn/proxmox</a> 即可。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm.bak</span><br><span class="line"></span><br><span class="line">sed -i <span class="string">'s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g'</span> /usr/share/perl5/PVE/APLInfo.pm</span><br></pre></td></tr></tbody></table></figure><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    host =&gt; "mirrors.ustc.edu.cn",</span><br><span class="line">    url =&gt; "https://mirrors.ustc.edu.cn/turnkeylinux/metadata/pve",</span><br><span class="line">    file =&gt; 'aplinfo.dat',</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart pvedaemon.service &amp;&amp; pveam update &amp;&amp; pveam available</span><br></pre></td></tr></tbody></table></figure><h2 id="删除订阅弹窗"><a href="#删除订阅弹窗" class="headerlink" title="删除订阅弹窗"></a>删除订阅弹窗</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -Ezi.bak <span class="string">"s/(Ext.Msg.show\(\{\s+title: gettext\('No valid sub)/void\(\{ \/\/\1/g"</span> /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js &amp;&amp; systemctl restart pveproxy.service</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="oh-my-zsh"><a href="#oh-my-zsh" class="headerlink" title="oh-my-zsh"></a>oh-my-zsh</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apt update &amp;&amp; apt install git zsh curl \</span><br><span class="line">	&amp;&amp; sh -c <span class="string">"<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>"</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">${ZSH_CUSTOM:-~/.oh-my-zsh/custom}</span>/plugins/zsh-syntax-highlighting \</span><br><span class="line">	&amp;&amp; git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">${ZSH_CUSTOM:-~/.oh-my-zsh/custom}</span>/plugins/zsh-autosuggestions \</span><br><span class="line">  &amp;&amp; git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-completions <span class="variable">${ZSH_CUSTOM:-<span class="variable">${ZSH:-~/.oh-my-zsh}</span>/custom}</span>/plugins/zsh-completions</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="连接-WiFi"><a href="#连接-WiFi" class="headerlink" title="连接 WiFi"></a>连接 WiFi</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">apt-get install wpasupplicant wireless-tools -y</span><br><span class="line"></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> wlp91s0 up</span><br><span class="line">iwlist wlp91s0 scanning | grep <span class="string">"ESSID"</span></span><br><span class="line"></span><br><span class="line">wpa_passphrase [WIFI名称] [WIFI密码]</span><br></pre></td></tr></tbody></table></figure><blockquote><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9yYXNwYmVycnlwaS5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvMTM3MTIxL25vLXdwYS1zdXBwbGljYW50LWV4ZWN1dGFibGU=">No wpa_supplicant executable</a></p></blockquote><p>会得到类似以下的输出(也可以使用网页工具计算: <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cud2lyZXNoYXJrLm9yZy90b29scy93cGEtcHNrLmh0bWw=">https://www.wireshark.org/tools/wpa-psk.html</a>:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">network={</span><br><span class="line">    ssid="[WIFI名称]"</span><br><span class="line">    #psk="[WIFI密码]"</span><br><span class="line">    psk=[WIFI密码的密钥值]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>我们需要复制这个 PSK 值。</p><hr><ol><li>打开<code>/etc/network/interfaces</code>文件</li><li>添加以下内容</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">auto [网卡名称]</span><br><span class="line"></span><br><span class="line"># 如果你使用静态IP</span><br><span class="line">iface [网卡名称] inet static</span><br><span class="line">    address [你要分配的IP地址，如192.168.4.1/24]</span><br><span class="line">    gateway [网关地址]</span><br><span class="line">    wpa-ssid [WIFI名称]</span><br><span class="line">    wpa-psk [WIFI密码的密钥值]</span><br><span class="line"></span><br><span class="line"># 如果你使用动态IP</span><br><span class="line">iface [网卡名称] inet dhcp</span><br><span class="line">    wpa-ssid [WIFI名称]</span><br><span class="line">    wpa-psk [WIFI密码的密钥值]</span><br></pre></td></tr></tbody></table></figure><blockquote><p>为了方便管理，我们推荐你使用静态 IP 3. 重启网络</p></blockquote><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifdown [网卡名称]</span><br><span class="line">ifup [网卡名称]</span><br></pre></td></tr></tbody></table></figure><p><strong>安装 iw 工具</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install iw -y</span><br></pre></td></tr></tbody></table></figure><p><strong>查看 WiFi 信息</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ iwconfig wlp91s0</span><br><span class="line">wlp91s0   IEEE 802.11  ESSID:<span class="string">"xxxxx"</span></span><br><span class="line">          Mode:Managed  Frequency:5.745 GHz  Access Point: 9C:9D:7E:7C:90:19</span><br><span class="line">          Bit Rate=29.2 Mb/s   Tx-Power=22 dBm</span><br><span class="line">          Retry short <span class="built_in">limit</span>:7   RTS thr:off   Fragment thr:off</span><br><span class="line">          Encryption key:off</span><br><span class="line">          Power Management:on</span><br><span class="line">          Link Quality=48/70  Signal level=-62 dBm</span><br><span class="line">          Rx invalid nwid:0  Rx invalid crypt:0  Rx invalid frag:0</span><br><span class="line">          Tx excessive retries:0  Invalid misc:92   Missed beacon:0</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL29wdXMvOTM4NDM3ODA4NjI4OTU3MTkx">基于 PVE 与 AX210 无线网卡的 NAS 主机调试记录</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9mb3hpLmJ1ZHVhbndhbmcudmlwL3ZpcnR1YWxpemF0aW9uL3B2ZS8xOTM5Lmh0bWwv">proxmox 中使用 ax210 连接无线网络</a></li></ul><hr><h2 id="Web-打不开"><a href="#Web-打不开" class="headerlink" title="Web 打不开"></a>Web 打不开</h2><p><code>501 no such file '/PVE/StdWorkspace.js'</code></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apt install --reinstall proxmox-widget-toolkit</span><br><span class="line"></span><br><span class="line">apt update &amp;&amp; apt upgrade</span><br><span class="line">apt install -f</span><br><span class="line"></span><br><span class="line">apt dist-upgrade</span><br><span class="line">pvecm updatecerts --force</span><br><span class="line">service pveproxy restart</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="pve-source-脚本"><a href="#pve-source-脚本" class="headerlink" title="pve_source 脚本"></a>pve_source 脚本</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9iYnMueDg2cGkuY24vdGhyZWFkP3RvcGljSWQ9MjA=">https://bbs.x86pi.cn/thread?topicId=20</a></p><p><strong>稳定版</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O /root/pve_source.tar.gz <span class="string">'https://bbs.x86pi.cn/file/topic/2023-11-28/file/01ac88d7d2b840cb88c15cb5e19d4305b2.gz'</span> &amp;&amp; tar zxvf /root/pve_source.tar.gz &amp;&amp; /root/./pve_source</span><br></pre></td></tr></tbody></table></figure><p>开发版 (PVE 系统配置 IOMMU、核显直通、核显 SR-IOV 调整为定制向导+推荐方案)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -q -O /root/pve_source.tar.gz <span class="string">'https://bbs.x86pi.cn/file/topic/2024-01-06/file/24f723efc6ab4913b1f99c97a1d1a472b2.gz'</span> &amp;&amp; tar zxvf /root/pve_source.tar.gz &amp;&amp; /root/./pve_source</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="迁移-Ubuntu-系统到-PVE"><a href="#迁移-Ubuntu-系统到-PVE" class="headerlink" title="迁移 Ubuntu 系统到 PVE"></a>迁移 Ubuntu 系统到 PVE</h2><p><strong>列举一下已存在的 M.2 固态硬盘信息:</strong></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250218100813_9YKCDhZZ.webp" alt="20250218100813_9YKCDhZZ.webp"></p><p>一共 1T *4 M.2 固态硬盘, 其中 <strong>nvme0n1</strong> 安装的 PVE, 其他 3 根还未使用.</p><h3 id="镜像打包"><a href="#镜像打包" class="headerlink" title="镜像打包"></a>镜像打包</h3><p>原来安装 Ubuntu 的 M.2 500G 固态硬盘已经从机器上拔下来了, 为了将此固态硬盘中的系统打包成镜像然后恢复到 PVE 中, 这里使用了 Clonezilla 来完成这项工作.</p><p>使用到的工具:</p><ol><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9jbG9uZXppbGxhLm9yZy8=">Clonezilla</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cudmVudG95Lm5ldC8=">Ventoy</a></li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250218105012_ChdOGfq8.webp" alt="20250218105012_ChdOGfq8.webp"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250221012151_nPtdL8DT.webp" alt="20250221012151_nPtdL8DT.webp"></p><p>执行完成后会在指定的 U 盘生成一些系统文件, 但是这个还不能直接使用, 所以我又使用 Clonezilla 将这些文件打包成 ISO.</p><blockquote><p>最终的目的是将 Ubuntu 系统打包成 ISO, 然后在 PVE 中使用虚拟机安装.</p></blockquote><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zNjQzMjEyOS9hcnRpY2xlL2RldGFpbHMvMTMwNTAyNDEx">clonezilla(再生龙)克隆 linux 系统 操作指南</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNTQ1ODQxMTE=">使用再生龙 CloneZilla 进行 Linux 系统的镜像完全封装和还原</a></li></ul><h3 id="安装到-PVE"><a href="#安装到-PVE" class="headerlink" title="安装到 PVE"></a>安装到 PVE</h3><p>在 PVE 下查看 P40 显卡的信息：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lspci |  grep 3D</span><br><span class="line">81:00.0 3D controller: NVIDIA Corporation GP102 [P102-100] (rev a1)</span><br></pre></td></tr></tbody></table></figure><p>要直通这块卡给 Ubuntu 24.04 虚拟机，需要准备：</p><ul><li>开启 pcie 直通</li><li>安装 Ubuntu 24.04 虚拟机(就是上一步打包的 ISO)</li></ul><hr><h2 id="安装-Windows"><a href="#安装-Windows" class="headerlink" title="安装 Windows"></a>安装 Windows</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cubXVsaW5neXVlci5jb20vYXJjaGl2ZXMvMTAyNy8=">https://www.mulingyuer.com/archives/1027/</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93aWxseHVwLnRvcC9hcmNoaXZlcy9wdmUtaW5zdGFsbC13aW4xMQ==">https://willxup.top/archives/pve-install-win11</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9pbWFjb3MudG9wLzIwMjMvMDkvMDcvcHZlLXdpbmRvd3MtMTEv">https://imacos.top/2023/09/07/pve-windows-11/</a></p><h3 id="核显直通与虚拟核显直通"><a href="#核显直通与虚拟核显直通" class="headerlink" title="核显直通与虚拟核显直通"></a>核显直通与虚拟核显直通</h3><p><strong>物理核显直通 vs SRIOV vGPU 的优缺点对比：</strong></p><table><thead><tr><th></th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>物理核显直通</td><td>1、性能强 2、支持物理显示输出 (VGA/DP/HDMI/Type-C) 3、兼容性好，不妨碍 PVE 升级。</td><td>独占（不支持直通给多个虚拟机） 直通后，PVE 宿主不能同时用核显。</td></tr><tr><td>SRIOV 虚拟核显直通</td><td>可分为多个 VF 虚拟显卡， 给不同的虚拟机使用。</td><td>1、性能拆分（分成多个 VF 显卡具体如何分配性能不详） 如 N100 等不建议超过 3 个 VF 显卡，具有性能高核显的处理器可以分为最高 7 个）； 2、不支持物理显示输出，虽可使用 Todesk 等软件远程桌面，但 CPU 占用率较高。在作为服务器的小主机上，让原本紧张的资源更加捉襟见肘。 3、对内核 header 依赖（6.1-6.5），PVE 升级受限。 4、兼容性稳定性一般，部分流媒体软件硬解/转码功能受限。</td></tr></tbody></table><h3 id="虚拟核显直通"><a href="#虚拟核显直通" class="headerlink" title="虚拟核显直通"></a>虚拟核显直通</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apt install pve-kernel-$(<span class="built_in">uname</span> -r)</span><br><span class="line">proxmox-boot-tool kernel pin $(<span class="built_in">uname</span> -r)</span><br><span class="line">apt install pve-headers-$(<span class="built_in">uname</span> -r)</span><br><span class="line"></span><br><span class="line">wget https://github.com/moetayuko/intel-gpu-i915-backports/releases/download/I915MT65-24.1.19-6/intel-i915-dkms_1.24.1.19.240119.1.nodrm+i6-1_all.deb</span><br><span class="line"></span><br><span class="line">apt update &amp; apt install build-* pve-headers-$(<span class="built_in">uname</span> -r) git dkms sysfsutils flex bison -y</span><br><span class="line"></span><br><span class="line">wget -O /lib/firmware/updates/i915/tgl_guc_70.9.1.bin https://github.com/intel-gpu/intel-gpu-firmware/blob/main/firmware/tgl_guc_70.9.1.bin</span><br><span class="line"></span><br><span class="line">dpkg -i intel-i915-dkms_1.24.1.19.240119.1.nodrm+i6-1_all.deb</span><br><span class="line"></span><br><span class="line">vim /etc/default/grub</span><br></pre></td></tr></tbody></table></figure><p>在 <code>quiet</code> 后添加 <code>intel_iommu=on iommu=pt i915.enable_guc=3 i915.max_vfs=7</code></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br><span class="line">update-initramfs -u</span><br><span class="line"></span><br><span class="line">apt install -y sysfsutils</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"devices/pci0000:00/0000:00:02.0/sriov_numvfs = 3"</span> &gt; /etc/sysfs.conf</span><br><span class="line"></span><br><span class="line">----------------</span><br><span class="line"><span class="comment">#有修改虚拟核显数量的需求</span></span><br><span class="line">nano /etc/sysfs.conf</span><br><span class="line"><span class="comment">#将原来写入的参数注释掉</span></span><br><span class="line"><span class="comment">#devices/pci0000:00/0000:00:02.0/sriov_numvfs = 3</span></span><br><span class="line"><span class="comment">#改成你需要的数量，例如下述为5个</span></span><br><span class="line">devices/pci0000:00/0000:00:02.0/sriov_numvfs = 5</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ dkms status</span><br><span class="line">intel-i915-dkms/1.24.1.19.240119.1.nodrm, 6.8.12-8-pve, x86_64: installed</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg |grep i915</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">[    4.564128] i915 0000:00:02.0: Enabled 3 VFs</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pve/qemu-server/100.conf</span><br><span class="line"></span><br><span class="line">args: -<span class="built_in">set</span> device.hostpci0.addr=02.0 -<span class="built_in">set</span> device.hostpci0.x-igd-gms=0x2</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong></p><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuY2xvdWRzdGF5bW9vbi5jb20vMjAyNC8wNC8xMC9hbGwtaW4tb25lLTE=">【PVE】All in One 的快乐之系统配置及核显 SR-IOV 直通</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC81NzEyMjQyOTY=">一边原神一边 galgame ：同时独显直通和核显虚拟化</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83MzY0MjI0NjIyNjgxMTEyNjEw">玩转 AIGC：打造本地大模型地基，PVE 配置显卡直通</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9za3lhby5pby9sZWFybmluZy1jb21wdXRlci1oYXJkd2FyZS9ncmFwaGljcy9wMTAyL3B2ZS11YnVudHUyMjA0Lw==">PVE8 直通 ubuntu 22.04</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hemh1Z2UyMzMuY29tL3Byb3htb3gtdmUtdGVzbGEtcDQwLXZncHUtJWU5JTg1JThkJWU3JWJkJWFlLw==">Proxmox VE (Tesla P40) vGPU 配置</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hemh1Z2UyMzMuY29tL3Byb3htb3gtdmUtOC10ZXNsYS1wNDAtdmdwdS0lRTklODUlOEQlRTclQkQlQUUv">Proxmox VE 8 Tesla P40 vGPU 配置</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hemh1Z2UyMzMuY29tL3Byb3htb3gtdmUtJUU2JTk4JUJFJUU1JThEJUExJUVGJUJDJTg4dGVzbGEtcDQwJUVGJUJDJTg5JUU3JTlCJUI0JUU5JTgwJTlBLw==">Proxmox VE 显卡（Tesla P40）直通</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83MzMwOTIwNTQ5NzcxODM3NDgx">PVE 直通显卡 &amp; Intel SRIOV</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wdmUucHJveG1veC5jb20vd2lraS9QQ0lfUGFzc3Rocm91Z2g=">PCI Passthrough</a></p></li></ul><hr><h2 id="安装-Ubuntu"><a href="#安装-Ubuntu" class="headerlink" title="安装 Ubuntu"></a>安装 Ubuntu</h2><p>PVE（Proxmox VE）中的网络模型选择取决于 <strong>虚拟机的用途和性能需求</strong>。不同的网卡模型有不同的<strong>兼容性</strong>和<strong>性能</strong>，以下是对比：</p><p><strong>1. VirtIO（半虚拟化）（✅ 推荐）</strong></p><ul><li><p><strong>优点</strong>：</p><ul><li><strong>性能最佳</strong>，支持 <strong>高吞吐量</strong>，<strong>低 CPU 开销</strong>。</li><li><strong>延迟最低</strong>，适合高性能服务器、数据库、Web 服务等应用。</li><li>现代 Linux（Ubuntu、Debian、CentOS）<strong>自带 VirtIO 驱动</strong>，无需额外安装。</li></ul></li><li><p><strong>缺点</strong>：</p><ul><li>Windows 需要 <strong>手动安装 VirtIO 驱动</strong>（可以从<a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9mZWRvcmFwZW9wbGUub3JnL2dyb3Vwcy92aXJ0L3ZpcnRpby13aW4vZGlyZWN0LWRvd25sb2Fkcy8=">这里</a>下载）。</li></ul></li></ul><p>✅ <strong>推荐用于：Linux 虚拟机、Windows（安装 VirtIO 驱动）、高性能应用</strong></p><p><strong>2. Intel E1000 / E1000E（🟡 兼容性好，但性能一般）</strong></p><ul><li><p><strong>优点</strong>：</p><ul><li>兼容性<strong>非常好</strong>，几乎所有操作系统都<strong>自带驱动</strong>，无需额外安装。</li><li>适用于<strong>老旧操作系统</strong>（如 Windows XP/2003）。</li></ul></li><li><p><strong>缺点</strong>：</p><ul><li><strong>CPU 开销大</strong>，数据包处理效率低。</li><li><strong>带宽限制在 1Gbps</strong>，无法发挥现代硬件的最大性能。</li></ul></li></ul><p>🟡 <strong>适用于：老旧操作系统（如 Windows XP/2003）、兼容性优先的环境</strong></p><p><strong>3. Realtek RTL8139（⚠️ 极老，几乎不推荐）</strong></p><ul><li><p><strong>优点</strong>：</p><ul><li>兼容性好，适用于一些<strong>极老的操作系统</strong>（如 Windows 98）。</li></ul></li><li><p><strong>缺点</strong>：</p><ul><li><strong>性能最差</strong>，带宽 <strong>100Mbps</strong>，完全跟不上现代网络需求。</li><li>高 CPU 负载，不适合生产环境。</li></ul></li></ul><p>❌ <strong>不推荐，除非你要运行 Windows 98 这类老系统。</strong></p><p><strong>4. VMware vmxnet3（🟡 适用于 VMware 兼容环境）</strong></p><ul><li><p><strong>优点</strong>：</p><ul><li><strong>适合从 VMware 迁移的虚拟机</strong>，可无缝兼容 VMware 环境。</li><li>低 CPU 开销，性能比 Intel E1000 好。</li></ul></li><li><p><strong>缺点</strong>：</p><ul><li>需要安装 <strong>VMware Tools</strong> 才能正常工作，否则性能低下。</li><li>如果不是从 VMware 迁移过来的 VM，<strong>VirtIO 仍然是更好的选择</strong>。</li></ul></li></ul><p>🟡 <strong>适用于：从 VMware 迁移过来的虚拟机</strong></p><p><strong>总结</strong></p><table><thead><tr><th><strong>选项</strong></th><th><strong>性能</strong></th><th><strong>兼容性</strong></th><th><strong>适用场景</strong></th><th><strong>推荐度</strong></th></tr></thead><tbody><tr><td><strong>VirtIO（半虚拟化）</strong></td><td><strong>✅ 最佳</strong></td><td>需要驱动（Linux 自带，Windows 需安装）</td><td>现代 Linux、Windows（安装驱动）、高吞吐应用</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Intel E1000/E1000E</strong></td><td>🟡 一般</td><td><strong>无需驱动</strong></td><td>老旧 Windows/Linux 兼容性优先</td><td>⭐⭐⭐</td></tr><tr><td><strong>Realtek RTL8139</strong></td><td>❌ 最差</td><td><strong>无需驱动</strong></td><td><strong>极老系统（Windows 98/2000）</strong></td><td>⭐</td></tr><tr><td><strong>VMware vmxnet3</strong></td><td>🟡 较好</td><td>需要 VMware Tools</td><td>从 VMware 迁移的 VM</td><td>⭐⭐⭐</td></tr></tbody></table><p><strong>推荐</strong></p><ul><li><strong>Linux（Ubuntu、Debian、CentOS）→ 选 VirtIO</strong></li><li><strong>Windows（10/11/Server）→ 选 VirtIO（安装 VirtIO 驱动）</strong></li><li><strong>Windows XP/2003 → 选 Intel E1000</strong></li><li><strong>VMware 迁移过来的 VM → 选 vmxnet3</strong></li></ul><p><strong>✅ 最终建议：如果是 Linux 或现代 Windows，</strong>请使用 <strong>VirtIO（半虚拟化）</strong>，它的性能最佳。</p><hr><h3 id="开启-SSH-登录"><a href="#开启-SSH-登录" class="headerlink" title="开启 SSH 登录"></a>开启 SSH 登录</h3><ol><li><p>安装 openssh-server</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install openssh-server</span><br></pre></td></tr></tbody></table></figure></li><li><p>安装完成后，SSH 服务默认自动启动，你可以通过以下命令校验服务运行状态：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status ssh</span><br></pre></td></tr></tbody></table></figure></li><li><p>如果你启用了防火墙，请确保防火墙打开了 SSH 端口，命令如下：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw allow ssh</span><br></pre></td></tr></tbody></table></figure></li><li><p>允许远程登录</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 修改配置</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>重启 ssh 服务</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service ssh restart</span><br></pre></td></tr></tbody></table></figure></li></ol><h3 id="开启远程桌面"><a href="#开启远程桌面" class="headerlink" title="开启远程桌面"></a>开启远程桌面</h3><p>因为通过 PVE 控制台链接 Ubuntu 后, 进入设置页面打开远程桌面老是卡死, 所以直接通过命令行操作.</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install xrdp -y &amp;&amp; sudo systemctl <span class="built_in">enable</span> --now xrdp</span><br></pre></td></tr></tbody></table></figure><h3 id="安装-docker"><a href="#安装-docker" class="headerlink" title="安装 docker"></a>安装 docker</h3><blockquote><p>执行前先开启代理</p></blockquote><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apt remove -y docker docker-engine docker.io containerd runc || <span class="built_in">echo</span> <span class="string">"Docker components may not be installed, skipping removal"</span> \</span><br><span class="line">  &amp;&amp; apt update \</span><br><span class="line">  &amp;&amp; apt install -y gpg \</span><br><span class="line">  &amp;&amp; <span class="built_in">mkdir</span> -p /etc/apt/keyrings \</span><br><span class="line">  &amp;&amp; curl -fsSL https://download.docker.com/linux/ubuntu/gpg | <span class="built_in">tee</span> /etc/apt/keyrings/docker.asc &gt; /dev/null \</span><br><span class="line">  &amp;&amp; <span class="built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc \</span><br><span class="line">  &amp;&amp; gpg --dearmor -o /etc/apt/keyrings/docker.gpg /etc/apt/keyrings/docker.asc \</span><br><span class="line">  &amp;&amp; <span class="built_in">echo</span> <span class="string">"deb [arch=<span class="subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable"</span> | <span class="built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null \</span><br><span class="line">  &amp;&amp; apt update \</span><br><span class="line">  &amp;&amp; apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></tbody></table></figure><h4 id="docker-镜像源"><a href="#docker-镜像源" class="headerlink" title="docker 镜像源"></a>docker 镜像源</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将内容写入 /etc/docker/daemon.json 文件，root 用户可以去掉 sudo</span></span><br><span class="line"><span class="comment"># 配置 Docker 镜像，使用多个镜像源来提高镜像下载速度</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'{</span></span><br><span class="line"><span class="string">  "registry-mirrors": [</span></span><br><span class="line"><span class="string">    "https://docker.1ms.run",</span></span><br><span class="line"><span class="string">    "https://proxy.1panel.live",</span></span><br><span class="line"><span class="string">    "https://docker.ketches.cn"</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">}'</span> | sudo <span class="built_in">tee</span> /etc/docker/daemon.json</span><br><span class="line"><span class="comment"># 重启 Docker 服务以使配置生效</span></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></tbody></table></figure><h3 id="修改时区"><a href="#修改时区" class="headerlink" title="修改时区"></a>修改时区</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timedatectl set-timezone Asia/Shanghai</span><br></pre></td></tr></tbody></table></figure><h3 id="终端支持中文显示"><a href="#终端支持中文显示" class="headerlink" title="终端支持中文显示"></a>终端支持中文显示</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install -y language-pack-zh-hans &amp;&amp; localectl set-locale LANG=zh_CN.UTF-8 &amp;&amp; <span class="built_in">source</span> /etc/default/locale</span><br></pre></td></tr></tbody></table></figure><h3 id="直通-nvme"><a href="#直通-nvme" class="headerlink" title="直通 nvme"></a>直通 nvme</h3><p>因为同品牌 nvme 固态硬盘在 PVE WebUI 的硬件列表中无法区分, 所以需要在命令行在找到具体的 PCI ID 才能直通给虚拟机, 避免错误的将安装了 PVE 系统的 nvem 分配给虚拟机导致 PVE 崩溃.</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 nvme 的 PCI 列表</span></span><br><span class="line">$ lspci | grep -i nvme</span><br><span class="line"></span><br><span class="line">01:00.0 Non-Volatile memory controller: Yangtze Memory Technologies Co.,Ltd ZHITAI TiPro5000 NVMe SSD (rev 01)</span><br><span class="line">81:00.0 Non-Volatile memory controller: Yangtze Memory Technologies Co.,Ltd ZHITAI TiPro5000 NVMe SSD (rev 01)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看系统安装在哪块盘</span></span><br><span class="line">$ lsblk -o NAME,MAJ:MIN,RM,TYPE,SIZE,MOUNTPOINT,UUID</span><br><span class="line"></span><br><span class="line">NAME                         MAJ:MIN RM TYPE   SIZE MOUNTPOINT UUID</span><br><span class="line">nvme0n1                      259:0    0 disk 953.9G</span><br><span class="line">└─nvme0n1p1                  259:2    0 part 953.9G            1a8fd1dd-021a-4e59-bcde-d77502ecc0e7</span><br><span class="line">nvme1n1                      259:1    0 disk 953.9G</span><br><span class="line">├─nvme1n1p1                  259:3    0 part  1007K</span><br><span class="line">├─nvme1n1p2                  259:4    0 part     1G /boot/efi  4773-0652</span><br><span class="line">└─nvme1n1p3                  259:5    0 part 952.9G            5v5ZMp-dJCX-EEep-rBgv-U5ry-q4E4-8vGhuC</span><br><span class="line">  ├─pve-swap                 252:0    0 lvm      8G [SWAP]     ad3ef0fd-b31a-49a3-b72d-8a059358f99a</span><br><span class="line">  ├─pve-root                 252:1    0 lvm     96G /          877cad13-9e68-4d5c-b4bf-fe92ffc241d8</span><br><span class="line">  ├─pve-data_tmeta           252:2    0 lvm    8.3G</span><br><span class="line">  │ └─pve-data-tpool         252:4    0 lvm  816.2G</span><br><span class="line">  │   ├─pve-data             252:5    0 lvm  816.2G</span><br><span class="line">  │   └─pve-vm--102--disk--0 252:6    0 lvm     32G</span><br><span class="line">  └─pve-data_tdata           252:3    0 lvm  816.2G</span><br><span class="line">    └─pve-data-tpool         252:4    0 lvm  816.2G</span><br><span class="line">      ├─pve-data             252:5    0 lvm  816.2G</span><br><span class="line">      └─pve-vm--102--disk--0 252:6    0 lvm     32G</span><br></pre></td></tr></tbody></table></figure><p>上面的输出得知 PVE 安装在 <strong>nvme1n1</strong>, 因此 <strong>nvme0n1</strong> 就是应该直通给虚拟机的盘, 让我们找出它的 PCI ID:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ udevadm info -q path -n /dev/nvme0n1 | grep -oP <span class="string">'\d+:\d+\.\d+'</span></span><br><span class="line"></span><br><span class="line">00:01.0</span><br><span class="line">01:00.0</span><br></pre></td></tr></tbody></table></figure><p>找到了: <strong>01:00.0</strong>.</p><blockquote><p>或者这样也行:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /sys/block/nvme0n1/device &amp;&amp; <span class="built_in">ls</span> -al</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">lrwxrwxrwx  1 root root    0 Feb 19 17:23 device -&gt; ../../../0000:01:00.0</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure></blockquote><h3 id="LVM-扩容"><a href="#LVM-扩容" class="headerlink" title="LVM 扩容"></a>LVM 扩容</h3><p>刚开始只给了 32G 磁盘, 后面光安装显卡驱动就不够用了, 所以在 PVE 控制天新添加了 100G 空间给 Ubuntu:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ lsblk</span><br><span class="line">NAME                      MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">loop0                       7:0    0  73.9M  1 loop /snap/core22/1748</span><br><span class="line">loop1                       7:1    0  44.4M  1 loop /snap/snapd/23545</span><br><span class="line">sda                         8:0    0    32G  0 disk</span><br><span class="line">├─sda1                      8:1    0     1M  0 part</span><br><span class="line">├─sda2                      8:2    0     2G  0 part /boot</span><br><span class="line">└─sda3                      8:3    0    30G  0 part</span><br><span class="line">  ├─ubuntu--vg-ubuntu--lv 252:0    0    15G  0 lvm  /</span><br><span class="line">  └─ubuntu--vg-lv--0      252:1    0    15G  0 lvm  /home</span><br><span class="line">sdb                         8:16   0   100G  0 disk</span><br><span class="line">sr0                        11:0    1   2.6G  0 rom</span><br><span class="line">nvme0n1                   259:0    0 953.9G  0 disk</span><br><span class="line">└─nvme0n1p1               259:1    0 953.9G  0 part</span><br></pre></td></tr></tbody></table></figure><p>其中 <strong>sdb</strong> 是新增的磁盘, 需要将这 100G 空间添加到根分区中:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将 sdb 添加为一个物理卷（PV）：</span></span><br><span class="line">sudo pvcreate /dev/sdb</span><br><span class="line"><span class="comment"># 将新创建的物理卷添加到现有的卷组中</span></span><br><span class="line">sudo vgextend ubuntu-vg /dev/sdb</span><br><span class="line"><span class="comment"># 扩展的是根分区（/dev/ubuntu-vg/ubuntu-lv）</span></span><br><span class="line">sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv</span><br><span class="line"><span class="comment"># 扩展完逻辑卷后，需要扩展文件系统，使其能够使用新的空间(ext4 文件系统)</span></span><br><span class="line">sudo resize2fs /dev/ubuntu-vg/ubuntu-lv</span><br><span class="line"><span class="comment"># xfs 文件系统</span></span><br><span class="line"><span class="comment"># sudo xfs_growfs /dev/ubuntu-vg/ubuntu-lv</span></span><br><span class="line"><span class="comment"># 检查文件系统是否成功扩展</span></span><br><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong>:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cDovL3d3dy5odWVycHUuY2M6NzAwMC8/cD03Mjk=">PVE 系列教程(二十二)、安装 Ubuntu24.04(桌面版)</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83MzY1NzY0MjIyODM4MjEwNTk4">玩转 AIGC：打造本地 AI 大模型地基，PVE 制作 Ubuntu 24.04 LTS 模板</a></li></ul><hr><h2 id="磁盘共享"><a href="#磁盘共享" class="headerlink" title="磁盘共享"></a>磁盘共享</h2><h3 id="测试-NVMe-读写速度"><a href="#测试-NVMe-读写速度" class="headerlink" title="测试 NVMe 读写速度"></a>测试 NVMe 读写速度</h3><p>可以使用 <strong>fio、dd、nvme-cli</strong> 等工具，下面是具体的推荐及使用方法：</p><p><strong>🔥 推荐工具 1：fio（最佳选择，适用于真实负载）</strong></p><p><strong>fio</strong> 是专业的存储测试工具，可以模拟多线程、高并发读写，适合评估 NVMe 的真实性能。</p><p><strong>1️⃣ 安装 fio</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install fio -y</span><br></pre></td></tr></tbody></table></figure><p><strong>2️⃣ 测试 NVMe 顺序写（最大写入速度）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=write_test --filename=/mnt/nvme/testfile --size=10G --rw=write --bs=1M --numjobs=4 --ioengine=libaio --direct=1</span><br></pre></td></tr></tbody></table></figure><ul><li>bs=1M（块大小 1MB）</li><li>numjobs=4（4 线程并发）</li><li>direct=1（绕过系统缓存）</li><li>rw=write（顺序写）</li></ul><p><strong>预期结果</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WRITE: bw=3000MiB/s, iops=3000, runt=3000ms</span><br></pre></td></tr></tbody></table></figure><p><strong>NVMe Gen3 x4</strong>：写入 2.5GB/s ~ 3.2GB/s</p><p><strong>NVMe Gen4 x4</strong>：写入 4GB/s ~ 7GB/s</p><p><strong>3️⃣ 测试 NVMe 顺序读取（最大读取速度）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=read_test --filename=/mnt/nvme/testfile --size=10G --rw=read --bs=1M --numjobs=4 --ioengine=libaio --direct=1</span><br></pre></td></tr></tbody></table></figure><ul><li>rw=read（顺序读取）</li></ul><p><strong>预期结果</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">READ: bw=3500MiB/s, iops=3500, runt=3000ms</span><br></pre></td></tr></tbody></table></figure><p>读取速度一般高于写入速度。</p><p><strong>4️⃣ 测试 NVMe 随机 4K 读写（I/O 性能）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fio --name=random_test --filename=/mnt/nvme/testfile --size=10G --rw=randrw --bs=4K --numjobs=4 --iodepth=32 --ioengine=libaio --direct=1 --rwmixread=70</span><br></pre></td></tr></tbody></table></figure><ul><li>rw=randrw（随机读写）</li><li>bs=4K（4KB 块大小）</li><li>iodepth=32（深度 32）</li><li>rwmixread=70（70% 读，30% 写）</li></ul><p><strong>随机读写主要看 IOPS</strong>，高端 NVMe 可能达到 **500K IOPS+**。</p><p><strong>🔹 推荐工具 2：dd（快速测试）</strong></p><p>dd 可以用于简单的读写测试，但不能准确反映真实 NVMe 性能。</p><p><strong>1️⃣ 顺序写</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=/mnt/nvme/testfile bs=1G count=10 oflag=direct</span><br></pre></td></tr></tbody></table></figure><p><strong>输出示例</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">10+0 records in</span><br><span class="line">10+0 records out</span><br><span class="line">10737418240 bytes (10 GB) copied, 3.42 s, 3.1 GB/s</span><br></pre></td></tr></tbody></table></figure><p><strong>NVMe Gen3 x4</strong>：2.5GB/s ~ 3.5GB/s</p><p><strong>NVMe Gen4 x4</strong>：5GB/s ~ 7GB/s</p><p><strong>2️⃣ 顺序读</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/mnt/nvme/testfile of=/dev/null bs=1G count=10 iflag=direct</span><br></pre></td></tr></tbody></table></figure><p>读取速度通常比写入更快。</p><p><strong>🔹 推荐工具 3：nvme-cli（查看驱动和硬件信息）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nvme-cli -y</span><br><span class="line">nvme list</span><br></pre></td></tr></tbody></table></figure><p><strong>可以查看 NVMe 型号、协议、接口速度</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvme smart-log /dev/nvme0n1</span><br></pre></td></tr></tbody></table></figure><p><strong>查看 NVMe 的寿命、温度、错误统计</strong></p><p><strong>🎯 结论</strong></p><table><thead><tr><th><strong>测试方式</strong></th><th><strong>优点</strong></th><th><strong>适用场景</strong></th></tr></thead><tbody><tr><td>fio</td><td>专业级，支持多线程、高并发</td><td><strong>最精准的 NVMe 测试</strong></td></tr><tr><td>dd</td><td>简单易用，适合快速测试</td><td><strong>快速测试顺序读写</strong></td></tr><tr><td>nvme-cli</td><td>适用于 NVMe 设备管理</td><td><strong>查看 NVMe 信息和健康状态</strong></td></tr></tbody></table><hr><h3 id="Ceph-节点简介"><a href="#Ceph-节点简介" class="headerlink" title="Ceph 节点简介"></a>Ceph 节点简介</h3><ul><li>Ceph MON：Ceph 监视器（<strong>Mon</strong>itor），负责维护集群状态映射，帮助协调 Ceph 守护进程，并负责管理守护进程与客户端之间的身份验证。通常需要至少三个 MON 节点。</li><li>Ceph MGR：Ceph 管理器守护进程（<strong>M</strong>ana<strong>g</strong>e<strong>r</strong> Daemon），负责跟踪运行时指标和 Ceph 当前运行状态，并负责管理和公开 Ceph 集群信息。通常需要至少两个 MAN 节点。</li><li>Ceph OSD：Ceph 对象存储守护进程（<strong>O</strong>bject <strong>S</strong>torage <strong>D</strong>aemon），负责存储数据、处理数据复制、恢复、重新平衡，并通过检查其他 OSD 心跳向 Ceph 监视器和管理器提供监视信息。通常需要至少三个 OSD 节点。</li><li>Ceph MDS：Ceph 元数据服务器（<strong>M</strong>eta<strong>d</strong>ata <strong>S</strong>erver），负责存储元数据，并允许 CephFS 用户运行基本命令，而不为 Ceph 存储集群带来负担。</li></ul><h4 id="时间同步"><a href="#时间同步" class="headerlink" title="时间同步"></a>时间同步</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install chrony -y &amp;&amp; systemctl <span class="built_in">enable</span> chronyd &amp;&amp; systemctl start chronyd</span><br></pre></td></tr></tbody></table></figure><p>修改 NTP 服务器地址:</p><p><code>/etc/chrony/chrony.conf</code></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">server ntp.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp1.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp2.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp3.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp4.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp5.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp6.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp7.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line"><span class="comment"># 允许NTP客户同步 ip 段  NTP同步时需要配置</span></span><br><span class="line">allow 192.168.0.0/16</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart chronyd.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动同步</span></span><br><span class="line">chronyc makestep</span><br><span class="line"><span class="comment"># 查看本机时间同步状态</span></span><br><span class="line">chronyc tracking</span><br><span class="line"><span class="comment"># 查看时间同步服务器列表</span></span><br><span class="line">chronyc -n sources -v</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9oZWxwLmFsaXl1bi5jb20vemgvZWNzL3VzZXItZ3VpZGUvYWxpYmFiYS1jbG91ZC1udHAtc2VydmVy">管理时间同步服务</a></li></ul><h3 id="安装-Ceph"><a href="#安装-Ceph" class="headerlink" title="安装 Ceph"></a>安装 Ceph</h3><p>直接在 PVE Web 端安装, 但是安装后报错:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rados_connect failed - No such file or directory (500)</span><br></pre></td></tr></tbody></table></figure><p>原因是 MON 节点启动失败, 但是在 Web 端有没有 MON 节点显示, 创建的时候报错:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Multiple IPs for ceph public network '192.168.31.99/24' detected on nuc: 192.168.31.99 192.168.31.9 use 'mon-address' to specify one of them. (500)</span><br></pre></td></tr></tbody></table></figure><p>所以直接使用命令行来处理:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># NUC 节点</span></span><br><span class="line">pveceph mon create --mon-address 192.168.31.99</span><br><span class="line"><span class="comment"># Station 节点</span></span><br><span class="line">pveceph mon create --mon-address 192.168.31.66</span><br></pre></td></tr></tbody></table></figure><h3 id="配置-Ceph"><a href="#配置-Ceph" class="headerlink" title="配置 Ceph"></a>配置 Ceph</h3><p>NUC 节点上的 nvme:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME                         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">nvme3n1                      259:0    0 953.9G  0 disk</span><br><span class="line">nvme2n1                      259:1    0 953.9G  0 disk</span><br><span class="line">nvme1n1                      259:2    0 931.5G  0 disk</span><br><span class="line">├─nvme1n1p1                  259:3    0  1007K  0 part</span><br><span class="line">├─nvme1n1p2                  259:4    0     1G  0 part /boot/efi</span><br><span class="line">└─nvme1n1p3                  259:5    0 930.5G  0 part</span><br><span class="line">  ├─pve-swap                 252:0    0     8G  0 lvm  [SWAP]</span><br><span class="line">  ├─pve-root                 252:1    0    96G  0 lvm  /</span><br><span class="line">  ├─pve-data_tmeta           252:2    0   8.1G  0 lvm</span><br><span class="line">  │ └─pve-data-tpool         252:4    0 794.3G  0 lvm</span><br><span class="line">  │   ├─pve-data             252:5    0 794.3G  1 lvm</span><br><span class="line">  │   ├─pve-vm--100--disk--0 252:6    0     4M  0 lvm</span><br><span class="line">  │   ├─pve-vm--100--disk--1 252:7    0   200G  0 lvm</span><br><span class="line">  │   ├─pve-vm--100--disk--2 252:8    0     4M  0 lvm</span><br><span class="line">  │   └─pve-vm--103--disk--0 252:9    0   128G  0 lvm</span><br><span class="line">  └─pve-data_tdata           252:3    0 794.3G  0 lvm</span><br><span class="line">    └─pve-data-tpool         252:4    0 794.3G  0 lvm</span><br><span class="line">      ├─pve-data             252:5    0 794.3G  1 lvm</span><br><span class="line">      ├─pve-vm--100--disk--0 252:6    0     4M  0 lvm</span><br><span class="line">      ├─pve-vm--100--disk--1 252:7    0   200G  0 lvm</span><br><span class="line">      ├─pve-vm--100--disk--2 252:8    0     4M  0 lvm</span><br><span class="line">      └─pve-vm--103--disk--0 252:9    0   128G  0 lvm</span><br><span class="line">nvme0n1                      259:6    0 931.5G  0 disk</span><br></pre></td></tr></tbody></table></figure><p>所以有 <code>nvme0n1</code>, <code>nvme2n1</code> 和 <code>nvme3n1</code> 可以使用, Station 上的 nvme:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME                         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">nvme0n1                      259:0    0 953.9G  0 disk</span><br><span class="line">├─nvme0n1p1                  259:1    0  1007K  0 part</span><br><span class="line">├─nvme0n1p2                  259:2    0     1G  0 part /boot/efi</span><br><span class="line">└─nvme0n1p3                  259:3    0 952.9G  0 part</span><br><span class="line">  ├─pve-swap                 252:0    0     8G  0 lvm  [SWAP]</span><br><span class="line">  ├─pve-root                 252:1    0    96G  0 lvm  /</span><br><span class="line">  ├─pve-data_tmeta           252:2    0   8.3G  0 lvm</span><br><span class="line">  │ └─pve-data-tpool         252:4    0 816.2G  0 lvm</span><br><span class="line">  │   ├─pve-data             252:5    0 816.2G  1 lvm</span><br><span class="line">  │   ├─pve-vm--102--disk--0 252:6    0    32G  0 lvm</span><br><span class="line">  │   └─pve-vm--102--disk--1 252:7    0   100G  0 lvm</span><br><span class="line">  └─pve-data_tdata           252:3    0 816.2G  0 lvm</span><br><span class="line">    └─pve-data-tpool         252:4    0 816.2G  0 lvm</span><br><span class="line">      ├─pve-data             252:5    0 816.2G  1 lvm</span><br><span class="line">      ├─pve-vm--102--disk--0 252:6    0    32G  0 lvm</span><br><span class="line">      └─pve-vm--102--disk--1 252:7    0   100G  0 lvm</span><br></pre></td></tr></tbody></table></figure><p>上面是 PVE 系统盘, 另一块直通给 Ubuntu 使用了, 所以没有显示出来, 这个在数据迁移完成后再处理, 我们先将 NUC 节点的 3 块 nvme 添加到 OSD.</p><p>这里将每块 NVMe 盘拆分为 4 个分区，然后 将这些分区分别添加为独立的 OSD。这样可以让 Ceph 更加 高效利用 NVMe 资源，同时 减少 IO 阻塞，提高并发性能。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> disk <span class="keyword">in</span> /dev/nvme0n1 /dev/nvme2n1 /dev/nvme3n1; <span class="keyword">do</span></span><br><span class="line">  parted --script <span class="variable">$disk</span> mklabel gpt</span><br><span class="line">  parted --script <span class="variable">$disk</span> mkpart primary 0% 25%</span><br><span class="line">  parted --script <span class="variable">$disk</span> mkpart primary 25% 50%</span><br><span class="line">  parted --script <span class="variable">$disk</span> mkpart primary 50% 75%</span><br><span class="line">  parted --script <span class="variable">$disk</span> mkpart primary 75% 100%</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME                         MAJ:MIN RM   SIZE RO TYPE MOUNTPOINTS</span><br><span class="line">nvme3n1                      259:0    0 953.9G  0 disk</span><br><span class="line">├─nvme3n1p1                  259:11   0 238.5G  0 part</span><br><span class="line">├─nvme3n1p2                  259:16   0 238.5G  0 part</span><br><span class="line">├─nvme3n1p3                  259:21   0 238.5G  0 part</span><br><span class="line">└─nvme3n1p4                  259:22   0 238.5G  0 part</span><br><span class="line">nvme2n1                      259:1    0 953.9G  0 disk</span><br><span class="line">├─nvme2n1p1                  259:12   0 238.5G  0 part</span><br><span class="line">├─nvme2n1p2                  259:13   0 238.5G  0 part</span><br><span class="line">├─nvme2n1p3                  259:17   0 238.5G  0 part</span><br><span class="line">└─nvme2n1p4                  259:18   0 238.5G  0 part</span><br><span class="line">nvme1n1                      259:2    0 931.5G  0 disk</span><br><span class="line">├─nvme1n1p1                  259:3    0  1007K  0 part</span><br><span class="line">├─nvme1n1p2                  259:4    0     1G  0 part /boot/efi</span><br><span class="line">└─nvme1n1p3                  259:5    0 930.5G  0 part</span><br><span class="line">  └─ ...</span><br><span class="line">nvme0n1                      259:6    0 931.5G  0 disk</span><br><span class="line">├─nvme0n1p1                  259:8    0 232.9G  0 part</span><br><span class="line">├─nvme0n1p2                  259:9    0 232.9G  0 part</span><br><span class="line">├─nvme0n1p3                  259:10   0 232.9G  0 part</span><br><span class="line">└─nvme0n1p4                  259:14   0 232.9G  0 part</span><br></pre></td></tr></tbody></table></figure><p><strong>使用 pveceph osd create 命令，将这些分区作为 OSD：</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">for</span> part <span class="keyword">in</span> {1..4}; <span class="keyword">do</span></span><br><span class="line">  pveceph osd create /dev/nvme0n1p<span class="variable">$part</span></span><br><span class="line">  pveceph osd create /dev/nvme2n1p<span class="variable">$part</span></span><br><span class="line">  pveceph osd create /dev/nvme3n1p<span class="variable">$part</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></tbody></table></figure><p><strong>检查结果</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ceph osd tree</span><br><span class="line">ID  CLASS  WEIGHT   TYPE NAME       STATUS  REWEIGHT  PRI-AFF</span><br><span class="line">-1         2.77271  root default</span><br><span class="line">-3         2.77271      host nuc</span><br><span class="line"> 0    ssd  0.22739          osd.0       up   1.00000  1.00000</span><br><span class="line"> 1    ssd  0.23289          osd.1       up   1.00000  1.00000</span><br><span class="line"> 2    ssd  0.23289          osd.2       up   1.00000  1.00000</span><br><span class="line"> 3    ssd  0.22739          osd.3       up   1.00000  1.00000</span><br><span class="line"> 4    ssd  0.23289          osd.4       up   1.00000  1.00000</span><br><span class="line"> 5    ssd  0.23289          osd.5       up   1.00000  1.00000</span><br><span class="line"> 6    ssd  0.22739          osd.6       up   1.00000  1.00000</span><br><span class="line"> 7    ssd  0.23289          osd.7       up   1.00000  1.00000</span><br><span class="line"> 8    ssd  0.23289          osd.8       up   1.00000  1.00000</span><br><span class="line"> 9    ssd  0.22739          osd.9       up   1.00000  1.00000</span><br><span class="line">10    ssd  0.23289          osd.10      up   1.00000  1.00000</span><br><span class="line">11    ssd  0.23289          osd.11      up   1.00000  1.00000</span><br></pre></td></tr></tbody></table></figure><p>接下来还需要配置存储池, 并将存储池添加到 RBD 和 CephFS.</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="在-PVE-虚拟机中挂载-CephFS"><a href="#在-PVE-虚拟机中挂载-CephFS" class="headerlink" title="在 PVE 虚拟机中挂载 CephFS"></a>在 PVE 虚拟机中挂载 CephFS</h4><ol><li><p>创建 CephFS：</p><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ceph fs <span class="keyword">new</span> cephfs cephfs_metadata cephfs_data</span><br></pre></td></tr></tbody></table></figure></li><li><p>添加到 PVE Web UI 中的 CephFS：</p></li><li><p>在 VM 或 LXC 中挂载 CephFS：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /mnt/cephfs</span><br><span class="line">mount -t ceph 192.168.31.99:6789:/ /mnt/cephfs -o name=admin,secret=&lt;ceph-secret&gt;</span><br></pre></td></tr></tbody></table></figure></li></ol><h4 id="在虚拟机中使用-RBD（块存储）"><a href="#在虚拟机中使用-RBD（块存储）" class="headerlink" title="在虚拟机中使用 RBD（块存储）"></a>在虚拟机中使用 RBD（块存储）</h4><ol><li><p>查看 Ceph 存储池：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rbd pool <span class="built_in">ls</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>创建 RBD：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rbd <span class="keyword">create</span> <span class="comment">--size 10G vm_storage/test-disk</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>在 VM 内部映射 RBD 磁盘并进行基本设置：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rbd map vm_storage/test-disk --name client.admin</span><br><span class="line">mkfs.ext4 /dev/rbd0</span><br><span class="line">mount /dev/rbd0 /mnt</span><br></pre></td></tr></tbody></table></figure></li></ol><p><strong>参考</strong>:</p><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wdmUtZG9jLWNuLnJlYWR0aGVkb2NzLmlvL3poLWNuL2xhdGVzdC9jaGFwdGVyX3B2ZWNlcGgvaW5kZXguaHRtbA==">部署超融合 Ceph 集群</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9tYWNlc3V0ZWQubW9lL2FydGljbGUvaHlwZXItY29udmVyZ2VuY2U=">Proxmox VE + Ceph 超融合集群部署实录</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82MTcwMjQ2Mzc=">proxmox+ceph 集群完整方案/完整方案</a></p></li></ul><blockquote><p>PVE 上使用 Ceph 的想法算了总结了, 太复杂了, 现在 12 个 OSD 跑了一晚上数据还没有同步完成, 所以打算玩玩 ZFS, 家用应该也够了.</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9mb3J1bS5wcm94bW94LmNvbS90aHJlYWRzL2Zvci1iZXN0LXBlcmZvcm1hbmNlLXByb3htb3gtY2x1c3Rlci13aXRoLWNlcGgtb3ItemZzLjEyOTYzNS8=">For Best Performance - Proxmox Cluster with CEPH or ZFS?</a></p></blockquote><hr><h3 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">apt install ceph-mgr-dashboard (on all service manager nodes)</span><br><span class="line">ceph mgr module <span class="built_in">enable</span> dashboard</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate new pw and paste it in the dashboard-pw file</span></span><br><span class="line"><span class="built_in">cd</span> /etc/ceph</span><br><span class="line">vim dashboard-pw</span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/ceph/dashboard-pw</span><br><span class="line"></span><br><span class="line"><span class="comment"># ceph dashboard ac-user-create &lt;user&gt; -i &lt;pw file&gt; &lt;role&gt;</span></span><br><span class="line">ceph dashboard set-login-credentials username -i dashboard</span><br><span class="line">ceph config-key <span class="built_in">set</span> mgr/dashboard/server_addr ::</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate certificate</span></span><br><span class="line">openssl req -newkey rsa:4096 -nodes -x509 \</span><br><span class="line">-keyout /etc/ceph/dashboard-key.pem -out /etc/ceph/dashboard-crt.pem -sha512 \</span><br><span class="line">-days 3650 -subj <span class="string">"/CN=IT/O=ceph-mgr-dashboard"</span> -utf8</span><br><span class="line"></span><br><span class="line">ceph config-key <span class="built_in">set</span> mgr/dashboard/key -i /etc/ceph/dashboard-key.pem</span><br><span class="line">ceph config-key <span class="built_in">set</span> mgr/dashboard/crt -i /etc/ceph/dashboard-crt.pem</span><br><span class="line"></span><br><span class="line">ceph mgr module <span class="built_in">disable</span> dashboard</span><br><span class="line">ceph mgr module <span class="built_in">enable</span> dashboard</span><br><span class="line">systemctl restart ceph-mgr@[servername].service</span><br><span class="line"></span><br><span class="line">Afterwards, go to the dashboard URL: https://[IP or FQDN]:8443 or http://[IP or FQDN]:8080</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1NDg1ODc1L2FydGljbGUvZGV0YWlscy8xMjg5MDY0MDM=">ProxmoxVE 启用 Ceph Dashboard 仪表盘，配置 Object Getaway 对象网关</a></li></ul><h3 id="卸载-Ceph-🙉"><a href="#卸载-Ceph-🙉" class="headerlink" title="卸载 Ceph 🙉"></a>卸载 Ceph 🙉</h3><p><strong>1. 停止并禁用 Ceph 服务</strong></p><p>首先，确保停止所有与 Ceph 相关的服务，包括 <strong>Monitor（mon）</strong>、<strong>OSD</strong>、<strong>MDS</strong>、<strong>Manager（mgr）</strong> 等：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop ceph-mon.target</span><br><span class="line">systemctl stop ceph-osd.target</span><br><span class="line">systemctl stop ceph-mgr.target</span><br><span class="line">systemctl stop ceph-mds.target</span><br></pre></td></tr></tbody></table></figure><p>然后，禁用这些服务，以确保它们不会在系统重启后自动启动：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable ceph-mon.target</span><br><span class="line">systemctl disable ceph-osd.target</span><br><span class="line">systemctl disable ceph-mgr.target</span><br><span class="line">systemctl disable ceph-mds.target</span><br></pre></td></tr></tbody></table></figure><p><strong>2. 卸载 Ceph 软件包</strong></p><p>卸载所有 Ceph 相关的包：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get remove --purge ceph ceph-common ceph-mds ceph-mon ceph-osd ceph-mgr ceph-fuse librados2 librgw1 libcephfs1 librados-dev librgw-dev libboost-iostreams1.58.0 libboost-filesystem1.58.0 libboost-system1.58.0 librados2 librgw1</span><br></pre></td></tr></tbody></table></figure><p>这将删除所有 Ceph 相关的软件包及其依赖。</p><p><strong>3. 删除 Ceph 配置和数据</strong></p><p>删除 Ceph 的配置文件和数据目录：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /etc/ceph</span><br><span class="line">rm -rf /var/lib/ceph</span><br><span class="line">rm -rf /var/log/ceph</span><br></pre></td></tr></tbody></table></figure><p>这些目录包含了 Ceph 的所有配置、日志和数据文件。</p><p><strong>4. 清理 LVM 卷和 Ceph OSD 数据</strong></p><p>如果您使用了 <strong>LVM</strong> 来管理 Ceph OSD，确保删除所有的 LVM 卷和卷组。首先，查看当前的 LVM 配置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo lvdisplay</span><br><span class="line">sudo vgdisplay</span><br><span class="line">sudo pvdisplay</span><br></pre></td></tr></tbody></table></figure><p>如果存在 Ceph 使用的 <strong>LVM 逻辑卷</strong>，<strong>卷组</strong> 或 <strong>物理卷</strong>，可以使用以下命令删除它们：</p><ol><li>删除 LVM 逻辑卷：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lvremove /dev/ceph/&lt;volume_group&gt;/&lt;logical_volume&gt;</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>删除 LVM 卷组：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vgremove &lt;volume_group&gt;</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>删除物理卷：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pvremove /dev/&lt;device&gt;</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>删除 Ceph OSD 设备：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wipefs -a /dev/&lt;device&gt;   # 用实际的设备路径替换 &lt;device&gt;</span><br></pre></td></tr></tbody></table></figure><p><strong>5. 删除 Ceph 相关的系统服务文件</strong></p><p>清理 Ceph 服务文件，确保没有服务文件残留：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/systemd/system/ceph-*</span><br><span class="line">rm -f /etc/systemd/system/ceph-mgr@*.service</span><br><span class="line">rm -f /etc/systemd/system/ceph-mon@*.service</span><br><span class="line">rm -f /etc/systemd/system/ceph-mds@*.service</span><br><span class="line">rm -f /etc/systemd/system/ceph-osd@*.service</span><br></pre></td></tr></tbody></table></figure><p><strong>6. 清除 Ceph 集群配置和密钥</strong></p><p>如果还没有删除 Ceph 集群的密钥环和配置文件，可以手动清理：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -f /etc/ceph/ceph.client.admin.keyring</span><br><span class="line">rm -f /etc/ceph/ceph.mon.keyring</span><br><span class="line">rm -f /etc/ceph/ceph-osd.keyring</span><br></pre></td></tr></tbody></table></figure><p><strong>7. 删除 ceph-crash</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop ceph-crash</span><br><span class="line">systemctl <span class="built_in">disable</span> ceph-crash</span><br><span class="line">systemctl mask ceph-crash</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf /etc/systemd/system/multi-user.target.wants/ceph-crash.service</span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/ceph/crash</span><br><span class="line"><span class="built_in">rm</span> -f /usr/bin/ceph-crash</span><br></pre></td></tr></tbody></table></figure><p><strong>8. 清理网络和存储设置</strong></p><p>如果配置了 Ceph 使用的特定 <strong>网络接口</strong> 或 <strong>防火墙规则</strong>，请手动清理这些设置：</p><ul><li><p>清理防火墙规则：使用 iptables 或 firewalld 清理 Ceph 使用的端口。</p></li><li><p>删除 <strong>虚拟网络接口</strong>（如 virtio 等）和 <strong>存储挂载点</strong>。</p></li></ul><p><strong>9. 重启系统</strong></p><p>完成以上步骤后，最好重启系统以确保所有 Ceph 组件完全卸载：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></tbody></table></figure><p><strong>10. 检查系统状态</strong></p><p>重启后，可以使用以下命令检查系统中是否仍然存在与 Ceph 相关的进程或配置：</p><ol><li>检查是否有 Ceph 相关的进程：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep ceph</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>检查 Ceph 配置是否被完全清除：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/ceph</span><br><span class="line">ls /var/lib/ceph</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>检查 LVM 是否有残留的 Ceph 卷：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo lvdisplay</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>使用以下命令检查系统日志是否仍有 Ceph 相关的错误：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /var/log/syslog</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="ZFS"><a href="#ZFS" class="headerlink" title="ZFS"></a>ZFS</h2><p>我 2 块 1T 的 pcie4 Gen3 的 nvme 固态硬盘, 分别是 nvme2n1 和 nvme3n1, 还有一块 1T 的 pcie4 Gen4: nvme0n1. 而且后期我可能还会增加其他 nvme 和 ssd. 现在我想在 pve 集群中使用 ZFS, 初步计划是让 nvme0n1 划分为 2 个分区, 分别作为 zfs 的读写缓存, 而其他盘作为数据盘.</p><p>下面是具体操作:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parted /dev/nvme0n1</span><br><span class="line"></span><br><span class="line">(parted) mklabel gpt</span><br><span class="line">(parted) <span class="built_in">print</span></span><br><span class="line">(parted) mkpart primary 0GB 500GB</span><br><span class="line">(parted) mkpart primary 500GB 100%</span><br><span class="line">(parted) quit</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">zpool create nvmes mirror /dev/nvme2n1 /dev/nvme3n1</span><br><span class="line"></span><br><span class="line">zfs <span class="built_in">set</span> secondarycache=all nvmes</span><br><span class="line">zfs <span class="built_in">set</span> recordsize=128k  nvmes</span><br><span class="line"></span><br><span class="line">zpool add nvmes cache /dev/nvme0n1p1</span><br><span class="line">zpool add nvmes <span class="built_in">log</span> /dev/nvme0n1p2</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250221012158_iZntJA26.webp" alt="20250221012158_iZntJA26.webp"></p><h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><p><strong>1. 在 PVE 宿主机中使用 ZFS 存储</strong></p><p>PVE 支持直接在宿主机中使用 ZFS 存储池。可以将 ZFS 存储池挂载到宿主机的特定目录，然后将虚拟机和 LXC 容器配置为使用该存储。</p><p><strong>挂载 ZFS 存储：</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs set mountpoint=/mnt/nvmes nvmes</span><br></pre></td></tr></tbody></table></figure><p>这将把你的 mypool ZFS 存储池挂载到 /mnt/nvmes 目录。可以在这个目录下创建文件并访问。</p><p><strong>创建 ZFS 快照：</strong></p><p>如果你想对 ZFS 存储池进行快照，可以使用：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs snapshot nvmes@snapshot_name</span><br></pre></td></tr></tbody></table></figure><p><strong>2. 在虚拟机中使用 ZFS 存储</strong></p><p>要在虚拟机中使用 ZFS 存储，可以通过以下两种方式：</p><p><strong>方式 1: 使用 ZFS 作为虚拟机的磁盘</strong></p><p>在宿主机中创建一个 ZFS 数据集作为虚拟机的磁盘：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs create nvmes/nvmes-disk</span><br></pre></td></tr></tbody></table></figure><p>在 PVE 中的虚拟机配置中，将 nvmes/nvmes-disk 数据集作为虚拟磁盘挂载给虚拟机。例如，通过 PVE Web 界面，可以在虚拟机的硬盘设置中选择该数据集，或者通过命令行使用：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qm set VMID -ide0 /dev/zvol/nvmes/nvmes-disk</span><br></pre></td></tr></tbody></table></figure><p><strong>方式 2: 使用 ZFS 文件共享给虚拟机</strong></p><p>如果不希望直接将 ZFS 存储池作为虚拟磁盘，可以将 ZFS 存储池中的某个目录挂载为共享目录，虚拟机通过网络访问。</p><ol><li>在宿主机中创建目录：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/nvmes/share</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>设置权限：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 /mnt/nvmes/share</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>在虚拟机内挂载 NFS 或 Samba 共享（见下面的“共享 ZFS 存储到局域网”部分）。</li></ol><p><strong>3. 在 LXC 容器中使用 ZFS 存储</strong></p><p>LXC 容器与虚拟机类似，也可以直接访问宿主机上的 ZFS 存储池。可以通过以下方式将 ZFS 存储挂载到容器内部：</p><ol><li><strong>挂载 ZFS 存储到容器目录：</strong></li></ol><p>可以将宿主机上的 ZFS 存储池挂载到容器的某个目录。假设将 nvmes/share 挂载到容器中的 /mnt/storage，可以在容器配置中添加以下配置：</p><p>编辑 /etc/pve/lxc/VMID.conf 配置文件，添加：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mp0: /mnt/nvmes/share,mp=/mnt/storage</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>重新启动容器：</strong></li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pct restart VMID</span><br></pre></td></tr></tbody></table></figure><p>容器就能访问宿主机上的 ZFS 存储了。</p><p><strong>4. 在局域网中共享 ZFS 存储</strong></p><p>如果希望将 ZFS 存储共享给局域网中的其他设备（比如其他计算机、服务器或虚拟机），可以使用 NFS 或 Samba。</p><p><strong>使用 NFS 共享 ZFS 存储：</strong></p><ol><li>安装 NFS 服务：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install nfs-kernel-server</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>配置 NFS 共享目录：</li></ol><p>在 /etc/exports 文件中添加 ZFS 存储目录：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/mnt/nvmes/share *(rw,sync,no_subtree_check)</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>重新启动 NFS 服务：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nfs-kernel-server</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>在客户端（其他计算机）挂载共享：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs &lt;宿主机_IP&gt;:/mnt/nvmes/share /mnt/nfs_share</span><br></pre></td></tr></tbody></table></figure><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vd2FuZ21vL3AvMTUwNDgwNDUuaHRtbA==">macOS 上通过 NFS 挂载 PVE ZFS 的问题</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9lY25lbGlzZXMuY29tLzIwMjIvMDgvcmVhZGluZy16ZnMtb24tbWFjb3Mv">在 macOS 上读取 ZFS 硬盘</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hcHBsZS5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvMjg1MzkwL2hvdy10by1tb3VudC1uZnMtZHJpdmUtb24tbWFjb3Mtd2l0aC1yZWFkd3JpdGUtYWNjZXNz">How to mount nfs drive on macOS with read+write access?</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9mb3hpLmJ1ZHVhbndhbmcudmlwL3ZpcnR1YWxpemF0aW9uLzI3MC5odG1sLw==">Proxmox VE pve 添加 nfs/smb/iscsi/NTFS 储存</a></p></li></ul><p><strong>使用 Samba 共享 ZFS 存储：</strong></p><ol><li>安装 Samba：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install samba</span><br></pre></td></tr></tbody></table></figure><ol start="2"><li>配置共享目录：</li></ol><p>编辑 /etc/samba/smb.conf 文件，添加以下配置：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[nvmes]</span><br><span class="line">   path = /mnt/nvmes</span><br><span class="line">   browsable = yes</span><br><span class="line">   read only = no</span><br><span class="line">   guest ok = yes        # 允许匿名访问</span><br><span class="line">   create mask = 0775    # 设置文件的创建权限</span><br><span class="line">   directory mask = 0775 # 设置目录的创建权限</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> -R 775 /mnt/nvmes</span><br><span class="line"><span class="built_in">chown</span> -R nobody:nogroup /mnt/nvmes</span><br></pre></td></tr></tbody></table></figure><ol start="3"><li>重启 Samba 服务：</li></ol><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart smbd</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>在客户端（其他计算机）访问共享：</li></ol><p>通过 smb:// 协议挂载共享：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbclient //宿主机_IP/nvmes</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="策略路由"><a href="#策略路由" class="headerlink" title="策略路由"></a>策略路由</h3><p>每台 PVE 都有至少 2 个网卡, 且分别链接到电信和联通宽带, 因为 PVE 只能设置一个网关, 所以需要通过策略路由的方式让第二块网卡可以链接外网.</p><p>比如 <strong>vmbr0</strong> 是第一块网卡, 且能够成功链接外网, <strong>vmbr1</strong> 是另一块网卡, 需要配置策略路由:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加第二个默认路由</span></span><br><span class="line">ip route add default via 192.168.21.1 dev vmbr1 table 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建规则</span></span><br><span class="line">ip rule add from 192.168.21.0/24 table 100</span><br></pre></td></tr></tbody></table></figure><p>然后使用 curl 测试不同的网卡:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --interface vmbr0 https://4.ipw.cn ; curl --interface vmbr1 https://4.ipw.cn</span><br></pre></td></tr></tbody></table></figure><p>能够成功返回正确的外网 IP 地址.</p><p><strong>持久化</strong></p><p>编辑 <code>/etc/network/interfaces</code>:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">auto vmbr1</span><br><span class="line">iface vmbr1 inet static</span><br><span class="line">				...</span><br><span class="line">        post-up ip route add default via 192.168.21.1 dev vmbr1 table 100</span><br><span class="line">        post-up ip rule add from 192.168.21.0/24 table 100</span><br><span class="line">        pre-down ip rule del from 192.168.21.0/24 table 100</span><br><span class="line">        pre-down ip route del default via 192.168.21.1 dev vmbr1 table 100</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart systemd-networkd</span><br></pre></td></tr></tbody></table></figure><h4 id="基于-debian-的虚拟机配置"><a href="#基于-debian-的虚拟机配置" class="headerlink" title="基于 debian 的虚拟机配置"></a>基于 debian 的虚拟机配置</h4><p>同上, 需要修改一下网卡名</p><h4 id="基于-ubuntu-的虚拟机配置"><a href="#基于-ubuntu-的虚拟机配置" class="headerlink" title="基于 ubuntu 的虚拟机配置"></a>基于 ubuntu 的虚拟机配置</h4><p>编辑 <code>/etc/systemd/network/eth1.network</code></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[Match]</span><br><span class="line">Name = eth1</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">Description = Interface eth1 autoconfigured by PVE</span><br><span class="line">Address = 192.168.21.100/24</span><br><span class="line">Gateway=192.168.21.1</span><br><span class="line">DHCP=ipv6</span><br><span class="line">IPv6AcceptRA=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[RoutingPolicyRule]</span><br><span class="line">Priority=1000</span><br><span class="line">From=192.168.21.0/24</span><br><span class="line">Table=100</span><br><span class="line"></span><br><span class="line">[Route]</span><br><span class="line">Destination=0.0.0.0/0</span><br><span class="line">Gateway=192.168.21.1</span><br><span class="line">Table=100</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart systemd-networkd</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --interface eth0 https://4.ipw.cn ; curl --interface eth1 https://4.ipw.cn</span><br></pre></td></tr></tbody></table></figure><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>上述配置后, 虽然能够通过两张网卡同时访问外网, 但是局域网的其他设备则无法通过网卡 2 访问 pve 和 虚拟机.</p><p>问题在于没有上述配置时, 如果从其他设备访问 PVE 时, PVE 知道请求来自 vmbr1，直接通过 vmbr1 返回 <code>192.168.21.x</code>，因为<strong>同网段的流量不会走路由表</strong>，只要 vmbr1 有 IP，流量就会正常往返.</p><p>为了能让第二块网卡也能访问外网, 我们添加了如下配置:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义 table 100，让它的默认网关是 192.168.21.1</span></span><br><span class="line">post-up ip route add default via 192.168.21.1 dev vmbr1 table 100</span><br><span class="line"><span class="comment"># 让 从 192.168.21.x 发出的流量 走 table 100，也就是 vmbr1</span></span><br><span class="line">post-up ip rule add from 192.168.21.0/24 table 100</span><br></pre></td></tr></tbody></table></figure><p>这样，<strong>如果 PVE 通过 192.168.21.119 访问外网，它就会从 vmbr1 走 192.168.21.1</strong>，从而实现两张网卡都能访问外网的目标.</p><p>但是当局域网设备访问 <code>192.168.21.x</code> 时, <strong>Linux 的路由策略默认使用“主路由表”决定回包路径</strong>, 而默认路由定义的是网卡 1, 所以会把默认从网卡 1 出去, 导致请求的设备无法正确接收数据.</p><p><strong>为什么 192.168.21.x 设备无法正确接收数据？</strong></p><p><strong>1. PVE 收到 192.168.21.x 设备的请求</strong></p><p>比如 192.168.21.50 想访问 PVE（192.168.21.119），它发送数据包：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src: 192.168.21.50  → dst: 192.168.21.119</span><br></pre></td></tr></tbody></table></figure><p>这个包会通过 vmbr1 接收。</p><p><strong>2. PVE 的默认路由选择 31.x 出口</strong></p><ul><li><p>PVE 既有 192.168.21.119，也有 192.168.31.119（假设）。</p></li><li><p>因为 PVE <strong>的默认网关是 192.168.31.1</strong>，所以它的默认路由是：</p></li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">default via 192.168.31.1 dev vmbr0</span><br></pre></td></tr></tbody></table></figure><ul><li><p><strong>Linux 默认使用 “主路由表” 进行路由查找，而不是基于入口接口回包</strong></p></li><li><p>于是 PVE 发送回包：</p></li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">src: 192.168.21.119  → dst: 192.168.21.50</span><br></pre></td></tr></tbody></table></figure><p>但是, <strong>它从 31.x 的网关 192.168.31.1 出去了</strong>.</p><p><strong>3. 回包从 31.x 出去，导致 NAT 失败</strong></p><ul><li><p>192.168.21.50 设备本来期望：</p><ul><li><strong>请求</strong>：21.50 -&gt; 21.119</li><li><strong>回包</strong>：21.119 -&gt; 21.50</li></ul></li><li><p>但实际上发生了：</p><ul><li><strong>请求</strong>：21.50 -&gt; 21.119</li><li><strong>回包</strong>：21.119 -&gt; 21.50（<strong>却从 31.x 出去</strong>）</li></ul></li></ul><p>这导致 192.168.21.50 <strong>收到的回包源 IP 还是 21.119</strong>，但路由器可能会 <strong>丢弃该包</strong>，因为：</p><ul><li><p>它的<strong>入站连接不是从 31.x 发出的</strong>，而是从 21.x 来的，<strong>这导致 NAT 不匹配</strong>。</p></li><li><p>许多防火墙（特别是企业路由器）默认会<strong>丢弃”非对称路由”的回包</strong>，因为它可能是伪造流量。</p></li></ul><hr><h4 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h4><p>为了满足以下要求:</p><ol><li>PVE 的两张网卡都能访问外网;</li><li>局域网能够正常访问 PVE 的两张网卡;</li></ol><p>我们需要做如下配置.</p><h5 id="基于-debian"><a href="#基于-debian" class="headerlink" title="基于 debian"></a>基于 debian</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">post-up ip route add 192.168.21.0/24 dev vmbr1 table 100</span><br><span class="line">post-up ip route add default via 192.168.21.1 dev vmbr1 table 100</span><br><span class="line">post-up ip rule add from 192.168.21.0/24 table 100</span><br><span class="line">post-up ip rule add to 192.168.21.0/24 table 100</span><br><span class="line">post-up ip rule add iif vmbr1 table 100</span><br><span class="line"></span><br><span class="line">post-down ip rule del from all iif vmbr1 lookup 100</span><br><span class="line">post-down ip rule del from all to 192.168.21.0/24 lookup 100</span><br><span class="line">post-down ip rule del from 192.168.21.0/24 lookup 100</span><br><span class="line">post-down ip route del 192.168.21.0/24 dev vmbr1 scope <span class="built_in">link</span> table 100</span><br><span class="line">post-down ip route del default via 192.168.21.1 dev vmbr1 table 100</span><br></pre></td></tr></tbody></table></figure><blockquote><p>LXC 或虚拟机中, 只需要修改一下网卡名称</p></blockquote><h5 id="基于-ubuntu"><a href="#基于-ubuntu" class="headerlink" title="基于 ubuntu"></a>基于 ubuntu</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[Match]</span><br><span class="line">Name=eth1</span><br><span class="line"></span><br><span class="line">[Network]</span><br><span class="line">Description=Interface eth1 autoconfigured by PVE</span><br><span class="line">Address=192.168.21.103/24</span><br><span class="line">Gateway=192.168.21.1</span><br><span class="line">DHCP=ipv6</span><br><span class="line">IPv6AcceptRA=<span class="literal">false</span></span><br><span class="line"></span><br><span class="line">[RoutingPolicyRule]</span><br><span class="line">Priority=1000</span><br><span class="line">From=192.168.21.0/24</span><br><span class="line">Table=100</span><br><span class="line"></span><br><span class="line">[RoutingPolicyRule]</span><br><span class="line">Priority=1001</span><br><span class="line">To=192.168.21.0/24</span><br><span class="line">Table=100</span><br><span class="line"></span><br><span class="line">[RoutingPolicyRule]</span><br><span class="line">Priority=1002</span><br><span class="line">IncomingInterface=eth1</span><br><span class="line">Table=100</span><br><span class="line"></span><br><span class="line">[Route]</span><br><span class="line">Destination=192.168.21.0/24</span><br><span class="line">Table=100</span><br><span class="line"></span><br><span class="line">[Route]</span><br><span class="line">Destination=0.0.0.0/0</span><br><span class="line">Gateway=192.168.21.1</span><br><span class="line">Table=100</span><br></pre></td></tr></tbody></table></figure><p>最后我们可以以下命令验证:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ip rule show</span><br><span class="line">0:      from all lookup <span class="built_in">local</span></span><br><span class="line">1000:   from 192.168.21.0/24 lookup 100 proto static</span><br><span class="line">1001:   from all to 192.168.21.0/24 lookup 100 proto static</span><br><span class="line">1002:   from all iif eth1 lookup 100 proto static</span><br><span class="line">32766:  from all lookup main</span><br><span class="line">32767:  from all lookup default</span><br><span class="line"></span><br><span class="line">$ ip route show table 100</span><br><span class="line">default via 192.168.21.1 dev eth1 proto static</span><br><span class="line">192.168.21.0/24 dev eth1 proto static scope <span class="built_in">link</span></span><br></pre></td></tr></tbody></table></figure><hr><h5 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h5><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    subgraph "外部设备"</span><br><span class="line">        Client31["设备 (192.168.31.x)"]</span><br><span class="line">        Client21["设备 (192.168.21.x)"]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph "PVE 服务器"</span><br><span class="line">        vmbr0["vmbr0 (192.168.31.119)"]</span><br><span class="line">        vmbr1["vmbr1 (192.168.21.119)"]</span><br><span class="line">        RouteTable["路由表 (策略路由)"]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph "网关"</span><br><span class="line">        GW31["192.168.31.1 (默认网关)"]</span><br><span class="line">        GW21["192.168.21.1"]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    %% 连接设备到 PVE</span><br><span class="line">    Client31 -- "流量进入" --&gt; vmbr0</span><br><span class="line">    Client21 -- "流量进入" --&gt; vmbr1</span><br><span class="line"></span><br><span class="line">    %% PVE 的路由处理</span><br><span class="line">    vmbr0 -- "默认流量走主路由表 (via 192.168.31.1)" --&gt; GW31</span><br><span class="line">    vmbr1 -- "匹配规则: iif vmbr1" --&gt; RouteTable</span><br><span class="line">    RouteTable -- "出口: vmbr1 (via 192.168.21.1)" --&gt; GW21</span><br><span class="line"></span><br><span class="line">    %% 设备访问返回流量</span><br><span class="line">    GW31 -- "回包流量" --&gt; vmbr0 -- "返回 Client31" --&gt; Client31</span><br><span class="line">    GW21 -- "回包流量" --&gt; vmbr1 -- "返回 Client21" --&gt; Client21</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="qemu-guest-agent"><a href="#qemu-guest-agent" class="headerlink" title="qemu-guest-agent"></a>qemu-guest-agent</h3><p>虚拟机执行命令:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install qemu-guest-agent -y</span><br><span class="line"></span><br><span class="line">sudo systemctl start qemu-guest-agent</span><br></pre></td></tr></tbody></table></figure><p>不过报错了:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ sudo systemctl start qemu-guest-agent</span><br><span class="line">^@A dependency job for qemu-guest-agent.service failed. See 'journalctl -xe' for details.</span><br><span class="line"></span><br><span class="line">Feb 20 06:26:26 ai systemd[1]: dev-virtio\x2dports-org.qemu.guest_agent.0.device: Job dev-virtio\x2dports-org.qemu.guest_agent.0.device/start timed out.</span><br><span class="line">Feb 20 06:26:26 ai systemd[1]: Timed out waiting for device dev-virtio\x2dports-org.qemu.guest_agent.0.device - /dev/virtio-ports/org.qemu.guest_agent.0.</span><br></pre></td></tr></tbody></table></figure><p><strong>虚拟机内的 QEMU Guest Agent 无法找到 /dev/virtio-ports/org.qemu.guest_agent.0 设备</strong>，通常是因为 <strong>PVE 的 VM 配置没有正确启用 QEMU Guest Agent</strong>。</p><p>所以需要在 PVE 宿主机上开启虚拟机的 Guest Agent:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qm <span class="built_in">set</span> 102 --agent enabled=1</span><br><span class="line"></span><br><span class="line">qm reboot 102</span><br></pre></td></tr></tbody></table></figure><p>然后还是启动失败:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ sudo systemctl status qemu-guest-agent</span><br><span class="line">○ qemu-guest-agent.service - QEMU Guest Agent</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/qemu-guest-agent.service; static)</span><br><span class="line">     Active: inactive (dead)</span><br><span class="line"></span><br><span class="line">Feb 20 06:34:46 ai systemd[1]: qemu-guest-agent.service: Bound to unit dev-virtio\x2dports-org.qemu.guest_agent.0.device, but unit isn<span class="string">'t active.</span></span><br><span class="line"><span class="string">Feb 20 06:34:46 ai systemd[1]: Dependency failed for qemu-guest-agent.service - QEMU Guest Agent.</span></span><br><span class="line"><span class="string">Feb 20 06:34:46 ai systemd[1]: qemu-guest-agent.service: Job qemu-guest-agent.service/start failed with result '</span>dependency<span class="string">'.</span></span><br></pre></td></tr></tbody></table></figure><p>查阅资料后发现是需要添加一个 <strong>virtio-serial</strong> 的设备:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qm <span class="built_in">set</span> 102 -serial0 socket</span><br><span class="line"></span><br><span class="line">qm reboot 102</span><br></pre></td></tr></tbody></table></figure><p>然后再次启动 agent:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) ➜  ~ sudo systemctl status qemu-guest-agent</span><br><span class="line">● qemu-guest-agent.service - QEMU Guest Agent</span><br><span class="line">     Loaded: loaded (/usr/lib/systemd/system/qemu-guest-agent.service; static)</span><br><span class="line">     Active: active (running) since Thu 2025-02-20 06:37:46 UTC; 3s ago</span><br><span class="line">   Main PID: 1549 (qemu-ga)</span><br><span class="line">      Tasks: 2 (<span class="built_in">limit</span>: 38427)</span><br><span class="line">     Memory: 416.0K (peak: 840.0K)</span><br><span class="line">        CPU: 5ms</span><br><span class="line">     CGroup: /system.slice/qemu-guest-agent.service</span><br><span class="line">             └─1549 /usr/sbin/qemu-ga</span><br><span class="line"></span><br><span class="line">Feb 20 06:37:46 ai systemd[1]: Started qemu-guest-agent.service - QEMU Guest Agent.</span><br></pre></td></tr></tbody></table></figure><p>显示启动成功了, 能够正常获取 IP 信息:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250221012204_Kp7lflpS.webp" alt="20250221012204_Kp7lflpS.webp"></p><p>服务器上查看虚拟机信息:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">qm agent &lt;vmid&gt; &lt;cmd&gt;</span><br><span class="line"></span><br><span class="line">    fsfreeze-freeze</span><br><span class="line">    fsfreeze-status</span><br><span class="line">    fsfreeze-thaw</span><br><span class="line">    fstrim                      <span class="comment">#查看ssd——trim</span></span><br><span class="line">    get-fsinfo                  <span class="comment">#查看磁盘信息</span></span><br><span class="line">    get-host-name               <span class="comment">#查看主机名</span></span><br><span class="line">    get-memory-block-info       <span class="comment">#查看内存块 信息</span></span><br><span class="line">    get-memory-blocks           <span class="comment">#查看您内存</span></span><br><span class="line">    get-osinfo                  <span class="comment">#查看系统信息</span></span><br><span class="line">    get-time                    <span class="comment">#查看时间</span></span><br><span class="line">    get-timezone                <span class="comment">#查看时区</span></span><br><span class="line">    get-users                   <span class="comment">#用户</span></span><br><span class="line">    get-vcpus                   <span class="comment">#查看CPU数量</span></span><br><span class="line">    info                        <span class="comment">#查看支持的命令</span></span><br><span class="line">    network-get-interfaces      <span class="comment">#查看网络</span></span><br><span class="line">    ping                        <span class="comment">#不明</span></span><br><span class="line">    shutdown                    <span class="comment">#关机</span></span><br><span class="line">    suspend-disk                <span class="comment">#休眠，储存到硬盘</span></span><br><span class="line">    suspend-hybrid              <span class="comment">#休眠，混合</span></span><br><span class="line">    suspend-ram                 <span class="comment">#挂起/休眠 内存</span></span><br></pre></td></tr></tbody></table></figure><p><strong>参考:</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9mb3hpLmJ1ZHVhbndhbmcudmlwL3ZpcnR1YWxpemF0aW9uL3B2ZS81MzAuaHRtbC8=">PVE 中 qemu guest agent 的安装和使用</a></li></ul><h3 id="删减-PCIe-设备后网卡名称变更"><a href="#删减-PCIe-设备后网卡名称变更" class="headerlink" title="删减 PCIe 设备后网卡名称变更"></a>删减 PCIe 设备后网卡名称变更</h3><p>网卡名称发生变化是因为系统使用了 <strong>udev</strong>（设备管理器）来自动为网络接口分配名称，默认使用 <strong>Predictable Network Interface Names</strong>（可预测的网络接口名称）规则。这个规则基于网卡的硬件地址（MAC 地址）或者设备路径（例如 PCI 地址）来命名网卡。</p><p>当拔掉 GPU 后，系统可能重新分配了网卡接口的名称，这主要是因为 PCI 插槽顺序、设备初始化顺序等因素的变化，导致了 udev 给网卡分配了不同的名称。</p><p>这会导致 PVE 系统中已经配置好的网络会无法获取 IP.</p><p>我们可以 <strong>通过 udev 规则固定网卡名称</strong>:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/udev/rules.d/99-network.rules</span><br><span class="line"></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, ACTION==<span class="string">"add"</span>, ATTR{address}==<span class="string">"1c:69:7a:d0:c5:11"</span>, NAME=<span class="string">"enp92s0"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, ACTION==<span class="string">"add"</span>, ATTR{address}==<span class="string">"18:9b:a5:80:5a:22"</span>, NAME=<span class="string">"enp2s0f0"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, ACTION==<span class="string">"add"</span>, ATTR{address}==<span class="string">"18:9b:a5:80:5a:33"</span>, NAME=<span class="string">"enp2s0f1"</span></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, ACTION==<span class="string">"add"</span>, ATTR{address}==<span class="string">"28:df:eb:5c:ab:44"</span>, NAME=<span class="string">"wlp91s0"</span></span><br></pre></td></tr></tbody></table></figure><p>重新加载 udev 规则:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">udevadm control --reload</span><br></pre></td></tr></tbody></table></figure><blockquote><p>我重新加载后没有生效, 是重启解决的</p></blockquote><p>这样，系统每次启动时，都会根据这个规则将指定的网卡名称固定为你指定的名称。</p><hr><h3 id="4G-网卡拨号-qmi-wwan"><a href="#4G-网卡拨号-qmi-wwan" class="headerlink" title="4G 网卡拨号(qmi_wwan)"></a>4G 网卡拨号(qmi_wwan)</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install libqmi-utils udhcpc</span><br></pre></td></tr></tbody></table></figure><p><strong>配置 4G 网卡并拨号上网</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 查看系统中识别到的 QMI 设备</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --dms-get-model</span><br><span class="line"></span><br><span class="line"># 获取 4G 卡的设备 ID 信息</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --dms-get-ids</span><br><span class="line"></span><br><span class="line"># 获取 4G 卡的 SIM 卡状态</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --uim-get-card-status</span><br><span class="line"></span><br><span class="line"># 获取网络信号强度信息</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --nas-get-signal-strength</span><br><span class="line"></span><br><span class="line"># 获取运营商网络状态</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --nas-get-serving-system</span><br><span class="line"></span><br><span class="line"># 设置 APN 并启动拨号连接（替换 `your_apn` 为实际 APN）[中国移动：cmnet 中国联通：3gnet 中国电信：ctnet]</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --wds-start-network="apn=your_apn,ip-type=4" --client-no-release-cid</span><br></pre></td></tr></tbody></table></figure><p><strong>获取拨号后的网络配置</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取当前网络配置，包括 IP 地址、子网掩码和网关</span><br><span class="line">qmicli -d /dev/cdc-wdm0 --device-open-proxy --wds-get-current-settings</span><br></pre></td></tr></tbody></table></figure><p><strong>配置动态获取 IP（DHCP）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 为 wwan0 接口配置 DHCP 动态获取 IP 地址</span><br><span class="line">sudo nano /etc/network/interfaces</span><br><span class="line"></span><br><span class="line"># 在文件中添加以下内容</span><br><span class="line"># 配置 wwan0 使用 DHCP 动态获取 IP 地址</span><br><span class="line">auto wwan0</span><br><span class="line">iface wwan0 inet dhcp</span><br></pre></td></tr></tbody></table></figure><p><strong>启动并检查网络接口</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 重启网络服务以使配置生效</span><br><span class="line">sudo systemctl restart networking</span><br><span class="line"></span><br><span class="line"># 确认 wwan0 接口已正确获取 IP 地址</span><br><span class="line">ip a show wwan0</span><br><span class="line"></span><br><span class="line"># 查看网络路由，确保默认路由通过 4G 网卡</span><br><span class="line">ip route show</span><br></pre></td></tr></tbody></table></figure><p><strong>手动请求 DHCP 获取 IP（可选）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 使用 dhclient 手动请求 DHCP 服务器分配 IP 地址</span><br><span class="line">sudo dhclient wwan0</span><br><span class="line"></span><br><span class="line"># 再次检查接口状态，确认是否已获取到 IP 地址</span><br><span class="line">ip a show wwan0</span><br></pre></td></tr></tbody></table></figure><p><strong>添加默认路由（如果需要）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果 IP 地址已正确分配，但默认路由没有设置，可以手动添加默认路由</span><br><span class="line">sudo ip route add default via &lt;your_gateway&gt; dev wwan0</span><br></pre></td></tr></tbody></table></figure><p><strong>配置 DNS（可选）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 手动添加 DNS 服务器</span><br><span class="line">echo "nameserver 218.6.200.139" | sudo tee /etc/resolv.conf</span><br><span class="line">echo "nameserver 61.139.2.69" | sudo tee -a /etc/resolv.conf</span><br></pre></td></tr></tbody></table></figure><p><strong>配置虚拟网络桥接（PVE）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 编辑网络配置文件，确保 wwan0 接口桥接到虚拟网桥 vmbr0</span><br><span class="line">sudo nano /etc/network/interfaces</span><br><span class="line"></span><br><span class="line"># 添加如下配置，使虚拟机通过 4G 网络连接</span><br><span class="line">auto vmbr0</span><br><span class="line">iface vmbr0 inet static</span><br><span class="line">    address 10.165.54.10</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    gateway 10.165.54.153</span><br><span class="line">    bridge_ports wwan0</span><br><span class="line">    bridge_stp off</span><br><span class="line">    bridge_fd 0</span><br></pre></td></tr></tbody></table></figure><p><strong>测试网络连接</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 测试网络是否能正常连接到外部地址</span><br><span class="line">ping 8.8.8.8</span><br><span class="line"></span><br><span class="line"># 测试 DNS 是否能解析域名</span><br><span class="line">dig @218.6.200.139 google.com</span><br></pre></td></tr></tbody></table></figure><p><strong>动态更新 IP 地址和路由（如果需要静态配置）</strong></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 创建脚本来动态更新 IP 地址和路由（当 IP 变化时）</span><br><span class="line">sudo nano /etc/network/if-up.d/update-wwan0-ip</span><br><span class="line"></span><br><span class="line"># 添加以下内容</span><br><span class="line">#!/bin/bash</span><br><span class="line">if [ "$IFACE" == "wwan0" ]; then</span><br><span class="line">    IP=$(ip addr show wwan0 | grep 'inet ' | awk '{print $2}' | cut -d/ -f1)</span><br><span class="line">    GATEWAY=$(ip route show dev wwan0 | grep default | awk '{print $3}')</span><br><span class="line">    DNS1="218.6.200.139"</span><br><span class="line">    DNS2="61.139.2.69"</span><br><span class="line"></span><br><span class="line">    # 更新 resolv.conf</span><br><span class="line">    echo "nameserver $DNS1" &gt; /etc/resolv.conf</span><br><span class="line">    echo "nameserver $DNS2" &gt;&gt; /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">    # 更新默认路由</span><br><span class="line">    ip route del default</span><br><span class="line">    ip route add default via "$GATEWAY"</span><br><span class="line"></span><br><span class="line">    # 更新 wwan0 的 IP 地址（仅在你使用静态 IP 时才需要）</span><br><span class="line">    ip addr add "$IP/30" dev wwan0</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 赋予脚本执行权限</span><br><span class="line">sudo chmod +x /etc/network/if-up.d/update-wwan0-ip</span><br></pre></td></tr></tbody></table></figure><h4 id="自动拨号"><a href="#自动拨号" class="headerlink" title="自动拨号"></a>自动拨号</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/qmi-network.service</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=QMI 4G Network</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/qmicli -d /dev/cdc-wdm0 --device-open-proxy --wds-start-network=<span class="string">"apn=ctnet,ip-type=4"</span> --client-no-release-cid</span><br><span class="line">ExecStartPost=/sbin/udhcpc -i wwan0</span><br><span class="line">Restart=always</span><br><span class="line">RestartSec=5</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> qmi-network</span><br><span class="line">sudo systemctl start qmi-network</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9tYW5wYWdlcy5kZWJpYW4ub3JnL3Rlc3RpbmcvbGlicW1pLXV0aWxzL3FtaWNsaS4xLmVuLmh0bWw=">debian-QMICLI</a></li></ul><hr><h3 id="4G-网卡拨号-wvdial"><a href="#4G-网卡拨号-wvdial" class="headerlink" title="4G 网卡拨号(wvdial)"></a>4G 网卡拨号(wvdial)</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install wvdial</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">vim /etc/wvdial.conf</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 电信</span></span><br><span class="line">[Dialer T]</span><br><span class="line">Init1 = ATZ</span><br><span class="line">Init2 = ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2 +FCLASS=0</span><br><span class="line">Modem Type = Analog Modem</span><br><span class="line">Baud = 9600</span><br><span class="line">New PPPD = <span class="built_in">yes</span></span><br><span class="line">Modem = /dev/ttyUSB3</span><br><span class="line">ISDN = 0</span><br><span class="line">Phone = *99<span class="comment">#</span></span><br><span class="line">Password = card</span><br><span class="line">Username = card</span><br></pre></td></tr></tbody></table></figure><p><strong>拨号</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ wvdial  T</span><br><span class="line">--&gt; WvDial: Internet dialer version 1.61</span><br><span class="line">--&gt; Initializing modem.</span><br><span class="line">--&gt; Sending: ATZ</span><br><span class="line">ATZ</span><br><span class="line">OK</span><br><span class="line">--&gt; Sending: ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2 +FCLASS=0</span><br><span class="line">ATQ0 V1 E1 S0=0 &amp;C1 &amp;D2 +FCLASS=0</span><br><span class="line">OK</span><br><span class="line">--&gt; Modem initialized.</span><br><span class="line">--&gt; Sending: ATDT*99<span class="comment">#</span></span><br><span class="line">--&gt; Waiting <span class="keyword">for</span> carrier.</span><br><span class="line">ATDT*99<span class="comment">#</span></span><br><span class="line">CONNECT 150000000</span><br><span class="line">--&gt; Carrier detected.  Waiting <span class="keyword">for</span> prompt.</span><br><span class="line">--&gt; Don<span class="string">'t know what to do!  Starting pppd and hoping for the best.</span></span><br><span class="line"><span class="string">--&gt; Starting pppd at Mon Feb 24 18:23:27 2025</span></span><br><span class="line"><span class="string">--&gt; Pid of pppd: 6407</span></span><br><span class="line"><span class="string">--&gt; Using interface ppp0</span></span><br><span class="line"><span class="string">--&gt; local  IP address 10.165.54.154</span></span><br><span class="line"><span class="string">--&gt; remote IP address 10.64.64.64</span></span><br><span class="line"><span class="string">--&gt; primary   DNS address 218.6.200.139</span></span><br><span class="line"><span class="string">--&gt; secondary DNS address 61.139.2.69</span></span><br></pre></td></tr></tbody></table></figure><h4 id="自动拨号-1"><a href="#自动拨号-1" class="headerlink" title="自动拨号"></a>自动拨号</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#! /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#运行步骤变量初始化</span></span><br><span class="line">ec20_step=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#超时计数初始化</span></span><br><span class="line">over_time=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#循环</span></span><br><span class="line"><span class="keyword">while</span> [ 1 ]</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="comment">#第一步先检查驱动</span></span><br><span class="line">	<span class="keyword">if</span> [ <span class="variable">$ec20_step</span> -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">	<span class="comment">#使用lsusb查看是否有ec20驱动 grep查询结果是否包含Quectel</span></span><br><span class="line">		result=$(lsusb | grep Quectel)</span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"1. 检查驱动: "</span> <span class="variable">$result</span></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="variable">$result</span> =~ <span class="string">"EC25"</span> ]]; <span class="keyword">then</span></span><br><span class="line">			ec20_step=1</span><br><span class="line"></span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			ec20_step=0</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="comment">#延时2s</span></span><br><span class="line">		<span class="built_in">sleep</span> 2</span><br><span class="line">	<span class="comment">#第二步 开始使用 wvdial 拨号</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="variable">$ec20_step</span> -eq 1 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"2. wvdial 拨号"</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"password"</span> | sudo <span class="built_in">nohup</span> wvdial T &amp;</span><br><span class="line">		ec20_step=2</span><br><span class="line"></span><br><span class="line">		<span class="built_in">sleep</span> 2</span><br><span class="line">	<span class="comment">#第三步 查询路由是否包含 ppp0 网卡，拨号成功则会包含有 ppp0 网卡</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="variable">$ec20_step</span> -eq 2 ]; <span class="keyword">then</span></span><br><span class="line">		result=$(route -n | grep ppp0)</span><br><span class="line"></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"3. 检查是否存在 ppp0 网卡"</span> <span class="variable">$result</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="variable">$result</span> =~ <span class="string">"ppp0"</span> ]]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"3.1 包含网卡，添加默认路由"</span></span><br><span class="line">			<span class="comment">#若包含网卡，则添加默认路由</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"password"</span> | sudo route add default dev ppp0</span><br><span class="line">			ec20_step=3</span><br><span class="line">			over_time=0</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"3.2 不包含网卡, 再次循环查询, 循环次数:"</span> <span class="variable">$over_time</span></span><br><span class="line">			<span class="comment">#超时计数</span></span><br><span class="line">			<span class="built_in">let</span> over_time++</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="comment">#若一分钟都没有路由网卡则说明没有拨号成功</span></span><br><span class="line">		<span class="keyword">if</span> [ <span class="variable">$over_time</span> -eq 12 ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"12 次检查不存在路由网卡, 说明没有拨号成功, 进入重启逻辑"</span></span><br><span class="line">			over_time=0</span><br><span class="line">			<span class="comment">#超时拨号则跳入重启步骤</span></span><br><span class="line">			ec20_step=4</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">sleep</span> 5</span><br><span class="line">	<span class="comment">#第四步 通过 ping 命令检查网络状态</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="variable">$ec20_step</span> -eq 3 ]; <span class="keyword">then</span></span><br><span class="line">		result=$(ping -I ppp0 -c 1 www.baidu.com)</span><br><span class="line"></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"4. 通过 ping 命令检查网络状态"</span> <span class="variable">$result</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> [[ <span class="variable">$result</span> =~ <span class="string">"1 received"</span> ]]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"4.1 ping 成功"</span></span><br><span class="line">			over_time=0</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"4.2 ping 失败, 再次循环查询"</span></span><br><span class="line">			<span class="built_in">let</span> over_time++</span><br><span class="line"></span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="comment">#超时则杀掉拨号线程，并进入重启步骤</span></span><br><span class="line">		<span class="keyword">if</span> [ <span class="variable">$over_time</span> -eq 6 ]; <span class="keyword">then</span></span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"6 次 ping 失败, 进入重启逻辑"</span></span><br><span class="line">			over_time=0</span><br><span class="line">			ec20_step=4</span><br><span class="line">			<span class="built_in">echo</span> <span class="string">"password"</span> | sudo pkill wvdial</span><br><span class="line">		<span class="keyword">fi</span></span><br><span class="line">		<span class="built_in">sleep</span> 5</span><br><span class="line"></span><br><span class="line">	<span class="comment">#第五步重启模块</span></span><br><span class="line">	<span class="keyword">elif</span> [ <span class="variable">$ec20_step</span> -eq 4 ]; <span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"重启网卡"</span></span><br><span class="line">		<span class="built_in">echo</span> -e <span class="string">"AT+CFUN=1,1\r\n"</span> &gt; /dev/ttyUSB2</span><br><span class="line">		ec20_step=0</span><br><span class="line">		<span class="comment">#重启命令后延时稍微长一点</span></span><br><span class="line">		<span class="built_in">sleep</span> 15</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></tbody></table></figure><hr><h3 id="搭建-40G-56G-内网"><a href="#搭建-40G-56G-内网" class="headerlink" title="搭建 40G/56G 内网"></a>搭建 40G/56G 内网</h3><h4 id="40G"><a href="#40G" class="headerlink" title="40G"></a>40G</h4><p>购买的 迈络思 354A-FCCT 默认为 ETH 模式, 所以直接连接然后测试:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">iperf -c 1.0.0.18 -t 30 -i 1 -P 10</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">Client connecting to 1.0.0.18, TCP port 5001</span><br><span class="line">TCP window size: 16.0 KByte (default)</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">[  2] <span class="built_in">local</span> 1.0.0.19 port 39866 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/370)</span><br><span class="line">[  9] <span class="built_in">local</span> 1.0.0.19 port 39958 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/193)</span><br><span class="line">[  5] <span class="built_in">local</span> 1.0.0.19 port 39870 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/343)</span><br><span class="line">[ 10] <span class="built_in">local</span> 1.0.0.19 port 39954 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/196)</span><br><span class="line">[  7] <span class="built_in">local</span> 1.0.0.19 port 39952 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/394)</span><br><span class="line">[  8] <span class="built_in">local</span> 1.0.0.19 port 39936 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/411)</span><br><span class="line">[  6] <span class="built_in">local</span> 1.0.0.19 port 39922 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/320)</span><br><span class="line">[  1] <span class="built_in">local</span> 1.0.0.19 port 39864 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/381)</span><br><span class="line">[  4] <span class="built_in">local</span> 1.0.0.19 port 39862 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/369)</span><br><span class="line">[  3] <span class="built_in">local</span> 1.0.0.19 port 39868 connected with 1.0.0.18 port 5001 (icwnd/mss/irtt=87/8948/364)</span><br><span class="line">[ ID] Interval       Transfer     Bandwidth</span><br><span class="line">[  6] 0.0000-1.0000 sec   794 MBytes  6.66 Gbits/sec</span><br><span class="line">[  9] 0.0000-1.0000 sec   802 MBytes  6.73 Gbits/sec</span><br><span class="line">[ 10] 0.0000-1.0000 sec   399 MBytes  3.34 Gbits/sec</span><br><span class="line">[  1] 0.0000-1.0000 sec   159 MBytes  1.33 Gbits/sec</span><br><span class="line">[  7] 0.0000-1.0000 sec   403 MBytes  3.38 Gbits/sec</span><br><span class="line">[  8] 0.0000-1.0000 sec   651 MBytes  5.46 Gbits/sec</span><br><span class="line">[  3] 0.0000-1.0000 sec   420 MBytes  3.53 Gbits/sec</span><br><span class="line">[  4] 0.0000-1.0000 sec   472 MBytes  3.96 Gbits/sec</span><br><span class="line">[  5] 0.0000-1.0000 sec   385 MBytes  3.23 Gbits/sec</span><br><span class="line">[  2] 0.0000-1.0000 sec   195 MBytes  1.64 Gbits/sec</span><br><span class="line">[SUM] 0.0000-1.0000 sec  4.57 GBytes  39.3 Gbits/sec</span><br></pre></td></tr></tbody></table></figure><p>基本上跑满了 40G 带宽.</p><h4 id="56G"><a href="#56G" class="headerlink" title="56G"></a>56G</h4><p>56G 需要设置成 IB 模式.</p><h5 id="安装-MFT"><a href="#安装-MFT" class="headerlink" title="安装 MFT"></a>安装 MFT</h5><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9uZXR3b3JrLm52aWRpYS5jb20vcHJvZHVjdHMvYWRhcHRlci1zb2Z0d2FyZS9maXJtd2FyZS10b29scy8=">Mellanox Firmware Tools (MFT) (nvidia.com)</a></p><p>安装依赖:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y dkms <span class="string">"build-*"</span> pve-headers pve-headers-`<span class="built_in">uname</span> -r`</span><br></pre></td></tr></tbody></table></figure><p>安装 MFT 时报错:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  mft-4.30.1-113-x86_64-deb mst start</span><br><span class="line">Starting MST (Mellanox Software Tools) driver set</span><br><span class="line">Loading MST PCI modulemodprobe: ERROR: could not insert 'mst_pci': Key was rejected by service</span><br><span class="line"> - Failure: 1</span><br><span class="line">Loading MST PCI configuration modulemodprobe: ERROR: could not insert 'mst_pciconf': Key was rejected by service</span><br><span class="line"> - Failure: 1</span><br><span class="line">Create devices</span><br><span class="line"></span><br><span class="line">mst_pci driver not found</span><br><span class="line">Unloading MST PCI module (unused) - Success</span><br><span class="line">Unloading MST PCI configuration module (unused) - Success</span><br></pre></td></tr></tbody></table></figure><p>我在另一台 PVE 上安装则没有问题, AI 给我的回答是 <strong>Secure Boot 阻止了未签名的驱动</strong>, 所以查看一下两台 PVE 的 <strong>Secure Boot</strong> 的状态:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mokutil --sb-state</span><br><span class="line">SecureBoot enabled</span><br></pre></td></tr></tbody></table></figure><p>报错的这台开启了 <code>SecureBoot</code>, 另一台则没有开启, 所以基本上确认是这个问题, 需要去 BIOS 禁用 <strong>SecureBoot</strong>, 然后重新安装 MFT.</p><p>第一次安装的是 4.30 版本, 安装后使用 <code>mst start</code> 出现如下问题:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ mst start</span><br><span class="line">Starting MST (Mellanox Software Tools) driver <span class="built_in">set</span></span><br><span class="line">Loading MST PCI module - Success</span><br><span class="line">Loading MST PCI configuration module - Success</span><br><span class="line">Create devices</span><br><span class="line">Unloading MST PCI module (unused) - Success</span><br><span class="line">Unloading MST PCI configuration module (unused) - Success</span><br></pre></td></tr></tbody></table></figure><p>加载模块后又自动卸载了, 且使用 <code>mst status</code> 无法获取网卡信息:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mst status</span><br><span class="line">MST modules:</span><br><span class="line">------------</span><br><span class="line">    MST PCI module is not loaded</span><br><span class="line">    MST PCI configuration module is not loaded</span><br><span class="line"></span><br><span class="line">PCI Devices:</span><br><span class="line">------------</span><br><span class="line"></span><br><span class="line">	No devices were found.</span><br></pre></td></tr></tbody></table></figure><p>查阅相关信息后, 是因为 MFT 版本问题, 在尝试了多个版本后, 确认 4.24 版本可行(<strong>我的网卡是 HP544+ 和 354A-FCCT</strong>):</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ mst status</span><br><span class="line">MST modules:</span><br><span class="line">------------</span><br><span class="line">    MST PCI module loaded</span><br><span class="line">    MST PCI configuration module loaded</span><br><span class="line"></span><br><span class="line">MST devices:</span><br><span class="line">------------</span><br><span class="line">/dev/mst/mt4103_pciconf0         - PCI configuration cycles access.</span><br><span class="line">                                   domain:bus:dev.fn=0000:01:00.0 addr.reg=88 data.reg=92 cr_bar.gw_offset=-1</span><br><span class="line">                                   Chip revision is: 00</span><br><span class="line">/dev/mst/mt4103_pci_cr0          - PCI direct access.</span><br><span class="line">                                   domain:bus:dev.fn=0000:01:00.0 bar=0x6c600000 size=0x100000</span><br><span class="line">                                   Chip revision is: 00</span><br></pre></td></tr></tbody></table></figure><h5 id="查询固件信息"><a href="#查询固件信息" class="headerlink" title="查询固件信息"></a>查询固件信息</h5><p><strong>MCX354A-FCCT</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ mlxfwmanager</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device <span class="comment">#1:</span></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">  Device Type:      ConnectX3Pro</span><br><span class="line">  Part Number:      MCX354A-FCC_Ax</span><br><span class="line">  Description:      ConnectX-3 Pro VPI adapter card; dual-port QSFP; FDR IB (56Gb/s) and 40GigE;PCIe3.0 x8 8GT/s;RoHS R6</span><br><span class="line">  PSID:             MT_1090111019</span><br><span class="line">  PCI Device Name:  /dev/mst/mt4103_pci_cr0</span><br><span class="line">  Port1 GUID:       e41d2d03004ab0c1</span><br><span class="line">  Port2 GUID:       e41d2d03004ab0c2</span><br><span class="line">  Versions:         Current        Available</span><br><span class="line">     FW             2.42.5000      N/A</span><br><span class="line">     PXE            3.4.0752       N/A</span><br><span class="line"></span><br><span class="line">  Status:           No matching image found</span><br></pre></td></tr></tbody></table></figure><p><strong>HP544+</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ mlxfwmanager</span><br><span class="line">Querying Mellanox devices firmware ...</span><br><span class="line"></span><br><span class="line">Device <span class="comment">#1:</span></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">  Device Type:      ConnectX3Pro</span><br><span class="line">  Part Number:      764285-B21_Ax</span><br><span class="line">  Description:      HP InfiniBand FDR/Ethernet 10Gb/40Gb 2-port 544+FLR-QSFP Adapter</span><br><span class="line">  PSID:             HP_1380110017</span><br><span class="line">  PCI Device Name:  /dev/mst/mt4103_pci_cr0</span><br><span class="line">  Port1 GUID:       88e9a4ffff1241a1</span><br><span class="line">  Port2 MAC:        88e9a41241a2</span><br><span class="line">  Versions:         Current        Available</span><br><span class="line">     FW             2.42.5700      N/A</span><br><span class="line">     CLP            8025           N/A</span><br><span class="line">     PXE            3.4.0754       N/A</span><br><span class="line">     UEFI           14.11.0049     N/A</span><br><span class="line"></span><br><span class="line">  Status:           No matching image found</span><br></pre></td></tr></tbody></table></figure><h5 id="切换-IB-Ethernet-模式"><a href="#切换-IB-Ethernet-模式" class="headerlink" title="切换 IB/Ethernet 模式"></a>切换 IB/Ethernet 模式</h5><p>首先查询当前连接模式:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mlxconfig -d /dev/mst/mt4103_pci_cr0 query</span><br><span class="line"></span><br><span class="line">Device <span class="comment">#1:</span></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line">Device <span class="built_in">type</span>:    ConnectX3Pro</span><br><span class="line">Device:         /dev/mst/mt4103_pci_cr0</span><br><span class="line"></span><br><span class="line">Configurations:                                      Next Boot</span><br><span class="line">         SRIOV_EN                                    True(1)</span><br><span class="line">         NUM_OF_VFS                                  8</span><br><span class="line">         LINK_TYPE_P1                                ETH(2)</span><br><span class="line">         LINK_TYPE_P2                                ETH(2)</span><br><span class="line">         LOG_BAR_SIZE                                3</span><br><span class="line">         BOOT_PKEY_P1                                0</span><br><span class="line">         BOOT_PKEY_P2                                0</span><br><span class="line">         BOOT_OPTION_ROM_EN_P1                       True(1)</span><br><span class="line">         BOOT_VLAN_EN_P1                             False(0)</span><br><span class="line">         BOOT_RETRY_CNT_P1                           0</span><br><span class="line">         LEGACY_BOOT_PROTOCOL_P1                     PXE(1)</span><br><span class="line">         BOOT_VLAN_P1                                1</span><br><span class="line">         BOOT_OPTION_ROM_EN_P2                       True(1)</span><br><span class="line">         BOOT_VLAN_EN_P2                             False(0)</span><br><span class="line">         BOOT_RETRY_CNT_P2                           0</span><br><span class="line">         LEGACY_BOOT_PROTOCOL_P2                     PXE(1)</span><br><span class="line">         BOOT_VLAN_P2                                1</span><br><span class="line">         IP_VER_P1                                   IPv4(0)</span><br><span class="line">         IP_VER_P2                                   IPv4(0)</span><br><span class="line">         CQ_TIMESTAMP                                True(1)</span><br></pre></td></tr></tbody></table></figure><p>其中 <strong>LINK_TYPE_P1</strong> 为 ETH, 修改为 IB 模式:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mlxconfig -d /dev/mst/mt4103_pciconf0 <span class="built_in">set</span> LINK_TYPE_P1=1</span><br><span class="line">mlxconfig -d /dev/mst/mt4103_pciconf0 <span class="built_in">set</span> LINK_TYPE_P2=1</span><br></pre></td></tr></tbody></table></figure><ol><li>IB 模式</li><li>ETH 模式</li><li>VPI 模式</li></ol><h5 id="IB-组网"><a href="#IB-组网" class="headerlink" title="IB 组网"></a>IB 组网</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装相关依赖</span></span><br><span class="line">apt update</span><br><span class="line">apt install -y infiniband-diags rdma-core ibverbs-providers perftest</span><br></pre></td></tr></tbody></table></figure><p><strong>检查 InfiniBand 设备是否可用</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">ibstat</span><br><span class="line"></span><br><span class="line">CA <span class="string">'mlx4_0'</span></span><br><span class="line">	CA <span class="built_in">type</span>: MT4103</span><br><span class="line">	Number of ports: 2</span><br><span class="line">	Firmware version: 2.42.5700</span><br><span class="line">	Hardware version: 0</span><br><span class="line">	Node GUID: 0x88e9a4ffff1241a0</span><br><span class="line">	System image GUID: 0x88e9a4ffff1241a3</span><br><span class="line">	Port 1:</span><br><span class="line">		State: Initializing</span><br><span class="line">		Physical state: LinkUp</span><br><span class="line">		Rate: 56</span><br><span class="line">		Base lid: 0</span><br><span class="line">		LMC: 0</span><br><span class="line">		SM lid: 0</span><br><span class="line">		Capability mask: 0x02514868</span><br><span class="line">		Port GUID: 0x88e9a4ffff1241a1</span><br><span class="line">		Link layer: InfiniBand</span><br><span class="line">	Port 2:</span><br><span class="line">		State: Down</span><br><span class="line">		Physical state: Disabled</span><br><span class="line">		Rate: 10</span><br><span class="line">		Base lid: 0</span><br><span class="line">		LMC: 0</span><br><span class="line">		SM lid: 0</span><br><span class="line">		Capability mask: 0x00010000</span><br><span class="line">		Port GUID: 0x8ae9a4fffe1241a2</span><br><span class="line">		Link layer: Ethernet</span><br></pre></td></tr></tbody></table></figure><h5 id="InfiniBand-子网管理器"><a href="#InfiniBand-子网管理器" class="headerlink" title="InfiniBand 子网管理器"></a>InfiniBand 子网管理器</h5><p>ibstat 输出显示 <strong>Port 1 仍然处于 “Initializing” 状态</strong>，说明 InfiniBand 连接还没有完全建立，因为 InfiniBand 网络需要 <strong>Subnet Manager (SM)</strong> 来管理连接。默认情况下，如果网络中没有运行 InfiniBand 交换机（支持 SM），则需要在 <strong>至少一台 PVE 服务器上运行 SM</strong>。</p><blockquote><p>所有 InfiniBand 网络都必须运行子网管理器才能正常工作。即使两台机器没有使用交换机直接进行连接，也是如此。</p><p>有可能有一个以上的子网管理器。在这种情况下，一个 master 充当一个主子网管理器，另一个子网管理器充当从属子网管理器，当主子网管理器出现故障时将接管。</p><p>Red Hat Enterprise Linux 提供 <code>OpenSM</code>，这是 InfiniBand 子网管理器的实现。但是，<code>Open</code> SM 的功能是有限的，没有活跃的上游开发。通常，InfiniBand 交换机中嵌入的子网管理器提供更多功能，并支持最新的 InfiniBand 硬件。详情请查看 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9hY2Nlc3MucmVkaGF0LmNvbS9hcnRpY2xlcy83MDg3OTUzP2V4dElkQ2FycnlPdmVyPXRydWUmc2NfY2lkPTcwMWYyMDAwMDAxQ3NzNUFBQw==">安装和配置 OpenSM InfiniBand 子网管理器</a>。</p></blockquote><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y opensm</span><br><span class="line">systemctl <span class="built_in">enable</span> --now opensm</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ ibstat</span><br><span class="line">CA <span class="string">'mlx4_0'</span></span><br><span class="line">	CA <span class="built_in">type</span>: MT4103</span><br><span class="line">	Number of ports: 2</span><br><span class="line">	Firmware version: 2.42.5700</span><br><span class="line">	Hardware version: 0</span><br><span class="line">	Node GUID: 0x88e9a4ffff1241a0</span><br><span class="line">	System image GUID: 0x88e9a4ffff1241a3</span><br><span class="line">	Port 1:</span><br><span class="line">		State: Active</span><br><span class="line">		Physical state: LinkUp</span><br><span class="line">		Rate: 56</span><br><span class="line">		Base lid: 1</span><br><span class="line">		LMC: 0</span><br><span class="line">		SM lid: 1</span><br><span class="line">		Capability mask: 0x0251486a</span><br><span class="line">		Port GUID: 0x88e9a4ffff1241a1</span><br><span class="line">		Link layer: InfiniBand</span><br><span class="line">	Port 2:</span><br><span class="line">		State: Down</span><br><span class="line">		Physical state: Disabled</span><br><span class="line">		Rate: 10</span><br><span class="line">		Base lid: 0</span><br><span class="line">		LMC: 0</span><br><span class="line">		SM lid: 0</span><br><span class="line">		Capability mask: 0x00010000</span><br><span class="line">		Port GUID: 0x8ae9a4fffe1241a2</span><br><span class="line">		Link layer: Ethernet</span><br></pre></td></tr></tbody></table></figure><p>现在显示连接正常, 且自动新增了一个 IB 网络:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ip a</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">5: ibp1s0: &lt;BROADCAST,MULTICAST&gt; mtu 4092 qdisc noop state DOWN group default qlen 256</span><br><span class="line">    <span class="built_in">link</span>/infiniband 80:00:02:08:fe:80:00:00:00:00:00:00:e4:1d:2d:03:00:4a:b0:c1 brd 00:ff:ff:ff:ff:12:40:1b:ff:ff:00:00:00:00:00:00:ff:ff:ff:ff</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure><p>接下来就是配置静态 IP, 将两台 PVE 通过 IB 网络连接.</p><h5 id="IP-over-Infiniband"><a href="#IP-over-Infiniband" class="headerlink" title="IP over Infiniband"></a>IP over Infiniband</h5><p>InfiniBand 是一种高速网络通信技术，用于在计算机系统和数据中心中连接高性能计算、存储和网络设备。InfiniBand 提供了一种高效的低延迟和高带宽的解决方案，通过使用专用硬件和协议来提高数据传输的速度和可靠性。与传统的以太网技术相比，InfiniBand 提供了更高的带宽和更低的延迟。</p><p>然而，不是所有的软件都支持 Infiniband，因此赋予 infiniband 一个 IP 则可以让它兼容大部分的软件协议，这种方法就是 IP over Infiniband(IPoIB)。</p><p><strong>HP544+</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">auto ibp1s0</span><br><span class="line">iface ibp1s0 inet static</span><br><span class="line">    address 1.0.0.1</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    mtu 65520</span><br><span class="line"><span class="comment"># IB</span></span><br></pre></td></tr></tbody></table></figure><p><strong>MCX354A-FCCT</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">auto ibp1s0</span><br><span class="line">iface ibp1s0 inet static</span><br><span class="line">    address 1.0.0.2</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line">    mtu 65520</span><br><span class="line"><span class="comment"># IB</span></span><br></pre></td></tr></tbody></table></figure><p><strong>自动加载模块</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/modules</span><br><span class="line"></span><br><span class="line">+ ib_ipoib</span><br><span class="line">+ ib_umad</span><br></pre></td></tr></tbody></table></figure><p><strong>重启网络</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> ibp1s0 down &amp;&amp; ip <span class="built_in">link</span> <span class="built_in">set</span> ibp1s0 up</span><br></pre></td></tr></tbody></table></figure><p><strong>测试</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping -c 4 1.0.0.2  <span class="comment"># 在 PVE1 上</span></span><br><span class="line">ping -c 4 1.0.0.1  <span class="comment"># 在 PVE2 上</span></span><br></pre></td></tr></tbody></table></figure><p><strong>ibping 测试</strong></p><p>首先在 HP544+ 的服务器(节点为 <strong>NUC</strong>)上启动服务端:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ibping -S</span><br></pre></td></tr></tbody></table></figure><p>然后查询相关信息:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ ibnetdiscover</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Topology file: generated on Tue Mar  4 14:51:01 2025</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Initiated from node e41d2d03004ab0c0 port e41d2d03004ab0c1</span></span><br><span class="line"></span><br><span class="line">vendid=0x2c9</span><br><span class="line">devid=0x1007</span><br><span class="line">sysimgguid=0x88e9a4ffff1241a3</span><br><span class="line">caguid=0x88e9a4ffff1241a0</span><br><span class="line">Ca	2 <span class="string">"H-88e9a4ffff1241a0"</span>		<span class="comment"># "nuc mlx4_0"</span></span><br><span class="line">[1](88e9a4ffff1241a1) 	<span class="string">"H-e41d2d03004ab0c0"</span>[1] (e41d2d03004ab0c1) 		<span class="comment"># lid 1 lmc 0 "alpha mlx4_0" lid 2 4xFDR</span></span><br><span class="line"></span><br><span class="line">vendid=0x2c9</span><br><span class="line">devid=0x1007</span><br><span class="line">sysimgguid=0xe41d2d03004ab0c3</span><br><span class="line">caguid=0xe41d2d03004ab0c0</span><br><span class="line">Ca	2 <span class="string">"H-e41d2d03004ab0c0"</span>		<span class="comment"># "alpha mlx4_0"</span></span><br><span class="line">[1](e41d2d03004ab0c1) 	<span class="string">"H-88e9a4ffff1241a0"</span>[1] (88e9a4ffff1241a1) 		<span class="comment"># lid 2 lmc 0 "nuc mlx4_0" lid 1 4xFDR</span></span><br></pre></td></tr></tbody></table></figure><p>显示有 2 个节点, 分别是 <strong>nuc(lid = 1)</strong> 和 <strong>alpha(lid = 2)</strong>, 所以我们可以在节点 <strong>alpha</strong> 上作为客户端启动测试:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ibping -L 1</span><br><span class="line">Pong from nuc.(none) (Lid 1): time 0.040 ms</span><br><span class="line">Pong from nuc.(none) (Lid 1): time 0.057 ms</span><br><span class="line">Pong from nuc.(none) (Lid 1): time 0.045 ms</span><br></pre></td></tr></tbody></table></figure><h5 id="测试-IB-网络速度"><a href="#测试-IB-网络速度" class="headerlink" title="测试 IB 网络速度"></a>测试 IB 网络速度</h5><p>在 <strong>NUC</strong> 节点上运行:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ib_send_bw -d ibp1s0 -i 1</span><br><span class="line"></span><br><span class="line">************************************</span><br><span class="line">* Waiting <span class="keyword">for</span> client to connect... *</span><br><span class="line">************************************</span><br></pre></td></tr></tbody></table></figure><p>在 <strong>Aplha</strong> 节点上运行:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ib_send_bw -d ibp1s0 -i 1 1.0.0.1</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line">                    Send BW Test</span><br><span class="line"> Dual-port       : OFF		Device         : mlx4_0</span><br><span class="line"> Number of qps   : 1		Transport <span class="built_in">type</span> : IB</span><br><span class="line"> Connection <span class="built_in">type</span> : RC		Using SRQ      : OFF</span><br><span class="line"> PCIe relax order: ON</span><br><span class="line"> ibv_wr* API     : OFF</span><br><span class="line"> TX depth        : 128</span><br><span class="line"> CQ Moderation   : 1</span><br><span class="line"> Mtu             : 2048[B]</span><br><span class="line"> Link <span class="built_in">type</span>       : IB</span><br><span class="line"> Max inline data : 0[B]</span><br><span class="line"> rdma_cm QPs	 : OFF</span><br><span class="line"> Data ex. method : Ethernet</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line"> <span class="built_in">local</span> address: LID 0x02 QPN 0x020a PSN 0x749791</span><br><span class="line"> remote address: LID 0x01 QPN 0x021a PSN 0xbd4c28</span><br><span class="line">---------------------------------------------------------------------------------------</span><br><span class="line"> <span class="comment">#bytes     #iterations    BW peak[MB/sec]    BW average[MB/sec]   MsgRate[Mpps]</span></span><br><span class="line">Conflicting CPU frequency values detected: 4511.015000 != 800.000000. CPU Frequency is not max.</span><br><span class="line"> 65536      1000             5757.44            5757.29		   0.092117</span><br><span class="line">---------------------------------------------------------------------------------------</span><br></pre></td></tr></tbody></table></figure><p>BW 速率接近 <strong>56Gbps</strong>，说明 IB 速率正常。</p><h5 id="使用-RDMA-提升-IB-网络性能"><a href="#使用-RDMA-提升-IB-网络性能" class="headerlink" title="使用 RDMA 提升 IB 网络性能"></a>使用 RDMA 提升 IB 网络性能</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">modprobe ib_ipoib</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"options ib_ipoib ipoib_cm=1"</span> &gt; /etc/modprobe.d/ib_ipoib.conf</span><br><span class="line">update-initramfs -u</span><br><span class="line">reboot</span><br></pre></td></tr></tbody></table></figure><p>然后检查 RDMA 是否启用：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /sys/module/ib_ipoib/parameters/ipoib_cm</span><br></pre></td></tr></tbody></table></figure><p>如果返回 Y，说明 RDMA 已开启，可以进一步提升 InfiniBand 网络性能 🚀</p><blockquote><p>服务器有多个网卡并且已经配置好运行当中，却没记得 eth0、eth1、eth2…..分别对应的是哪个物理的网卡，此时可以使用如下命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ethtool -p eth0</span><br></pre></td></tr></tbody></table></figure><p>此时就会看到 eth0 对应的物理口一个灯在不停的<strong>闪烁</strong></p></blockquote><p><strong>参考</strong>:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9za3lhby5pby9sZWFybmluZy1jb21wdXRlci1oYXJkd2FyZS9uaWMvaHA1NDQvZmlybXdhcmUvbWZ0Lw==">电脑硬件学习笔记-HP544+-固件</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLnhqbjgxOS5jb20vcG9zdC9VcGdyYWRlLWZyb20tMTBHYnBzLXRvLTQwR2Jwcy1uZXR3b3JrLmh0bWw=">ZFS:从 10Gbps 升级到 40Gbps 网络</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC83NDA4MjM3Nw==">家用万兆网络指南 1 - 不如先来个最简单的 100G 网络</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9za3lhby5pby9sZWFybmluZy1jb21wdXRlci1oYXJkd2FyZS9uaWMvaHA1NDQvc3BlZWR0ZXN0Lw==">HP544+ 网卡测速</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly94c2wuc2gvMjAyMy8wOS9wdmU4LWhwZS01NDQtZmxyLw==">在 PVE8 中使用 HPE 544+FLR(ConnectX-3 Pro)</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9kb2NzLnJlZGhhdC5jb20vemgtY24vZG9jdW1lbnRhdGlvbi9yZWRfaGF0X2VudGVycHJpc2VfbGludXgvOC9odG1sLXNpbmdsZS9jb25maWd1cmluZ19pbmZpbmliYW5kX2FuZF9yZG1hX25ldHdvcmtzL2luZGV4">配置 InfiniBand 和 RDMA 网络</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cDovL2Jicy5rZWluc2NpLmNvbS90aHJlYWQtMjY5NDctMS0xLmh0bWw=">ib 网络中 NFS 走 RDMA 协议</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuaHVhLWhhbmcuY24vY2FzZS8yOTIuaHRtbA==">Mellanox 网卡安装教程</a></li></ul><hr><h3 id="82599ES-网卡-开启-SR-IOV"><a href="#82599ES-网卡-开启-SR-IOV" class="headerlink" title="82599ES 网卡 开启 SR-IOV"></a>82599ES 网卡 开启 SR-IOV</h3><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly95YW5nd2VucWluZy5jb20vYXJjaGl2ZXMvMTg3NS8=">PVE8.X 开启网卡 SR-IOV 虚拟化–基于英特尔 Intel 82576 网卡</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL29wdXMvOTI5MTYyNjU5MjI2NDUyMDAx"><strong>PVE 7.x-8.x Proxmox VE 7 8 网卡 Sriov 开启 保姆级教程</strong></a></li></ul><h2 id="连接-USB-摄像头"><a href="#连接-USB-摄像头" class="headerlink" title="连接 USB 摄像头"></a>连接 USB 摄像头</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ lsusb</span><br><span class="line"></span><br><span class="line">Bus 003 Device 004: ID 1bcf:2c6a Sunplus Innovation Technology Inc. 5M Cam</span><br></pre></td></tr></tbody></table></figure><p><strong>加载驱动</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe uvcvideo</span><br></pre></td></tr></tbody></table></figure><p><strong>检查摄像头设备文件</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">ls</span> /dev/video*</span><br><span class="line"></span><br><span class="line">/dev/video0  /dev/video1</span><br></pre></td></tr></tbody></table></figure><p><strong>安装 v4l-utils</strong></p><p>v4l-utils 是用于视频设备的工具，可以测试和配置摄像头：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ apt install v4l-utils</span><br><span class="line"></span><br><span class="line">$ v4l2-ctl --list-devices</span><br><span class="line">5M Cam: 5M Cam (usb-0000:00:14.0-6):</span><br><span class="line">	/dev/video0</span><br><span class="line">	/dev/video1</span><br><span class="line">	/dev/media0</span><br></pre></td></tr></tbody></table></figure><p><strong>推流</strong>:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f v4l2 -i /dev/video0 -vcodec libx264 -preset ultrafast -tune zerolatency -f flv rtmp://192.168.31.7/live/stream</span><br></pre></td></tr></tbody></table></figure><p>如果需要修改分辨率, 我们需要先支持摄像头支持哪些分辨率:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ v4l2-ctl --list-formats-ext</span><br><span class="line">ioctl: VIDIOC_ENUM_FMT</span><br><span class="line">	Type: Video Capture</span><br><span class="line"></span><br><span class="line">	[0]: <span class="string">'YUYV'</span> (YUYV 4:2:2)</span><br><span class="line">		Size: Discrete 640x480</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 800x600</span><br><span class="line">			Interval: Discrete 0.067s (15.000 fps)</span><br><span class="line">		Size: Discrete 320x240</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 352x288</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 1024x768</span><br><span class="line">			Interval: Discrete 0.125s (8.000 fps)</span><br><span class="line">		Size: Discrete 1280x720</span><br><span class="line">			Interval: Discrete 0.100s (10.000 fps)</span><br><span class="line">		Size: Discrete 1280x960</span><br><span class="line">			Interval: Discrete 0.125s (8.000 fps)</span><br><span class="line">		Size: Discrete 1600x1200</span><br><span class="line">			Interval: Discrete 0.200s (5.000 fps)</span><br><span class="line">		Size: Discrete 1920x1080</span><br><span class="line">			Interval: Discrete 0.200s (5.000 fps)</span><br><span class="line">		Size: Discrete 2592x1944</span><br><span class="line">			Interval: Discrete 0.333s (3.000 fps)</span><br><span class="line">		Size: Discrete 2048x1536</span><br><span class="line">			Interval: Discrete 0.333s (3.000 fps)</span><br><span class="line">	[1]: <span class="string">'MJPG'</span> (Motion-JPEG, compressed)</span><br><span class="line">		Size: Discrete 640x480</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 800x600</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 320x240</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 352x288</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 1024x768</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 1280x720</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 1280x960</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 1600x1200</span><br><span class="line">			Interval: Discrete 0.067s (15.000 fps)</span><br><span class="line">		Size: Discrete 1920x1080</span><br><span class="line">			Interval: Discrete 0.033s (30.000 fps)</span><br><span class="line">		Size: Discrete 2592x1944</span><br><span class="line">			Interval: Discrete 0.067s (15.000 fps)</span><br><span class="line">		Size: Discrete 2048x1536</span><br><span class="line">			Interval: Discrete 0.067s (15.000 fps)</span><br></pre></td></tr></tbody></table></figure><h3 id="推流"><a href="#推流" class="headerlink" title="推流"></a>推流</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -f v4l2 -i /dev/video0 -vcodec libx264 -preset ultrafast -tune zerolatency -s 1280x720 -f flv rtmp://192.168.31.7/live/stream</span><br></pre></td></tr></tbody></table></figure><p><strong>参数解析：</strong></p><p><strong>1. -f v4l2</strong></p><ul><li><p><strong>作用</strong>：指定输入格式为 v4l2，即使用 Video4Linux2 驱动来捕获视频流。</p></li><li><p><strong>背景</strong>：v4l2 是 Linux 系统中处理视频设备（例如 USB 摄像头）的视频驱动标准。此参数告诉 ffmpeg 使用 v4l2 驱动来捕获摄像头的实时视频流。</p></li></ul><p><strong>2. -i /dev/video0</strong></p><ul><li><p><strong>作用</strong>：指定输入视频源，这里是 /dev/video0，表示连接的 USB 摄像头设备。</p></li><li><p><strong>背景</strong>：在 Linux 系统中，视频设备通常以 /dev/videoX 的形式表示（X 是数字）。你可以通过 ls /dev/video* 命令查看设备名称，通常第一个摄像头是 /dev/video0。</p></li></ul><p><strong>3. -vcodec libx264</strong></p><ul><li><p><strong>作用</strong>：指定视频编码器使用 libx264，即 H.264 编码格式。</p></li><li><p><strong>背景</strong>：libx264 是一种高效的 H.264 视频编码器，广泛用于视频流和视频文件的压缩。H.264 是现代视频流媒体中的常见编码格式，因为它可以提供较高的压缩效率和质量。</p></li></ul><p><strong>4. -preset ultrafast</strong></p><ul><li><p><strong>作用</strong>：设置编码预设为 ultrafast，这是一个编码速度最快的设置，但会牺牲一定的视频压缩率。</p></li><li><p><strong>背景</strong>：preset 控制 libx264 编码的速度和压缩效率，选择较快的编码预设可以减少延迟。ultrafast 是最快的预设，但会使文件体积相对较大，适合低延迟的实时流。</p></li></ul><p><strong>5. -tune zerolatency</strong></p><ul><li><p><strong>作用</strong>：优化编码器以减少延迟。</p></li><li><p><strong>背景</strong>：tune 选项控制 libx264 编码器的调优模式。zerolatency 是一种专门用于低延迟流的设置，适用于直播、视频会议等实时应用。</p></li></ul><p><strong>6. -s 1280x720</strong></p><ul><li><p><strong>作用</strong>：设置输出视频的分辨率为 1280x720。</p></li><li><p><strong>背景</strong>：-s 选项用于设置输出视频的分辨率，1280x720 是常见的高清分辨率。如果你的摄像头支持更高的分辨率，可以根据需要进行调整。</p></li></ul><p><strong>7. -f flv</strong></p><ul><li><p><strong>作用</strong>：设置输出格式为 flv（Flash Video 格式）。</p></li><li><p><strong>背景</strong>：flv 是一种常用于流媒体传输的格式，尤其是在 RTMP（Real-Time Messaging Protocol）流媒体传输中。大部分流媒体服务器（如 NGINX 和 RTMP）支持这种格式。</p></li></ul><p><strong>8. rtmp://192.168.31.7/live/stream</strong></p><ul><li><p><strong>作用</strong>：指定 RTMP 服务器地址。</p></li><li><p><strong>背景</strong>：这是你要推送流的 RTMP 服务器地址。rtmp://192.168.31.7/live/stream 表示推送流到 IP 地址 192.168.31.7 上的 live/stream 路径。你可以根据自己的服务器地址和路径进行修改。</p></li></ul><hr><h2 id="Cloud-init"><a href="#Cloud-init" class="headerlink" title="Cloud-init"></a>Cloud-init</h2><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9uZXZlcjY2Ni51ay8yMTA3Lw==">在 PVE 8 中使用 Cloud-init 初始化 ubuntu cloud-image 并创建模板</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzI4NTIxNDg3L2FydGljbGUvZGV0YWlscy8xNDAxMjY3NjA=">一键变身！Cloud-Init 让 PVE 镜像华丽转身，快来看看怎么做！</a></li></ul><hr><h2 id="使用域名并添加-SSL-证书"><a href="#使用域名并添加-SSL-证书" class="headerlink" title="使用域名并添加 SSL 证书"></a>使用域名并添加 SSL 证书</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkcert <span class="string">"alpha.pve"</span> 192.168.1.119</span><br><span class="line"></span><br><span class="line">mkcert -install</span><br></pre></td></tr></tbody></table></figure><p>在 PVE 控制台添加 SSL 证书: <strong>系统-&gt;凭证</strong></p><p>在 Surge 设置自定义 Hosts:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alpha.pve = 192.168.1.119</span><br></pre></td></tr></tbody></table></figure><p>在 Surge 设置规则:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Rule]</span><br><span class="line">DOMAIN-SUFFIX,*.pve,DIRECT</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wb3N0LnNtemRtLmNvbS9wL2FuM29uODlwLw==">https://post.smzdm.com/p/an3on89p/</a></p><hr><h2 id="自制-CT-模版"><a href="#自制-CT-模版" class="headerlink" title="自制 CT 模版"></a>自制 CT 模版</h2><p><strong>清理无用软件包</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt autoremove -y --purge</span><br><span class="line">apt clean</span><br></pre></td></tr></tbody></table></figure><p><strong>清除 DNS 和主机名配置</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /etc/resolv.conf</span><br><span class="line"><span class="built_in">rm</span> /etc/hostname</span><br></pre></td></tr></tbody></table></figure><p><strong>清除操作命令</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">history</span> -c</span><br></pre></td></tr></tbody></table></figure><h4 id="创建容器备份"><a href="#创建容器备份" class="headerlink" title="创建容器备份"></a>创建容器备份</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vzdump 100 --dumpdir /var/lib/vz/dump --compress zstd</span><br></pre></td></tr></tbody></table></figure><p><strong>移动到 CT 模板目录</strong></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /var/lib/vz/dump/vzdump-lxc-100-2025_03_06-12_35_47.tar.zst /var/lib/vz/template/cache/ubuntu-24.04-base.tar.zst</span><br></pre></td></tr></tbody></table></figure><p><strong>参考</strong>:</p><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmhlbGxvd29vZC5kZXYvcG9zdHMvdWJ1bnR1LTIyLSVFNyU4RSVBRiVFNSVBMiU4MyVFNSU4OCU5RCVFNSVBNyU4QiVFNSU4QyU5Ni8=">Ubuntu 22 环境初始化</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmhlbGxvd29vZC5kZXYvcG9zdHMvcHJveG1veC12ZS0lRTUlODglOUIlRTUlQkIlQkElRTglODclQUElRTUlQUUlOUElRTQlQjklODklRTclOUElODQtbHhjLSVFNSVBRSVCOSVFNSU5OSVBOC1jdC0lRTYlQTglQTElRTYlOUQlQkYv">Proxmox VE 创建自定义的 LXC 容器 CT 模板</a></p></li></ul><hr><h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NjE5MjEyNTk=">https://zhuanlan.zhihu.com/p/661921259</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9rYi5zeW5vbG9neS5jbi96aC1jbi9EU00vdHV0b3JpYWwvYmFja191cF9yZXN0b3JlX3Byb3htb3hfdm0=">https://kb.synology.cn/zh-cn/DSM/tutorial/back_up_restore_proxmox_vm</a></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cucHJveG1veC5jb20vZW4vcHJvZHVjdHMvcHJveG1veC1iYWNrdXAtc2VydmVyL292ZXJ2aWV3">Proxmox Backup Server</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLm1lbi5jaS9iYWNrdXAtcHZlLXdpdGgtcGJzLw==">使用 Proxmox Backup Server 备份 Proxmox VE 的客户机与宿主机</a></li></ul><hr><h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><h3 id="退出集群"><a href="#退出集群" class="headerlink" title="退出集群"></a>退出集群</h3><p>在集群节点上执行一面的命令:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop pve-cluster.service</span><br><span class="line">systemctl stop corosync.service</span><br><span class="line">pmxcfs -l</span><br><span class="line"><span class="built_in">rm</span> /etc/pve/corosync.conf</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/corosync/*</span><br><span class="line">killall pmxcfs</span><br><span class="line">systemctl start pve-cluster.service</span><br></pre></td></tr></tbody></table></figure><p>停止 PVE 和集群的服务，并设置本机操作的宿主为「本地模式」，删除之前的集群配置文件和进程，再次启动单独的 PVE 服务。</p><p>还需要删除本机以外的其他集群节点（Node），以便从 Web UI 中移除：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/pve/nodes</span><br><span class="line">rm -rf [本机之外的其他节点]</span><br></pre></td></tr></tbody></table></figure><hr><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><h3 id="功耗节能"><a href="#功耗节能" class="headerlink" title="功耗节能"></a>功耗节能</h3><p><strong>参考</strong></p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wdmUuc3Fsc2VjLmNvbS80LzYv"><strong>国光的 PVE 环境搭建教程</strong>- CPU 节能模式</a></li></ul><h2 id="问题汇总"><a href="#问题汇总" class="headerlink" title="问题汇总"></a>问题汇总</h2><h3 id="ERROR-Verification-failed-0x1A-Security-Violation"><a href="#ERROR-Verification-failed-0x1A-Security-Violation" class="headerlink" title="ERROR Verification failed: (0x1A) Security Violation"></a>ERROR Verification failed: (0x1A) Security Violation</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cubWN1bG9vcC5jb20vdGhyZWFkLTIwMS0xLTEuaHRtbA==">https://www.mculoop.com/thread-201-1-1.html</a></p><h3 id="daemons-have-recently-crashed"><a href="#daemons-have-recently-crashed" class="headerlink" title="daemons have recently crashed"></a>daemons have recently crashed</h3><p><strong>参考</strong></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1FUTV9HaXRlZS9hcnRpY2xlL2RldGFpbHMvMTA2MDA0NDM1">https://blog.csdn.net/QTM_Gitee/article/details/106004435</a></p><hr><h2 id="运维脚本"><a href="#运维脚本" class="headerlink" title="运维脚本"></a>运维脚本</h2><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL0tvb2xDb3JlL1Byb3htb3hfVkVfU3RhdHVz">Proxmox_VE_Status</a></li><li><strong><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2NvbW11bml0eS1zY3JpcHRzL1Byb3htb3hWRQ==">ProxmoxVE</a></strong></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9jb21tdW5pdHktc2NyaXB0cy5naXRodWIuaW8vUHJveG1veFZFLw==">Make managing your Homelab a breeze</a></li></ul><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wb3N0LnNtemRtLmNvbS9wL2FrbGU2Mm1rLw==">2024 年 PVE8 最新安装使用指南|新手入门|安装|优化|Proxmox VE 8.1</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly90YXBsdXMubWUvbnVjMTEtYWlvLXRpbmtlcmluZy8=">NUC11 AIO 折腾小记</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL3NxbHNlYy9QVkU="><strong>国光的 PVE 环境搭建教程</strong></a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9za3lhby5pby9sZWFybmluZy1wdmUv">PVE 学习笔记</a> <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL3NreWFvL2xlYXJuaW5nLXB2ZQ==">https://github.com/skyao/learning-pve</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9wdmUucHJveG1veC5jb20vcHZlLWRvY3Mv">PVE doc</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9xdWVudGluLWJsb2cudmVyY2VsLmFwcC9wb3N0LzItLS1wcm94bW94LXZlLXdlYmd1aS0=">配置 &amp; 探索 Proxmox VE WebGUI 管理页面</a></p></li><li><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly90ZW5kY29kZS5jb20vc3ViamVjdC9hcnRpY2xlL3B2ZS11c2VkLw==">PVE 系统最佳实践</a></p></li></ul><hr></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar1.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">dong4j</div><div class="post-copyright__author_desc">岁月静好，诗酒趁年华🍺</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.dong4j.site/posts/13e613ba.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl(&quot;https://blog.dong4j.site/posts/13e613ba.html&quot;)">Proxmox VE 8.3 安装与配置指南</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/wechat-pay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/wechat-pay.webp" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/alipay.webp" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wechat/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.dong4j.site/posts/13e613ba.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Proxmox VE 8.3 安装与配置指南&amp;url=https://blog.dong4j.site/posts/13e613ba.html&amp;pic=https://api.dong4j.ink:1024/cover?34n7j520" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div><div class="share-link follow"><div class="share-button" id="post-share-url" title="订阅" onclick="icat.showFollowBox()"><i class="anzhiyufont anzhiyu-icon-rss"></i></div></div></div></div></div><div class="submit-box display"><form id="follow" action="https://api.follow.it/subscription-form/b29peEszNWYzK3FQbEw2dVlITEJMZ2pQRXh2dWRLVDE3SC96eFhRaGwwQWprcXpYYUp0NGFWemxVZllXRGU4Nm4yenNGSzNpV3l0Z1EwQzBXQU5xTG9pZWNzVCt5YWptWUt6TXppRXVXMXZxQTRZOGQ0NUVDRlRFOUYxSHMzMEJ8NmlodHY1VWhDQVZBaG8wM0pSV2pXSjdTNGRWS1o0RDVZbE11KzlEeWhuZz0=/8" method="post" target="_blank"><div class="follow-it-form-subscribe" style="position:relative"><div class="heading"><h5 style="font-weight:700;text-align:center">订阅本站文章：</h5></div><div class="input-field"><input type="email" id="email-input" name="email" placeholder="填入您的邮箱地址" spellcheck="false" oninput="validateEmail()"></div><div class="submit-button"><button type="submit" id="submit-button" onclick="ga(&quot;send&quot;,&quot;event&quot;,&quot;Form&quot;,&quot;Submit&quot;,&quot;Affiliate&quot;)" style="font-weight:700;font-size:14px;text-align:center" disabled="">确认订阅</button></div></div></form><style>#email-input{font-size:16px;font-weight:700;padding:10px;border:2px solid #ccc;border-radius:5px;width:100%;box-sizing:border-box}#email-input:focus{outline:0}#email-input.valid{border-color:green}#email-input.invalid{border-color:red}</style><script>function validateEmail(){var s=document.getElementById("email-input"),a=document.getElementById("submit-button"),e=s.value;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(a.disabled=!1,s.classList.add("valid"),s.classList.remove("invalid")):(a.disabled=!0,s.classList.add("invalid"),s.classList.remove("valid"))}</script></div><script>var icat={showFollowBox:function(){var s=document.querySelector(".submit-box");s.classList.contains("display")?s.classList.remove("display"):s.classList.add("display")}}</script><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.dong4j.site" target="_blank">司机带你开车</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%96%B0%E6%97%B6%E4%BB%A3%E7%A0%81%E5%86%9C/"><span class="categoryes-punctuation"><i class="anzhiyufont anzhiyu-icon-inbox"></i></span>新时代码农<span class="categoryesPageCount">212</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/node-js/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>Node.js<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/llm/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>LLM<span class="tagsPageCount">3</span></a><a class="post-meta__box__tags" href="/tags/one-api/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>one-api<span class="tagsPageCount">2</span></a></div></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook a2a_counter"></a><a class="a2a_button_x"></a><a class="a2a_button_threads"></a><a class="a2a_button_pocket"></a><a class="a2a_button_email"></a><a class="a2a_button_sms"></a><a class="a2a_dd" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.addtoany.com/share"></a></div></div><script async="" src="https://static.addtoany.com/menu/page.js"></script><script>var a2a_config=a2a_config||{};a2a_config.templates=a2a_config.templates||{},a2a_config.templates.email={subject:"来自 dong4j 的分享: ${title}",body:"一篇有意思的博文:\n${link}"},a2a_config.templates.sms={body:"给你分享一篇有意思的博客:\n${title}\n${link}"}</script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/posts/91f73d3b.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?mg3iapx4" onerror="onerror=null,src=&quot;/img/404.webp&quot;" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ubuntu 使用备忘录：好记性不如烂笔头</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/bb4018e9.html" title="使用 Node.js 开发数字名片并集成 Chat 服务"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20250115192416_nhXEcB8o.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-15</div><div class="title">使用 Node.js 开发数字名片并集成 Chat 服务</div></div></a></div><div><a href="/posts/19e627d5.html" title="Node.js 版本管理：从入门到精通"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?v727kpdz" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2014-07-30</div><div class="title">Node.js 版本管理：从入门到精通</div></div></a></div><div><a href="/posts/f3b0024e.html" title="从通用到垂直：企业知识库的AI赋能"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?8b3prhd5" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-11-06</div><div class="title">从通用到垂直：企业知识库的AI赋能</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/coding.gif" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">dong4j</h1><div class="author-info__desc">岁月静好，诗酒趁年华 🍺</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/dong4j" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fa-brands fa-github faa-tada"></i></a><a class="social-icon faa-parent animated-hover" href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fa-solid fa-at faa-tada"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><div style="display:flex;align-items:center"><span>👋🏻 Hi，欢迎来到我的博客~</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mario.gif" width="40"></div><span>❓ 如有问题欢迎评论区交流！🎉</span><br><span>😫 页面异常？试试<kbd>Ctrl</kbd>+<kbd>F5</kbd>🙉</span><br><span>📧 如需联系：<a href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer"><b>发邮件给我吧 🚀</b></a></span><div id="welcome-info"></div><a id="my-card-info-btn" href="/subscribe/" data-pjax-state=""><i class="anzhiyufont anzhiyu-icon-rss"></i><span>订阅本站</span></a></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://cdn.dong4j.site/source/image/63c02edf44033.webp) center center/100% no-repeat"></div><div class="back face" style="background:url(https://cdn.dong4j.site/source/image/645fa415e8694.webp) center center/100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E5%90%8E-IP-%E4%B8%8D%E5%AF%B9"><span class="toc-number">2.</span> <span class="toc-text">安装完成后 IP 不对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E6%8D%A2%E6%BA%90"><span class="toc-number">3.</span> <span class="toc-text">更换源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E8%BD%AF%E4%BB%B6%E6%BA%90"><span class="toc-number">3.1.</span> <span class="toc-text">通用软件源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pve-%E8%BD%AF%E4%BB%B6%E6%BA%90"><span class="toc-number">3.2.</span> <span class="toc-text">pve 软件源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ceph-%E6%BA%90"><span class="toc-number">3.3.</span> <span class="toc-text">Ceph 源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CT-%E9%95%9C%E5%83%8F%E4%B8%8B%E8%BD%BD%E6%BA%90"><span class="toc-number">3.4.</span> <span class="toc-text">CT 镜像下载源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%AE%A2%E9%98%85%E5%BC%B9%E7%AA%97"><span class="toc-number">4.</span> <span class="toc-text">删除订阅弹窗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#oh-my-zsh"><span class="toc-number">5.</span> <span class="toc-text">oh-my-zsh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-WiFi"><span class="toc-number">6.</span> <span class="toc-text">连接 WiFi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-%E6%89%93%E4%B8%8D%E5%BC%80"><span class="toc-number">7.</span> <span class="toc-text">Web 打不开</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pve-source-%E8%84%9A%E6%9C%AC"><span class="toc-number">8.</span> <span class="toc-text">pve_source 脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB-Ubuntu-%E7%B3%BB%E7%BB%9F%E5%88%B0-PVE"><span class="toc-number">9.</span> <span class="toc-text">迁移 Ubuntu 系统到 PVE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%89%93%E5%8C%85"><span class="toc-number">9.1.</span> <span class="toc-text">镜像打包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%88%B0-PVE"><span class="toc-number">9.2.</span> <span class="toc-text">安装到 PVE</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Windows"><span class="toc-number">10.</span> <span class="toc-text">安装 Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E6%98%BE%E7%9B%B4%E9%80%9A%E4%B8%8E%E8%99%9A%E6%8B%9F%E6%A0%B8%E6%98%BE%E7%9B%B4%E9%80%9A"><span class="toc-number">10.1.</span> <span class="toc-text">核显直通与虚拟核显直通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%A0%B8%E6%98%BE%E7%9B%B4%E9%80%9A"><span class="toc-number">10.2.</span> <span class="toc-text">虚拟核显直通</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Ubuntu"><span class="toc-number">11.</span> <span class="toc-text">安装 Ubuntu</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF-SSH-%E7%99%BB%E5%BD%95"><span class="toc-number">11.1.</span> <span class="toc-text">开启 SSH 登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2"><span class="toc-number">11.2.</span> <span class="toc-text">开启远程桌面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-docker"><span class="toc-number">11.3.</span> <span class="toc-text">安装 docker</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-%E9%95%9C%E5%83%8F%E6%BA%90"><span class="toc-number">11.3.1.</span> <span class="toc-text">docker 镜像源</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%97%B6%E5%8C%BA"><span class="toc-number">11.4.</span> <span class="toc-text">修改时区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%88%E7%AB%AF%E6%94%AF%E6%8C%81%E4%B8%AD%E6%96%87%E6%98%BE%E7%A4%BA"><span class="toc-number">11.5.</span> <span class="toc-text">终端支持中文显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E9%80%9A-nvme"><span class="toc-number">11.6.</span> <span class="toc-text">直通 nvme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LVM-%E6%89%A9%E5%AE%B9"><span class="toc-number">11.7.</span> <span class="toc-text">LVM 扩容</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A3%81%E7%9B%98%E5%85%B1%E4%BA%AB"><span class="toc-number">12.</span> <span class="toc-text">磁盘共享</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-NVMe-%E8%AF%BB%E5%86%99%E9%80%9F%E5%BA%A6"><span class="toc-number">12.1.</span> <span class="toc-text">测试 NVMe 读写速度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ceph-%E8%8A%82%E7%82%B9%E7%AE%80%E4%BB%8B"><span class="toc-number">12.2.</span> <span class="toc-text">Ceph 节点简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5"><span class="toc-number">12.2.1.</span> <span class="toc-text">时间同步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-Ceph"><span class="toc-number">12.3.</span> <span class="toc-text">安装 Ceph</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Ceph"><span class="toc-number">12.4.</span> <span class="toc-text">配置 Ceph</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">12.5.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-PVE-%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E6%8C%82%E8%BD%BD-CephFS"><span class="toc-number">12.5.1.</span> <span class="toc-text">在 PVE 虚拟机中挂载 CephFS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E4%BD%BF%E7%94%A8-RBD%EF%BC%88%E5%9D%97%E5%AD%98%E5%82%A8%EF%BC%89"><span class="toc-number">12.5.2.</span> <span class="toc-text">在虚拟机中使用 RBD（块存储）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dashboard"><span class="toc-number">12.6.</span> <span class="toc-text">Dashboard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B8%E8%BD%BD-Ceph-%F0%9F%99%89"><span class="toc-number">12.7.</span> <span class="toc-text">卸载 Ceph 🙉</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZFS"><span class="toc-number">13.</span> <span class="toc-text">ZFS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">13.1.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">14.</span> <span class="toc-text">网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E8%B7%AF%E7%94%B1"><span class="toc-number">14.1.</span> <span class="toc-text">策略路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-debian-%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">14.1.1.</span> <span class="toc-text">基于 debian 的虚拟机配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-ubuntu-%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE"><span class="toc-number">14.1.2.</span> <span class="toc-text">基于 ubuntu 的虚拟机配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">14.1.3.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95"><span class="toc-number">14.1.4.</span> <span class="toc-text">解决办法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-debian"><span class="toc-number">14.1.4.1.</span> <span class="toc-text">基于 debian</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-ubuntu"><span class="toc-number">14.1.4.2.</span> <span class="toc-text">基于 ubuntu</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">14.1.4.3.</span> <span class="toc-text">流程图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#qemu-guest-agent"><span class="toc-number">14.2.</span> <span class="toc-text">qemu-guest-agent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E5%87%8F-PCIe-%E8%AE%BE%E5%A4%87%E5%90%8E%E7%BD%91%E5%8D%A1%E5%90%8D%E7%A7%B0%E5%8F%98%E6%9B%B4"><span class="toc-number">14.3.</span> <span class="toc-text">删减 PCIe 设备后网卡名称变更</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4G-%E7%BD%91%E5%8D%A1%E6%8B%A8%E5%8F%B7-qmi-wwan"><span class="toc-number">14.4.</span> <span class="toc-text">4G 网卡拨号(qmi_wwan)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8B%A8%E5%8F%B7"><span class="toc-number">14.4.1.</span> <span class="toc-text">自动拨号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4G-%E7%BD%91%E5%8D%A1%E6%8B%A8%E5%8F%B7-wvdial"><span class="toc-number">14.5.</span> <span class="toc-text">4G 网卡拨号(wvdial)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8B%A8%E5%8F%B7-1"><span class="toc-number">14.5.1.</span> <span class="toc-text">自动拨号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA-40G-56G-%E5%86%85%E7%BD%91"><span class="toc-number">14.6.</span> <span class="toc-text">搭建 40G/56G 内网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#40G"><span class="toc-number">14.6.1.</span> <span class="toc-text">40G</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#56G"><span class="toc-number">14.6.2.</span> <span class="toc-text">56G</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-MFT"><span class="toc-number">14.6.2.1.</span> <span class="toc-text">安装 MFT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%9B%BA%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">14.6.2.2.</span> <span class="toc-text">查询固件信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%87%E6%8D%A2-IB-Ethernet-%E6%A8%A1%E5%BC%8F"><span class="toc-number">14.6.2.3.</span> <span class="toc-text">切换 IB/Ethernet 模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IB-%E7%BB%84%E7%BD%91"><span class="toc-number">14.6.2.4.</span> <span class="toc-text">IB 组网</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#InfiniBand-%E5%AD%90%E7%BD%91%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">14.6.2.5.</span> <span class="toc-text">InfiniBand 子网管理器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#IP-over-Infiniband"><span class="toc-number">14.6.2.6.</span> <span class="toc-text">IP over Infiniband</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-IB-%E7%BD%91%E7%BB%9C%E9%80%9F%E5%BA%A6"><span class="toc-number">14.6.2.7.</span> <span class="toc-text">测试 IB 网络速度</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-RDMA-%E6%8F%90%E5%8D%87-IB-%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD"><span class="toc-number">14.6.2.8.</span> <span class="toc-text">使用 RDMA 提升 IB 网络性能</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#82599ES-%E7%BD%91%E5%8D%A1-%E5%BC%80%E5%90%AF-SR-IOV"><span class="toc-number">14.7.</span> <span class="toc-text">82599ES 网卡 开启 SR-IOV</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5-USB-%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-number">15.</span> <span class="toc-text">连接 USB 摄像头</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A8%E6%B5%81"><span class="toc-number">15.1.</span> <span class="toc-text">推流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cloud-init"><span class="toc-number">16.</span> <span class="toc-text">Cloud-init</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9F%9F%E5%90%8D%E5%B9%B6%E6%B7%BB%E5%8A%A0-SSL-%E8%AF%81%E4%B9%A6"><span class="toc-number">17.</span> <span class="toc-text">使用域名并添加 SSL 证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%88%B6-CT-%E6%A8%A1%E7%89%88"><span class="toc-number">18.</span> <span class="toc-text">自制 CT 模版</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%A4%87%E4%BB%BD"><span class="toc-number">18.0.1.</span> <span class="toc-text">创建容器备份</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD"><span class="toc-number">19.</span> <span class="toc-text">备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">20.</span> <span class="toc-text">集群</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">20.1.</span> <span class="toc-text">退出集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">21.</span> <span class="toc-text">优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%80%97%E8%8A%82%E8%83%BD"><span class="toc-number">21.1.</span> <span class="toc-text">功耗节能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB"><span class="toc-number">22.</span> <span class="toc-text">问题汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ERROR-Verification-failed-0x1A-Security-Violation"><span class="toc-number">22.1.</span> <span class="toc-text">ERROR Verification failed: (0x1A) Security Violation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#daemons-have-recently-crashed"><span class="toc-number">22.2.</span> <span class="toc-text">daemons have recently crashed</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%BB%B4%E8%84%9A%E6%9C%AC"><span class="toc-number">23.</span> <span class="toc-text">运维脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">24.</span> <span class="toc-text">参考</span></a></li></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/13e613ba.html" title="Proxmox VE 8.3 安装与配置指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?34n7j520" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Proxmox VE 8.3 安装与配置指南"></a><div class="content"><a class="title" href="/posts/13e613ba.html" title="Proxmox VE 8.3 安装与配置指南">Proxmox VE 8.3 安装与配置指南</a><time datetime="2025-02-17T11:52:42.000Z" title="发表于 2025-02-17 19:52:42">2025-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?mg3iapx4" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Ubuntu 使用备忘录：好记性不如烂笔头"></a><div class="content"><a class="title" href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头">Ubuntu 使用备忘录：好记性不如烂笔头</a><time datetime="2025-02-15T06:37:31.000Z" title="发表于 2025-02-15 14:37:31">2025-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?eb4q02fh" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="使用 Cloudflare 增强公网服务安全性的实践"></a><div class="content"><a class="title" href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践">使用 Cloudflare 增强公网服务安全性的实践</a><time datetime="2025-02-12T16:17:11.000Z" title="发表于 2025-02-13 00:17:11">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?po6ikv1j" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Ubuntu 系统下 LCD4Linux 的安装与配置指南"></a><div class="content"><a class="title" href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南">Ubuntu 系统下 LCD4Linux 的安装与配置指南</a><time datetime="2025-02-12T11:35:45.000Z" title="发表于 2025-02-12 19:35:45">2025-02-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c78c58c7.html" title="树莓派与移远EC20 4G网卡集成及自动拨号方案解析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?56t44pn3" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="树莓派与移远EC20 4G网卡集成及自动拨号方案解析"></a><div class="content"><a class="title" href="/posts/c78c58c7.html" title="树莓派与移远EC20 4G网卡集成及自动拨号方案解析">树莓派与移远EC20 4G网卡集成及自动拨号方案解析</a><time datetime="2025-02-12T06:55:16.000Z" title="发表于 2025-02-12 14:55:16">2025-02-12</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://weibo.com/u/1884084142" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.facebook.com/dsj.array" title="facebook"><i class="anzhiyufont anzhiyu-icon-facebook1"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" size="50px"><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/1835978167" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://v.douyin.com/iUqoRYwb/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener external nofollow noreferrer" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.travellings.cn/go.html">开往</a><a class="footer-item" title="服务状态" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services">服务状态</a></div></div><div class="footer-group"><div class="footer-title">项目</div><div class="footer-links"><a class="footer-item" title="Watt.Stack" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack">Watt.Stack</a><a class="footer-item" title="MIK" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit">MIK</a><a class="footer-item" title="macOS.dev" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev">macOS.dev</a><a class="footer-item" title="更多" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.ink:1024/">更多</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="我的装备" href="/equipment/">我的装备</a><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://nonbot.org/pledged/view/9e6e360a-4834-4dd0-b672-845baa0eb4de" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="Made By Humans" title="Made By Humans"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nonbot_pledged_logo.svg" alt="Made By Humans"></a><a class="github-badge" target="_blank" href="https://notbyai.fyi/cn/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="Not By AI" title="Not By AI"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/written-by-human-not-by-ai-white.svg" alt="Not By AI"></a><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/dong4j" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><footer-bar-left><div id="footer-bar-tips"><div class="copyright" style="display:flex;align-items:center;gap:10px">©2013 - 2025 By <a class="footer-bar-link" href="/" title="dong4j" target="_blank">dong4j</a><span class="indicator" id="indicator" style="display:inline-block;width:8px;height:8px;border-radius:50%;background-color:green;margin-left:0;animation:subtle-breathing 1.2s infinite;box-shadow:0 0 5px rgba(255,0,0,.8)"></span><span>在线人数:</span><span id="online_user" style="font-size:1em;font-weight:700">1</span></div></div><div id="footer-type-tips"></div></footer-bar-left><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/" title="蜀ICP备2025119258号">蜀ICP备2025119258号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">258</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">1094</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">18</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.dong4j.site" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/homepage.webp" alt="个人主页"><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://blog.dong4j.site" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/blog.webp" alt="博客"><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://resume.dong4j.site" title="简历"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/resume.webp" alt="简历"><span class="back-menu-item-text">简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://npx-card.dong4j.site" title="npx-card"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/npx-card.webp" alt="npx-card"><span class="back-menu-item-text">npx-card</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack" title="Watt.Stack"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/watt.webp" alt="Watt.Stack"><span class="back-menu-item-text">Watt.Stack</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit" title="MIK"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mik.webp" alt="MIK"><span class="back-menu-item-text">MIK</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev" title="macOS.dev"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mac.webp" alt="macOS.dev"><span class="back-menu-item-text">macOS.dev</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.site/" title="更多"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/project.webp" alt="更多"><span class="back-menu-item-text">更多</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">服务</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services" title="服务状态"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/uptime-kuma.svg" alt="服务状态"><span class="back-menu-item-text">服务状态</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nezha.dong4j.dev" title="服务面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nezha.webp" alt="服务面板"><span class="back-menu-item-text">服务面板</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nav.dong4j.dev" title="导航页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nav.webp" alt="导航页"><span class="back-menu-item-text">导航页</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://umami.dong4j.ink:1024/share/V7Rat8DdVw4npjl2/blog.dong4j.site" title="Umami"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/umami.webp" alt="Umami"><span class="back-menu-item-text">Umami</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://muselink.cc/dong4j 👈这是我的MuseLink数字名片！" title="数字名片"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/muse.lin.webp" alt="数字名片"><span class="back-menu-item-text">数字名片</span></a><a class="back-menu-item" href="/ai/deepseek-r1-webgpu/" title="DeepSeek"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/deepseek.webp" alt="DeepSeek"><span class="back-menu-item-text">DeepSeek</span></a><a class="back-menu-item" href="/ai/rmbg/playground/" title="RMBG"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/rmbg.webp" alt="RMBG"><span class="back-menu-item-text">RMBG</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.dong4j.site/" title="Mini-Chat"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/emoji1.webp" alt="Mini-Chat"><span class="back-menu-item-text">Mini-Chat</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa fa-comments faa-tada"></i><span> 最新评论</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size:.9em"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/memos/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 备忘录</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fa-solid fa-map faa-tada"></i><span> 折腾清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/stars/"><i class="fa-brands fa-github faa-tada"></i><span> Star 清单</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.dong4j.dev"><span>小黑屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size:.88rem;color:#556363;font-weight:500;color:var(--anzhiyu-lighttext)">Java<sup>48</sup></a><a href="/tags/final/" style="font-size:.88rem;color:#678a45">final<sup>2</sup></a><a href="/tags/finalize/" style="font-size:.88rem;color:#c069bc">finalize<sup>1</sup></a><a href="/tags/finally/" style="font-size:.88rem;color:#714840">finally<sup>2</sup></a><a href="/tags/new%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:.88rem;color:#197f3d">new关键字<sup>1</sup></a><a href="/tags/static/" style="font-size:.88rem;color:#704a0d">static<sup>1</sup></a><a href="/tags/super/" style="font-size:.88rem;color:#338051">super<sup>2</sup></a><a href="/tags/this/" style="font-size:.88rem;color:#a224a6">this<sup>1</sup></a><a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size:.88rem;color:#334e6b">二进制<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size:.88rem;color:#2dbd22">数据类型<sup>4</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" style="font-size:.88rem;color:#b7640c">构造方法<sup>1</sup></a><a href="/tags/%E6%BA%A2%E5%87%BA/" style="font-size:.88rem;color:#0b6ab5">溢出<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:.88rem;color:#0e1424">算法<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" style="font-size:.88rem;color:#000592">编程实践<sup>2</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F/" style="font-size:.88rem;color:#56b352">计算机程序<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/" style="font-size:.88rem;color:#8a3737">计算机语言<sup>1</sup></a><a href="/tags/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" style="font-size:.88rem;color:#a03027">访问控制<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size:.88rem;color:#0d6442">软件<sup>1</sup></a><a href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" style="font-size:.88rem;color:#c753c8">错误处理<sup>2</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size:.88rem;color:#c14483">面向对象<sup>6</sup></a></div></div><hr></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask(()=>{function o(){HoldLog.apply(console,arguments)}var c=new Date("6/28/2018 00:00:00"),c=(now1.setTime(now1.getTime()+250),(now1-c)/1e3/60/60/24),c=["Hi there 👋，I'm dong4j, Welcome to my blog","岁月静好，诗酒趁年华🍺",`
        
      +========================================================+
      |  ██████╗  ██████╗ ███╗   ██╗ ██████╗ ██╗  ██╗     ██╗  |
      |  ██╔══██╗██╔═══██╗████╗  ██║██╔════╝ ██║  ██║     ██║  |
      |  ██║  ██║██║   ██║██╔██╗ ██║██║  ███╗███████║     ██║  |
      |  ██║  ██║██║   ██║██║╚██╗██║██║   ██║╚════██║██   ██║  |
      |  ██████╔╝╚██████╔╝██║ ╚████║╚██████╔╝     ██║╚█████╔╝  |
      |  ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝ ╚═════╝      ╚═╝ ╚════╝   |
      +========================================================+
        
        `,"已上线",Math.floor(c),"天","Use 「npx dong4j」 and find me."],e=["NCC2-036","调用前置摄像头拍照成功，识别为【绝顶大佬】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`
%c${c[0]} %c ${c[1]} %c ${c[2]} %c${c[3]}%c ${c[4]}%c ${c[5]}

%c ${c[6]}
`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${e[0]} %c ${e[1]} %c 
${e[2]} %c
${e[3]}
`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，绝顶大佬.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 dong4j 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))})</script><script async="" src="/anzhiyu/random.js"></script><script async="">(()=>{var n,o,r,a,i,e=new Date("6/28/2018 00:00:00"),l=new Date;setInterval(()=>{var t;if(l=new Date,i=l.getHours(),t=(l-e)/1e3/60/60/24,n=Math.floor(t),t=(l-e)/1e3/60/60-24*n,o=Math.floor(t),1==String(o).length&&(o="0"+o),t=(l-e)/1e3/60-1440*n-60*o,r=Math.floor(t),1==String(r).length&&(r="0"+r),t=(l-e)/1e3-86400*n-3600*o-60*r,a=Math.round(t),1==String(a).length&&(a="0"+a),document.getElementById("footer")){let e="";e=(i<18&&9<=i||null!=(t=document.querySelector("#workboard .workSituationImg"))&&(t.src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg",t.title="下班了就该开开心心的玩耍，嘿嘿~",t.alt="下班了就该开开心心的玩耍，嘿嘿~"),`本站居然运行了 ${n} 天<span id='runtime'> ${o} 小时 ${r} 分 ${a} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`),document.getElementById("runtimeTextTip")&&(document.getElementById("runtimeTextTip").innerHTML=e)}},1e3)})()</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(()=>{let t=document.querySelectorAll("#article-container .mermaid-wrap");if(0!==t.length){let e=()=>{window.loadMermaid=!0;let a="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(t).forEach((e,t)=>{let d=e.firstElementChild;e="%%{init:{ 'theme':'"+a+"'}}%%\n"+d.textContent;let n=mermaid.render("mermaid-"+t,e);"string"==typeof n?(t=n,d.insertAdjacentHTML("afterend",t)):n.then(({svg:e})=>{d.insertAdjacentHTML("afterend",e)})})};var d=()=>{window.loadMermaid?e():getScript("https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js").then(e)};anzhiyu.addGlobalFn("themeChange",e,"mermaid"),window.pjax?d():document.addEventListener("DOMContentLoaded",d)}})()</script><script>(()=>{let t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.dong4j.ink:1024",region:"",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))};var o=()=>{"object"==typeof twikoo?setTimeout(n,0):getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(n)};let e=()=>{let o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo.dong4j.ink:1024",region:"",urls:[window.location.pathname],includeReply:!1}).then(t=>{o.textContent=t[0].count}).catch(t=>{console.error(t)})},n=()=>{t(),GLOBAL_CONFIG_SITE.isPost&&e()};o()})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",()=>{let t=e=>e=""!==e&&150<(e=(e=(e=(e=e.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length?e.substring(0,150)+"...":e,n=t=>{let n="";if(t.length)for(let e=0;e<t.length;e++)n=(n=(n+="<div class='aside-list-item'>")+`<a href='${t[e].url}' class='thumbnail'><img data-lazy-src='${t[e].avatar}' alt='${t[e].nick}'><div class='name'><span>${t[e].nick} </span></div></a>`)+`<div class='content'>
        <a class='comment' href='${t[e].url}' title='${t[e].content}'>${t[e].content}</a>
        <time datetime="${t[e].date}">${anzhiyu.diffDate(t[e].date,!0)}</time></div>
        </div>`;else n+="没有评论";var e=document.querySelector("#card-newest-comments .aside-list");e&&(e.innerHTML=n),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(e)};var e=()=>{var e;document.querySelector("#card-newest-comments .aside-list")&&((e=saveToLocal.get("twikoo-newest-comments"))?n(JSON.parse(e)):(e=()=>{twikoo.getRecentComments({envId:"https://twikoo.dong4j.ink:1024",region:"",pageSize:6,includeReply:!0}).then(function(e){e=e.map(e=>({content:t(e.comment),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(e),10/1440),n(e)}).catch(function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"})},"object"==typeof twikoo?e():getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(e)))};e(),document.addEventListener("pjax:complete",e)})</script><script>var visitorMail="996@icu.com"</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/subscribe.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/card-widget-today.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/card-widget-calendar.css" media="print" onload="this.media=&quot;all&quot;"><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/automatic-redirection.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-welcome.js"></script><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/card-widget-comments.js"></script><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/card-widget-today.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-countdown.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-calendar.js"></script><script async="" data-pjax="" src="https://open.lightxi.com/unpkg/chinese-lunar@0.1.4/lib/chinese-lunar.js"></script><script async="" data-pjax="" src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script src="https://cdn.dong4j.site/source/static/custom.js"></script><script src="https://cdn.dong4j.site/source/static/geoip2-check.js"></script><script defer="" id="fluttering_ribbon" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="永不言败,勇往直前,砥砺前行,自强不息,笃行致远,厚德载物,持之以恒,奋发有为,志在四方,拼搏进取,实事求是，为人民服务,勤劳致富，共奔小康,爱国、创新、包容、厚德,敬业乐群，诚信友善,自强不息，厚德载物,以人为本，全面协调可持续发展,建设生态文明，构建和谐社会,坚持改革开放，推动科学发展,立党为公，执政为民,实现中华民族伟大复兴的中国梦" data-fontsize="15px" data-random="true" async=""></script><script src="//code.tidio.co/14aqpkwnauu3r5ngcmspfxwelvattym5.js" async=""></script><script>(()=>{{let i=!1,o=()=>{window.tidioChatApi.hide(),i=!1,document.body.style.position="relative",document.documentElement.style.overflow="auto"};var t=()=>{window.tidioChatApi.hide(),window.tidioChatApi.on("close",o)};window.tidioChatApi?window.tidioChatApi.on("ready",t):document.addEventListener("tidioChat-ready",t),window.chatBtnFn=()=>{window.tidioChatApi&&(i?o():(window.tidioChatApi.open(),window.tidioChatApi.show(),i=!0))}}})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();var e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")}),document.addEventListener("pjax:complete",function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{let t=document.createElement("script");var a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()}),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async="" data-pjax="" data-prefix="busuanzi_value" src="https://cdn.dong4j.site/source/static/busuanzi.self.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script data-pjax="" src="https://cdn.dong4j.site/source/static/github-calendar.js"></script><script data-pjax="">function GithubCalendarConfig(){var t=document.getElementById("recent-posts");t&&"/"==location.pathname&&(console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>')),GithubCalendar("https://github-calendar.dong4j.ink:1024/api?user=dong4j",["#ebedf0","#a2f7af","#6ce480","#54ad63","#469252","#31753c","#1f5f2a","#13531f","#084111","#032b09","#000000"],"dong4j")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:0}}</style><style></style></body></html>