<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>NAT 内网穿透详解：揭秘网络连接背后的奥秘 | 司机带你开车</title><meta name="keywords" content="HomeLab,NAT,IPv4,IPv6,网络地址转换,NAPT,内网穿透"><meta name="author" content="dong4j"><meta name="copyright" content="dong4j"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="NAT 内网穿透详解：揭秘网络连接背后的奥秘"><meta name="application-name" content="NAT 内网穿透详解：揭秘网络连接背后的奥秘"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="NAT 内网穿透详解：揭秘网络连接背后的奥秘"><meta property="og:url" content="https://blog.dong4j.site/posts/46fb4e89.html"><meta property="og:site_name" content="司机带你开车"><meta property="og:description" content="本文深入探讨了NAT（网络地址转换）的起源、作用和类型，以及它在家庭和办公网络中的工作原理。文章首先介绍了IPv4地址耗尽问题，私有地址的需求，以及NAT的诞生背景。接着详细解释了NAT的作用，如缓解地址枯竭、提高安全性等。然后，文章讨论了NAT的类型，包括静态NAT、动态NAT和端口地址转换（PA"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.dong4j.site/source/image/20241229154732_ygRx9mbO.webp"><meta property="article:author" content="dong4j"><meta property="article:tag" content="dong4j, Java, Python, Golang, HomeLab, SpringBoot, 架构"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.dong4j.site/source/image/20241229154732_ygRx9mbO.webp"><meta name="description" content="本文深入探讨了NAT（网络地址转换）的起源、作用和类型，以及它在家庭和办公网络中的工作原理。文章首先介绍了IPv4地址耗尽问题，私有地址的需求，以及NAT的诞生背景。接着详细解释了NAT的作用，如缓解地址枯竭、提高安全性等。然后，文章讨论了NAT的类型，包括静态NAT、动态NAT和端口地址转换（PA"><link rel="shortcut icon" href="https://cdn.dong4j.site/source/image/favicon.ico"><link rel="canonical" href="https://blog.dong4j.site/posts/46fb4e89.html"><link rel="preconnect" href="//cdn.cbd.int"><link rel="preconnect" href="//hm.baidu.com"><meta name="google-site-verification" content="xxx"><meta name="baidu-site-verification" content="codeva-D4HsBP841S"><meta name="msvalidate.01" content="xxx"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media=&quot;all&quot;"><script>var _hmt=_hmt||[];(()=>{var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?61a751ac36d18d3ba293fe8ef3ec53eb",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)})()</script><script>let GLOBAL_CONFIG={linkPageTop:{enable:!0,title:"与数百名博主无限进步",addFriendPlaceholder:"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},peoplecanvas:void 0,postHeadAiDescription:{enable:!0,gptName:"Local",mode:"online",switchBtn:!0,btnLink:"https://github.com/dong4j/blog-summary-assistant-server",randomNum:3,basicWordCount:1999,key:"84yT3Gkl6fp",Referer:"https://blog.dong4j.site:1024",apiUrl:"https://oneapi.dong4j.ink:1024/api/summary",audioUrl:"https://api.dong4j.ink:1024/audio"},diytitle:{enable:!0,leaveTitle:"兄台留步 🙏",backTitle:"兄台,别来无恙 👋"},LA51:{enable:!0,ck:"3Ki5mmyy6E5xtXuf",LingQueMonitorID:"3Ki5mmyy6E5xtXuf"},greetingBox:{enable:!0,default:"晚上好👋",list:[{greeting:"晚安😴",startTime:0,endTime:5},{greeting:"早上好鸭👋, 祝你一天好心情！",startTime:6,endTime:9},{greeting:"上午好👋, 状态很好，鼓励一下～",startTime:10,endTime:10},{greeting:"11点多啦, 在坚持一下就吃饭啦～",startTime:11,endTime:11},{greeting:"午安👋, 宝贝",startTime:12,endTime:14},{greeting:"🌈充实的一天辛苦啦！",startTime:14,endTime:18},{greeting:"19点喽, 奖励一顿丰盛的大餐吧🍔。",startTime:19,endTime:19},{greeting:"晚上好👋, 在属于自己的时间好好放松😌~",startTime:20,endTime:24}]},twikooEnvId:"https://twikoo.dong4j.ink:1024",commentBarrageConfig:{enable:!0,maxBarrage:1,barrageTime:4e3,accessToken:"3a358103e6024cfb97546ec8f8408f5a",mailMd5:"3435c7a74ba1cad3f5d57b0b61b9b25cee221b97599c47b32edbdb36038c5411"},music_page_default:"nav_music",root:"/",preloader:{source:"car"},friends_vue_info:{apiurl:"https://friends.dong4j.ink:1024/"},navMusic:!0,mainTone:{mode:"both",api:"https://img2color.dong4j.ink:1024/api?img=",cover_change:!0},authorStatus:{skills:["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","😎 HomeLab 折腾专家","🏃 脚踏实地行动派","🧱 团队小组发动机","👶 尿不湿更换专家"]},algolia:{appId:"JFMEP32WXP",apiKey:"8e3acd038435dda872706ba6777a54b3",indexName:"blog-index",hits:{per_page:10},languages:{input_placeholder:"输入关键词后按下回车查找",hits_empty:"找不到您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，用时 ${time} 毫秒"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"简",rightMenuMsgToTraditionalChinese:"转为繁体",rightMenuMsgToSimplifiedChinese:"转为简体"},noticeOutdate:{limitDay:365,position:"top",messagePrev:"该内容距离上次更新已经过了",messageNext:"天，文章内容可能已经过时。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:330},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,simplehomepage:!0,post:!0},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{copy:!0,copyrightEbable:!1,limitCount:50,languages:{author:"作者: dong4j",link:"链接: ",source:"来源: 司机带你开车",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。",copySuccess:"复制成功，复制和转载请标注本文地址"}},lightbox:"mediumZoom",Snackbar:{chs_to_cht:"你已切换为繁体",cht_to_chs:"你已切换为简体",day_to_night:"你已切换为深色模式",night_to_day:"你已切换为浅色模式",bgLight:"#425AEF",bgDark:"#1f1f1f",position:"top-center"},source:{justifiedGallery:{js:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js",css:"https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!0,shortcutKey:{enable:!0,delay:100,shiftDelay:200},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={configTitle:"司机带你开车",title:"NAT 内网穿透详解：揭秘网络连接背后的奥秘",postAI:"本文深入探讨了NAT（网络地址转换）的起源、作用和类型，以及它在家庭和办公网络中的工作原理。文章首先介绍了IPv4地址耗尽问题，私有地址的需求，以及NAT的诞生背景。接着详细解释了NAT的作用，如缓解地址枯竭、提高安全性等。然后，文章讨论了NAT的类型，包括静态NAT、动态NAT和端口地址转换（PAT/NAT Overload）。随着IPv6的发展，NAT的角色逐渐被重新审视，但它在IPv4网络中仍然扮演着重要角色。文章最后介绍了NAPT（网络地址端口转换）的工作原理，内网穿透的实现方式，以及如何检测和提升NAT类型。",pageFillDescription:"前言, 背景与由来, 1. IPv4 地址枯竭问题, 2. 私有网络需求, 3. NAT 的诞生, NAT 的作用, NAT 的类型, 后续发展, 总结, 概述, NAT 的工作原理, 发送流程, 响应流程, NAPT 的工作原理, 概述, NAPT 原理解析, 数据包传输流程, Ping 命令, 内网穿透, 概述, 即时通讯软件的网络通信机制, 点对点 (P2P) 网络通信, UDP 打洞的局限性, NAT 类型, 简介, 基本 NAT 与 NAPT, 基本 NAT, NAPT, 锥型 NAT 分类, 完全圆锥体 NAT, 受限制的圆锥体 NAT, 端口受限制的圆锥体 NAT, 总结, NAT 类型总结, NAT 类型提升, 低延迟方案, 总结, UPnP, DMA, 端口映射, 检测 NAT 类型, 参考前言网络地址转换的由来与互联网的发展历史密切相关主要是为了解决地址资源紧张问题同时增强网络安全性和管理灵活性相关文章先导篇我的概要硬件篇介绍我所拥有的硬件设备网络篇包括网络环境异地组网与网络安全服务篇使用搭建的各类服务数据篇包括数据存储方案备份方案和数据恢复方案数据同步构建高效的数据同步网络数据备份打造坚实的数据安全防线网络续集升级网络再战年内网穿透详解揭秘网络连接背后的奥秘背景与由来地址枯竭问题使用位地址空间最多可以提供约亿个唯一地址随着互联网的普及联网设备数量迅速增长特别是年代后期地址分配紧张的问题愈发明显早期解决方案如子网划分和无类别域间路由延缓了地址耗尽但并不能彻底解决问题私有网络需求很多组织和企业需要将大量内部设备联网但没有足够的公有地址在年提出了私有地址标准为内部网络预留了一些专用地址段私有地址无法直接通过互联网通信需要一个机制将其转换为公有地址的诞生概念最早在年由提出记录在中作为一种解决地址短缺问题的方法允许多个设备通过一个或少量的公有地址访问互联网它通过在路由器或防火墙上修改数据包的源地址或目标地址实现地址的映射的作用缓解地址枯竭内部设备使用私有地址多个设备可以共享一个公有地址访问互联网提高安全性外部无法直接访问内部设备形成一定的网络隔离网络管理灵活性组织内部地址可以自行规划避免更改时需调整内部网络结构的类型静态一个私有地址映射到一个固定的公有地址常用于需要外部访问的设备动态一组私有地址动态映射到一组公有地址基于需求分配端口地址转换使用单个公有地址通过端口号区分多个内部设备的连接是最常见的类型后续发展随着的推出的角色开始被重新审视提供了位地址空间几乎可以为每台设备分配一个唯一地址然而由于的部署进展缓慢仍然广泛应用于网络并在双栈环境下继续扮演重要角色总结的诞生充分体现了互联网早期技术对现实问题的灵活应对即使未来普及的概念在某些场景如隐私保护中仍可能保留其价值接下来我将详细介绍的实现细节包括表的构建地址转换过程以及如何通过实现内网穿透概述在我们家中的局域网内部网络设备通常都使用所谓的私有地址例如当我们在网络上发送数据包时如果填写的是这样的私有地址那么在网络收到回复的数据包时可能会遇到一个难题因为成千上万的用户都可能在使用同样的私有地址比如网络无法仅凭这些内部地址来判断究竟应该将数据包转发给哪一个设备因此为了使局域网内的私有能够向外部公有发送和接收信息我们需要进行一种称为网络地址转换的机制简单来说就是将内部的私有地址转换为外部的公有地址的过程在局域网与互联网之间通常会有一个专门的设备或服务来执行这一转换它确保了即使多个内部设备共享相同的私有地址也能正确地接收和发送数据这个转换过程可以在路由器防火墙或者设备中完成的工作原理在你的家庭网络中你拥有了一个独立的公网地址并且这个地址已经配置在你家内置了功能的路由器上你的手机电脑以及其他需要连接到互联网的设备都组成了一个局域网每个设备都有一个私有地址发送流程当你想在电脑上访问公网上的一个特定服务比如地址为的服务时你需要通过路由器来完成这个请求当你使用命令行工具如在你的电脑上查看网络配置时你会看到你的电脑的私有地址在准备发送数据包的过程中你的电脑内核协议栈会构建一个包含源地址和目标地址的数据包这个数据包的报头包含了关于如何将数据包从源点传输到终点的全部信息当这个数据包被发送到路由器时路由器的网络地址转换功能会介入将原始数据包中的私有地址替换为分配给你的公网地址这个过程称为源地址转换同时路由器会记住这个映射关系即在内部维护一张映射表记录着私有地址和公网地址之间的对应关系这条映射信息对于后续将响应数据包正确地转发回原始设备至关重要修改后的数据包现在包含源地址和目标地址并经过互联网上的多个路由器进行传输和转发这些路由器根据数据包中的目标地址来决定如何将数据包发送到下一个目的地到这里发送流程结束响应流程当接收端处理完你的请求并发送响应时它会在其构造的数据包中填写自己的地址作为源地址即并将目标地址设置为你的公网地址即这个修改后的数据包会被发送回路由器路由器接收到来自公网的响应后会检查其内部维护的映射记录表在这个表中它会找到一个与公网地址相关联的私有地址即之前留下的映射记录路由器根据这条映射信息知道原始数据包是从你的电脑发送出去的因此它会执行目的地址转换功能将数据包的目标地址从公网地址修改为内部网络的私有地址随后路由器会将这个修改后的数据包转发回局域网内的你的电脑你的电脑收到数据包后会根据其目标地址识别出这是一个针对它的响应网络地址转换在用户毫不知情的情况下隐秘地改变了数据包中的源地址和目标地址对于原始的发送者和接收者而言这种更改是完全看不见的这正是运作的核心机制它确保了即使是使用私有地址的设备也能够安全有效地与互联网上的任何公网进行通信而无需每个设备都有一个唯一的公网地址的工作原理概述在了解了的工作原理后你可能会产生一个疑问局域网中不仅有你的电脑还有其他设备如手机平板等它们各自的映射记录也将是这看起来没问题但当我们需要接收响应时路由器将如何知道哪个响应应该发送给哪一个内部的设备呢这个问题确实很重要因为如果无法区分内部网络的多个连接那么它就无法正确地将外部的响应数据包转发回特定的内部设备为了解决这个问题我们需要引入额外的信息来标识局域网内的每个网络连接一个简单而有效的解决方案是使用端口每个内部设备在发起网络请求时都会分配一个唯一的端口号这通常是通过传输控制协议或用户数据报协议的源端口实现的这样路由器就可以根据这些端口号来区分不同的内部设备即使它们的私有地址相同原理解析数据包在网络层的协议不包含端口号信息端口号信息是存储在传输层如或的数据报头中的当计算机发送一个数据包时它会在网络层包含源地址和目标地址但在传输层或协议会添加额外的头部其中包括源端口号和目标端口号于是流程就变成了下面这样子当你准备发送数据包的时候你的电脑内核协议栈就会先构造一个或者数据报头里面写入端口号比如发送端口是接收端口是然后在这个基础上加入数据报头填入发送端和接收端的地址那数据包长这样数据包传输流程假设发送端地址填的就是接收端地址就是将数据包发到路由器中此时路由器会将数据包里的源地址和端口号修改一下从改写成并且还会在路由器内部留下一条的映射记录之后数据包经过公网里各个路由器的转发发到了接收端到这里发送流程结束当接收端准备发送响应时它会在数据包中写入原始请求源的地址即你的公网作为源地址以及目标地址即路由器的内部端口因为这是它接收到数据的来源然后这个修改后的数据包会被发送回路由器路由器在处理这个响应时会查找到之前留下的映射记录基于这个记录会将数据包的目的地址和端口从修改回你的私有网络内的地址以及对应的端口号之后将其转发给你的电脑上如果局域网内有多个设备他们就会映射到不同的公网端口上毕竟端口最大可达完全够用这样大家都可以相安无事像这种同时转换和端口的技术就是网络地址端口转换命令这里出现了一个疑问通常我们认为只有那些包含端口信息的网络协议才能被网络地址转换识别并进行转发然而这如何解释命令的工作原理呢命令是基于协议的而协议的报文中并不包含端口信息尽管如此我们仍然能够正常地使用命令与公网上的机器通信并接收到回应包这是怎么回事呢实上针对协议路由器做了特殊处理报文头里有个的信息它其实指的是放出命令的进程对路由器来说这个的作用就跟端口一样另外当我们去抓包的时候就会发现有两个一个后面带个另一个带个其实他们都是同一个数值只不过大小端不同读出来的值不一样就好像同样的数字反着读就成了这是为了兼容不同操作系统比如和下大小端不同的情况内网穿透概述当使用网络地址转换上网时一个基本的前提是内网机器必须主动向公网发起请求这样才能将内网的地址和端口映射到外网的地址和端口上然而如果公网上的机器试图主动连接到内网机器这个请求将会在路由器处受阻由于路由器上没有相应的地址和端口映射记录因此它不会将数据转发到内网的任何机器例如假设你在家里电脑上启动了一个服务地址是但你在公司办公室试图通过手机访问这个服务时会发现无法连接这就引出了一个问题有没有办法让外网机器访问内网的服务呢答案是肯定的有一句话说得好任何问题都可以通过增加一个中间层来解决如果不行那就再加一层在这个情况下这个原则同样适用归根结底由于网络地址转换的存在我们通常只能从内网向外网主动发起连接如果内网机器没有首先建立连接设备就不会创建相应的映射关系而没有这个映射关系外网的数据就无法被转发到内网为了解决这个问题我们可以在公网上部署一台服务器并为其分配一个可访问的域名然后让内网的服务主动连接到这台服务器这样路由器就会建立相应的映射关系之后任何外网的访问请求都可以发送到服务器服务器再将这些请求转发到内网机器并将内网机器的响应返回给请求者从而实现数据的双向通信这个过程就是我们所说的内网穿透至于服务器你并不需要自己搭建市面上已经有许多现成的内网穿透服务比如使用某壳提供的内网穿透解决方案或者开源的内网穿透服务到这里我们就可以回答这个问题为什么我在公司里访问不了家里的电脑那是因为家里的电脑在局域网内局域网和广域网之间有个路由器由于路由器的存在外网服务无法主动连通局域网内的电脑即时通讯软件的网络通信机制我家电脑位于我们小区的局域网中而老婆闺蜜家的电脑则位于她们小区的局域网内既然两台电脑都处于各自的局域网中且只允许内网设备主动连接到外网那我电脑上登录的是如何与老婆闺蜜电脑上的建立连接的呢这种提问方式隐含了一个错误的假设即认为两个客户端应用能够直接建立点对点的连接但实际情况并非如此两个客户端之间的通信是间接的它们之间还有一个中间环节那就是通讯软件服务器换言之当两个位于内网的客户端登录时它们都会主动与公网上的通讯服务器建立连接此时各自的路由器会记录下相应的映射条目当一个客户端通过发送消息时这些数据首先会传输到服务器然后由服务器将其转发到另一个客户端反之亦然通过这种机制两台处于内网的计算机得以实现数据的交换点对点网络通信在下载等双向通信场景中通常会涉及到穿越的问题假设还是和两个局域网内的机子内网对应的设备叫内网里的设备叫和一个第三方服务器通过第三方服务器帮助两台位于不同局域网的机器和建立连接的简化流程如下机器首先主动连接第三方服务器其设备记录下的内网和外网地址的映射关系同时记下了的外网和端口机器也进行同样的操作主动连接服务器记录下的内网和外网地址映射同样获取了的外网和端口关键步骤来了通知让主动向的外网和端口发送消息此时收到这个的数据包时这时候根据的设置不同可能存在种情况上没有关于的映射关系导致直接丢包不过丢包没关系这个操作的目的是给上留下有关的映射关系有可能因为延迟或消息达到的顺序问题已经有了关于的映射关系此时和就能正常通信了跟步骤一样通知让向的外网和端口发送消息上也留下了关于的映射关系这时候由于之前上有过关于的映射关系此时就能正常接受的数据包并将其转发给到这里和就能正常进行数据通信了这就是所谓的打洞注意之前我们都是用的数据包目的只是为了在两个局域网的上打个洞出来实际上大部分应用用的都是连接所以这时候我们还需要主动向发起连接比如我们熟知的到此我们就完成了两端之间的通信可能会有这样的疑问既然已经使用了一个端口那么再使用相同的端口会不会出现端口重复占用的错误实际上这种情况并不会发生端口重复占用的错误通常出现在两个连接没有使用选项并且尝试在同一个地址上使用相同的端口然而和之间并不会引发这样的错误原因在于在内核中网络数据包是根据五元组传输协议源目的源端口目的端口来唯一确定接收者的当两个连接的五元组完全相同时内核就无法判断数据应该发送给哪个连接但由于和的传输协议不同即使它们使用了相同的地址和端口五元组也是不同的因此和可以共享相同的端口而不会发生冲突打洞的局限性从年开始一些传统的网络穿透技术如不再有效是一种创新的网络穿透方法它允许设备在没有代理服务器第三方服务器设置源端口欺骗或转换的情况下实现环境下的点对点通信工作原理服务端的操作模拟发送请求服务端启动后会不断向一个固定的无法访问的地址比如发送回显请求包注意只是一个占位符服务端不是真的期待从这个地址收到任何回应这些请求包会被服务端的记录为有一个数据包正在发往等待返回数据服务端内网端口公网端口核心目标服务端的设备在等待这些回显请求包的响应但由于并不存在响应包自然不会到达客户端的操作伪装成一个跳跃点当客户端希望连接服务端时客户端需要知道服务端的地址然后客户端发送一个超时包到服务端这个超时包伪装成某个网络节点的响应告诉服务端你发往的回显请求包超时了无法到达目的地关键点在于客户端发送的超时包中包含了服务端原始发送的回显请求包的完整信息原始数据包的内容的行为识别匹配的请求当客户端发送的超时包到达服务端的时会检查包的内容发现里面嵌套了服务端最初发往的请求包智能转发认为这个超时包是和服务端最初的请求包相关联的回应于是将包转发给后面的服务端服务端获取客户端的地址提取信息服务端收到客户端伪装的超时包后从中提取出客户端的真实地址和端口完成连接服务端和客户端此时可以通过提取的地址建立点对点连接服务端启动后它会开始向固定地址发送固定的请求数据包同时会创建一个记录这个请求数据包在经过转换后的内容为源目标用于区分会话使用的固定值方便与客户端发送的超时包匹配用于追踪包的顺序使用的固定值方便与客户端发送的超时包匹配客户端在只知道服务端对应的公网的情况下发送伪造的超时包经过转换后的内容为伪造的超时包源目标超时包服务端原始发出的回显请求的和头源目标用于区分会话使用的固定值方便与客户端发送的超时包匹配用于追踪包的顺序使用的固定值方便与客户端发送的超时包匹配因为的请求和响应包匹配依赖于层的源和目标以及数据包头中的字段和最主要的是构建和因为前面服务器端发送的都是固定的请求数据包所以这里就非常容易伪造超时包伪造的数据包首先达到服务器前面的设备在检查内后发现与服务端之前发往的请求相关联认为这是一个合法的响应因为设备已经有相关的记录了就会把目标为的数据包转发给类型简介分为两大类基本的和即端口英文全称为基本与基本这种类型的主要是进行地址的转换它将私有网络中的地址映射到公网上的一个或多个公网地址它的可以分为静态静态是一种将内部网络的私有地址映射到一个固定的公有地址的方法这种映射关系是由网络管理员手动配置的并且在映射建立后不会改变特点为一对一映射每个私有地址都对应一个唯一的公有地址永久性映射关系是永久性的除非管理员手动更改配置动态动态是一种将内部网络的私有地址动态地映射到公有地址池中的地址的方法映射关系不是永久固定的而是根据需要动态分配和释放特点为多对多映射私有地址可以映射到公有地址池中的任何一个地址临时性映射关系在会话结束时释放地址可以重新分配给其他内部主机也称为端口是一种更高级的形式它不仅转换地址还转换传输层协议的端口号允许多个内部私有地址共享同一个公网地址通过不同的端口号来区分不同的数据流这是最常见的类型广泛用于家庭和小型企业网络中因为它可以有效地解决公网地址不足的问题又分为锥型和对称型锥型它在转换时内部主机的私有地址和端口号与公网地址和端口号之间的映射关系是一致的不依赖于通信的目的地址特点映射一致性一旦内部主机的私有端口映射到公网的一个端口无论目的地址是什么这个映射关系都保持不变如果使用内网端口与通信并且将公网端口分配给的端口那么当使用同一个端口向任何其他服务器如发起通信时仍然会将公网端口分配给的端口对称型是一种更严格的它在进行转换时不仅考虑内部主机的私有地址和端口号还考虑通信的目的地址对于每个新的目的地可能会分配一个新的公网端口特点映射依赖性映射关系依赖于目的地址即使内部主机的源端口相同如果目的地址不同也会分配不同的公网端口如果已经使用内网端口与通信并且将公网端口分配给这个通信那么当想要与通信时可能会分配一个新的公网端口如给同一个内网端口锥型与对称型的区别锥型映射关系与目的地址无关只要源地址内部主机的和端口相同映射关系就相同对称型映射关系不仅与源地址有关还与目的地址有关即使是同一个源地址如果目的地址不同映射关系也可能不同锥型分类锥形又可分为完全圆锥体受限制的圆锥体端口受限制的圆锥体三种完全圆锥体特性最宽松的限制内网客户端与外部设备通信时会创建一个映射内部和端口到外部和端口的映射任何外部设备只要知道这个映射的外部和端口都可以通过该端口直接与内网客户端通信规则内网客户端主动发起连接时创建的映射是固定的内部端口外部路由器公网端口外部设备只需知道外部的和端口就能发包到内网客户端无需内网客户端与之通信过内部服务主动访问时创建的记录为内部端口外址端口此时任何外部服务都可以通过访问到内部的因为设备并不关心报文的源和源端口号即报文来自谁只要收到匹配记录的报文都能发送到内网设备此时内部服务访问其他的服务比如因为源地址相同的缘故则不会再创建映射不会为同一个内网地址和端口针对不同目标服务器创建多个映射受限制的圆锥体特性中等限制内网客户端发起连接时会创建一个映射只有客户端主动通信过的外部设备才能通过该映射访问内网客户端记录允许的规则内网客户端发起连接时创建映射内部端口外部路由器公网端口允许目标只有客户端通信过的外部设备即目标在映射记录中且通讯过的外部设备记还要匹配允许的才能通过映射访问客户端外部设备发来的数据包必须与客户端通信的外部和端口一致内部服务主动访问时创建的记录为内网端口外部端口允许目标此时只有来自任意端口的请求才能通过访问到内部的比如来自的请求则不能访问内部服务因为它没有在允许目标地址中内网设备正在与哪些外部设备通信此时必须由内部服务先发起请求以增加新的允许的目标记录才能让访问内网端口外部端口允许目标这样的安全性有一定的提高但是也提高了打洞难度两台内网设备需要互相给对方发送一个报文才能打洞成功端口受限制的圆锥体特性最严格的限制内网客户端发起连接时会创建一个映射只有客户端主动通信过的外部设备才能通过该映射访问内网客户端记录允许的规则内网客户端发起连接时创建映射内部端口外部路由器公网端口允许的目标端口外部设备发来的数据包必须与客户端通信的外部和端口一致比受限制的圆锥体增加了一层对端口的限制内部服务主动访问时创建的记录为内网端口外部端口允许的目标端口此时来自且端口是的请求才能通过访问到内部的同理如果想让也能访问则必须由内部服务先发起请求以新增允许的目标端口记录内网端口外部端口允许的目标端口总结与完全圆锥形相比受限圆锥形在内网设备向外发送报文时路由器除了生成记录还会根据报文的目的记录下内网设备正在与哪些外部设备通信这样只有内网设备先发送报文给外部设备外部设备回应的报文才会被转发到内网设备而其他外部设备发送过来的报文即使匹配记录也无法发送到内网设备而受限制的圆锥体与端口受限制的圆锥体最显著的区别是受限制的范围不一样后者相对于前者添加了端口的限制我们回顾一下圆锥形的定义一旦内部主机的私有端口映射到公网的一个端口无论目的地址是什么这个映射关系都保持不变而上述三种圆锥形的示例中自始至终都只有条记录不同的是是否需要通过允许的地址来放行请求与谁通信过的记录而对称型会同时根据内网设备出方向报文的源源端口号目的目的端口号四个信息来建立记录如果报文的目的目的端口号发生了变化映射到的外部端口号也会发生改变内网设备首先和通信内网和内网端口号会被映射为一个外部和外部端口号内网端口外部端口接下来内网设备和另一台设备通信相同的内网和内网端口号又会被映射为另外一个外部端口号内网端口外部端口我们以前文说的打洞点对点网络通信为例说说为什么对称型无法成功打洞第一步都是一样的和同时向发送数据这时会分别在设备上生成对应的记录同时记录设备和对应的外网和端口第二步是将对应的公网和外部端口发送给和让它们互相访问此时在两端的设备上各新增了一条记录但因为对称型的特性因为目标地址不同或端口不同即使是同一个内网通过相同的端口发送数据包在设备生成的记录的外部端口也会不一样即这次生成的外部端口为经转换后源地址为目标地址为而端记录中的只能被源地址为访问所以发送给的数据包被丢失导致打洞失败类型总结基本的它仅将内网主机的私有地址转换成公网地址但并不将端口信息进行转换有动态与静态之区分由于现在大部分都属于另一种类型即其中对称打洞困难很高但是安全性好而锥型打洞比较容易实际上大部运营商提供的光猫上网服务都是锥形而光纤入户网络公共等因为安全因素都是对称另外目前绝大多数的路由器都是非对称型只要请求链接的对方是非端口限制锥型就都能实现打洞链接的只有双方都是对称是一定无法实现或一方对称一方是端口限制锥型的情况也无法实现打洞下面是各种类型打洞总结发送端类型接收端类型是否能打洞完全锥形完全锥形完全锥形限制性锥形完全锥形端口限制性锥形完全锥形对称式限制性锥形限制性锥形限制性锥形端口限制性锥形限制性锥形对称式端口限制性锥形端口限制性锥形端口限制性锥形对称式对称式对称式类型提升简单回顾一下的个类型它们分别是全锥形这是最宽松的网络环境你想做什么基本没啥限制和端口都不受限受限锥型相比增加了地址限制也就是受限而端口不受限端口受限锥型相比增加了端口限制即端口都受限对称型对称型具有端口受限锥型的受限特性内部地址每一次请求一个特定的外部地址都会绑定到一个新的端口这种类型基本上就告别了从到限制越来越多为了满足各种需求我们希望提升类型提升类型的好处有浏览网页观看视频游戏等更顺畅下载速度更稳定快速特别是对那些玩游戏的提升改善类型后联机速度更快游戏体验明显提高低延迟方案想要游戏网速快延迟低就要公网桥接硬件加速修改光猫工作模式把光猫工作模式设置为桥接模式需要超级管理员账号密码很多都是默认可以根据地区上网搜索新款的直接联系维修工人修改模式因为运营商一般默认设置光猫工作在路由模式无线路由器直接连到猫上就可以上网的那么光猫是路由模式无线路由器需要拨号上网的就是桥接模式更改路由器设置启用无线路由器的功能大部分路由器都支持把要提升类型的主机设置为静态然后开启通过路由器拨号路由器最好要刷机然后选择模式总结路由器层数越少越可能得到和类型是最宽松的网络环境基本没限制是最严格的网络环境可能会玩不了游戏下载都没速度如果光猫是桥接模式路由器拨号上网的有可能是和对上网游戏和下载都没有太多限制拨号能获得公网的可以优化到拨号获得内网基本是中国电信中国联通宽带一般是公网中国移动中国广电长宽等基本是内网因为移动公网池比其他运营商少所以一般都用对称型节约公网因为断开连接就会解绑映射不过绑定关系的建立和解除会消耗性能所以移动打游戏时不时跳是一种网络协议允许设备在网络中自动发现彼此并通过网络进行互操作使设备能够在网络中动态地发现控制和配置其他设备而无需手动配置它广泛应用于家庭和办公环境中特别是在涉及到网络设备之间的协作时主要特点自动发现设备能够自动发现网络中的其他设备并能够与其进行通信例如智能家电路由器打印机等设备通过协议可以自动连接并相互配合零配置设备不需要用户进行复杂的网络配置如地址或端口映射自动完成这些操作设备控制通过协议可以控制其他设备的功能如播放音乐控制视频播放网络摄像头的调节等与的关系是一种用于网络层的技术用来将内网设备的私有地址转换为公共地址使得多个设备能够共享一个公共地址的典型应用场景是家庭路由器它将内网设备的请求映射到一个公共的地址上从而允许多个设备通过一个公共地址访问互联网然而会带来一些问题尤其是当多个设备需要与外部设备进行点对点通信时例如不会自动将外部设备的请求转发到内网设备因此需要手动配置端口映射端口转发才能允许外部设备通过公共地址访问内网设备如何帮助穿透具体来说协议允许内网设备通过协议自动请求路由器开放特定的端口并进行端口映射这使得内网设备能够在不手动配置端口转发的情况下允许外部设备访问内网服务突破了的限制工作原理设备发现内网设备如计算机游戏主机智能摄像头等通过发送请求寻找支持协议的路由器端口映射请求内网设备通过向路由器发送请求要求路由器将指定的端口映射到设备的地址和端口上路由器通常会响应并将端口映射添加到表中外部访问外部设备通过路由器的公共地址和开放的端口访问内网设备路由器根据配置的端口映射将请求转发到正确的内网设备穿透的应用场景特别适用于以下几种情况和视频通话通过自动配置端口映射使得或视频会议可以穿透直接进行通信文件共享如在线游戏等内网用户通过自动创建端口映射使得外部用户能够直接连接到内网用户游戏控制台如或设备通过请求开放端口以便与其他设备进行联网对战的安全性问题虽然提供了便利性但也存在一些安全隐患自动端口映射如果功能启用路由器会允许内网设备自动请求端口映射这意味着恶意软件也可以通过请求将某些端口暴露到外部网络未经授权的设备访问未经授权的设备可能会通过请求端口映射允许外部攻击者访问内网设备防火墙绕过恶意软件可以通过自动打开端口从而绕过防火墙获取不应有的网络访问权限总结是一种使设备能够自动发现并互相通信的协议广泛应用于家庭和办公网络中会阻止外部设备直接访问内网设备但可以自动化端口映射过程解决穿透问题对进行了优化使得内网设备能够自动配置路由器进行端口映射从而使外部设备能够访问内网服务上文中介绍的路由器会根据内网设备发出的报文自动形成表项实际上用户还可以在路由器上手动配置端口映射关系让内网设备可被外部访问其中功能可以指定一台内网设备为主机到达路由器上的报文如果没有匹配表项就会转发到主机从而使主机可被外部访问功能能让一台内网设备上的所有端口都能被公网访问但这样做也影响了内网设备的安全性如果没有特殊需要不建议打开这一功能端口映射端口映射是指将外部网络通常是公共网络上的某个端口映射到内网设备上的相应端口允许外部用户通过路由器访问内网设备的服务它通常与配合使用在路由器或防火墙上设置映射规则从而实现外部与内网的通信举个例子假设你有一台内部设备地址为并且这台设备上的某个服务监听的是端口你希望外部用户能够访问这个服务但内网的地址无法直接暴露给外部网络你可以在路由器上设置端口映射规则将外部的某个公共端口例如映射到内网设备的端口这样外部用户访问路由器的端口时实际上会转发到内网设备的作用通过端口映射外部设备可以访问内网中的特定设备或服务它用于解决带来的内网设备无法直接被外部访问的问题和端口映射区别是一种技术或机制用于将私有地址转换为公共地址端口映射是的一种配置通过设置规则将外部访问的端口映射到内网设备的端口使得外部设备能够访问内网设备检测类型是一个用于获取类型和外部的客户端安装也可以使用自定义服务器默认的在中定义自己也可以搭建一个使用自建服务器服务的域名或的端口号如果你做相关工作的开发那么这个开源项目可以关注一下参考张图详解换个马甲就能上网家庭网络中的到底是什么入网指南地址大揭秘少数派局域网游戏串流让我们都做一回云玩家少数派小白也能看懂的网络基础地址是如何工作的少数派小白也能看懂的网络基础地址深度学习少数派小白也能看懂的网络基础和是如何工作的少数派科普与类型提升互联网网关设备协议维基百科自由的百科全书端口映射协议维基百科自由的百科全书解决错误和多人游戏问题相关文章先导篇我的概要硬件篇介绍我所拥有的硬件设备网络篇包括网络环境异地组网与网络安全服务篇使用搭建的各类服务数据篇包括数据存储方案备份方案和数据恢复方案数据同步构建高效的数据同步网络数据备份打造坚实的数据安全防线网络续集升级网络再战年内网穿透详解揭秘网络连接背后的奥秘",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2025-04-03 20:08:00",postMainColor:""}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:(e,t,a)=>{var o;0!==a&&(o=Date.now(),localStorage.setItem(e,JSON.stringify({value:t,expiry:o+864e5*a})))},get:e=>{var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!(Date.now()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=(o,c={})=>new Promise((t,e)=>{let a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},Object.keys(c).forEach(e=>{a.setAttribute(e,c[e])}),document.head.appendChild(a)}),e.getCSS=(o,c=!1)=>new Promise((t,e)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,c&&(a.id=c),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#18171d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#f7f9fe")};var e=saveToLocal.get("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,a=window.matchMedia("(prefers-color-scheme: light)").matches,o=window.matchMedia("(prefers-color-scheme: no-preference)").matches,c=!t&&!a&&!o,t=(void 0===e?(a?activateLightMode():t?activateDarkMode():(o||c)&&((a=(new Date).getHours())<=8||22<=a?activateDarkMode:activateLightMode)(),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>{void 0===saveToLocal.get("theme")&&(e.matches?activateDarkMode:activateLightMode)()})):("light"===e?activateLightMode:activateDarkMode)(),saveToLocal.get("aside-status"));void 0!==t&&("hide"===t?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://s1.hdslb.com/bfs/static/jinkela/long/font/medium.css"><script src="https://cdn.dong4j.site/source/static/echarts.min.js"></script><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/core.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/footer.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/index-imgloaded.css"><script src="https://cdn.dong4j.site/source/static/index-imgloaded.js"></script><script src="https://cdn.dong4j.site/source/static/detect-devtools.js"></script><script defer="" src="https://cdn.dong4j.site/source/static/umami.self.js" data-host-url="https://umami.dong4j.ink:1024" data-website-id="bd4721b7-a43f-4161-83ed-51c148a7ca9d"></script><script defer="" src="https://cdn.dong4j.site/source/static/counter.js" async="" id="online-counter" interval="60000" api="https://umami.dong4j.ink:1024/counter" room="000000001"></script><script src="https://cdn.dong4j.site/source/static/confetti.browser.min.js"></script><script src="https://cdn.dong4j.site/source/static/confetti.js"></script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="司机带你开车" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="司机带你开车" type="application/rss+xml"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box"><div class="carplay"></div></div><script>let preloader={endLoading:()=>{document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",()=>{preloader.endLoading()}),setTimeout(function(){preloader.endLoading()},2e3),document.getElementById("loading-box").addEventListener("click",()=>{preloader.endLoading()}),document.addEventListener("pjax:send",()=>{preloader.initLoading()}),document.addEventListener("pjax:complete",()=>{preloader.endLoading()})</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"><script async="" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.dong4j.site" title="个人主页"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/homepage.webp" alt="个人主页"><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://blog.dong4j.site" title="博客"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/blog.webp" alt="博客"><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://resume.dong4j.site" title="简历"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/resume.webp" alt="简历"><span class="back-menu-item-text">简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://npx-card.dong4j.site" title="npx-card"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/npx-card.webp" alt="npx-card"><span class="back-menu-item-text">npx-card</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack" title="Watt.Stack"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/watt.webp" alt="Watt.Stack"><span class="back-menu-item-text">Watt.Stack</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit" title="MIK"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/mik.webp" alt="MIK"><span class="back-menu-item-text">MIK</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev" title="macOS.dev"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/mac.webp" alt="macOS.dev"><span class="back-menu-item-text">macOS.dev</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.site/" title="更多"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/project.webp" alt="更多"><span class="back-menu-item-text">更多</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">服务</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services" title="服务状态"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/uptime-kuma.svg" alt="服务状态"><span class="back-menu-item-text">服务状态</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nezha.dong4j.dev" title="服务面板"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/nezha.webp" alt="服务面板"><span class="back-menu-item-text">服务面板</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nav.dong4j.dev" title="导航页"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/nav.webp" alt="导航页"><span class="back-menu-item-text">导航页</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://umami.dong4j.ink:1024/share/V7Rat8DdVw4npjl2/blog.dong4j.site" title="Umami"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/umami.webp" alt="Umami"><span class="back-menu-item-text">Umami</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://muselink.cc/dong4j 👈这是我的MuseLink数字名片！" title="数字名片"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/muse.lin.webp" alt="数字名片"><span class="back-menu-item-text">数字名片</span></a><a class="back-menu-item" href="/ai/deepseek-r1-webgpu/" title="DeepSeek"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/deepseek.webp" alt="DeepSeek"><span class="back-menu-item-text">DeepSeek</span></a><a class="back-menu-item" href="/ai/rmbg/playground/" title="RMBG"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/rmbg.webp" alt="RMBG"><span class="back-menu-item-text">RMBG</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.dong4j.site/" title="Mini-Chat"><img class="back-menu-item-icon" src="https://cdn.dong4j.site/source/image/emoji1.webp" alt="Mini-Chat"><span class="back-menu-item-text">Mini-Chat</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">司机带你开车</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa fa-comments faa-tada"></i><span> 最新评论</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size:.9em"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/memos/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 备忘录</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fa-solid fa-map faa-tada"></i><span> 折腾清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/stars/"><i class="fa-brands fa-github faa-tada"></i><span> Star 清单</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.dong4j.dev"><span>小黑屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole()"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/wechat-pay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.dong4j.site/source/image/wechat-pay.webp"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.dong4j.site/source/image/alipay.webp"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title">最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/checkedexception/" style="font-size:1.05rem;color:#148f76">CheckedException<sup>1</sup></a><a href="/tags/error/" style="font-size:1.05rem;color:#7caa4e">Error<sup>1</sup></a><a href="/tags/exception/" style="font-size:1.05rem;color:#6ca2ab">Exception<sup>1</sup></a><a href="/tags/java/" style="font-size:1.05rem;color:#72966d">Java<sup>48</sup></a><a href="/tags/javabean/" style="font-size:1.05rem;color:#860ac1">JavaBean<sup>1</sup></a><a href="/tags/math/" style="font-size:1.05rem;color:#a75222">Math<sup>1</sup></a><a href="/tags/random/" style="font-size:1.05rem;color:#967478">Random<sup>1</sup></a><a href="/tags/runtimeexception/" style="font-size:1.05rem;color:#94aec3">RuntimeException<sup>1</sup></a><a href="/tags/string/" style="font-size:1.05rem;color:#453533">String<sup>2</sup></a><a href="/tags/stringbuffer/" style="font-size:1.05rem;color:#3f431c">StringBuffer<sup>2</sup></a><a href="/tags/stringbuilder/" style="font-size:1.05rem;color:#a0673c">StringBuilder<sup>1</sup></a><a href="/tags/throwable/" style="font-size:1.05rem;color:#ad4b80">Throwable<sup>1</sup></a><a href="/tags/final/" style="font-size:1.05rem;color:#77b142">final<sup>2</sup></a><a href="/tags/finalize/" style="font-size:1.05rem;color:#9a5c58">finalize<sup>1</sup></a><a href="/tags/finally/" style="font-size:1.05rem;color:#4fad4c">finally<sup>2</sup></a><a href="/tags/getter/" style="font-size:1.05rem;color:#a5c25f">getter<sup>1</sup></a><a href="/tags/new%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:1.05rem;color:#050f6f">new关键字<sup>1</sup></a><a href="/tags/setter/" style="font-size:1.05rem;color:#85a1b8">setter<sup>1</sup></a><a href="/tags/static/" style="font-size:1.05rem;color:#096286">static<sup>1</sup></a><a href="/tags/super/" style="font-size:1.05rem;color:#4f916e">super<sup>2</sup></a><a href="/tags/this/" style="font-size:1.05rem;color:#869dc2">this<sup>1</sup></a><a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size:1.05rem;color:#4d7499">二进制<sup>1</sup></a><a href="/tags/%E5%8C%85%E8%A3%85%E7%B1%BB/" style="font-size:1.05rem;color:#410937">包装类<sup>1</sup></a><a href="/tags/%E5%B0%81%E8%A3%85/" style="font-size:1.05rem;color:#768122">封装<sup>3</sup></a><a href="/tags/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" style="font-size:1.05rem;color:#501f70">异常处理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size:1.05rem;color:#690252">数据类型<sup>4</sup></a><a href="/tags/%E6%96%B9%E6%B3%95%E9%87%8D%E8%BD%BD/" style="font-size:1.05rem;color:#a38b10">方法重载<sup>1</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" style="font-size:1.05rem;color:#95a701">构造方法<sup>1</sup></a><a href="/tags/%E6%BA%A2%E5%87%BA/" style="font-size:1.05rem;color:#bf8181">溢出<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:1.05rem;color:#4ec37b">算法<sup>1</sup></a><a href="/tags/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2/" style="font-size:1.05rem;color:#34c54f">类型转换<sup>3</sup></a><a href="/tags/%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" style="font-size:1.05rem;color:#74835a">线程安全<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" style="font-size:1.05rem;color:#702108">编程实践<sup>2</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F/" style="font-size:1.05rem;color:#3d022e">计算机程序<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/" style="font-size:1.05rem;color:#4c85aa">计算机语言<sup>1</sup></a><a href="/tags/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" style="font-size:1.05rem;color:#23b3be">访问控制<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size:1.05rem;color:#95198d">软件<sup>1</sup></a><a href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" style="font-size:1.05rem;color:#92b58f">错误处理<sup>2</sup></a><a href="/tags/%E9%9A%8F%E6%9C%BA%E6%95%B0/" style="font-size:1.05rem;color:#34929b">随机数<sup>1</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size:1.05rem;color:#53ab26">面向对象<sup>6</sup></a></div></div><hr></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多"> <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">十一月 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div><div class="console-btn-item" id="consoleKeyboard" onclick="anzhiyu.keyboardToggle()" title="快捷键开关"><a class="keyboard-switch"><i class="anzhiyufont anzhiyu-icon-keyboard"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/homelab-%E4%B8%AD%E5%B9%B4%E7%94%B7%E4%BA%BA%E7%9A%84%E5%BF%AB%E4%B9%90%E6%BA%90%E6%B3%89/" itemprop="url">HomeLab:中年男人的快乐源泉</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/homelab/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>HomeLab</span></a><a class="article-meta__tags" href="/tags/nat/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>NAT</span></a><a class="article-meta__tags" href="/tags/ipv4/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>IPv4</span></a><a class="article-meta__tags" href="/tags/ipv6/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>IPv6</span></a><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络地址转换</span></a><a class="article-meta__tags" href="/tags/napt/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>NAPT</span></a><a class="article-meta__tags" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" tabindex="-1" itemprop="url"> <span><i class="anzhiyufont anzhiyu-icon-hashtag"></i>内网穿透</span></a></span></div></div><h1 class="post-title" itemprop="name headline">NAT 内网穿透详解：揭秘网络连接背后的奥秘</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2020-04-12T16:00:00.000Z" title="发表于 2020-04-13 00:00:00">2020-04-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-03T12:08:00.682Z" title="更新于 2025-04-03 20:08:00">2025-04-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12.8k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" data-flag-title="NAT 内网穿透详解：揭秘网络连接背后的奥秘"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator"> </span><span class="post-meta-position" title="作者IP属地为成都"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>成都</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/46fb4e89.html#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.dong4j.site/source/image/20241229154732_ygRx9mbO.webp"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="fa-regular fa-robot fa-fade"></i><div class="ai-title-text">摘要助手</div><div id="ai-Toggle">切换</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">SummaryGPT</div></div><div class="ai-explanation">AI 初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成摘要 👋</div><div class="ai-btn-item">推荐文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item">前往订阅 💥</div><div class="ai-btn-item" id="go-comment">前往评论 💬</div><div class="ai-btn-item" id="read-audio">Kokoro TTS 🎙️</div><div class="ai-btn-item" id="go-tianli-blog">👀 部署教程</div></div><script data-pjax="" src="https://cdn.dong4j.site/source/static/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope="" itemtype="https://blog.dong4j.site/posts/46fb4e89.html"><header><a class="post-meta-categories" href="/categories/homelab-%E4%B8%AD%E5%B9%B4%E7%94%B7%E4%BA%BA%E7%9A%84%E5%BF%AB%E4%B9%90%E6%BA%90%E6%B3%89/" itemprop="url">HomeLab:中年男人的快乐源泉</a><a href="/tags/homelab/" tabindex="-1" itemprop="url">HomeLab</a><a href="/tags/nat/" tabindex="-1" itemprop="url">NAT</a><a href="/tags/ipv4/" tabindex="-1" itemprop="url">IPv4</a><a href="/tags/ipv6/" tabindex="-1" itemprop="url">IPv6</a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/" tabindex="-1" itemprop="url">网络地址转换</a><a href="/tags/napt/" tabindex="-1" itemprop="url">NAPT</a><a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" tabindex="-1" itemprop="url">内网穿透</a><h1 id="CrawlerTitle" itemprop="name headline">NAT 内网穿透详解：揭秘网络连接背后的奥秘</h1><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">dong4j</span><time itemprop="dateCreated datePublished" datetime="2020-04-12T16:00:00.000Z" title="发表于 2020-04-13 00:00:00">2020-04-13</time><time itemprop="dateCreated datePublished" datetime="2025-04-03T12:08:00.682Z" title="更新于 2025-04-03 20:08:00">2025-04-03</time></header><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_ygRx9mbO.webp" alt="/images/cover/20241229154732_ygRx9mbO.webp"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>NAT (网络地址转换, Network Address Translation) 的由来与互联网的发展历史密切相关, 主要是为了解决 IPv4 地址资源紧张问题, 同时增强网络安全性和管理灵活性.</p><p><strong>相关文章:</strong></p><ol><li><a href="/posts/15433dee.html">先导篇</a>：我的 HomeLab 概要;</li><li><a href="/posts/1c3b04a.html">硬件篇</a>：介绍我所拥有的硬件设备;</li><li><a href="/posts/e537d446.html">网络篇</a>：包括网络环境、异地组网与网络安全;</li><li><a href="/posts/b2341239.html">服务篇</a>：使用 Docker 搭建的各类服务;</li><li><a href="/posts/b808f350.html">数据篇</a>：包括数据存储方案、备份方案和数据恢复方案;</li><li><a href="/posts/273b6766.html">HomeLab数据同步：构建高效的数据同步网络</a></li><li><a href="/posts/6c25aa66.html">HomeLab数据备份：打造坚实的数据安全防线</a></li><li><a href="/posts/7e09e56.html">HomeLab 网络续集：升级 10G 网络-再战 10 年</a></li><li><a href="/posts/15433dee.html">NAT 内网穿透详解：揭秘网络连接背后的奥秘</a></li></ol><h3 id="背景与由来"><a href="#背景与由来" class="headerlink" title="背景与由来"></a>背景与由来</h3><h4 id="1-IPv4-地址枯竭问题"><a href="#1-IPv4-地址枯竭问题" class="headerlink" title="1. IPv4 地址枯竭问题"></a>1. IPv4 地址枯竭问题</h4><p>IPv4 使用 32 位地址空间, 最多可以提供约 43 亿个唯一地址. 随着互联网的普及, 联网设备数量迅速增长, 特别是 1990 年代后期, 地址分配紧张的问题愈发明显.</p><p>早期解决方案如子网划分和无类别域间路由 (CIDR) 延缓了地址耗尽, 但并不能彻底解决问题.</p><h4 id="2-私有网络需求"><a href="#2-私有网络需求" class="headerlink" title="2. 私有网络需求"></a>2. 私有网络需求</h4><ul><li>很多组织和企业需要将大量内部设备联网, 但没有足够的公有 IPv4 地址.</li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzE5MTg=">RFC 1918</a> 在 1996 年提出了私有地址标准, 为内部网络预留了一些专用地址段：<ul><li><code>10.0.0.0/8</code></li><li><code>172.16.0.0/12</code></li><li><code>192.168.0.0/16</code></li></ul></li><li>私有地址无法直接通过互联网通信, 需要一个机制将其转换为公有地址.</li></ul><h4 id="3-NAT-的诞生"><a href="#3-NAT-的诞生" class="headerlink" title="3. NAT 的诞生"></a>3. NAT 的诞生</h4><ul><li>NAT 概念最早在 1994 年由 IETF 提出, 记录在 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cucmZjLWVkaXRvci5vcmcvcmZjL3JmYzE2MzE=">RFC 1631</a> 中, 作为一种解决 IPv4 地址短缺问题的方法.</li><li>NAT 允许多个设备通过一个或少量的公有 IP 地址访问互联网. 它通过在路由器或防火墙上修改 IP 数据包的源地址或目标地址, 实现地址的映射.</li></ul><h3 id="NAT-的作用"><a href="#NAT-的作用" class="headerlink" title="NAT 的作用"></a>NAT 的作用</h3><ol><li><strong>缓解地址枯竭</strong>: 内部设备使用私有地址, 多个设备可以共享一个公有地址访问互联网.</li><li><strong>提高安全性</strong>: 外部无法直接访问内部设备, 形成一定的网络隔离.</li><li><strong>网络管理灵活性</strong>: 组织内部地址可以自行规划, 避免更改 ISP 时需调整内部网络结构.</li></ol><h3 id="NAT-的类型"><a href="#NAT-的类型" class="headerlink" title="NAT 的类型"></a>NAT 的类型</h3><ol><li><strong>静态 NAT</strong>: 一个私有地址映射到一个固定的公有地址, 常用于需要外部访问的设备.</li><li><strong>动态 NAT</strong>: 一组私有地址动态映射到一组公有地址, 基于需求分配.</li><li><strong>端口地址转换 (PAT/NAT Overload)</strong>: 使用单个公有 IP 地址, 通过端口号区分多个内部设备的连接, 是最常见的 NAT 类型.</li></ol><h3 id="后续发展"><a href="#后续发展" class="headerlink" title="后续发展"></a>后续发展</h3><ul><li>随着 <strong>IPv6</strong> 的推出, NAT 的角色开始被重新审视. IPv6 提供了 128 位地址空间, 几乎可以为每台设备分配一个唯一地址.</li><li>然而, 由于 IPv6 的部署进展缓慢, NAT 仍然广泛应用于 IPv4 网络, 并在双栈环境下继续扮演重要角色.</li></ul><hr><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>NAT 的诞生充分体现了互联网早期技术对现实问题的灵活应对. 即使未来 IPv6 普及, NAT 的概念在某些场景 (如隐私保护) 中仍可能保留其价值.</p><p>接下来, 我将详细介绍 NAT 的实现细节, 包括 NAT 表的构建、地址转换过程, 以及如何通过 NAT 实现内网穿透.</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在我们家中的局域网内部, 网络设备通常都使用所谓的<strong>私有 IP 地址</strong>, 例如<code>192.168.xx.xx</code>. 当我们在网络上发送数据包时, 如果填写的是这样的私有 IP 地址, 那么在网络收到回复的数据包时可能会遇到一个难题：因为成千上万的用户都可能在使用同样的私有 IP 地址——比如<code>192.168.31.2</code>. 网络无法仅凭这些内部地址来判断究竟应该将数据包转发给哪一个设备.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_LxYJaHYG.webp" alt="20241229154732_LxYJaHYG.webp"></p><p>因此, 为了使局域网内的私有 IP 能够向外部公有 IP 发送和接收信息, 我们需要进行一种称为<strong>网络地址转换 (NAT)<strong>的机制. 简单来说就是将</strong>内部的私有 IP 地址转换为外部的公有 IP 地址的过程</strong>.</p><p>在局域网与互联网之间, 通常会有一个专门的设备或服务来执行这一转换, 它确保了即使多个内部设备共享相同的私有 IP 地址, 也能正确地接收和发送数据. 这个转换过程可以在路由器、防火墙或者 NAT 设备中完成.</p><h2 id="NAT-的工作原理"><a href="#NAT-的工作原理" class="headerlink" title="NAT 的工作原理"></a>NAT 的工作原理</h2><p>在你的家庭网络中, 你拥有了一个独立的公网 IP 地址 <code>20.20.20.20</code>, 并且这个 IP 地址已经配置在你家内置了 NAT 功能的路由器上. 你的手机、电脑以及其他需要连接到互联网的设备都组成了一个局域网, 每个设备都有一个私有 IP 地址.</p><h3 id="发送流程"><a href="#发送流程" class="headerlink" title="发送流程"></a>发送流程</h3><p>当你想在电脑上访问公网上的一个特定服务, 比如 IP 地址为 <code>30.30.30.30</code> 的服务时, 你需要通过 NAT 路由器来完成这个请求. 当你使用命令行工具 (如 ifconfig) 在你的电脑上查看网络配置时, 你会看到你的电脑的私有 IP 地址 <code>192.168.31.2</code>:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_u4I1HElD.webp" alt="20241229154732_u4I1HElD.webp"></p><p>在准备发送数据包的过程中, 你的电脑内核协议栈会构建一个包含源 IP 地址 <code>192.168.31.2</code> 和目标 IP 地址 <code>30.30.30.30</code> 的 IP 数据包. 这个 IP 数据包的报头包含了关于如何将数据包从源点传输到终点的全部信息.</p><p>当这个 IP 数据包被发送到 NAT 路由器时, 路由器的网络地址转换 (SNAT) 功能会介入: 将原始数据包中的私有 IP 地址 <code>192.168.31.2</code> 替换为分配给你的公网 IP 地址 <code>20.20.20.20</code>, 这个过程称为<strong>源地址转换</strong> (Source Network Address Translation) .</p><p>同时, NAT 路由器会记住这个映射关系, 即在内部维护一张映射表, 记录着私有 IP 地址和公网 IP 地址之间的对应关系. 这条映射信息对于后续将响应数据包正确地转发回原始设备至关重要.</p><p>修改后的数据包现在包含源 IP 地址 <code>20.20.20.20</code> 和目标 IP 地址 <code>30.30.30.30</code>, 并经过互联网上的多个路由器进行传输和转发. 这些路由器根据数据包中的目标 IP 地址来决定如何将数据包发送到下一个目的地. 到这里<strong>发送流程</strong>结束.</p><h3 id="响应流程"><a href="#响应流程" class="headerlink" title="响应流程"></a>响应流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_vKx8zBTH.webp" alt="20241229154732_vKx8zBTH.webp"></p><p>当接收端处理完你的请求并发送响应时, 它会在其构造的数据包中填写自己的 IP 地址作为源地址, 即 <code>30.30.30.30</code>, 并将目标地址设置为你的公网 IP 地址, 即 <code>20.20.20.20</code>. 这个修改后的数据包会被发送回 NAT 路由器.</p><p>NAT 路由器接收到来自公网的响应后, 会检查其内部维护的映射记录表. 在这个表中, 它会找到一个与公网 IP 地址 <code>20.20.20.20</code> 相关联的私有 IP 地址, 即之前留下的映射记录 <code>192.168.31.2 -&gt; 20.20.20.20</code>.</p><p>NAT 路由器根据这条映射信息知道原始数据包是从你的电脑发送出去的. 因此, 它会执行<strong>目的地址转换</strong> (Destination Network Address Translation, DNAT) 功能, 将数据包的目标 IP 地址从公网 IP 地址 <code>20.20.20.20</code> 修改为内部网络的私有 IP 地址 <code>192.168.31.2</code>.</p><p>随后, NAT 路由器会将这个修改后的数据包转发回局域网内的你的电脑. 你的电脑收到数据包后, 会根据其目标 IP 地址识别出这是一个针对它的响应.</p><blockquote><p>NAT (网络地址转换) 在用户毫不知情的情况下, 隐秘地改变了 IP 数据包中的源地址和目标地址. 对于原始的发送者和接收者而言, 这种更改是完全看不见的. 这正是 NAT 运作的核心机制：**它确保了即使是使用私有 IP 地址的设备也能够安全、有效地与互联网上的任何公网 IP 进行通信, 而无需每个设备都有一个唯一的公网 IP 地址. **</p></blockquote><hr><h2 id="NAPT-的工作原理"><a href="#NAPT-的工作原理" class="headerlink" title="NAPT 的工作原理"></a>NAPT 的工作原理</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>在了解了 NAT 的工作原理后, 你可能会产生一个疑问：局域网中不仅有你的电脑, 还有其他设备如手机、平板等, 它们各自的映射记录也将是 <code>192.168.xx.xx -&gt; 20.20.20.20</code>. 这看起来没问题, 但当我们需要接收响应时, NAT 路由器将如何知道哪个响应应该发送给哪一个内部的设备呢？</p><p>这个问题确实很重要, 因为如果 NAT 无法区分内部网络的多个连接, 那么它就无法正确地将外部的响应数据包转发回特定的内部设备. 为了解决这个问题, 我们需要引入额外的信息来标识局域网内的每个网络连接.</p><p>一个简单而有效的解决方案是使用端口. 每个内部设备在发起网络请求时, 都会分配一个唯一的端口号, 这通常是通过传输控制协议 (TCP) 或用户数据报协议 (UDP) 的源端口实现的. 这样, NAT 路由器就可以根据这些端口号来区分不同的内部设备, 即使它们的私有 IP 地址相同.</p><h3 id="NAPT-原理解析"><a href="#NAPT-原理解析" class="headerlink" title="NAPT 原理解析"></a>NAPT 原理解析</h3><p>IP 数据包 (在网络层的协议) 不包含端口号信息. 端口号信息是存储在传输层 (如 TCP 或 UDP) 的数据报头中的. 当计算机发送一个 IP 数据包时, 它会在网络层包含源 IP 地址和目标 IP 地址. 但在传输层, TCP 或 UDP 协议会添加额外的头部, 其中包括源端口号和目标端口号.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_hDXcxREr.webp" alt="20241229154732_hDXcxREr.webp"></p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_RQZrPRqR.webp" alt="20241229154732_RQZrPRqR.webp"></p><p>于是流程就变成了下面这样子. 当你准备发送数据包的时候, 你的电脑内核协议栈就会先构造一个 TCP 或者 UDP 数据报头, 里面写入端口号, 比如发送端口是<code>5000</code>, 接收端口是<code>3000</code>, 然后在这个基础上, 加入 IP 数据报头, 填入发送端和接收端的 IP 地址. 那数据包长这样.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_2jxPYBwL.webp" alt="20241229154732_2jxPYBwL.webp"></p><hr><h3 id="数据包传输流程"><a href="#数据包传输流程" class="headerlink" title="数据包传输流程"></a>数据包传输流程</h3><p>假设, <strong>发送端</strong>IP 地址填的就是<code>192.168.31.2</code>, <strong>接收端</strong>IP 地址就是<code>30.30.30.30</code>. 将数据包发到 NAT 路由器中. 此时 NAT 路由器会将 IP 数据包里的<strong>源 IP 地址和端口号</strong>修改一下, 从<code>192.168.31.2:5000</code>改写成<code>20.20.20.20:6000</code>. 并且还会在 NAT 路由器内部留下一条 <code>192.168.31.2:5000 -&gt; 20.20.20.20:6000</code>的映射记录. 之后数据包经过公网里各个路由器的转发, 发到了接收端<code>30.30.30.30:3000</code>, 到这里<strong>发送流程</strong>结束.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_xCgdZUIZ.webp" alt="20241229154732_xCgdZUIZ.webp"></p><p>当接收端准备发送响应时, 它会在数据包中写入原始请求源的 IP 地址 (即你的公网 IP <code>20.20.20.20</code>) 作为源地址, 以及目标 IP 地址 (即 NAT 路由器的内部端口 <code>6000</code>) , 因为这是它接收到数据的来源. 然后, 这个修改后的数据包会被发送回 NAT 路由器.</p><p>NAT 路由器在处理这个响应时, 会查找到之前留下的映射记录：<code>192.168.31.2:5000 -&gt; 20.20.20.20:6000</code>. 基于这个记录, NAT 会将数据包的目的 IP 地址和端口从 <code>20.20.20.20:6000</code> 修改回你的私有网络内的 IP 地址 <code>192.168.31.2</code> 以及对应的端口号 <code>5000</code>, 之后将其转发给你的电脑上.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_pOnKvvT7.webp" alt="20241229154732_pOnKvvT7.webp"></p><p>如果局域网内有多个设备, 他们就会映射到不同的公网端口上, 毕竟端口最大可达 65535, 完全够用. 这样大家都可以相安无事. 像这种同时转换 <strong>IP 和端口</strong>的技术, 就是<strong>NAPT</strong> (Network Address Port Transfer , <strong>网络地址端口转换</strong> ) .</p><hr><h3 id="Ping-命令"><a href="#Ping-命令" class="headerlink" title="Ping 命令"></a>Ping 命令</h3><p>这里出现了一个疑问. 通常我们认为只有那些包含端口信息的网络协议才能被 NAT (网络地址转换) 识别并进行转发. 然而, 这如何解释 ping 命令的工作原理呢？ping 命令是基于 ICMP 协议的, 而 ICMP 协议的报文中并不包含端口信息. 尽管如此, 我们仍然能够正常地使用 ping 命令与公网上的机器通信, 并接收到回应包. 这是怎么回事呢？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_e6uSRrHO.webp" alt="20241229154732_e6uSRrHO.webp"></p><p><strong>实上针对 ICMP 协议, NAT 路由器做了特殊处理. ping 报文头里有个<code>Identifier</code>的信息, 它其实指的是放出 ping 命令的进程 id</strong>. 对 NAT 路由器来说, 这个<code>Identifier</code>的作用就跟<code>端口</code>一样.</p><blockquote><p>另外, 当我们去抓包的时候, 就会发现有两个<code>Identifier</code>, 一个后面带个<code>BE (Big Endian)</code>, 另一个带个<code>LE (Little Endian)</code>. 其实他们都是<strong>同一个数值</strong>, 只不过<strong>大小端不同</strong>, 读出来的值不一样. 就好像同样的数字 345, 反着读就成了 543. 这是为了兼容不同操作系统 (比如 linux 和 Windows) 下大小端不同的情况.</p></blockquote><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_c6rHtCc5.webp" alt="20241229154732_c6rHtCc5.webp"></p><hr><h2 id="内网穿透"><a href="#内网穿透" class="headerlink" title="内网穿透"></a>内网穿透</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>当使用 NAT (网络地址转换) 上网时, 一个基本的前提是内网机器必须主动向公网 IP 发起请求, 这样 NAT 才能将内网的 IP 地址和端口映射到外网的 IP 地址和端口上. 然而, 如果公网上的机器试图主动连接到内网机器, 这个请求将会在 NAT 路由器处受阻.</p><p>由于 NAT 路由器上没有相应的 IP 地址和端口映射记录, 因此它不会将数据转发到内网的任何机器.</p><p>例如, 假设你在家里电脑上启动了一个 HTTP 服务, 地址是<code>192.168.31.2:5000</code>, 但你在公司办公室试图通过手机访问这个服务时, 会发现无法连接. 这就引出了一个问题：有没有办法让外网机器访问内网的服务呢？答案是肯定的. 有一句话说得好, <strong>任何问题都可以通过增加一个中间层来解决, 如果不行, 那就再加一层.</strong> 在这个情况下, 这个原则同样适用.</p><p>归根结底, 由于 NAT (网络地址转换) 的存在, 我们通常只能从内网向外网主动发起连接. 如果内网机器没有首先建立连接, NAT 设备就不会创建相应的映射关系, 而没有这个映射关系, 外网的数据就无法被转发到内网.</p><p>为了解决这个问题, 我们可以在公网上部署一台服务器 x, 并为其分配一个可访问的域名. 然后, 让内网的服务主动连接到这台服务器 x, 这样 NAT 路由器就会建立相应的映射关系. 之后, 任何外网的访问请求都可以发送到服务器 x, 服务器 x 再将这些请求转发到内网机器, 并将内网机器的响应返回给请求者, 从而实现数据的双向通信. 这个过程就是我们所说的内网穿透.</p><p>至于服务器 x, 你并不需要自己搭建, 市面上已经有许多现成的内网穿透服务. 比如使用某壳提供的内网穿透解决方案, 或者开源的内网穿透服务:</p><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2ZhdGVkaWVyL2ZycA=="><strong>frp (Fast Reverse Proxy)</strong></a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2luY29uc2hyZXZlYWJsZS9uZ3Jvaw=="><strong>ngrok</strong></a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2VoYW5nLWlvL25wcw=="><strong>nps (Network Proxy Server)</strong></a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2ZmYXkvbGFucHJveHk="><strong>lanproxy</strong></a></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_y9pPR1xV.webp" alt="20241229154732_y9pPR1xV.webp"></p><p>到这里, 我们就可以回答这个问题：<strong>为什么我在公司里访问不了家里的电脑</strong>？</p><p>那是因为家里的电脑在局域网内, 局域网和广域网之间有个 NAT 路由器. 由于 NAT 路由器的存在, 外网服务无法主动连通局域网内的电脑.</p><hr><h3 id="即时通讯软件的网络通信机制"><a href="#即时通讯软件的网络通信机制" class="headerlink" title="即时通讯软件的网络通信机制"></a>即时通讯软件的网络通信机制</h3><p>我家电脑位于我们小区的局域网中, 而老婆闺蜜家的电脑则位于她们小区的局域网内. 既然两台电脑都处于各自的局域网中, 且 NAT 只允许内网设备主动连接到外网, 那我电脑上登录的 QQ 是如何与老婆闺蜜电脑上的 QQ 建立连接的呢？</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_fWxM3JVM.webp" alt="20241229154732_fWxM3JVM.webp"></p><p>这种提问方式隐含了一个错误的假设, 即认为两个 QQ 客户端应用能够直接建立点对点的连接. 但实际情况并非如此, 两个 QQ 客户端之间的通信是间接的, 它们之间还有一个中间环节, 那就是通讯软件服务器:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_aI9dT9wY.webp" alt="20241229154732_aI9dT9wY.webp"></p><p>换言之, 当两个位于内网的 QQ 客户端登录时, 它们都会主动与公网上的通讯服务器建立连接, 此时各自的 NAT 路由器会记录下相应的映射条目. 当一个客户端通过 QQ 发送消息时, 这些数据首先会传输到服务器, 然后由服务器将其转发到另一个客户端. 反之亦然, 通过这种机制, 两台处于内网的计算机得以实现数据的交换.</p><hr><h3 id="点对点-P2P-网络通信"><a href="#点对点-P2P-网络通信" class="headerlink" title="点对点 (P2P) 网络通信"></a>点对点 (P2P) 网络通信</h3><p>在 P2P 下载等双向通信场景中, 通常会涉及到 NAT 穿越的问题. 假设还是 A 和 B 两个<strong>局域网内</strong>的机子, A 内网对应的 NAT 设备叫<code>NAT_A</code>, B 内网里的 NAT 设备叫<code>NAT_B</code>, 和一个第三方服务器<code>Server</code>.</p><p>通过第三方服务器帮助两台位于不同局域网的机器 A 和 B 建立连接的简化流程如下：</p><ol><li><strong>Step1 + Step2</strong>: A 机器首先主动连接第三方服务器, 其 NAT 设备 (NAT_A) 记录下 A 的内网和外网地址的映射关系. 同时, <code>Server</code> 记下了 A 的外网 IP 和端口.</li><li><strong>Step3 + Step4</strong>: B 机器也进行同样的操作, 主动连接服务器, NAT_B 记录下 B 的内网和外网地址映射, <code>Server</code> 同样获取了 B 的外网 IP 和端口.</li><li><strong>Step5 + Step6 + Step7</strong>: 关键步骤来了, <code>Server</code> 通知 A, 让 A 主动向 B 的外网 IP 和端口发送 UDP 消息. 此时 NAT_B 收到这个 A 的 UDP 数据包时, 这时候<strong>根据 NAT_B 的设置不同</strong> 可能存在 2 种情况:<ol><li>NAT_B 上没有关于 A 的映射关系导致直接丢包, 不过丢包没关系, 这个操作的 <strong>目的是</strong> 给 NAT_A 上留下 <strong>有关 B 的映射关系</strong>;</li><li>有可能因为延迟或消息达到的顺序问题, NAT_B 已经有了关于 A 的映射关系, 此时 A 和 B 就能正常通信了;</li></ol></li><li><strong>Step8 + Step9 + Step10</strong>: 跟 5,6,7 步骤一样, <code>Server</code>通知 B, 让 B 向 A 的外网 IP 和端口发送 UDP 消息. NAT_B 上也留下了关于 A 的映射关系, 这时候由于之前 NAT_A 上有过关于 B 的映射关系, 此时 NAT_A 就能正常接受 B 的数据包, 并将其转发给 A. 到这里 A 和 B 就能正常进行数据通信了. 这就是所谓的 <strong>NAT 打洞</strong>.</li><li><strong>Step11</strong>: 注意, 之前我们都是用的 <strong>UDP 数据包</strong>, 目的只是为了在两个局域网的 NAT 上<strong>打个洞</strong>出来, 实际上大部分应用用的都是 TCP 连接, 所以, 这时候我们还需要 A 主动向 B 发起 TCP 连接(比如我们熟知的 <strong>WireGuard</strong>). 到此, 我们就完成了两端之间的通信.</li></ol><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_fq5jEgvm.webp" alt="20241229154732_fq5jEgvm.webp"></p><p>可能会有这样的疑问：既然 UDP 已经使用了一个端口, 那么 TCP 再使用相同的端口, 会不会出现端口重复占用的错误？</p><p>实际上, 这种情况并不会发生. 端口重复占用的错误通常出现在两个 TCP 连接没有使用 <strong>SO_REUSEADDR</strong> 选项, 并且尝试在同一个 IP 地址上使用相同的端口. 然而, UDP 和 TCP 之间并不会引发这样的错误.</p><p>原因在于, 在 Linux 内核中, 网络数据包是根据五元组 (<strong>传输协议</strong>、<strong>源 IP</strong>、<strong>目的 IP</strong>、<strong>源端口</strong>、<strong>目的端口</strong>) 来唯一确定接收者的. 当两个连接的五元组完全相同时, 内核就无法判断数据应该发送给哪个连接. 但由于 UDP 和 TCP 的 <strong>传输协议</strong> 不同, 即使它们使用了相同的 IP 地址和端口, 五元组也是不同的.</p><p>因此, UDP 和 TCP 可以共享相同的端口而不会发生冲突.</p><hr><h3 id="UDP-打洞的局限性"><a href="#UDP-打洞的局限性" class="headerlink" title="UDP 打洞的局限性"></a>UDP 打洞的局限性</h3><p>从 2019 年开始, 一些传统的网络穿透技术 (如 pwnat) 不再有效. <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL3NhbXlrL3B3bmF0">pwnat</a> 是一种创新的网络穿透方法, 它允许设备在没有代理服务器、第三方服务器、UPnP、DMZ 设置、源端口欺骗或 DNS 转换的情况下, 实现 NAT 环境下的点对点通信.</p><p><strong>工作原理</strong></p><p><strong>1. 服务端的操作</strong></p><ul><li><p><strong>模拟发送请求：</strong> 服务端启动后, 会不断向一个固定的、无法访问的 IP 地址 (比如 3.3.3.3) 发送 <strong>ICMP 回显请求包</strong> (ICMP echo request) .</p><ul><li>注意：3.3.3.3 只是一个占位符, 服务端不是真的期待从这个地址收到任何回应.</li><li>这些请求包会被服务端的 NAT 记录为 “有一个数据包正在发往 3.3.3.3, 等待返回数据”: <code>服务端内网 IP:端口 → NAT 公网 IP:端口 → 3.3.3.3</code></li></ul></li><li><p><strong>核心目标：</strong></p><p>服务端的 NAT 设备在等待这些 ICMP 回显请求包的响应, 但由于 3.3.3.3 并不存在, 响应包自然不会到达.</p></li></ul><p><strong>2. 客户端的操作</strong></p><ul><li><strong>伪装成一个跳跃点：</strong> 当客户端希望连接服务端时, 客户端需要知道 <strong>服务端的 IP 地址</strong>. 然后, 客户端发送一个 <strong>ICMP 超时包</strong> (ICMP Time Exceeded) 到服务端.<ul><li>这个超时包伪装成某个网络节点的响应, 告诉服务端：“你发往 3.3.3.3 的 ICMP 回显请求包超时了, 无法到达目的地. ”</li><li>关键点在于, 客户端发送的超时包中, 包含了服务端原始发送的 ICMP 回显请求包的完整信息 (原始数据包的内容) .</li></ul></li></ul><p><strong>3. NAT 的行为</strong></p><ul><li><p><strong>识别匹配的请求：</strong> 当客户端发送的 ICMP 超时包到达服务端的 NAT 时, NAT 会检查包的内容, 发现里面嵌套了服务端最初发往 3.3.3.3 的 ICMP 请求包.</p></li><li><p><strong>智能转发：</strong> NAT 认为这个 ICMP 超时包是和服务端最初的 ICMP 请求包相关联的回应, 于是将包转发给 NAT 后面的服务端.</p></li></ul><p><strong>4. 服务端获取客户端的 IP 地址</strong></p><ul><li><p><strong>提取 IP 信息：</strong> 服务端收到客户端伪装的 ICMP 超时包后, 从中提取出客户端的真实 IP 地址和端口.</p></li><li><p><strong>完成连接：</strong> 服务端和客户端此时可以通过提取的地址建立点对点连接.</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_loEPi3DG.webp" alt="20241229154732_loEPi3DG.webp"></p><ul><li><p>服务端(<code>192.168.1.2</code>) 启动后它会开始向固定地址 3.3.3.3 发送 <strong>固定的 ICMP 请求数据包</strong>, 同时会创建一个 NAT 记录: <code>ICMP: 192.168.1.2:Identifier -&gt; 40.40.40.40:xxx -&gt; 3.3.3.3</code>, 这个请求数据包在经过 NAT 转换后的内容为:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">IP Header</span><br><span class="line">------------------------</span><br><span class="line">源 IP: 40.40.40.40</span><br><span class="line">目标 IP: 3.3.3.3</span><br><span class="line"></span><br><span class="line">ICMP Header</span><br><span class="line">-------------------</span><br><span class="line">Type: 8 (Echo Request)</span><br><span class="line">Code: 0</span><br><span class="line">Identifier: 1111 (用于区分会话, pwnat 使用的固定值, 方便与客户端发送的 ICMP 超时包匹配)</span><br><span class="line">Sequence Number: 2222 (用于追踪包的顺序, pwnat 使用的固定值, 方便与客户端发送的 ICMP 超时包匹配)</span><br></pre></td></tr></tbody></table></figure></li><li><p>客户端(<code>192.168.31.2</code>) 在只知道服务端对应的公网 IP (<code>40.40.40.40</code>) 的情况下发送 <strong>伪造的超时包</strong>, 经过 NAT 转换后的内容为:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">IP Header (伪造的超时包)</span><br><span class="line">------------------------</span><br><span class="line">源 IP: 20.20.20.20</span><br><span class="line">目标 IP: 40.40.40.40</span><br><span class="line"></span><br><span class="line">ICMP Header (超时包)</span><br><span class="line">-------------------</span><br><span class="line">Type: 11 (Time Exceeded)</span><br><span class="line">Code: 0</span><br><span class="line">Data: (服务端原始发出的 ICMP 回显请求的 IP 和 ICMP 头)</span><br><span class="line">		IP Header</span><br><span class="line">    ------------------------</span><br><span class="line">    源 IP: 40.40.40.40</span><br><span class="line">    目标 IP: 3.3.3.3</span><br><span class="line"></span><br><span class="line">    ICMP Header</span><br><span class="line">    -------------------</span><br><span class="line">    Type: 8 (Echo Request)</span><br><span class="line">    Code: 0</span><br><span class="line">    Identifier: 1111 (用于区分会话, pwnat 使用的固定值, 方便与客户端发送的 ICMP 超时包匹配)</span><br><span class="line">    Sequence Number: 2222 (用于追踪包的顺序, pwnat 使用的固定值, 方便与客户端发送的 ICMP 超时包匹配)</span><br></pre></td></tr></tbody></table></figure><p>因为 ICMP 的请求和响应包匹配依赖于 <strong>IP 层的源 IP 和目标 IP</strong> 以及 <strong>ICMP 数据包头中的字段</strong>：Type、Code、Identifier 和 Sequence Number. 最主要的是构建 Identifier 和 Sequence Number, 因为前面服务器端发送的都是固定的 ICMP 请求数据包, 所以这里就非常容易伪造超时包.</p></li><li><p>伪造的数据包首先达到服务器前面的 NAT 设备, 在检查内后发现与服务端之前发往 <code>3.3.3.3</code> 的请求相关联, 认为这是一个合法的响应.</p></li><li><p>因为 NAT 设备 已经有相关的 NAT 记录了(<code>ICMP: 2.168.1.2:Identifier -&gt; 40.40.40.40:xxx -&gt; 3.3.3.3</code>), 就会把目标 IP 为 <code>40.40.40.40</code> 的数据包转发给 <code>192.168.1.2</code>.</p></li></ul><hr><h2 id="NAT-类型"><a href="#NAT-类型" class="headerlink" title="NAT 类型"></a>NAT 类型</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>NAT 分为两大类, 基本的 NAT 和 NAPT (即 <strong>端口 NAT</strong>, 英文全称为 <strong>Network Address/Port Translator</strong>) .</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_JGgmpHKR.webp" alt="20241229154732_JGgmpHKR.webp"></p><h3 id="基本-NAT-与-NAPT"><a href="#基本-NAT-与-NAPT" class="headerlink" title="基本 NAT 与 NAPT"></a>基本 NAT 与 NAPT</h3><h4 id="基本-NAT"><a href="#基本-NAT" class="headerlink" title="基本 NAT"></a>基本 NAT</h4><p>这种类型的 NAT (Basic NAT) 主要是进行 IP 地址的转换, 它将私有网络中的 IP 地址映射到公网上的一个或多个公网 IP 地址. 它的可以分为:</p><ul><li><strong>静态 NAT (Static NAT)</strong>: 静态 NAT 是一种将内部网络的私有 IP 地址映射到一个固定的公有 IP 地址的方法. 这种映射关系是由网络管理员手动配置的, 并且在映射建立后不会改变.特点为：<ul><li><strong>一对一映射</strong>：每个私有 IP 地址都对应一个唯一的公有 IP 地址.</li><li><strong>永久性</strong>：映射关系是永久性的, 除非管理员手动更改配置.</li></ul></li><li><strong>动态 NAT (Dynamic NAT)</strong>: 动态 NAT 是一种将内部网络的私有 IP 地址动态地映射到公有 IP 地址池中的地址的方法. 映射关系不是永久固定的, 而是根据需要动态分配和释放. 特点为：<ul><li><strong>多对多映射</strong>：私有 IP 地址可以映射到公有 IP 地址池中的任何一个地址.</li><li><strong>临时性</strong>：映射关系在会话结束时释放, IP 地址可以重新分配给其他内部主机.</li></ul></li></ul><h4 id="NAPT"><a href="#NAPT" class="headerlink" title="NAPT"></a>NAPT</h4><p>也称为端口 NAT (Network Address/Port Translator) , 是一种更高级的 NAT 形式. 它不仅转换 IP 地址, 还转换传输层协议的端口号. NAPT 允许多个内部私有 IP 地址共享同一个公网 IP 地址, 通过不同的端口号来区分不同的数据流. 这是最常见的 NAT 类型, 广泛用于家庭和小型企业网络中, 因为它可以有效地解决公网 IP 地址不足的问题.</p><p>NAPT 又分为**锥型 (Cone) 和对称型 (Symmetric)**：</p><ul><li><p><strong>锥型 NAT (Cone NAT)</strong>: 它在 NAT 转换时, 内部主机的私有 IP 地址和端口号与公网 IP 地址和端口号之间的映射关系是一致的, 不依赖于通信的目的地址.</p><ul><li><strong>特点</strong>：<strong>映射一致性</strong>, 一旦内部主机的私有端口映射到公网的一个端口, 无论目的地址是什么, 这个映射关系都保持不变.</li></ul><p>如果 client A 使用内网端口 123 与 server A 通信, 并且 NAT 将公网端口 456 分配给 client A 的端口 123, 那么当 client A 使用同一个端口 123 向任何其他服务器 (如 server B) 发起通信时, NAT 仍然会将公网端口 456 分配给 client A 的端口 123.</p></li><li><p><strong>对称型 NAT (Symmetric NAT)</strong>: 是一种更严格的 NAPT, 它在进行 NAT 转换时, 不仅考虑内部主机的私有 IP 地址和端口号, 还考虑通信的目的地址. 对于每个新的目的地, NAT 可能会分配一个新的公网端口.</p><ul><li><strong>特点</strong>：<strong>映射依赖性</strong>, 映射关系依赖于目的地址. 即使内部主机的源端口相同, 如果目的地址不同, NAT 也会分配不同的公网端口.</li></ul><p>如果 client A 已经使用内网端口 123 与 server A 通信, 并且 NAT 将公网端口 456 分配给这个通信, 那么当 client A 想要与 server B 通信时, NAT 可能会分配一个新的公网端口 (如 789) 给同一个内网端口 123.</p></li></ul><p><strong>锥型 NAT 与 对称型 NAT 的区别：</strong></p><ul><li>**锥型 NAT (Cone NAT)**：映射关系与目的地址无关, 只要源地址 (内部主机的 IP 和端口) 相同, 映射关系就相同.</li><li><strong>对称型 NAT</strong>：映射关系不仅与源地址有关, 还与目的地址有关. 即使是同一个源地址, 如果目的地址不同, 映射关系也可能不同.</li></ul><hr><h3 id="锥型-NAT-分类"><a href="#锥型-NAT-分类" class="headerlink" title="锥型 NAT 分类"></a>锥型 NAT 分类</h3><p>锥形 NAT 又可分为：<strong>完全圆锥体 (Full Cone NAT)<strong>、</strong>受限制的圆锥体 (Restricted Cone NAT)<strong>、</strong>端口受限制的圆锥体 NAT (Port Restricted Cone NAT) 三种</strong>.</p><h4 id="完全圆锥体-NAT"><a href="#完全圆锥体-NAT" class="headerlink" title="完全圆锥体 NAT"></a>完全圆锥体 NAT</h4><p>Full Cone NAT</p><p><strong>特性</strong></p><ul><li><strong>最宽松的限制</strong>;</li><li>内网客户端与外部设备通信时, NAT 会创建一个映射 (内部 IP 和端口到外部 IP 和端口的映射) ;</li><li><strong>任何外部设备</strong>, 只要知道这个映射的外部 IP 和端口, 都可以通过该端口直接与内网客户端通信;</li></ul><p><strong>规则</strong></p><ul><li><p>内网客户端主动发起连接时, NAT 创建的映射是固定的：<strong>内部 IP:端口 → 外部 IP(路由器公网 IP):端口</strong>;</p></li><li><p>外部设备只需知道外部的 IP 和端口, 就能发包到内网客户端, <strong>无需内网客户端与之通信过</strong>;</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_VtTs6uzK.webp" alt="20241229154732_VtTs6uzK.webp"></p><p>内部服务 <code>192.168.31.2:123</code> 主动访问 <code>30.30.30.30:789</code> 时. 创建的 NAT 记录为:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内部IP:端口 (192.168.31.2:123) → 外址IP:端口 (20.20.20.20:456)</span><br></pre></td></tr></tbody></table></figure><p>此时 <strong>任何外部服务</strong> 都可以通过 <code>20.20.20.20:456</code> 访问到内部的 <code>192.168.31.2:123</code>. 因为 NAT 设备并不关心报文的源 IP 和源端口号 (即报文来自谁) , 只要收到 <strong>匹配 NAT 记录的报文</strong>, 都能发送到内网设备.</p><p>此时内部服务 <code>192.168.31.2:123</code> 访问其他的服务比如 <code>40.40.40.40:1234</code>, 因为源地址相同(<code>192.168.31.2:123</code>) 的缘故, NAT 则不会再创建映射: <strong>NAT 不会为同一个内网地址和端口 (192.168.1.10:12345)</strong> 针对不同目标服务器创建多个映射.</p><hr><h4 id="受限制的圆锥体-NAT"><a href="#受限制的圆锥体-NAT" class="headerlink" title="受限制的圆锥体 NAT"></a>受限制的圆锥体 NAT</h4><p>Restricted Cone NAT</p><p><strong>特性</strong></p><ul><li><strong>中等限制</strong>;</li><li>内网客户端发起连接时, NAT 会创建一个映射;</li><li><strong>只有客户端主动通信过的外部设备</strong>, 才能通过该映射访问内网客户端(<strong>记录允许的 IP</strong>).</li></ul><p><strong>规则</strong></p><ul><li>内网客户端发起连接时, NAT 创建映射：<strong>内部 IP:端口 → 外部 IP(路由器公网 IP):端口 → 允许目标 IP</strong></li><li>只有客户端通信过的外部设备 (即目标 IP 在 NAT 映射记录中且通讯过的外部设备, 记还要匹配允许的 IP) , 才能通过映射访问客户端.</li><li>外部设备发来的数据包, <strong>必须与客户端通信的外部 IP 和端口 一致</strong>.</li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_NPRlSHn6.webp" alt="20241229154732_NPRlSHn6.webp"></p><p>内部服务 <code>192.168.31.2:123</code> 主动访问 <code>30.30.30.30:789</code> 时. 创建的 NAT 记录为:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网IP:端口 (192.168.31.2:123) → 外部IP:端口 (20.20.20.20:456) → 允许目标IP (30.30.30.30)</span><br></pre></td></tr></tbody></table></figure><p>此时只有来自 <code>30.30.30.30</code> 任意端口的请求才能通过 <code>20.20.20.20:456</code> 访问到内部的 <code>192.168.31.2:123</code>.</p><p>比如来自 <code>40.40.40.40</code> 的请求则不能访问内部服务, <strong>因为它没有在允许目标地址中(内网设备正在与哪些外部设备通信)</strong> 此时必须由内部服务先发起请求(<code>40.40.40.40:xxx</code>) 以增加新的允许的目标 IP 记录才能让 Server C 访问:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网IP:端口 (192.168.31.2:123) → 外部IP:端口 (20.20.20.20:456) → 允许目标IP (30.30.30.30 &amp; 40.40.40.40)</span><br></pre></td></tr></tbody></table></figure><blockquote><p>这样的 NAT 安全性有一定的提高, 但是也提高了打洞难度. 两台内网设备需要互相给对方发送一个报文, 才能打洞成功.</p></blockquote><hr><h4 id="端口受限制的圆锥体-NAT"><a href="#端口受限制的圆锥体-NAT" class="headerlink" title="端口受限制的圆锥体 NAT"></a>端口受限制的圆锥体 NAT</h4><p>Port Restricted Cone NAT</p><p><strong>特性</strong></p><ul><li><strong>最严格的限制</strong>;</li><li>内网客户端发起连接时, NAT 会创建一个映射;</li><li><strong>只有客户端主动通信过的外部设备</strong>, 才能通过该映射访问内网客户端(<strong>记录允许的 IP + Port</strong>).</li></ul><p><strong>规则</strong></p><ul><li><p>内网客户端发起连接时, NAT 创建映射：<strong>内部 IP:端口 → 外部 IP(路由器公网 IP):端口 → 允许的目标 IP+端口</strong></p></li><li><p>外部设备发来的数据包, <strong>必须与客户端通信的外部 IP 和端口 一致</strong>.</p></li><li><p>比受限制的圆锥体 NAT 增加了一层对 <strong>端口</strong> 的限制.</p></li></ul><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_fwclbrwC.webp" alt="20241229154732_fwclbrwC.webp"></p><p>内部服务 <code>192.168.31.2:123</code> 主动访问 <code>30.30.30.30:789</code> 时. 创建的 NAT 记录为:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网IP:端口 (192.168.31.2:123) → 外部IP:端口 (20.20.20.20:456) → 允许的目标IP:端口 (30.30.30.30:789)</span><br></pre></td></tr></tbody></table></figure><p>此时来自 <code>30.30.30.30</code> <strong>且端口是</strong> <code>789</code> 的请求才能通过 <code>20.20.20.20:456</code> 访问到内部的 <code>192.168.31.2:123</code>.</p><p>同理如果想让 <code>30.30.30.30:987</code> 也能访问 <code>192.168.31.2.123</code>, 则必须 <strong>由内部服务先发起请求以新增允许的目标 IP+端口记录</strong>:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网IP:端口 (192.168.31.2:123) → 外部IP:端口 (20.20.20.20:456) → 允许的目标IP:端口 (30.30.30.30:789 &amp; 30.30.30.30:987)</span><br></pre></td></tr></tbody></table></figure><hr><h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>与完全圆锥形 NAT 相比, 受限圆锥形 NAT 在内网设备向外发送报文时, 路由器除了生成 NAT 记录, 还会根据报文的目的 IP, <strong>记录下内网设备正在与哪些外部设备通信.</strong></p><p>这样, 只有内网设备先发送报文给外部设备, 外部设备回应的报文, 才会被转发到内网设备. 而其他外部设备发送过来的报文, 即使匹配 NAT 记录, 也无法发送到内网设备.</p><p>而 <strong>受限制的圆锥体 NAT</strong> 与 <strong>端口受限制的圆锥体 NAT</strong> 最显著的区别是受限制的范围不一样: 后者相对于前者添加了 <strong>端口</strong> 的限制.</p><p>我们回顾一下 <strong>圆锥形 NAT</strong> 的定义: <strong>一旦内部主机的私有端口映射到公网的一个端口, 无论目的地址是什么, 这个映射关系都保持不变.</strong></p><p>而上述三种 <strong>圆锥形 NAT</strong> 的示例中自始至终都只有 1 条 NAT 记录, 不同的是 <strong>是否需要通过允许的地址来放行请求</strong>(与谁通信过的记录).</p><p>而 <strong>对称型 NAT</strong> 会同时根据内网设备出方向报文的 <strong>源 IP</strong>、<strong>源端口号</strong>、<strong>目的 IP</strong>、<strong>目的端口号</strong> 四个信息来建立 NAT 记录. 如果报文的目的 IP、目的端口号发生了变化, 映射到的外部端口号也会发生改变.</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_bXSwBRvy.webp" alt="20241229154732_bXSwBRvy.webp"></p><p>内网设备首先和 ServerA 通信, 内网 IP 和内网端口号会被映射为一个外部 IP 和外部端口号:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网IP:端口 (192.168.31.2:123) → 外部IP:端口 (20.20.20.20:456)</span><br></pre></td></tr></tbody></table></figure><p>接下来, 内网设备和另一台设备 (Server B)通信, 相同的内网 IP 和内网端口号, 又会被映射为另外一个外部端口号:</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">内网IP:端口 (192.168.31.2:123) → 外部IP:端口 (20.20.20.20:1456)</span><br></pre></td></tr></tbody></table></figure><p>我们以前文说的 [UDP 打洞](#点对点 (P2P) 网络通信) 为例, 说说为什么 <strong>对称型 NAT</strong> 无法成功打洞:</p><p>第一步都是一样的, A 和 B 同时向 Server 发送数据, 这时会分别在 NAT 设备上生成对应的 NAT 记录, 同时 Server 记录设备 A 和 B 对应的外网 IP 和端口:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_GlDOpN6t.webp" alt="20241229154732_GlDOpN6t.webp"></p><p>第二步是 Server 将对应的公网 IP 和外部端口发送给 A 和 B, 让它们互相访问:</p><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_Nj3UnNvf.webp" alt="20241229154732_Nj3UnNvf.webp"></p><p>此时在两端的 NAT 设备上各新增了一条 NAT 记录, 但因为 <strong>对称型 NAT</strong> 的特性, 因为目标地址不同(IP 或端口不同), 即使是同一个内网 IP 通过相同的端口发送数据包, 在 NAT 设备生成的 NAT 记录的外部端口也会不一样, 即这次生成的外部端口为 <code>1456</code>, 经 NAT 转换后, 源地址为: <code>20.20.20.20:1456</code> 目标地址为 <code>40.40.40.40:789</code>.</p><p>而 B 端 NAT 记录中的 <code>40.40.40.40:789</code> 只能被源地址为 <code>30.30.30.30:5678</code> 访问, 所以 A 发送给 B 的数据包被丢失, 导致打洞失败.</p><hr><h3 id="NAT-类型总结"><a href="#NAT-类型总结" class="headerlink" title="NAT 类型总结"></a>NAT 类型总结</h3><p>基本的 NAT, 它仅将内网主机的私有 IP 地址转换成公网 IP 地址, 但并不将 TCP/UDP 端口信息进行转换, 有动态与静态之区分. 由于现在大部分都属于另一种类型, 即 NAPT, 其中对称 NAT 打洞困难很高, 但是安全性好；而锥型 NAT 打洞比较容易.</p><p>实际上大部运营商提供的 <strong>光猫上网服务都是锥形 NAT</strong>. <strong>而光纤入户, 4G, 5G 网络, 公共 WiFi 等因为安全因素都是对称 NAT</strong>, 另外目前<strong>绝大多数的路由器都是非对称型 NAT(Cone NAT)</strong>. 只要请求链接的对方是非端口限制锥型 nat 就都能实现打洞 P2P 链接的.</p><p>只有双方都是 <strong>对称 NAT</strong> 是一定无法实现, 或一方对称一方是 端口限制锥型 NAT 的情况也无法实现打洞. 下面是各种类型打洞总结:</p><table><thead><tr><th>发送端 NAT 类型</th><th>接收端 NAT 类型</th><th>是否能打洞</th></tr></thead><tbody><tr><td>完全锥形 NAT</td><td>完全锥形 NAT</td><td>✅</td></tr><tr><td>完全锥形 NAT</td><td>IP 限制性锥形 NAT</td><td>✅</td></tr><tr><td>完全锥形 NAT</td><td>端口限制性锥形 NAT</td><td>✅</td></tr><tr><td>完全锥形 NAT</td><td>对称式 NAT</td><td>✅</td></tr><tr><td>IP 限制性锥形 NAT</td><td>IP 限制性锥形 NAT</td><td>✅</td></tr><tr><td>IP 限制性锥形 NAT</td><td>端口限制性锥形 NAT</td><td>✅</td></tr><tr><td>IP 限制性锥形 NAT</td><td>对称式 NAT</td><td>✅</td></tr><tr><td>端口限制性锥形 NAT</td><td>端口限制性锥形 NAT</td><td>✅</td></tr><tr><td>端口限制性锥形 NAT</td><td>对称式 NAT</td><td>🚫</td></tr><tr><td>对称式 NAT</td><td>对称式 NAT</td><td>🚫</td></tr></tbody></table><hr><h2 id="NAT-类型提升"><a href="#NAT-类型提升" class="headerlink" title="NAT 类型提升"></a>NAT 类型提升</h2><p>简单回顾一下, NAT 的 4 个类型, 它们分别是：<strong>NAT1、NAT2、NAT3、NAT4</strong></p><ul><li><strong>NAT1: Full Cone NAT</strong>, 全锥形 NAT, 这是最宽松的网络环境, 你想做什么, 基本没啥限制 IP 和端口都不受限</li><li><strong>NAT2: Address-Restricted Cone NAT</strong>, 受限锥型 NAT, 相比 NAT1, NAT2 增加了地址限制, 也就是 IP 受限, 而端口不受限</li><li><strong>NAT3: Port-Restricted Cone NAT</strong>, 端口受限锥型, 相比 NAT2, NAT3 增加了端口限制, 即 IP、端口都受限</li><li><strong>NAT4: Symmetric NAT</strong>, 对称型 NAT, 对称型 NAT 具有端口受限锥型的受限特性, 内部地址每一次请求一个特定的外部地址, 都会绑定到一个新的端口. 这种类型基本上就告别 P2P 了</li></ul><p>从 NAT1 到 NAT4 限制越来越多, 为了满足各种需求, 我们希望提升 NAT 类型. 提升 NAT 类型的好处有, 浏览网页、观看视频、游戏等更顺畅, 下载速度更稳定快速, 特别是对那些玩游戏的, 提升改善 NAT 类型后联机速度更快, 游戏体验明显提高.</p><h3 id="低延迟方案"><a href="#低延迟方案" class="headerlink" title="低延迟方案"></a>低延迟方案</h3><blockquote><p>想要游戏网速快, 延迟低, 就要 nat1, 公网, 桥接, unpn, 硬件 nat 加速</p></blockquote><ul><li><p><strong>修改光猫工作模式</strong></p><p>把光猫工作模式设置为桥接模式(需要超级管理员账号密码, 很多都是默认, 可以根据地区上网搜索, 新款的直接联系维修工人), 修改模式, 因为运营商一般默认设置光猫工作在路由模式. 无线路由器直接连到猫上就可以上网的, 那么光猫是路由模式. <strong>无线路由器需要 PPPoE 拨号上网的就是桥接模式</strong>.</p></li><li><p><strong>更改路由器设置</strong></p><p>启用无线路由器的 uPnP 功能, uPnP 大部分路由器都支持. 把要提升 NAT 类型的主机 IP 设置为静态, 然后开启 DMZ(通过路由器拨号, 路由器最好要刷机, 然后选择 NAT1 模式)</p></li></ul><h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ul><li><p>路由器层数越少, 越可能得到 NAT1 和 NAT2 类型</p></li><li><p>NAT1 是最宽松的网络环境, 基本没限制. NAT4 是最严格的网络环境, 可能会玩不了游戏、P2P 下载都没速度</p></li><li><p>如果光猫是桥接模式, 路由器拨号上网的有可能是 NAT2 和 NAT3, 对上网、游戏和下载都没有太多限制</p></li><li><p>拨号能获得公网 IP 的, 可以优化到 NAT1, 拨号获得内网 IP 基本是 NAT4</p></li><li><p>中国电信、中国联通宽带一般是公网 IP, 中国移动、中国广电、长宽等基本是内网 IP.</p><p>因为移动公网 ip 池比其他运营商少, 所以一般都用对称型 nat(节约公网 ip, 因为断开连接就会解绑映射, 不过绑定关系的建立和解除会消耗 cpu 性能, 所以移动打游戏时不时跳 ping)</p></li></ul><hr><h2 id="UPnP"><a href="#UPnP" class="headerlink" title="UPnP"></a>UPnP</h2><p><strong>UPnP</strong> (Universal Plug and Play) 是一种网络协议, 允许设备在网络中自动发现彼此, 并通过网络进行互操作. UPnP 使设备能够在网络中动态地发现、控制和配置其他设备, 而无需手动配置. 它广泛应用于家庭和办公环境中, 特别是在涉及到网络设备之间的协作时.</p><p><strong>主要特点</strong></p><ol><li><p><strong>自动发现</strong>：设备能够自动发现网络中的其他设备, 并能够与其进行通信. 例如, 智能家电、路由器、打印机等设备通过 UPnP 协议可以自动连接并相互配合.</p></li><li><p><strong>零配置</strong>：设备不需要用户进行复杂的网络配置 (如 IP 地址或端口映射) , UPnP 自动完成这些操作.</p></li><li><p><strong>设备控制</strong>：通过 UPnP 协议, 可以控制其他设备的功能, 如播放音乐、控制视频播放、网络摄像头的调节等.</p></li></ol><p><strong>UPnP 与 NAT 的关系</strong></p><p><strong>NAT</strong> (Network Address Translation) 是一种用于网络层的技术, 用来将内网设备的私有 IP 地址转换为公共 IP 地址, 使得多个设备能够共享一个公共 IP 地址. NAT 的典型应用场景是家庭路由器, 它将内网设备的请求映射到一个公共的 IP 地址上, 从而允许多个设备通过一个公共 IP 地址访问互联网.</p><p>然而, NAT 会带来一些问题, 尤其是当多个设备需要与外部设备进行点对点通信时. 例如, NAT 不会自动将外部设备的请求转发到内网设备, 因此需要手动配置端口映射 (端口转发) , 才能允许外部设备通过公共 IP 地址访问内网设备.</p><p><strong>UPnP 如何帮助 NAT 穿透</strong></p><p>具体来说, UPnP 协议允许内网设备通过 UPnP 协议自动请求路由器开放特定的端口并进行端口映射. 这使得内网设备能够在不手动配置端口转发的情况下, 允许外部设备访问内网服务, 突破了 NAT 的限制.</p><p><strong>UPnP 工作原理</strong></p><ol><li><p><strong>设备发现</strong>：内网设备 (如计算机、游戏主机、智能摄像头等) 通过发送 <strong>SSDP</strong> (Simple Service Discovery Protocol) 请求, 寻找支持 UPnP 协议的路由器.</p></li><li><p><strong>端口映射请求</strong>：内网设备通过 UPnP 向路由器发送请求, 要求路由器将指定的端口映射到设备的 IP 地址和端口上. 路由器通常会响应并将端口映射添加到 NAT 表中.</p></li><li><p><strong>外部访问</strong>：外部设备通过路由器的公共 IP 地址和开放的端口访问内网设备. 路由器根据 UPnP 配置的端口映射, 将请求转发到正确的内网设备.</p></li></ol><p><strong>NAT 穿透的应用场景</strong></p><p>UPnP 特别适用于以下几种情况：</p><ul><li><p><strong>VoIP 和视频通话</strong>：通过 UPnP 自动配置端口映射, 使得 VoIP 或视频会议可以穿透 NAT, 直接进行通信.</p></li><li><p><strong>P2P 文件共享</strong>：如 BitTorrent、在线游戏等, 内网用户通过 UPnP 自动创建端口映射, 使得外部用户能够直接连接到内网用户.</p></li><li><p><strong>游戏控制台</strong>：如 Xbox 或 PlayStation, 设备通过 UPnP 请求开放端口以便与其他设备进行联网对战.</p></li></ul><p><strong>UPnP 的安全性问题</strong></p><p>虽然 UPnP 提供了便利性, 但也存在一些安全隐患：</p><ol><li><p><strong>自动端口映射</strong>：如果 UPnP 功能启用, 路由器会允许内网设备自动请求端口映射, 这意味着恶意软件也可以通过 UPnP 请求将某些端口暴露到外部网络.</p></li><li><p><strong>未经授权的设备访问</strong>：未经授权的设备可能会通过 UPnP 请求端口映射, 允许外部攻击者访问内网设备.</p></li><li><p><strong>防火墙绕过</strong>：恶意软件可以通过 UPnP 自动打开端口, 从而绕过防火墙, 获取不应有的网络访问权限.</p></li></ol><p><strong>总结</strong></p><ul><li><p><strong>UPnP</strong> 是一种使设备能够自动发现并互相通信的协议, 广泛应用于家庭和办公网络中.</p></li><li><p><strong>NAT</strong> 会阻止外部设备直接访问内网设备, 但 <strong>UPnP</strong> 可以自动化端口映射过程, 解决 NAT 穿透问题.</p></li><li><p>UPnP 对 NAT 进行了优化, 使得内网设备能够自动配置路由器进行端口映射, 从而使外部设备能够访问内网服务.</p></li></ul><h2 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h2><p>上文中介绍的 NAT, 路由器会根据内网设备发出的报文, 自动形成 NAT 表项. 实际上, 用户还可以在路由器上手动配置端口映射关系, 让内网设备可被外部访问.</p><p>其中, <strong>DMZ</strong> 功能, 可以指定一台内网设备为 DMZ 主机. 到达路由器上的报文, 如果没有匹配 NAT 表项, 就会转发到 DMZ 主机. 从而使 DMZ 主机可被外部访问.</p><p>DMZ 功能能让一台内网设备上的所有端口, 都能被公网访问. 但这样做也影响了内网设备的安全性, 如果没有特殊需要, 不建议打开这一功能.</p><hr><h2 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_8PwJl34p.webp" alt="20241229154732_8PwJl34p.webp"></p><p>端口映射是指将外部网络 (通常是公共网络) 上的某个端口映射到内网设备上的相应端口, 允许外部用户通过路由器访问内网设备的服务. 它通常与 NAT 配合使用, 在路由器或防火墙上设置映射规则, 从而实现外部与内网的通信.</p><p><strong>举个例子</strong>：</p><ul><li><p>假设你有一台内部设备, IP 地址为 192.168.1.10, 并且这台设备上的某个服务监听的是端口 8080.</p></li><li><p>你希望外部用户能够访问这个服务, 但内网的 192.168.1.10 地址无法直接暴露给外部网络.</p></li><li><p>你可以在路由器上设置端口映射规则, 将外部的某个公共端口 (例如 80) 映射到内网设备的端口 8080. 这样, 外部用户访问路由器的 80 端口时, 实际上会转发到内网设备的 192.168.1.10:8080.</p></li></ul><p><strong>作用</strong>：</p><ul><li><p>通过端口映射, 外部设备可以访问内网中的特定设备或服务.</p></li><li><p>它用于解决 NAT 带来的“内网设备无法直接被外部访问”的问题.</p></li></ul><p><strong>NAT 和端口映射区别</strong></p><ul><li><p><strong>NAT</strong> 是一种技术或机制, 用于将私有 IP 地址转换为公共 IP 地址.</p></li><li><p><strong>端口映射</strong> 是 NAT 的一种配置, 通过设置规则, 将外部访问的端口映射到内网设备的端口, 使得外部设备能够访问内网设备.</p></li></ul><hr><h2 id="检测-NAT-类型"><a href="#检测-NAT-类型" class="headerlink" title="检测 NAT 类型"></a>检测 NAT 类型</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL3RhbGtpcS9weXN0dW4z">pystun3</a> 是一个用于获取 NAT 类型和外部 IP 的 Python STUN 客户端</p><p>安装：</p><figure class="highlight sh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pystun3</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_DglFSGxe.webp" alt="20241229154732_DglFSGxe.webp"></p><p>也可以使用自定义 STUN 服务器:</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pystun3 -d -H stun.l.google.com -P 19302</span><br></pre></td></tr></tbody></table></figure><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_msZYrKtd.webp" alt="20241229154732_msZYrKtd.webp"></p><p><strong>pystun3</strong> 默认的 STUN Server 在 <code>stun/__init__.py</code> 中定义:</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">STUN_SERVERS = (</span><br><span class="line">    <span class="string">'stun.ekiga.net'</span>,</span><br><span class="line">    <span class="string">'stun.ideasip.com'</span>,</span><br><span class="line">    <span class="string">'stun.voiparound.com'</span>,</span><br><span class="line">    <span class="string">'stun.voipbuster.com'</span>,</span><br><span class="line">    <span class="string">'stun.voipstunt.com'</span>,</span><br><span class="line">    <span class="string">'stun.voxgratia.org'</span></span><br><span class="line">)</span><br></pre></td></tr></tbody></table></figure><p>自己也可以搭建一个 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2pzZWxiaWUvc3R1bnNlcnZlcg==">STUN Server</a>:</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/jselbie/stunserver</span><br><span class="line">cd stunserver</span><br><span class="line">docker image build -t=stun-server .</span><br><span class="line">docker run -d -p 3478:3478/tcp -p 3478:3478/udp --name=stun-server stun-server</span><br></pre></td></tr></tbody></table></figure><p>使用自建服务器</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pystun3 -d -H [STUN Server 服务的域名或 IP] -P {STUN Server 的端口号}</span><br></pre></td></tr></tbody></table></figure><p>如果你做 <strong>WebRTC</strong> 相关工作的开发, 那么 <a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL3ByYWR0Mi9hbHdheXMtb25saW5lLXN0dW4=">Always Online: STUN servers</a> 这个开源项目可以关注一下.</p><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9tcC53ZWl4aW4ucXEuY29tL3MvblFCUmhmWnV1ZlBCNzJfakdEWFF3Zw==">42 张图详解 NAT : 换个马甲就能上网</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC82ODAzNw==">家庭网络中的「NAT」到底是什么？</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC82NDQzMA==">入网指南 04 | IP 地址大揭秘 - 少数派</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC82MjQwMg==">局域网游戏串流：让我们都做一回「云」玩家 - 少数派</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC82NDY4OA==">小白也能看懂的网络基础 04 | IP 地址是如何工作的 - 少数派</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC82NTQyOA==">小白也能看懂的网络基础 05 | IP 地址深度学习 - 少数派</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zc3BhaS5jb20vcG9zdC82NTQ3MA==">小白也能看懂的网络基础 07 | TCP 和 UDP 是如何工作的？ - 少数派</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9jaGVuaGUubWUvcG9zdC9uYXQtdHlwZQ==">NAT 科普与类型提升</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU0JUJBJTkyJUU4JTgxJTk0JUU3JUJEJTkxJUU3JUJEJTkxJUU1JTg1JUIzJUU4JUFFJUJFJUU1JUE0JTg3JUU1JThEJThGJUU4JUFFJUFF">互联网网关设备协议 - 维基百科, 自由的百科全书</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvTkFUJUU3JUFCJUFGJUU1JThGJUEzJUU2JTk4JUEwJUU1JUIwJTg0JUU1JThEJThGJUU4JUFFJUFF">NAT 端口映射协议 - 维基百科, 自由的百科全书</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9zdXBwb3J0Lnhib3guY29tL3poLUNOL2hlbHAvaGFyZHdhcmUtbmV0d29yay9jb25uZWN0LW5ldHdvcmsveGJveC1vbmUtbmF0LWVycm9y">解决 NAT 错误和多人游戏问题 | Xbox Support</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9kYXRhdHJhY2tlci5pZXRmLm9yZy9kb2MvaHRtbC9yZmM2ODg3">Port Control Protocol (PCP) - RFC6887</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly90YWlsc2NhbGUuY29tL2Jsb2cvaG93LW5hdC10cmF2ZXJzYWwtd29ya3M=">How NAT traversal works · Tailscale</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly90YWlsc2NhbGUuY29tL2Jsb2cvaG93LXRhaWxzY2FsZS13b3Jrcw==">How Tailscale works · Tailscale</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly93d3cuY2hyb21pdW0ub3JnL3F1aWMv">QUIC, a multiplexed transport over UDP - The Chromium Projects</a></li><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/goto.html?u=aHR0cHM6Ly9naXRodWIuY29tL2JsYW5ib29tL2F3ZXNvbWUtaG9tZS1uZXR3b3JraW5nLWNu">awesome-home-networking-cn</a></li></ul><p><strong>相关文章:</strong></p><ol><li><a href="/posts/15433dee.html">先导篇</a>：我的 HomeLab 概要;</li><li><a href="/posts/1c3b04a.html">硬件篇</a>：介绍我所拥有的硬件设备;</li><li><a href="/posts/e537d446.html">网络篇</a>：包括网络环境、异地组网与网络安全;</li><li><a href="/posts/b2341239.html">服务篇</a>：使用 Docker 搭建的各类服务;</li><li><a href="/posts/b808f350.html">数据篇</a>：包括数据存储方案、备份方案和数据恢复方案;</li><li><a href="/posts/273b6766.html">HomeLab数据同步：构建高效的数据同步网络</a></li><li><a href="/posts/6c25aa66.html">HomeLab数据备份：打造坚实的数据安全防线</a></li><li><a href="/posts/7e09e56.html">HomeLab 网络续集：升级 10G 网络-再战 10 年</a></li><li><a href="/posts/15433dee.html">NAT 内网穿透详解：揭秘网络连接背后的奥秘</a></li></ol></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar1.webp" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" title="头像" alt="头像"></a><div class="post-copyright__author_name">dong4j</div><div class="post-copyright__author_desc">岁月静好，诗酒趁年华🍺</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.dong4j.site/posts/46fb4e89.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl(&quot;https://blog.dong4j.site/posts/46fb4e89.html&quot;)">NAT 内网穿透详解：揭秘网络连接背后的奥秘</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/wechat-pay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/wechat-pay.webp" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.dong4j.site/source/image/alipay.webp" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/alipay.webp" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display:none"></div><div class="reward-link mode"><a class="reward-link-button" href="/wechat/"><i class="anzhiyufont anzhiyu-icon-plant-fill"></i>运营模式与责任</a></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.dong4j.site/posts/46fb4e89.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=NAT 内网穿透详解：揭秘网络连接背后的奥秘&amp;url=https://blog.dong4j.site/posts/46fb4e89.html&amp;pic=https://cdn.dong4j.site/source/image/20241229154732_ygRx9mbO.webp" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl(){var e=window.location.href,t=document.createElement("input");t.setAttribute("value",e),document.body.appendChild(t),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),document.body.removeChild(t)}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div><div class="share-link follow"><div class="share-button" id="post-share-url" title="订阅" onclick="icat.showFollowBox()"><i class="anzhiyufont anzhiyu-icon-rss"></i></div></div></div></div></div><div class="submit-box display"><form id="follow" action="https://api.follow.it/subscription-form/b29peEszNWYzK3FQbEw2dVlITEJMZ2pQRXh2dWRLVDE3SC96eFhRaGwwQWprcXpYYUp0NGFWemxVZllXRGU4Nm4yenNGSzNpV3l0Z1EwQzBXQU5xTG9pZWNzVCt5YWptWUt6TXppRXVXMXZxQTRZOGQ0NUVDRlRFOUYxSHMzMEJ8NmlodHY1VWhDQVZBaG8wM0pSV2pXSjdTNGRWS1o0RDVZbE11KzlEeWhuZz0=/8" method="post" target="_blank"><div class="follow-it-form-subscribe" style="position:relative"><div class="heading"><h5 style="font-weight:700;text-align:center">订阅本站文章：</h5></div><div class="input-field"><input type="email" id="email-input" name="email" placeholder="填入您的邮箱地址" spellcheck="false" oninput="validateEmail()"></div><div class="submit-button"><button type="submit" id="submit-button" onclick="ga(&quot;send&quot;,&quot;event&quot;,&quot;Form&quot;,&quot;Submit&quot;,&quot;Affiliate&quot;)" style="font-weight:700;font-size:14px;text-align:center" disabled="">确认订阅</button></div></div></form><style>#email-input{font-size:16px;font-weight:700;padding:10px;border:2px solid #ccc;border-radius:5px;width:100%;box-sizing:border-box}#email-input:focus{outline:0}#email-input.valid{border-color:green}#email-input.invalid{border-color:red}</style><script>function validateEmail(){var s=document.getElementById("email-input"),a=document.getElementById("submit-button"),e=s.value;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(a.disabled=!1,s.classList.add("valid"),s.classList.remove("invalid")):(a.disabled=!0,s.classList.add("invalid"),s.classList.remove("valid"))}</script></div><script>var icat={showFollowBox:function(){var s=document.querySelector(".submit-box");s.classList.contains("display")?s.classList.remove("display"):s.classList.add("display")}}</script><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.dong4j.site" target="_blank">司机带你开车</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/homelab-%E4%B8%AD%E5%B9%B4%E7%94%B7%E4%BA%BA%E7%9A%84%E5%BF%AB%E4%B9%90%E6%BA%90%E6%B3%89/"><span class="categoryes-punctuation"><i class="anzhiyufont anzhiyu-icon-inbox"></i></span>HomeLab:中年男人的快乐源泉<span class="categoryesPageCount">15</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/homelab/"><span class="tags-punctuation"><i class="anzhiyufont anzhiyu-icon-tag"></i></span>HomeLab<span class="tagsPageCount">17</span></a><a class="post-meta__box__tags" href="/tags/nat/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>NAT<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/ipv4/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>IPv4<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/ipv6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>IPv6<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络地址转换<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/napt/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>NAPT<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>内网穿透<span class="tagsPageCount">1</span></a></div></div><div class="post_share"><div class="addtoany"><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_button_facebook a2a_counter"></a><a class="a2a_button_x"></a><a class="a2a_button_threads"></a><a class="a2a_button_pocket"></a><a class="a2a_button_email"></a><a class="a2a_button_sms"></a><a class="a2a_dd" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.addtoany.com/share"></a></div></div><script async="" src="https://static.addtoany.com/menu/page.js"></script><script>var a2a_config=a2a_config||{};a2a_config.templates=a2a_config.templates||{},a2a_config.templates.email={subject:"来自 dong4j 的分享: ${title}",body:"一篇有意思的博文:\n${link}"},a2a_config.templates.sms={body:"给你分享一篇有意思的博客:\n${title}\n${link}"}</script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/e537d446.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_xLHg6epx.webp" onerror="onerror=null,src=&quot;/img/404.webp&quot;" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">HomeLab 网络篇：互联世界-构建高效的自托管网络环境</div></div></a></div><div class="next-post pull-right"><a href="/posts/b2341239.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_hoB1PW2R.webp" onerror="onerror=null,src=&quot;/img/404.webp&quot;" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">HomeLab 服务篇：自托管的乐趣-探索和创造个人云端世界的旅程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size:1.5rem;margin-right:4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?mg3iapx4" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-15</div><div class="title">Ubuntu 使用备忘录：好记性不如烂笔头</div></div></a></div><div><a href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?eb4q02fh" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-13</div><div class="title">使用 Cloudflare 增强公网服务安全性的实践</div></div></a></div><div><a href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?po6ikv1j" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-12</div><div class="title">Ubuntu 系统下 LCD4Linux 的安装与配置指南</div></div></a></div><div><a href="/posts/ded15d16.html" title="捡垃圾的快乐：因为一张显卡组装了一台服务器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?esvhtge1" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-02-10</div><div class="title">捡垃圾的快乐：因为一张显卡组装了一台服务器</div></div></a></div><div><a href="/posts/adc3ac9e.html" title="哪吒面板配置指南：自托管与安全防控详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?minsr8vl" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-01-21</div><div class="title">哪吒面板配置指南：自托管与安全防控详解</div></div></a></div><div><a href="/posts/7e09e56.html" title="HomeLab 网络续集：升级 10G 网络-再战 10 年"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/20241229154732_0ssj32bq.webp" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-12-01</div><div class="title">HomeLab 网络续集：升级 10G 网络-再战 10 年</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)" rel="external nofollow noreferrer">匿名评论</a><a href="/privacy" style="margin-left:4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" onerror="this.onerror=null,this.src=&quot;/img/friend_404.gif&quot;" alt="avatar"><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/coding.gif" alt="status"></div></div><div class="author-info__description"><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">这有关于<b style="color:#fff">产品、设计、开发</b>相关的问题和看法，还有<b style="color:#fff">文章翻译</b>和<b style="color:#fff">分享</b>。</div><div style="line-height:1.38;margin:.6rem 0;text-align:justify;color:rgba(255,255,255,.8)">相信你可以在这里找到对你有用的<b style="color:#fff">知识</b>和<b style="color:#fff">教程</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">dong4j</h1><div class="author-info__desc">岁月静好，诗酒趁年华 🍺</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/dong4j" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fa-brands fa-github faa-tada"></i></a><a class="social-icon faa-parent animated-hover" href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fa-solid fa-at faa-tada"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content"><div style="display:flex;align-items:center"><span>👋🏻 Hi，欢迎来到我的博客~</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mario.gif" width="40"></div><span>❓ 如有问题欢迎评论区交流！🎉</span><br><span>😫 页面异常？试试<kbd>Ctrl</kbd>+<kbd>F5</kbd>🙉</span><br><span>📧 如需联系：<a href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer"><b>发邮件给我吧 🚀</b></a></span><div id="welcome-info"></div><a id="my-card-info-btn" href="/subscribe/" data-pjax-state=""><i class="anzhiyufont anzhiyu-icon-rss"></i><span>订阅本站</span></a></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background:url(https://cdn.dong4j.site/source/image/63c02edf44033.webp) center center/100% no-repeat"></div><div class="back face" style="background:url(https://cdn.dong4j.site/source/image/645fa415e8694.webp) center center/100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%B8%8E%E7%94%B1%E6%9D%A5"><span class="toc-number">1.1.</span> <span class="toc-text">背景与由来</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-IPv4-%E5%9C%B0%E5%9D%80%E6%9E%AF%E7%AB%AD%E9%97%AE%E9%A2%98"><span class="toc-number">1.1.1.</span> <span class="toc-text">1. IPv4 地址枯竭问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%E9%9C%80%E6%B1%82"><span class="toc-number">1.1.2.</span> <span class="toc-text">2. 私有网络需求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-NAT-%E7%9A%84%E8%AF%9E%E7%94%9F"><span class="toc-number">1.1.3.</span> <span class="toc-text">3. NAT 的诞生</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAT-%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">NAT 的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAT-%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">NAT 的类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E5%8F%91%E5%B1%95"><span class="toc-number">1.4.</span> <span class="toc-text">后续发展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">NAT 的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">发送流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%B5%81%E7%A8%8B"><span class="toc-number">3.2.</span> <span class="toc-text">响应流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAPT-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">NAPT 的工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAPT-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">NAPT 原理解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8C%85%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B"><span class="toc-number">4.3.</span> <span class="toc-text">数据包传输流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ping-%E5%91%BD%E4%BB%A4"><span class="toc-number">4.4.</span> <span class="toc-text">Ping 命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F"><span class="toc-number">5.</span> <span class="toc-text">内网穿透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-2"><span class="toc-number">5.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B3%E6%97%B6%E9%80%9A%E8%AE%AF%E8%BD%AF%E4%BB%B6%E7%9A%84%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="toc-number">5.2.</span> <span class="toc-text">即时通讯软件的网络通信机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%82%B9%E5%AF%B9%E7%82%B9-P2P-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="toc-number">5.3.</span> <span class="toc-text">点对点 (P2P) 网络通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP-%E6%89%93%E6%B4%9E%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">5.4.</span> <span class="toc-text">UDP 打洞的局限性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT-%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">NAT 类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">6.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC-NAT-%E4%B8%8E-NAPT"><span class="toc-number">6.2.</span> <span class="toc-text">基本 NAT 与 NAPT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC-NAT"><span class="toc-number">6.2.1.</span> <span class="toc-text">基本 NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NAPT"><span class="toc-number">6.2.2.</span> <span class="toc-text">NAPT</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%A5%E5%9E%8B-NAT-%E5%88%86%E7%B1%BB"><span class="toc-number">6.3.</span> <span class="toc-text">锥型 NAT 分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E5%85%A8%E5%9C%86%E9%94%A5%E4%BD%93-NAT"><span class="toc-number">6.3.1.</span> <span class="toc-text">完全圆锥体 NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%97%E9%99%90%E5%88%B6%E7%9A%84%E5%9C%86%E9%94%A5%E4%BD%93-NAT"><span class="toc-number">6.3.2.</span> <span class="toc-text">受限制的圆锥体 NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%8F%97%E9%99%90%E5%88%B6%E7%9A%84%E5%9C%86%E9%94%A5%E4%BD%93-NAT"><span class="toc-number">6.3.3.</span> <span class="toc-text">端口受限制的圆锥体 NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">6.3.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAT-%E7%B1%BB%E5%9E%8B%E6%80%BB%E7%BB%93"><span class="toc-number">6.4.</span> <span class="toc-text">NAT 类型总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT-%E7%B1%BB%E5%9E%8B%E6%8F%90%E5%8D%87"><span class="toc-number">7.</span> <span class="toc-text">NAT 类型提升</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8E%E5%BB%B6%E8%BF%9F%E6%96%B9%E6%A1%88"><span class="toc-number">7.1.</span> <span class="toc-text">低延迟方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">7.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UPnP"><span class="toc-number">8.</span> <span class="toc-text">UPnP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DMA"><span class="toc-number">9.</span> <span class="toc-text">DMA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">10.</span> <span class="toc-text">端口映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B-NAT-%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.</span> <span class="toc-text">检测 NAT 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">12.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/13e613ba.html" title="Proxmox VE 8.3 安装与配置指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?34n7j520" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Proxmox VE 8.3 安装与配置指南"></a><div class="content"><a class="title" href="/posts/13e613ba.html" title="Proxmox VE 8.3 安装与配置指南">Proxmox VE 8.3 安装与配置指南</a><time datetime="2025-02-17T11:52:42.000Z" title="发表于 2025-02-17 19:52:42">2025-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?mg3iapx4" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Ubuntu 使用备忘录：好记性不如烂笔头"></a><div class="content"><a class="title" href="/posts/91f73d3b.html" title="Ubuntu 使用备忘录：好记性不如烂笔头">Ubuntu 使用备忘录：好记性不如烂笔头</a><time datetime="2025-02-15T06:37:31.000Z" title="发表于 2025-02-15 14:37:31">2025-02-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?eb4q02fh" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="使用 Cloudflare 增强公网服务安全性的实践"></a><div class="content"><a class="title" href="/posts/5fa20a9e.html" title="使用 Cloudflare 增强公网服务安全性的实践">使用 Cloudflare 增强公网服务安全性的实践</a><time datetime="2025-02-12T16:17:11.000Z" title="发表于 2025-02-13 00:17:11">2025-02-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?po6ikv1j" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="Ubuntu 系统下 LCD4Linux 的安装与配置指南"></a><div class="content"><a class="title" href="/posts/b0f649a0.html" title="Ubuntu 系统下 LCD4Linux 的安装与配置指南">Ubuntu 系统下 LCD4Linux 的安装与配置指南</a><time datetime="2025-02-12T11:35:45.000Z" title="发表于 2025-02-12 19:35:45">2025-02-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c78c58c7.html" title="树莓派与移远EC20 4G网卡集成及自动拨号方案解析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://api.dong4j.ink:1024/cover?56t44pn3" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" alt="树莓派与移远EC20 4G网卡集成及自动拨号方案解析"></a><div class="content"><a class="title" href="/posts/c78c58c7.html" title="树莓派与移远EC20 4G网卡集成及自动拨号方案解析">树莓派与移远EC20 4G网卡集成及自动拨号方案解析</a><time datetime="2025-02-12T06:55:16.000Z" title="发表于 2025-02-12 14:55:16">2025-02-12</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" href="mailto:dong4j@gmail.com" rel="external nofollow noreferrer" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://weibo.com/u/1884084142" title="微博"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.facebook.com/dsj.array" title="facebook"><i class="anzhiyufont anzhiyu-icon-facebook1"></i></a><a class="deal_link" href="/atom.xml" title="RSS"><i class="anzhiyufont anzhiyu-icon-rss"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0,500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/avatar.webp" size="50px"><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://space.bilibili.com/1835978167" title="Bilibili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a><a class="deal_link" target="_blank" rel="noopener external nofollow noreferrer" href="https://v.douyin.com/iUqoRYwb/" title="抖音"><i class="anzhiyufont anzhiyu-icon-tiktok"></i></a><a class="deal_link" href="/copyright" title="CC"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i></a></div><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener external nofollow noreferrer" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.travellings.cn/go.html">开往</a><a class="footer-item" title="服务状态" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services">服务状态</a></div></div><div class="footer-group"><div class="footer-title">项目</div><div class="footer-links"><a class="footer-item" title="Watt.Stack" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack">Watt.Stack</a><a class="footer-item" title="MIK" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit">MIK</a><a class="footer-item" title="macOS.dev" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev">macOS.dev</a><a class="footer-item" title="更多" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.ink:1024/">更多</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="我的装备" href="/equipment/">我的装备</a><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title">协议</div><div class="footer-links"><a class="footer-item" title="隐私协议" href="/privacy/">隐私协议</a><a class="footer-item" title="Cookies" href="/cookies/">Cookies</a><a class="footer-item" title="版权协议" href="/copyright/">版权协议</a><a class="footer-item" title="更新日志" href="/update/">更新日志</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" rel="external nofollow noreferrer" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://nonbot.org/pledged/view/9e6e360a-4834-4dd0-b672-845baa0eb4de" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="Made By Humans" title="Made By Humans"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nonbot_pledged_logo.svg" alt="Made By Humans"></a><a class="github-badge" target="_blank" href="https://notbyai.fyi/cn/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="Not By AI" title="Not By AI"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/written-by-human-not-by-ai-white.svg" alt="Not By AI"></a><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"></a><a class="github-badge" target="_blank" href="https://github.com/dong4j" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div><div id="footer-bar"><div class="footer-bar-links"><footer-bar-left><div id="footer-bar-tips"><div class="copyright" style="display:flex;align-items:center;gap:10px">©2013 - 2025 By <a class="footer-bar-link" href="/" title="dong4j" target="_blank">dong4j</a><span class="indicator" id="indicator" style="display:inline-block;width:8px;height:8px;border-radius:50%;background-color:green;margin-left:0;animation:subtle-breathing 1.2s infinite;box-shadow:0 0 5px rgba(255,0,0,.8)"></span><span>在线人数:</span><span id="online_user" style="font-size:1em;font-weight:700">1</span></div></div><div id="footer-type-tips"></div></footer-bar-left><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://beian.miit.gov.cn/" title="蜀ICP备2025119258号">蜀ICP备2025119258号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">258</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">1094</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">18</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.dong4j.site" title="个人主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/homepage.webp" alt="个人主页"><span class="back-menu-item-text">个人主页</span></a><a class="back-menu-item" href="https://blog.dong4j.site" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/blog.webp" alt="博客"><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://resume.dong4j.site" title="简历"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/resume.webp" alt="简历"><span class="back-menu-item-text">简历</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://npx-card.dong4j.site" title="npx-card"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/npx-card.webp" alt="npx-card"><span class="back-menu-item-text">npx-card</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/watt-stack" title="Watt.Stack"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/watt.webp" alt="Watt.Stack"><span class="back-menu-item-text">Watt.Stack</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/markdown-image-kit" title="MIK"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mik.webp" alt="MIK"><span class="back-menu-item-text">MIK</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/dong4j/macOS-dev" title="macOS.dev"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/mac.webp" alt="macOS.dev"><span class="back-menu-item-text">macOS.dev</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://project.dong4j.site/" title="更多"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/project.webp" alt="更多"><span class="back-menu-item-text">更多</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">服务</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://uptime.dong4j.dev/status/services" title="服务状态"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/uptime-kuma.svg" alt="服务状态"><span class="back-menu-item-text">服务状态</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nezha.dong4j.dev" title="服务面板"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nezha.webp" alt="服务面板"><span class="back-menu-item-text">服务面板</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://nav.dong4j.dev" title="导航页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/nav.webp" alt="导航页"><span class="back-menu-item-text">导航页</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://umami.dong4j.ink:1024/share/V7Rat8DdVw4npjl2/blog.dong4j.site" title="Umami"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/umami.webp" alt="Umami"><span class="back-menu-item-text">Umami</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://muselink.cc/dong4j 👈这是我的MuseLink数字名片！" title="数字名片"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/muse.lin.webp" alt="数字名片"><span class="back-menu-item-text">数字名片</span></a><a class="back-menu-item" href="/ai/deepseek-r1-webgpu/" title="DeepSeek"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/deepseek.webp" alt="DeepSeek"><span class="back-menu-item-text">DeepSeek</span></a><a class="back-menu-item" href="/ai/rmbg/playground/" title="RMBG"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/rmbg.webp" alt="RMBG"><span class="back-menu-item-text">RMBG</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://chat.dong4j.site/" title="Mini-Chat"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.webp&quot;" data-lazy-src="https://cdn.dong4j.site/source/image/emoji1.webp" alt="Mini-Chat"><span class="back-menu-item-text">Mini-Chat</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size:.9em"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size:.9em"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size:.9em"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size:.9em"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size:.9em"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size:.9em"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size:.9em"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><i class="anzhiyufont anzhiyu-icon-bilibili faa-tada" style="font-size:.9em"></i><span> 追番页</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size:.9em"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/messages/"><i class="fa fa-comments faa-tada"></i><span> 最新评论</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><i class="fa fa-line-chart faa-tada"></i><span> 统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/equipment/"><i class="anzhiyufont anzhiyu-icon-dice-d20 faa-tada" style="font-size:.9em"></i><span> 我的装备</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/memos/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size:.9em"></i><span> 备忘录</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/todolist/"><i class="fa-solid fa-map faa-tada"></i><span> 折腾清单</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/stars/"><i class="fa-brands fa-github faa-tada"></i><span> Star 清单</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.dong4j.dev"><span>小黑屋</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span>关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size:.9em"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size:.9em"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size:.9em"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/java/" style="font-size:.88rem;color:#556363;font-weight:500;color:var(--anzhiyu-lighttext)">Java<sup>48</sup></a><a href="/tags/final/" style="font-size:.88rem;color:#678a45">final<sup>2</sup></a><a href="/tags/finalize/" style="font-size:.88rem;color:#c069bc">finalize<sup>1</sup></a><a href="/tags/finally/" style="font-size:.88rem;color:#714840">finally<sup>2</sup></a><a href="/tags/new%E5%85%B3%E9%94%AE%E5%AD%97/" style="font-size:.88rem;color:#197f3d">new关键字<sup>1</sup></a><a href="/tags/static/" style="font-size:.88rem;color:#704a0d">static<sup>1</sup></a><a href="/tags/super/" style="font-size:.88rem;color:#338051">super<sup>2</sup></a><a href="/tags/this/" style="font-size:.88rem;color:#a224a6">this<sup>1</sup></a><a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" style="font-size:.88rem;color:#334e6b">二进制<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size:.88rem;color:#2dbd22">数据类型<sup>4</sup></a><a href="/tags/%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95/" style="font-size:.88rem;color:#b7640c">构造方法<sup>1</sup></a><a href="/tags/%E6%BA%A2%E5%87%BA/" style="font-size:.88rem;color:#0b6ab5">溢出<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size:.88rem;color:#0e1424">算法<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/" style="font-size:.88rem;color:#000592">编程实践<sup>2</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F/" style="font-size:.88rem;color:#56b352">计算机程序<sup>1</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%AF%AD%E8%A8%80/" style="font-size:.88rem;color:#8a3737">计算机语言<sup>1</sup></a><a href="/tags/%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6/" style="font-size:.88rem;color:#a03027">访问控制<sup>1</sup></a><a href="/tags/%E8%BD%AF%E4%BB%B6/" style="font-size:.88rem;color:#0d6442">软件<sup>1</sup></a><a href="/tags/%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/" style="font-size:.88rem;color:#c753c8">错误处理<sup>2</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size:.88rem;color:#c14483">面向对象<sup>6</sup></a></div></div><hr></div></div><div id="keyboard-tips"><div class="keyboardTitle">博客快捷键</div><div class="keybordList"><div class="keybordItem"><div class="keyGroup"><div class="key">shift K</div></div><div class="keyContent"><div class="content">关闭快捷键功能</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift A</div></div><div class="keyContent"><div class="content">打开/关闭中控台</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift M</div></div><div class="keyContent"><div class="content">播放/暂停音乐</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift D</div></div><div class="keyContent"><div class="content">深色/浅色显示模式</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift S</div></div><div class="keyContent"><div class="content">站内搜索</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift R</div></div><div class="keyContent"><div class="content">随机访问</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift H</div></div><div class="keyContent"><div class="content">返回首页</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift F</div></div><div class="keyContent"><div class="content">友链鱼塘</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift L</div></div><div class="keyContent"><div class="content">友链页面</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift P</div></div><div class="keyContent"><div class="content">关于本站</div></div></div><div class="keybordItem"><div class="keyGroup"><div class="key">shift I</div></div><div class="keyContent"><div class="content">原版/本站右键菜单</div></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="anzhiyufont anzhiyu-icon-comment-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" rel="external nofollow noreferrer" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="anzhiyu.scrollToDest(document.body.scrollHeight,500)"><i class="anzhiyufont anzhiyu-icon-arrow-down"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size:1rem"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display:none"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/medium-zoom@1.1.0/dist/medium-zoom.min.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn(){"object"==typeof pangu?pangu.autoSpacingPage():getScript("https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js").then(()=>{pangu.autoSpacingPage()})}function panguInit(){panguFn()}document.addEventListener("DOMContentLoaded",panguInit)</script><script>var HoldLog=console.log;console.log=function(){};let now1=new Date;queueMicrotask(()=>{function o(){HoldLog.apply(console,arguments)}var c=new Date("6/28/2018 00:00:00"),c=(now1.setTime(now1.getTime()+250),(now1-c)/1e3/60/60/24),c=["Hi there 👋，I'm dong4j, Welcome to my blog","岁月静好，诗酒趁年华🍺",`
        
      +========================================================+
      |  ██████╗  ██████╗ ███╗   ██╗ ██████╗ ██╗  ██╗     ██╗  |
      |  ██╔══██╗██╔═══██╗████╗  ██║██╔════╝ ██║  ██║     ██║  |
      |  ██║  ██║██║   ██║██╔██╗ ██║██║  ███╗███████║     ██║  |
      |  ██║  ██║██║   ██║██║╚██╗██║██║   ██║╚════██║██   ██║  |
      |  ██████╔╝╚██████╔╝██║ ╚████║╚██████╔╝     ██║╚█████╔╝  |
      |  ╚═════╝  ╚═════╝ ╚═╝  ╚═══╝ ╚═════╝      ╚═╝ ╚════╝   |
      +========================================================+
        
        `,"已上线",Math.floor(c),"天","Use 「npx dong4j」 and find me."],e=["NCC2-036","调用前置摄像头拍照成功，识别为【绝顶大佬】.","Photo captured: ","🤪"];setTimeout(o.bind(console,`
%c${c[0]} %c ${c[1]} %c ${c[2]} %c${c[3]}%c ${c[4]}%c ${c[5]}

%c ${c[6]}
`,"color:#425AEF","","color:#425AEF","color:#425AEF","","color:#425AEF","")),setTimeout(o.bind(console,`%c ${e[0]} %c ${e[1]} %c 
${e[2]} %c
${e[3]}
`,"color:white; background-color:#4fd953","","",'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%')),setTimeout(o.bind(console,"%c WELCOME %c 你好，绝顶大佬.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c ⚡ Powered by 安知鱼 %c 你正在访问 dong4j 的博客.","color:white; background-color:#f0ad4e","")),setTimeout(o.bind(console,"%c W23-12 %c 你已打开控制台.","color:white; background-color:#4f90d9","")),setTimeout(console.warn.bind(console,"%c S013-782 %c 你现在正处于监控中.","color:white; background-color:#d9534f",""))})</script><script async="" src="/anzhiyu/random.js"></script><script async="">(()=>{var n,o,r,a,i,e=new Date("6/28/2018 00:00:00"),l=new Date;setInterval(()=>{var t;if(l=new Date,i=l.getHours(),t=(l-e)/1e3/60/60/24,n=Math.floor(t),t=(l-e)/1e3/60/60-24*n,o=Math.floor(t),1==String(o).length&&(o="0"+o),t=(l-e)/1e3/60-1440*n-60*o,r=Math.floor(t),1==String(r).length&&(r="0"+r),t=(l-e)/1e3-86400*n-3600*o-60*r,a=Math.round(t),1==String(a).length&&(a="0"+a),document.getElementById("footer")){let e="";e=(i<18&&9<=i||null!=(t=document.querySelector("#workboard .workSituationImg"))&&(t.src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg",t.title="下班了就该开开心心的玩耍，嘿嘿~",t.alt="下班了就该开开心心的玩耍，嘿嘿~"),`本站居然运行了 ${n} 天<span id='runtime'> ${o} 小时 ${r} 分 ${a} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`),document.getElementById("runtimeTextTip")&&(document.getElementById("runtimeTextTip").innerHTML=e)}},1e3)})()</script><script src="https://cdn.cbd.int/algoliasearch@4.18.0/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.cbd.int/instantsearch.js@4.60.0/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><div class="js-pjax"><script>(()=>{let t=document.querySelectorAll("#article-container .mermaid-wrap");if(0!==t.length){let e=()=>{window.loadMermaid=!0;let a="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(t).forEach((e,t)=>{let d=e.firstElementChild;e="%%{init:{ 'theme':'"+a+"'}}%%\n"+d.textContent;let n=mermaid.render("mermaid-"+t,e);"string"==typeof n?(t=n,d.insertAdjacentHTML("afterend",t)):n.then(({svg:e})=>{d.insertAdjacentHTML("afterend",e)})})};var d=()=>{window.loadMermaid?e():getScript("https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js").then(e)};anzhiyu.addGlobalFn("themeChange",e,"mermaid"),window.pjax?d():document.addEventListener("DOMContentLoaded",d)}})()</script><script>(()=>{let t=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://twikoo.dong4j.ink:1024",region:"",onCommentLoaded:()=>{anzhiyu.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null))};var o=()=>{"object"==typeof twikoo?setTimeout(n,0):getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(n)};let e=()=>{let o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://twikoo.dong4j.ink:1024",region:"",urls:[window.location.pathname],includeReply:!1}).then(t=>{o.textContent=t[0].count}).catch(t=>{console.error(t)})},n=()=>{t(),GLOBAL_CONFIG_SITE.isPost&&e()};o()})()</script><input type="hidden" name="page-type" id="page-type" value="post"><script async="" src="/js/anzhiyu/comment_barrage.js"></script></div><script>window.addEventListener("load",()=>{let t=e=>e=""!==e&&150<(e=(e=(e=(e=e.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[图片]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[链接]")).replace(/<pre><code>.*?<\/pre>/gi,"[代码]")).replace(/<[^>]+>/g,"")).length?e.substring(0,150)+"...":e,n=t=>{let n="";if(t.length)for(let e=0;e<t.length;e++)n=(n=(n+="<div class='aside-list-item'>")+`<a href='${t[e].url}' class='thumbnail'><img data-lazy-src='${t[e].avatar}' alt='${t[e].nick}'><div class='name'><span>${t[e].nick} </span></div></a>`)+`<div class='content'>
        <a class='comment' href='${t[e].url}' title='${t[e].content}'>${t[e].content}</a>
        <time datetime="${t[e].date}">${anzhiyu.diffDate(t[e].date,!0)}</time></div>
        </div>`;else n+="没有评论";var e=document.querySelector("#card-newest-comments .aside-list");e&&(e.innerHTML=n),window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(e)};var e=()=>{var e;document.querySelector("#card-newest-comments .aside-list")&&((e=saveToLocal.get("twikoo-newest-comments"))?n(JSON.parse(e)):(e=()=>{twikoo.getRecentComments({envId:"https://twikoo.dong4j.ink:1024",region:"",pageSize:6,includeReply:!0}).then(function(e){e=e.map(e=>({content:t(e.comment),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.id,date:new Date(e.created).toISOString()}));saveToLocal.set("twikoo-newest-comments",JSON.stringify(e),10/1440),n(e)}).catch(function(e){document.querySelector("#card-newest-comments .aside-list").textContent="无法获取评论，请确认相关配置是否正确"})},"object"==typeof twikoo?e():getScript("https://cdn.cbd.int/twikoo@1.6.39/dist/twikoo.all.min.js").then(e)))};e(),document.addEventListener("pjax:complete",e)})</script><script>var visitorMail="996@icu.com"</script><script async="" data-pjax="" src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/subscribe.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/card-widget-today.css" media="print" onload="this.media=&quot;all&quot;"><link rel="stylesheet" href="https://cdn.dong4j.site/source/static/card-widget-calendar.css" media="print" onload="this.media=&quot;all&quot;"><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/automatic-redirection.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-welcome.js"></script><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/card-widget-comments.js"></script><script async="" data-pjax="" src="https://cdn.dong4j.site/source/static/card-widget-today.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-countdown.js"></script><script src="https://cdn.dong4j.site/source/static/card-widget-calendar.js"></script><script async="" data-pjax="" src="https://open.lightxi.com/unpkg/chinese-lunar@0.1.4/lib/chinese-lunar.js"></script><script async="" data-pjax="" src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script src="https://cdn.dong4j.site/source/static/custom.js"></script><script src="https://cdn.dong4j.site/source/static/geoip2-check.js"></script><script defer="" id="fluttering_ribbon" mobile="false" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="永不言败,勇往直前,砥砺前行,自强不息,笃行致远,厚德载物,持之以恒,奋发有为,志在四方,拼搏进取,实事求是，为人民服务,勤劳致富，共奔小康,爱国、创新、包容、厚德,敬业乐群，诚信友善,自强不息，厚德载物,以人为本，全面协调可持续发展,建设生态文明，构建和谐社会,坚持改革开放，推动科学发展,立党为公，执政为民,实现中华民族伟大复兴的中国梦" data-fontsize="15px" data-random="true" async=""></script><script src="//code.tidio.co/14aqpkwnauu3r5ngcmspfxwelvattym5.js" async=""></script><script>(()=>{{let i=!1,o=()=>{window.tidioChatApi.hide(),i=!1,document.body.style.position="relative",document.documentElement.style.overflow="auto"};var t=()=>{window.tidioChatApi.hide(),window.tidioChatApi.on("close",o)};window.tidioChatApi?window.tidioChatApi.on("ready",t):document.addEventListener("tidioChat-ready",t),window.chatBtnFn=()=>{window.tidioChatApi&&(i?o():(window.tidioChatApi.open(),window.tidioChatApi.show(),i=!0))}}})()</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media=&quot;all&quot;"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors=['meta[property="og:image"]','meta[property="og:title"]','meta[property="og:url"]','meta[property="og:type"]','meta[property="og:site_name"]','meta[property="og:description"]',"head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",function(){if(anzhiyu.removeGlobalFnEvent("pjax"),anzhiyu.removeGlobalFnEvent("themeChange"),document.getElementById("rightside").classList.remove("rightside-show"),window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();var e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode")}),document.addEventListener("pjax:complete",function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach(e=>{let t=document.createElement("script");var a=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach(e=>t.setAttribute(e.name,e.value)),t.appendChild(document.createTextNode(a)),e.parentNode.replaceChild(t,e)}),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()}),document.addEventListener("pjax:error",e=>{404===e.request.status&&pjax.loadUrl("/404.html")})</script><script async="" data-pjax="" data-prefix="busuanzi_value" src="https://cdn.dong4j.site/source/static/busuanzi.self.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script data-pjax="" src="https://cdn.dong4j.site/source/static/github-calendar.js"></script><script data-pjax="">function GithubCalendarConfig(){var t=document.getElementById("recent-posts");t&&"/"==location.pathname&&(console.log("已挂载hexo-github-calendar https://github.com/Barry-Flynn/hexo-github-calendar"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>')),GithubCalendar("https://github-calendar.dong4j.ink:1024/api?user=dong4j",["#ebedf0","#a2f7af","#6ce480","#54ad63","#469252","#31753c","#1f5f2a","#13531f","#084111","#032b09","#000000"],"dong4j")}document.getElementById("recent-posts")&&GithubCalendarConfig()</script><style>#github_container{min-height:280px}@media screen and (max-width:650px){#github_container{min-height:0}}</style><style></style></body></html>