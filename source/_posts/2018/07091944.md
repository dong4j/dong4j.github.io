---
title: 错误的代码写法
categories:
  - Java
tags:
  - Other
abbrlink: c43d4ea4
date: 2018-07-09 00:00:00
---

整理一下项目中不好的代码写法

![image_source/2018/07091944/1111.png](1111.webp)

以下是一些具有代表性的问题, 都是一些一看就明白的问题, 还有一些代码的坑, 慢慢填吧.

只针对代码, 不针对谁, 如果写的不对的对方, 你咬我啊

## 代码问题

### 还失败重试? 失败重试个啥? 直接返回了 老铁!!

代码 1 后面, 获取了 batchResult, 不应该重新赋值 code 嘛?

代码 2 为修改后

![image_source/2018/07091944/15325189812902.jpg](15325189812902.webp)

### Intellij idea 是个好东西

![image_source/2018/07091944/15325191868917.jpg](15325191868917.webp)
![image_source/2018/07091944/15325192695231.jpg](15325192695231.webp)

修改为:

![image_source/2018/07091944/15325193077721.jpg](15325193077721.webp)

catch 里面使用 printStackTrace(), 错误日志全部输出到 `catalina.out`, 你考虑过 catalina 的感受吗?

**日志问题后面说**

### 这是先斩后奏吗?

前面都调用了 list 的 size 方法, 后面再来判断 list 是否为 null?

这种代码我看见起码不下 10 处, 系统能稳定吗老铁?

![image_source/2018/07091944/15325195481267.jpg](15325195481267.webp)

idea 都知道的问题, 你不应该不知道

![image_source/2018/07091944/15325198758977.jpg](15325198758977.webp)

logger.info 输出问题:

用 `log.info("{}", xxxx)`, 不要自己拼接字符串

### 老铁, 你可长点心吧

![image_source/2018/07091944/15325240857455.jpg](15325240857455.webp)

### 老铁, 我就服你

![image_source/2018/07091944/15325200536825.jpg](15325200536825.webp)

google : logger.error() 正确使用姿势

![image_source/2018/07091944/15325201553323.jpg](15325201553323.webp)

### JDK7 之后的变化

JDK7 之 钻石语法

![image_source/2018/07091944/15325202427415.jpg](15325202427415.webp)
![image_source/2018/07091944/15325202977026.jpg](15325202977026.webp)

### 画蛇添足

value 就是 String 类型了, 写 toString() 是为了练打字吗?

![image_source/2018/07091944/15311368667283.jpg](15311368667283.webp)

### 强迫症可能要急死

看见黄色警告了吗? 知道怎么改吗?

![image_source/2018/07091944/15325212228871.jpg](15325212228871.webp)

![image_source/2018/07091944/15325212784156.jpg](15325212784156.webp)

### 你就告诉我需要多宽的显示器?

老铁, 公司没给配这么宽的显示器啊... 啊, 27 寸的也看不过来啊

**超过 120 列宽必须需要换行**

![image_source/2018/07091944/15325214131546.jpg](15325214131546.webp)

![image_source/2018/07091944/15325214458089.jpg](15325214458089.webp)

**超过 5 个参数, 推荐使用实体类**

### 你还是去写 python 吧

![image_source/2018/07091944/15311374744373.jpg](15311374744373.webp)

### 知道什么叫 util 吗?

![image_source/2018/07091944/15311378124879.jpg](15311378124879.webp)

### Intellij IDEA 都知道会有空指针, 你还这么写?

![image_source/2018/07091944/15311379696500.jpg](15311379696500.webp)

### 不能直接 return 吗? 练打字吗?

![image_source/2018/07091944/15311380540319.jpg](15311380540319.webp)

### 面试题之 String, StringBuilder, StringBuffer

> JDK 5 以后 JVM 对字符串循环拼接的处理方式

![image_source/2018/07091944/15311381199583.jpg](15311381199583.webp)

### 老铁, 类注释, 方法注释呢

**类注释呢?**

**方法注释虽然有, 但是不标准啊, 老铁**

没看见那么多黄色警告吗?

![image_source/2018/07091944/15325219772861.jpg](15325219772861.webp)

**代码规范我们后面说**

![image_source/2018/07091944/15325221233995.jpg](15325221233995.webp)

每个模块都有一个 StringUtil, 还有叫 StringUtils 的

老铁, 写之前先看看能不能复用啊, 或者复制之前, 看是不是已经有了啊.

### 你以为把 DDL 语句拷贝过来就不用写字段注释了吗?

老铁, 你这样骚操作我很为难啊

![image_source/2018/07091944/15325226017793.jpg](15325226017793.webp)

在类上按 F1 看不到类注释啊

![image_source/2018/07091944/15325227597361.jpg](15325227597361.webp)

这样改啊

![image_source/2018/07091944/15325228899844.jpg](15325228899844.webp)

F1 直接看类注释啊, 不用跳转了啊

![image_source/2018/07091944/15325228697589.jpg](15325228697589.webp)

F1 直接看字段注释啊, 不用再去查 DDL 了啊, 不会在蒙圈了啊

![image_source/2018/07091944/15325228196153.jpg](15325228196153.webp)

### 老铁, 不是中文看不懂啊

额, 这个要怪 idea 了, 居然没有默认转换

![image_source/2018/07091944/15325232263464.jpg](15325232263464.webp)

![image_source/2018/07091944/15325233014643.jpg](15325233014643.webp)

老铁, 把 transpartent 打开, 你就认识中文了

![image_source/2018/07091944/15325233990286.jpg](15325233990286.webp)

老铁, 看见黄色警告了? 如果是自己解析配置, 没有处理空白符的话, 又出 bug 了啊.. 啊.

### 老铁, 代码用 UTF-8 啊, 不然要乱码啊

![image_source/2018/07091944/15325253775665.jpg](15325253775665.webp)

全都要 UTF-8 啊, 要跟国际接轨啊

![image_source/2018/07091944/15325254466365.jpg](15325254466365.webp)

### 老铁, 0 是啥, 1 是啥, 2 又是啥啊? 脑壳都大了啊...

定义个常量啊, 常量名用拼音也比没有好啊, 老铁

![image_source/2018/07091944/15325236499284.jpg](15325236499284.webp)

![image_source/2018/07091944/15325235962477.jpg](15325235962477.webp)

### 论 MVC 架构的职责

dao 就是对表的操作, 一个 dao 对应一张表;
service 组合多个 dao 进行业务处理;
controller 做参数检查, 结果封装, 跳转页面;

![image_source/2018/07091944/15311384292902.jpg](15311384292902.webp)

### 你咋不把所有的 sql 都写在一个 xml 里面呢?

![image_source/2018/07091944/15311385097765.jpg](15311385097765.webp)

### 这个也要注入? 也能注入?

😅😂🤣

![image_source/2018/07091944/15311421939156.jpg](15311421939156.webp)

### 多余的 finally

> redis-proxy 已经对 jedis 资源的安全释放做了处理, 不用自己在写这些冗余的代码

![image_source/2018/07091944/15311434304599.jpg](15311434304599.webp)

### catch 里面不要做流程控制, OK?

![image_source/2018/07091944/15311475450147.jpg](15311475450147.webp)

改为

![image_source/2018/07091944/15311950867272.jpg](15311950867272.webp)

### log 输出错误

> 日志的正确使用姿势, 你值得了解一下

推荐去搜一下 log 的正确输出方式.

![image_source/2018/07091944/15311496127819.jpg](15311496127819.webp)

```java
log.error("访问 redis 异常", e);
```

### 做人能不能真诚一点, 写代码能不能简单一点

![image_source/2018/07091944/15311935198608.jpg](15311935198608.webp)

改为:

```java
IavpResponse iavpResponse = HttpUtil.sendPost(inputParams, "gatherkey", Integer.parseInt(timeOut));
if(iavpResponse.getStatusCode() == HttpStatus.SC_OK){
    return XmlConverUtil.readGatherKeyXmlOut(iavpResponse.getContent());
}
```

XmlConverUtil.java

```java
public static List<GatherKeyInfo> readGatherKeyXmlOut(String xml) {
        if(StringUtils.isBlank(xml)){
            return null;
        }
        ...
}
```

### isNotEmpty 和 isNotBlank 的区别知道吗?

![image_source/2018/07091944/15311943295264.jpg](15311943295264.webp)

改为:

![image_source/2018/07091944/15311947889326.jpg](15311947889326.webp)

### 3 行代码搞定的事, 非要写几十行, 练打字吗?

**原始代码**

用于检查是否是会员

```java
public boolean judgeMiguSuperVIP(String caller) {
        boolean VIPReturn = false;
        // isMiguGameMothMember 表示游戏会员状态，1 表示是包月会员，0 表示不是包月会员
        String isMiguGameMothMember = "0";
        try {
            GameAccount gameAccount = miguGameProvider.queryUserInfo(caller);
            if (gameAccount != null) {
                isMiguGameMothMember = gameAccount.getMiguSupperMember();
            } else {
                isMiguGameMothMember = "0";
            }
            if ("1".equals(isMiguGameMothMember)) {
                // 是咪咕超级会员
                VIPReturn = true;
                return VIPReturn;
            } else {
                // 不是咪咕超级会员
                VIPReturn = false;
                return VIPReturn;
            }
        } catch (Exception e) {
            // 查询游戏账号状态异常
            VIPReturn = false;
            return VIPReturn;
        }
    }
```

**重构 1**

删除 boolean VIPReturn

```java
    public boolean judgeMiguSuperVIP(String caller, String type) {
        // isMiguGameMothMember 表示游戏会员状态，1 表示是包月会员，0 表示不是包月会员
        String isMiguGameMothMember = "0";
        try {
            GameAccount gameAccount = miguGameProvider.queryUserInfo(caller, type);
            if (gameAccount != null) {
                isMiguGameMothMember = gameAccount.getMiguSupperMember();
            } else {
                isMiguGameMothMember = "0";
            }
            return "1".equals(isMiguGameMothMember);
        } catch (Exception e) {
            return false;
        }
    }
```

**重构 2**

删除 isMiguGameMothMember

```java
public boolean judgeMiguSuperVIP(String caller, String type) {
        // isMiguGameMothMember 表示游戏会员状态，1 表示是包月会员，0 表示不是包月会员
        try {
            GameAccount gameAccount = miguGameProvider.queryUserInfo(caller, type);
            return gameAccount != null && "1".equals(gameAccount.getMiguSupperMember());
        } catch (Exception e) {
            return false;
        }
    }
```

**重构 3**

queryUserInfo 已经处理的下层抛出的异常, 这里不需要再处理

```java
public boolean judgeMiguSuperVIP(String caller, String type) {
        // isMiguGameMothMember 表示游戏会员状态，1 表示是包月会员，0 表示不是包月会员
        GameAccount gameAccount = miguGameProvider.queryUserInfo(caller, type);
        return gameAccount != null && "1".equals(gameAccount.getMiguSupperMember());
    }
```

## 日志问题

![image_source/2018/07091944/15325258386238.jpg](15325258386238.webp)

### 老铁, 日志输出到文件要用 UTF-8 啊

不然乱码看不懂啊

![image_source/2018/07091944/15325238883862.jpg](15325238883862.webp)

### 老铁, 日志输出能不能统一格式啊?

### 老铁, 日志输出能不能分级别啊?

### 老铁, 日志框架能不能统一使用一个啊?

一会 log4j, 一会 log4j2 的
做人喜新厌旧可以 (log4j2 更新, 效率更好)
但也要专一, 说好放学别走就不能走, 要跑...
说好用 log4j2 + slf4j, 就不要用 System.out.println() OK?

## Maven 问题

### 老铁, 一个模块这么多版本啊, 怎么管理啊

maven 用来管理项目中的依赖关系的, 这个没使用 maven 有什么区别?

![image_source/2018/07091944/15311370387038.jpg](15311370387038.webp)

### 拷贝依赖的时候看没看是不是存在了?

![image_source/2018/07091944/15311371885577.jpg](15311371885577.webp)

### 老铁, 不要只晓得拷贝依赖, 不看看依赖冲突啊

![image_source/2018/07091944/15311372443892.jpg](15311372443892.webp)

## 项目结构问题

### 1000 个人眼里, 有 1000 个哈姆雷特, 1000 个人写代码, 就有 1000 种代码风格

![image_source/2018/07091944/15311372952594.jpg](15311372952594.webp)

## 下一篇 musearch-project 介绍

已经重构的模块

![image_source/2018/07091944/15325262456132.jpg](15325262456132.webp)

```lua
.
├── musicsearch-business            # 业务主模块
│     ├── business-common             # 业务公共类库
│     ├── mservice-migu-game          # migu-game 业务
│     └── service-meeting             # meeting 服务模块
├── musicsearch-common              # musicsearch 项目 公共模块
├── musicsearch-component           # 组件主模块
│     ├── component-iavp              # iavp 模块, 封装 iavp 相关实体和接口, 直接注入即可
│     ├── component-mybatis           # mybatis 模块, 提供代码生成和 mybatis 相关功能
│     ├── component-redis             # redis 模块, 注入 RedisService 即可, 提供多种模式
│     └── component-websocket         # websocket 模块 netty-socket.io 封装
├── musicsearch-demo                # demo 主模块
│     ├── component-mybatis-demo
│     └── component-redis-demo
├── musicsearch-dependencies-bom    # 管理第三方 jar 版本和依赖关系
├── musicsearch-monitor             # 暂定
├── musicsearch-parent              # musicsearch 工程主模块, 管理整个功能的版本及依赖
│     └── docs                        # 放工程相关文档
└── musicsearch-support             # 支撑模块主模块
    ├── musicsearch-code-generator
    ├── musicsearch-management-system
    └── musicsearch-timer-task

```
